<!DOCTYPE html>
<html lang="zh-Hans-CN"><head><meta charset="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=Edge"/><link rel="stylesheet" type="text/css" href="../../../css/modern-norm.min.css"/><link rel="stylesheet" type="text/css" href="../../../css/prism.min.css"/><link rel="stylesheet" type="text/css" href="../../../css/katex.min.css"/><link rel="stylesheet" type="text/css" href="../../../css/wolai.css"/><title>gRPC - wolai 笔记</title><link rel="shortcut icon" href="https://grpc.io/favicon.ico"></link></head><body><header><div class="image"></div><div class="title"><div class="banner"><div class="icon icon-image" style="background-image: url(&quot;https://grpc.io/favicon.ico&quot;)"></div></div><div data-title="gRPC" class="main-title"></div></div></header><article><div class="wolai-block wolai-text"><div><span class="inline-wrap"></span><br/></div></div><h2 class="wolai-block"><span class="inline-wrap">Protobuf</span></h2><div class="wolai-block wolai-text"><div><span class="inline-wrap"><code>protobuf</code></span><span class="inline-wrap"> 是一种跨平台的数据序列化和反序列化机制,  通过</span><span class="inline-wrap"><code>proto</code></span><span class="inline-wrap">文件定义数据结构,  然后使用编译器生成对应语言的代码(数据结构,序列化和反序列化方法)。</span></div></div><h3 class="wolai-block"><span class="inline-wrap">HelloWorld</span></h3><code-block class="wolai-block"><div class="wolai-pre"><div data-lang="Protocol Buffers" class="marker"></div><pre>syntax <span class="token operator">=</span> <span class="token string">"proto3"</span><span class="token punctuation">;</span> <span class="token comment">// 声明proto文件的版本，默认是proto2</span>

message <span class="token maybe-class-name">SearchRequest</span> <span class="token punctuation">{</span>      <span class="token comment">// 定义一种数据结构，里面有三个字段</span>
  string query <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>          <span class="token comment">// 这里的1 2 3 并不是字段的默认值，而是该字段的id</span>
  int32 page_number <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>     <span class="token comment">// 当你这个数据结构已经被人使用了，就不能修改字段的id了</span>
  int32 result_per_page <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span> <span class="token comment">// 否则会导致序列化、反序列化有问题</span>
<span class="token punctuation">}</span>

message <span class="token maybe-class-name">SearchResponse</span> <span class="token punctuation">{</span>
 <span class="token spread operator">...</span>
<span class="token punctuation">}</span>
</pre></div></code-block><h3 class="wolai-block"><span class="inline-wrap">保留字段</span></h3><div class="wolai-block wolai-text"><div><span class="inline-wrap">如果你删除了某些字段，为了避免别人无意中重用了旧字段的<span class="jill"></span>id，你可以声明保留字段来提示别人，这些<span class="jill"></span>id<span class="jill"></span>不能用。</span></div></div><code-block class="wolai-block"><div class="wolai-pre"><div data-lang="Protocol Buffers" class="marker"></div><pre>message <span class="token maybe-class-name">Foo</span> <span class="token punctuation">{</span>
  reserved <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">9</span> to <span class="token number">11</span><span class="token punctuation">;</span>
  reserved <span class="token string">"foo"</span><span class="token punctuation">,</span> <span class="token string">"bar"</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></pre></div></code-block><blockquote class="wolai-block"><span class="inline-wrap">更多内容请看</span><span class="inline-wrap"><a href="https://developers.google.com/protocol-buffers/docs/javatutorial"><span>官方文档</span></a></span></blockquote><h3 class="wolai-block"><span class="inline-wrap">代码生成</span></h3><div class="wolai-block wolai-text"><div><span class="inline-wrap">定义数据结构</span></div></div><code-block class="wolai-block"><div class="wolai-pre"><div data-lang="Protocol Buffers" class="marker"></div><pre>syntax <span class="token operator">=</span> <span class="token string">"proto3"</span><span class="token punctuation">;</span>

<span class="token keyword">package</span> demo<span class="token punctuation">;</span> <span class="token comment">// </span>

option java_package <span class="token operator">=</span> <span class="token string">"com.eason.protobuf.demo"</span><span class="token punctuation">;</span>     <span class="token comment">// java文件的包路径</span>
option java_multiple_files <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>                   <span class="token comment">// 这两行什么玩意...</span>
option java_outer_classname <span class="token operator">=</span> <span class="token string">"Request"</span><span class="token punctuation">;</span>             <span class="token comment">// </span>

message <span class="token maybe-class-name">SearchRequest</span> <span class="token punctuation">{</span>      
  string query <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>          
  int32 page_number <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>     
  int32 result_per_page <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span>
</pre></div></code-block><div class="wolai-block wolai-text"><div><span class="inline-wrap">代码生成</span></div></div><code-block class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre>protoc -I<span class="token operator">=</span>. --java_out<span class="token operator">=</span>. demo.proto
</pre></div></code-block><blockquote class="wolai-block"><span class="inline-wrap">感觉<span class="jill"></span>protobuf<span class="jill"></span>生成的<span class="jill"></span>Java<span class="jill"></span>实体类有点阴间<span class="jill"></span>0.0</span></blockquote><div class="wolai-block wolai-text"><div></div></div></article><footer></footer></body></html>