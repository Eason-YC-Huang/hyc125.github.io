<!DOCTYPE html>
<html lang="zh-Hans-CN"><head><meta charset="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=Edge"/><link rel="stylesheet" type="text/css" href="../../../../../css/modern-norm.min.css"/><link rel="stylesheet" type="text/css" href="../../../../../css/prism.min.css"/><link rel="stylesheet" type="text/css" href="../../../../../css/katex.min.css"/><link rel="stylesheet" type="text/css" href="../../../../../css/wolai.css"/><title>Controllers - wolai 笔记</title><link rel="shortcut icon" href="data:image/svg+xml,%3Csvg xmlns=&apos;http://www.w3.org/2000/svg&apos; viewBox=&apos;0 0 800 800&apos;%3E%3Cdefs%3E%3Cstyle%3E.cls-1%7Bfill:%23fff;%7D%3C/style%3E%3C/defs%3E%3Cg%3E%3Cpath class=&apos;cls-1&apos; d=&apos;M610.08,0c66,0,90,6.88,114.13,19.79a134.62,134.62,0,0,1,56,56l2.28,4.4C793.93,103,800,127.88,800,189.92V610.08l-.08,11.56c-.78,57.38-7.58,79.89-19.71,102.57a134.62,134.62,0,0,1-56,56l-4.4,2.28C697,793.93,672.12,800,610.08,800H189.92l-11.56-.08c-57.38-.78-79.89-7.58-102.57-19.71a134.62,134.62,0,0,1-56-56l-2.28-4.4C6.44,697.75.4,673.72,0,616L0,189.92c0-66,6.88-90,19.79-114.13a134.62,134.62,0,0,1,56-56l4.4-2.28C102.25,6.44,126.28.4,184,0Z&apos;/%3E%3Cpath d=&apos;M610.08,0c66,0,90,6.88,114.13,19.79a134.62,134.62,0,0,1,56,56l2.28,4.4C793.93,103,800,127.88,800,189.92V610.08l-.08,11.56c-.78,57.38-7.58,79.89-19.71,102.57a134.62,134.62,0,0,1-56,56l-4.4,2.28C697,793.93,672.12,800,610.08,800H189.92l-11.56-.08c-57.38-.78-79.89-7.58-102.57-19.71a134.62,134.62,0,0,1-56-56l-2.28-4.4C6.44,697.75.4,673.72,0,616L0,189.92c0-66,6.88-90,19.79-114.13a134.62,134.62,0,0,1,56-56l4.4-2.28C102.25,6.44,126.28.4,184,0Zm4.72,88.9H185.2L172.42,89c-32.78.62-43.68,3.24-54.71,9.14a45.84,45.84,0,0,0-19.54,19.54c-6.61,12.36-9.11,24.55-9.27,67.49V614.8L89,627.58c.62,32.78,3.24,43.68,9.14,54.71a45.84,45.84,0,0,0,19.54,19.54c12.36,6.61,24.55,9.11,67.49,9.27H610.08c46.79,0,59.41-2.44,72.21-9.28a45.84,45.84,0,0,0,19.54-19.54c6.61-12.36,9.11-24.55,9.27-67.49V189.92c0-46.79-2.44-59.41-9.28-72.21a45.84,45.84,0,0,0-19.54-19.54C669.93,91.56,657.74,89.06,614.8,88.9ZM233.33,493.33A73.34,73.34,0,1,1,160,566.67,73.35,73.35,0,0,1,233.33,493.33Z&apos;/%3E%3C/g%3E%3C/svg%3E"></link></head><body><header><div class="image"></div><div class="title"><div class="banner"><div class="icon"></div></div><div data-title="Controllers" class="main-title"></div></div></header><article><div class="wolai-block wolai-text"><div><span class="inline-wrap">Spring MVC 提供了<span class="jill"></span>@Controller<span class="jill"></span>和<span class="jill"></span>@RestController<span class="jill"></span>注解来实现请求映射,请求输入,异常处理等等.</span></div></div><code-block class="wolai-block"><div class="wolai-pre"><div data-lang="Java" class="marker"></div><pre><span class="token annotation punctuation">@Controller</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HelloController</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/hello"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">handle</span><span class="token punctuation">(</span><span class="token class-name">Model</span> model<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        model<span class="token punctuation">.</span><span class="token function">addAttribute</span><span class="token punctuation">(</span><span class="token string">"message"</span><span class="token punctuation">,</span> <span class="token string">"Hello World!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token string">"index"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></pre></div></code-block><div class="wolai-block wolai-text"><div><span class="inline-wrap">上面这个例子,handle<span class="jill"></span>接收一个<span class="jill"></span>Model<span class="jill"></span>然后返回的<span class="jill"></span>View<span class="jill"></span>的名称,还有更多内容,我们接下来会讲.</span></div></div><h2 class="wolai-block"><span class="inline-wrap">声明控制器</span></h2><div class="wolai-block wolai-text"><div><span class="inline-wrap">@Controller</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">@RestController 是一个由<span class="jill"></span>@Controller<span class="jill"></span>和<span class="jill"></span>@ResponseBody<span class="jill"></span>组合而成的注解.</span></div></div><h2 class="wolai-block"><span class="inline-wrap">请求映射</span></h2><ul class="wolai-block"><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>@RequestMapping</code></span></li><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>@GetMapping</code></span></li><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>@PostMapping</code></span></li><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>@PutMapping</code></span></li><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>@DeleteMapping</code></span></li><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>@PatchMapping</code></span></li></ul><h3 class="wolai-block"><span class="inline-wrap">URL 通配符</span></h3><ul class="wolai-block"><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>?</code></span><span class="inline-wrap"> 匹配单个字符</span></li><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>*</code></span><span class="inline-wrap"> 匹配路径块的零到多个字符</span></li><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>**</code></span><span class="inline-wrap"> 匹配整个路径零到多个字符</span></li></ul><h3 class="wolai-block"><span class="inline-wrap">@PathVariable</span></h3><code-block class="wolai-block"><div class="wolai-pre"><div data-lang="Java" class="marker"></div><pre><span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/owners/{ownerId}/pets/{petId}"</span><span class="token punctuation">)</span> 
<span class="token keyword">public</span> <span class="token class-name">Pet</span> <span class="token function">findPet</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span> <span class="token class-name">Long</span> ownerId<span class="token punctuation">,</span> <span class="token annotation punctuation">@PathVariable</span> <span class="token class-name">Long</span> petId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ... </span>
<span class="token punctuation">}</span> </pre></div></code-block><div class="wolai-block wolai-text"><div><span class="inline-wrap"><b>@PathVariable<span class="jill"></span>中使用正则表达式</b></span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">语法<span class="jill"></span>{varName：regex}<span class="jill"></span>声明一个<span class="jill"></span>URI<span class="jill"></span>变量，其正则表达式的语法为<span class="jill"></span>{varName：regex}。</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">例如，给定<span class="jill"></span>URL“/spring-web-3.0.5 .jar”，以下方法提取名称，版本和文件扩展名：</span></div></div><code-block class="wolai-block"><div class="wolai-pre"><div data-lang="Java" class="marker"></div><pre><span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/{name:[a-z-]+}-{version:\\d\\.\\d\\.\\d}{ext:\\.[a-z]+}"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">handle</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span> <span class="token class-name">String</span> version<span class="token punctuation">,</span> <span class="token annotation punctuation">@PathVariable</span> <span class="token class-name">String</span> ext<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
<span class="token punctuation">}</span></pre></div></code-block><div class="wolai-block wolai-text"><div><span class="inline-wrap"><b>URI<span class="jill"></span>路径模式还可以嵌入<span class="jill"></span>$ {...}<span class="jill"></span>占位符 ????????????????????????/</b></span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">这些占位符在启动时通过对本地，系统，环境和其他属性源使用<span class="jill"></span>PropertyPlaceHolderConfigurer<span class="jill"></span>来解析。</span></div></div><h3 class="wolai-block"><span class="inline-wrap">后缀匹配</span></h3><div class="wolai-block wolai-text"><div><span class="inline-wrap">默认情况下，Spring MVC<span class="jill"></span>执行</span><span class="inline-wrap"><code>.*</code></span><span class="inline-wrap">后缀模式匹配，以便映射到</span><span class="inline-wrap"><code>/ person</code></span><span class="inline-wrap">的控制器也隐式映射到</span><span class="inline-wrap"><code>/person.*</code></span><span class="inline-wrap">。然后使用文件扩展名来解释用于响应的请求内容类型，例如</span><span class="inline-wrap"><code>/ person.pdf</code></span><span class="inline-wrap">，</span><span class="inline-wrap"><code>/person.xml</code></span><span class="inline-wrap">等。</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">当浏览器用于发送难以一致解释的<span class="jill"></span>Accept<span class="jill"></span>标头时，必须以这种方式使用文件扩展名。目前，这不再是必需品，使用<span class="jill"></span>Accept<span class="jill"></span>标头应该是首选。</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">随着时间的推移，文件扩展名的使用已经证明有多种方式存在问题。当使用<span class="jill"></span>URI<span class="jill"></span>变量，路径参数和<span class="jill"></span>URI<span class="jill"></span>编码进行覆盖时，它可能会导致歧义。有关基于<span class="jill"></span>URL<span class="jill"></span>的授权和安全性的推理（有关更多详细信息，请参阅下一节）也变得更加困难。</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">要完全禁用文件扩展名，必须同时设置以下两项：</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap"><code>useSuffixPatternMatching（false）</code></span><span class="inline-wrap">，请参阅<span class="jill"></span>PathMatchConfigurer</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap"><code>favorPathExtension（false）</code></span><span class="inline-wrap">，请参阅<span class="jill"></span>ContentNeogiationConfigurer</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">基于<span class="jill"></span>URL<span class="jill"></span>的内容协商仍然有用（例如，在浏览器中键入<span class="jill"></span>URL<span class="jill"></span>时）。为此，我们建议使用基于查询参数的策略来避免文件扩展名带来的大多数问题。或者，如果必须使用文件扩展名，请考虑通过<span class="jill"></span>ContentNeogiationConfigurer<span class="jill"></span>的<span class="jill"></span>mediaTypes<span class="jill"></span>属性将它们限制为显式注册的扩展名列表。</span></div></div><h3 class="wolai-block"><span class="inline-wrap">Suffix Match and RFD</span></h3><h3 class="wolai-block"><span class="inline-wrap">可接受的媒体类型</span></h3><div class="wolai-block wolai-text"><div><span class="inline-wrap">通过</span><span class="inline-wrap"><code>consumes</code></span><span class="inline-wrap">属性说明该处理方法可以接受什么类型的请求，从而缩小请求映射范围，如以下示例所示：</span></div></div><code-block class="wolai-block"><div class="wolai-pre"><div data-lang="Java" class="marker"></div><pre><span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span>path <span class="token operator">=</span> <span class="token string">"/pets"</span><span class="token punctuation">,</span> consumes <span class="token operator">=</span> <span class="token string">"application/json"</span><span class="token punctuation">)</span> 
<span class="token comment">// 请求头中有Content-Type:application/json 的请求才能被该处理方法处理</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">addPet</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestBody</span> <span class="token class-name">Pet</span> pet<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
<span class="token punctuation">}</span></pre></div></code-block><h3 class="wolai-block"><span class="inline-wrap">可生产的媒体类型</span></h3><div class="wolai-block wolai-text"><div><span class="inline-wrap">通过</span><span class="inline-wrap"><code>produces</code></span><span class="inline-wrap">属性说明该处理方法可以产生什么类型的响应，从而缩小请求映射范围，如以下示例所示：</span></div></div><code-block class="wolai-block"><div class="wolai-pre"><div data-lang="Java" class="marker"></div><pre><span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span>path <span class="token operator">=</span> <span class="token string">"/pets/{petId}"</span><span class="token punctuation">,</span> produces <span class="token operator">=</span> <span class="token string">"application/json;charset=UTF-8"</span><span class="token punctuation">)</span> 
<span class="token comment">// 请求头中有accept: application/json 的请求才能被该处理方法处理</span>
<span class="token annotation punctuation">@ResponseBody</span>
<span class="token keyword">public</span> <span class="token class-name">Pet</span> <span class="token function">getPet</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span> <span class="token class-name">String</span> petId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
<span class="token punctuation">}</span></pre></div></code-block><h3 class="wolai-block"><span class="inline-wrap">accept 和 content-Type<span class="jill"></span>区别</span></h3><div class="wolai-block wolai-text"><div><span class="inline-wrap">accept<span class="jill"></span>表示 客服端（浏览器）支持的类型，也是希望服务器响应发送回来的的数据类型。</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">例如：Accept：text/xml; ，也就是希望服务器响应发送回来的是<span class="jill"></span>xml<span class="jill"></span>文本格式的内容</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">区别：</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">1.Accept<span class="jill"></span>属于请求头， Content-Type<span class="jill"></span>属于实体头。
Http<span class="jill"></span>报头分为通用报头，请求报头，响应报头和实体报头。
请求方的<span class="jill"></span>http<span class="jill"></span>报头结构：通用报头<span class="jill"></span>|<span class="jill"></span>请求报头<span class="jill"></span>|<span class="jill"></span>实体报头
响应方的<span class="jill"></span>http<span class="jill"></span>报头结构：通用报头<span class="jill"></span>|<span class="jill"></span>响应报头<span class="jill"></span>|<span class="jill"></span>实体报头</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">2.Accept<span class="jill"></span>代表发送端（客户端）希望接受的数据类型。
比如：Accept：text/xml;
代表客户端希望接受的数据类型是<span class="jill"></span>xml<span class="jill"></span>类型</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">Content-Type<span class="jill"></span>代表发送端（客户端<span class="jill"></span>|<span class="jill"></span>服务器）发送的实体数据的数据类型。
比如：Content-Type：text/html;
代表发送端发送的数据格式是<span class="jill"></span>html。</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">二者合起来，
Accept:text/xml；
Content-Type:text/html
即代表客户端希望接受的数据类型是<span class="jill"></span>xml<span class="jill"></span>格式，本次客户端请求发送的数据的数据格式是<span class="jill"></span>html。</span></div></div><h3 class="wolai-block"><span class="inline-wrap">Parameters, headers</span></h3><div class="wolai-block wolai-text"><div><span class="inline-wrap">您可以根据请求参数条件缩小请求映射。 您可以测试是否存在请求参数（myParam），缺少一个（！myParam）或特定值（myParam = myValue）。 以下示例显示如何测试特定值：</span></div></div><code-block class="wolai-block"><div class="wolai-pre"><div data-lang="Java" class="marker"></div><pre><span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span>path <span class="token operator">=</span> <span class="token string">"/pets/{petId}"</span><span class="token punctuation">,</span> params <span class="token operator">=</span> <span class="token string">"myParam=myValue"</span><span class="token punctuation">)</span> 
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">findPet</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span> <span class="token class-name">String</span> petId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
<span class="token punctuation">}</span></pre></div></code-block><code-block class="wolai-block"><div class="wolai-pre"><div data-lang="Java" class="marker"></div><pre><span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span>path <span class="token operator">=</span> <span class="token string">"/pets"</span><span class="token punctuation">,</span> headers <span class="token operator">=</span> <span class="token string">"myHeader=myValue"</span><span class="token punctuation">)</span> 
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">findPet</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span> <span class="token class-name">String</span> petId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
<span class="token punctuation">}</span></pre></div></code-block><blockquote class="wolai-block"><span class="inline-wrap">You can match </span><span class="inline-wrap"><code>Content-Type</code></span><span class="inline-wrap"> and </span><span class="inline-wrap"><code>Accept</code></span><span class="inline-wrap"> with the headers condition, but it is better to use </span><span class="inline-wrap"><a href="https://docs.spring.io/spring/docs/current/spring-framework-reference/web.html#mvc-ann-requestmapping-consumes"><span>consumes</span></a></span><span class="inline-wrap"> and </span><span class="inline-wrap"><a href="https://docs.spring.io/spring/docs/current/spring-framework-reference/web.html#mvc-ann-requestmapping-produces"><span>produces</span></a></span><span class="inline-wrap"> instead.</span></blockquote><h3 class="wolai-block"><span class="inline-wrap">HTTP HEAD, OPTIONS</span></h3><div class="wolai-block wolai-text"><div><span class="inline-wrap">@GetMapping（和<span class="jill"></span>@RequestMapping（method = HttpMethod.GET））透明地支持<span class="jill"></span>HTTP HEAD<span class="jill"></span>以进行请求映射。控制器方法无需更改。应用于<span class="jill"></span>javax.servlet.http.HttpServlet<span class="jill"></span>的响应包装器确保将<span class="jill"></span>Content-Length<span class="jill"></span>头设置为写入的字节数（不实际写入响应）。</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">@GetMapping（和<span class="jill"></span>@RequestMapping（method = HttpMethod.GET））被隐式映射到并支持<span class="jill"></span>HTTP HEAD。处理<span class="jill"></span>HTTP HEAD<span class="jill"></span>请求就像它是<span class="jill"></span>HTTP GET<span class="jill"></span>一样，除了编写字节数而不是写入主体，并设置<span class="jill"></span>Content-Length<span class="jill"></span>头。</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">默认情况下，通过将<span class="jill"></span>Allow<span class="jill"></span>响应头设置为所有具有匹配<span class="jill"></span>URL<span class="jill"></span>模式的<span class="jill"></span>@RequestMapping<span class="jill"></span>方法中列出的<span class="jill"></span>HTTP<span class="jill"></span>方法列表来处理<span class="jill"></span>HTTP OPTIONS。</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">对于没有<span class="jill"></span>HTTP<span class="jill"></span>方法声明的<span class="jill"></span>@RequestMapping，Allow<span class="jill"></span>标头设置为<span class="jill"></span>GET，HEAD，POST，PUT，PATCH，DELETE，OPTIONS。控制器方法应始终声明支持的<span class="jill"></span>HTTP<span class="jill"></span>方法（例如，通过使用特定于<span class="jill"></span>HTTP<span class="jill"></span>方法的变体：@ GetMapping，@ PostMapping<span class="jill"></span>等）。</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">您可以将<span class="jill"></span>@RequestMapping<span class="jill"></span>方法显式映射到<span class="jill"></span>HTTP HEAD<span class="jill"></span>和<span class="jill"></span>HTTP OPTIONS，但在常见情况下这不是必需的。</span></div></div><h2 class="wolai-block"><span class="inline-wrap">处理方法</span></h2><div class="wolai-block wolai-text"><div><span class="inline-wrap">控制器里面<span class="jill"></span>@RequestMapping<span class="jill"></span>注解修饰的方法就是处理方法，她们用来处理请求，所以叫做处理方法。</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">@RequestMapping<span class="jill"></span>修饰的方法具有灵活的签名，可以从一系列受支持的控制器方法参数和返回值中进行选择。</span></div></div><h3 class="wolai-block"><span class="inline-wrap">方法参数</span></h3><div class="wolai-block wolai-simple-table"><table><thead><tr><th style="width: 370px"><span class="inline-wrap">controller 方法参数</span></th><th style="width: 370px"><span class="inline-wrap">描述</span></th></tr></thead><tbody><tr><td><span class="inline-wrap">WebRequest, NativeWebRequest</span></td><td><span class="inline-wrap">无需直接使用<span class="jill"></span>Servlet API<span class="jill"></span>即可访问请求参数以及请求和会话属性。</span></td></tr><tr><td><span class="inline-wrap">javax.servlet.ServletRequest, javax.servlet.ServletResponse</span></td><td><span class="inline-wrap">选择任何特定的请求或响应类型 - 例如，ServletRequest，HttpServletRequest<span class="jill"></span>或<span class="jill"></span>Spring<span class="jill"></span>的<span class="jill"></span>MultipartRequest，MultipartHttpServletRequest。</span></td></tr><tr><td><span class="inline-wrap">更多内容</span></td><td><span class="inline-wrap"><a href="https://docs.spring.io/spring/docs/current/spring-framework-reference/web.html#mvc-ann-arguments"><span></span></a></span><span class="inline-wrap"><a href="https://docs.spring.io/spring/docs/current/spring-framework-reference/web.html#mvc-ann-arguments"><span>https://docs.spring.io/spring/docs/current/spring-framework-reference/web.html#mvc-ann-arguments</span></a></span></td></tr></tbody></table></div><h3 class="wolai-block"><span class="inline-wrap">返回值</span></h3><div class="wolai-block wolai-text"><div><span class="inline-wrap">下表描述了支持的控制器方法返回值。 所有返回值都支持反应类型。</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap"><a href="https://docs.spring.io/spring/docs/current/spring-framework-reference/web.html#mvc-ann-return-types"><span>具体请看这个</span></a></span></div></div><h3 class="wolai-block"><span class="inline-wrap">类型转换</span></h3><div class="wolai-block wolai-text"><div><span class="inline-wrap">如果参数声明为<span class="jill"></span>String<span class="jill"></span>以外的其他参数，则表示基于<span class="jill"></span>String<span class="jill"></span>的请求输入的某些带注释的控制器方法参数（例如<span class="jill"></span>@ RequestParam，@ RequestHeader，@ PathVariable，@ MatrixVariable<span class="jill"></span>和<span class="jill"></span>@CookieValue）可能需要进行类型转换。</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">对于此类情况，将根据配置的转换器自动应用类型转换。 默认情况下，支持简单类型（int，long，Date<span class="jill"></span>和其他）。 您可以通过<span class="jill"></span>WebDataBinder<span class="jill"></span>自定义类型转换（请参阅使用<span class="jill"></span>DataBinder）或使用<span class="jill"></span>FormattingConversionService<span class="jill"></span>注册<span class="jill"></span>Formatters。 请参见<span class="jill"></span>Spring Field Formatting。</span></div></div><h3 class="wolai-block"><span class="inline-wrap">路径变量 @PathVariable</span></h3><code-block class="wolai-block"><div class="wolai-pre"><div data-lang="Java" class="marker"></div><pre><span class="token comment">// 修饰方法</span>
<span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/owners/{ownerId}/pets/{petId}"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">Pet</span> <span class="token function">findPet</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span> <span class="token class-name">Long</span> ownerId<span class="token punctuation">,</span> <span class="token annotation punctuation">@PathVariable</span> <span class="token class-name">Long</span> petId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
<span class="token comment">// 修饰类</span>
<span class="token annotation punctuation">@Controller</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/owners/{ownerId}"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OwnerController</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/pets/{petId}"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">Pet</span> <span class="token function">findPet</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span> <span class="token class-name">Long</span> ownerId<span class="token punctuation">,</span> <span class="token annotation punctuation">@PathVariable</span> <span class="token class-name">Long</span> petId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// ...</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></pre></div></code-block><h3 class="wolai-block"><span class="inline-wrap">矩阵变量 @MatrixVariable</span></h3><div class="wolai-block wolai-text"><div><span class="inline-wrap">矩阵变量可以出现在任何路径段中，每个变量用分号分隔，多个值用逗号分隔（例如，/ cars; color = red，green; year = 2012）。 也可以通过重复的变量名称指定多个值（例如，color = red; color = green; color = blue）。</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">如果<span class="jill"></span>URL<span class="jill"></span>预计包含矩阵变量，则控制器方法的请求映射必须使用<span class="jill"></span>URI<span class="jill"></span>变量来屏蔽该变量内容，并确保请求可以成功匹配，而与矩阵变量顺序和存在无关。 以下示例使用矩阵变量：</span></div></div><code-block class="wolai-block"><div class="wolai-pre"><div data-lang="Java" class="marker"></div><pre><span class="token comment">// GET /pets/42;q=11;r=22</span>

<span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/pets/{petId}"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">findPet</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span> <span class="token class-name">String</span> petId<span class="token punctuation">,</span> <span class="token annotation punctuation">@MatrixVariable</span> <span class="token keyword">int</span> q<span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token comment">// petId == 42</span>
    <span class="token comment">// q == 11</span>
<span class="token punctuation">}</span></pre></div></code-block><code-block class="wolai-block"><div class="wolai-pre"><div data-lang="Java" class="marker"></div><pre><span class="token comment">// GET /owners/42;q=11/pets/21;q=22</span>

<span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/owners/{ownerId}/pets/{petId}"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">findPet</span><span class="token punctuation">(</span>
        <span class="token annotation punctuation">@MatrixVariable</span><span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">"q"</span><span class="token punctuation">,</span> pathVar<span class="token operator">=</span><span class="token string">"ownerId"</span><span class="token punctuation">)</span> <span class="token keyword">int</span> q1<span class="token punctuation">,</span>
        <span class="token annotation punctuation">@MatrixVariable</span><span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">"q"</span><span class="token punctuation">,</span> pathVar<span class="token operator">=</span><span class="token string">"petId"</span><span class="token punctuation">)</span> <span class="token keyword">int</span> q2<span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token comment">// q1 == 11</span>
    <span class="token comment">// q2 == 22</span>
<span class="token punctuation">}</span></pre></div></code-block><code-block class="wolai-block"><div class="wolai-pre"><div data-lang="Java" class="marker"></div><pre><span class="token comment">// GET /pets/42</span>

<span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/pets/{petId}"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">findPet</span><span class="token punctuation">(</span><span class="token annotation punctuation">@MatrixVariable</span><span class="token punctuation">(</span>required<span class="token operator">=</span><span class="token boolean">false</span><span class="token punctuation">,</span> defaultValue<span class="token operator">=</span><span class="token string">"1"</span><span class="token punctuation">)</span> <span class="token keyword">int</span> q<span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token comment">// q == 1</span>
<span class="token punctuation">}</span></pre></div></code-block><code-block class="wolai-block"><div class="wolai-pre"><div data-lang="Java" class="marker"></div><pre><span class="token comment">// GET /owners/42;q=11;r=12/pets/21;q=22;s=23</span>

<span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/owners/{ownerId}/pets/{petId}"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">findPet</span><span class="token punctuation">(</span>
        <span class="token annotation punctuation">@MatrixVariable</span> <span class="token class-name">MultiValueMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">></span></span> matrixVars<span class="token punctuation">,</span>
        <span class="token annotation punctuation">@MatrixVariable</span><span class="token punctuation">(</span>pathVar<span class="token operator">=</span><span class="token string">"petId"</span><span class="token punctuation">)</span> <span class="token class-name">MultiValueMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">></span></span> petMatrixVars<span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token comment">// matrixVars: ["q" : [11,22], "r" : 12, "s" : 23]</span>
    <span class="token comment">// petMatrixVars: ["q" : 22, "s" : 23]</span>
<span class="token punctuation">}</span></pre></div></code-block><div class="wolai-block wolai-text"><div><span class="inline-wrap">请注意，您需要启用矩阵变量的使用。</span></div></div><ul class="wolai-block"><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">在<span class="jill"></span>MVC Java<span class="jill"></span>配置中，您需要通过路径匹配将</span><span class="inline-wrap"><code>removeSemicolonContent = false</code></span><span class="inline-wrap">设置为<span class="jill"></span>UrlPathHelper。</span></li><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">在<span class="jill"></span>MVC XML<span class="jill"></span>命名空间中，您可以设置</span><span class="inline-wrap"><code>&lt;mvc：annotation-driven enable-matrix-variables =“true”/&gt;</code></span><span class="inline-wrap">。</span></li></ul><code-block class="wolai-block"><div class="wolai-pre"><div data-lang="Java" class="marker"></div><pre><span class="token comment">// 开启矩阵变量</span>
<span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AppConfig</span> <span class="token keyword">implements</span> <span class="token class-name">WebMvcConfigurer</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">configurePathMatch</span><span class="token punctuation">(</span><span class="token class-name">PathMatchConfigurer</span> configurer<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">UrlPathHelper</span> urlPathHelper <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UrlPathHelper</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            urlPathHelper<span class="token punctuation">.</span><span class="token function">setRemoveSemicolonContent</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            configurer<span class="token punctuation">.</span><span class="token function">setUrlPathHelper</span><span class="token punctuation">(</span>urlPathHelper<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
<span class="token punctuation">}</span></pre></div></code-block><h3 class="wolai-block"><span class="inline-wrap">请求参数 @RequestParam</span></h3><div class="wolai-block wolai-text"><div><span class="inline-wrap">使用<span class="jill"></span>@RequestParam<span class="jill"></span>可以把<span class="jill"></span>Servlet<span class="jill"></span>的请求参数注入到控制器的方法中。</span></div></div><code-block class="wolai-block"><div class="wolai-pre"><div data-lang="Java" class="marker"></div><pre><span class="token annotation punctuation">@Controller</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/pets"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">EditPetForm</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@GetMapping</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">setupForm</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span><span class="token string">"petId"</span><span class="token punctuation">)</span> <span class="token keyword">int</span> petId<span class="token punctuation">,</span> <span class="token class-name">Model</span> model<span class="token punctuation">)</span> <span class="token punctuation">{</span> 
        <span class="token comment">//默认如果请求中没有petId参数则会报错，如果想取消该行为，添加required = false</span>
        <span class="token class-name">Pet</span> pet <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>clinic<span class="token punctuation">.</span><span class="token function">loadPet</span><span class="token punctuation">(</span>petId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        model<span class="token punctuation">.</span><span class="token function">addAttribute</span><span class="token punctuation">(</span><span class="token string">"pet"</span><span class="token punctuation">,</span> pet<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token string">"petForm"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span></pre></div></code-block><h3 class="wolai-block"><span class="inline-wrap">请求头 @RequestHeader</span></h3><div class="wolai-block wolai-text"><div><span class="inline-wrap">同上，把请求头信息注入到控制器的处理方法的参数中。</span></div></div><code-block class="wolai-block"><div class="wolai-pre"><div data-lang="Java" class="marker"></div><pre><span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/demo"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">handle</span><span class="token punctuation">(</span>
        <span class="token annotation punctuation">@RequestHeader</span><span class="token punctuation">(</span><span class="token string">"Accept-Encoding"</span><span class="token punctuation">)</span> <span class="token class-name">String</span> encoding<span class="token punctuation">,</span> 
        <span class="token annotation punctuation">@RequestHeader</span><span class="token punctuation">(</span><span class="token string">"Keep-Alive"</span><span class="token punctuation">)</span> <span class="token keyword">long</span> keepAlive<span class="token punctuation">)</span> <span class="token punctuation">{</span> 
    <span class="token comment">// ...</span>
<span class="token punctuation">}</span></pre></div></code-block><div class="wolai-block wolai-text"><div><span class="inline-wrap">如果该注解修饰的是</span><span class="inline-wrap"><code>Map&lt;String, String&gt;</code></span><span class="inline-wrap">, </span><span class="inline-wrap"><code>MultiValueMap&lt;String, String&gt;</code></span><span class="inline-wrap">, 或</span><span class="inline-wrap"><code>HttpHeaders</code></span><span class="inline-wrap">类型的参数，那么所有的头部信息都会被装进取。</span></div></div><h3 class="wolai-block"><span class="inline-wrap">@CookieValue</span></h3><div class="wolai-block wolai-text"><div><span class="inline-wrap">把<span class="jill"></span>CookieValue<span class="jill"></span>注入到处理方法的参数中。</span></div></div><code-block class="wolai-block"><div class="wolai-pre"><div data-lang="Java" class="marker"></div><pre><span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/demo"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">handle</span><span class="token punctuation">(</span><span class="token annotation punctuation">@CookieValue</span><span class="token punctuation">(</span><span class="token string">"JSESSIONID"</span><span class="token punctuation">)</span> <span class="token class-name">String</span> cookie<span class="token punctuation">)</span> <span class="token punctuation">{</span> 
    <span class="token comment">//...</span>
<span class="token punctuation">}</span></pre></div></code-block><h3 class="wolai-block"><span class="inline-wrap">会话属性 @SessionAttributes</span></h3><div class="wolai-block wolai-text"><div><span class="inline-wrap"><code>@SessionAttributes</code></span><span class="inline-wrap">把<span class="jill"></span>model attribute<span class="jill"></span>存储在同一次<span class="jill"></span>session<span class="jill"></span>的请求中。它是一个类型级别的注解，用于声明特定控制器使用会话属性。 这通常列出模型属性的名称或模型属性的类型，这些属性应该透明地存储在会话中以供后续访问请求使用。</span></div></div><code-block class="wolai-block"><div class="wolai-pre"><div data-lang="Java" class="marker"></div><pre><span class="token annotation punctuation">@Controller</span>
<span class="token annotation punctuation">@SessionAttributes</span><span class="token punctuation">(</span><span class="token string">"pet"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">EditPetForm</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
<span class="token punctuation">}</span></pre></div></code-block><div class="wolai-block wolai-text"><div><span class="inline-wrap">在第一个请求中，当名称为<span class="jill"></span>pet<span class="jill"></span>的模型属性添加到模型中时，它会自动提升并保存在<span class="jill"></span>HTTP Servlet<span class="jill"></span>会话中。 它保持不变，直到另一个控制器方法使用<span class="jill"></span>SessionStatus<span class="jill"></span>方法参数来清除存储，如下例所示：</span></div></div><code-block class="wolai-block"><div class="wolai-pre"><div data-lang="Java" class="marker"></div><pre><span class="token annotation punctuation">@Controller</span>
<span class="token annotation punctuation">@SessionAttributes</span><span class="token punctuation">(</span><span class="token string">"pet"</span><span class="token punctuation">)</span> 
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">EditPetForm</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">"/pets/{id}"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">handle</span><span class="token punctuation">(</span><span class="token class-name">Pet</span> pet<span class="token punctuation">,</span> <span class="token class-name">BindingResult</span> errors<span class="token punctuation">,</span> <span class="token class-name">SessionStatus</span> status<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>errors<span class="token punctuation">.</span>hasErrors<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// ...</span>
        <span class="token punctuation">}</span>
            status<span class="token punctuation">.</span><span class="token function">setComplete</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// ...</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></pre></div></code-block><h3 class="wolai-block"><span class="inline-wrap">会话属性 @SessionAttribute（没有<span class="jill"></span>S）</span></h3><div class="wolai-block wolai-text"><div><span class="inline-wrap">如果您需要访问全局管理的预先存在的会话属性（即，在控制器外部 - 例如，通过过滤器），则可以对方法参数使用<span class="jill"></span>@SessionAttribute<span class="jill"></span>注解，如 以下示例显示：</span></div></div><code-block class="wolai-block"><div class="wolai-pre"><div data-lang="Java" class="marker"></div><pre><span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">handle</span><span class="token punctuation">(</span><span class="token annotation punctuation">@SessionAttribute</span> <span class="token class-name">User</span> user<span class="token punctuation">)</span> <span class="token punctuation">{</span> 
    <span class="token comment">// ...</span>
<span class="token punctuation">}</span></pre></div></code-block><div class="wolai-block wolai-text"><div><span class="inline-wrap">如果要添加或删除会话属性，请把</span><span class="inline-wrap"><code>org.springframework.web.context.request.WebRequest</code></span><span class="inline-wrap"> 或</span><span class="inline-wrap"><code>javax.servlet.http.HttpSession</code></span><span class="inline-wrap">注入到处理方法的参数中。</span></div></div><h3 class="wolai-block"><span class="inline-wrap">模型属性 @ModelAttribute</span></h3><div class="wolai-block wolai-text"><div><span class="inline-wrap">您可以在方法参数上使用<span class="jill"></span>@ModelAttribute<span class="jill"></span>注解来访问<span class="jill"></span>model<span class="jill"></span>的属性，如果<span class="jill"></span>model<span class="jill"></span>不存在则将其实例化。model<span class="jill"></span>属性还覆盖了名称与字段名称匹配的<span class="jill"></span>HTTP Servlet<span class="jill"></span>请求参数的值，它使您不必处理解析和转换单个查询参数和表单字段。 以下示例显示了如何执行此操作：</span></div></div><code-block class="wolai-block"><div class="wolai-pre"><div data-lang="Java" class="marker"></div><pre><span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">"/owners/{ownerId}/pets/{petId}/edit"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">processSubmit</span><span class="token punctuation">(</span><span class="token annotation punctuation">@ModelAttribute</span> <span class="token class-name">Pet</span> pet<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span> </pre></div></code-block><div class="wolai-block wolai-text"><div><span class="inline-wrap">上面的<span class="jill"></span>Pet<span class="jill"></span>实例会按照以下流程进行解析</span></div></div><ul class="wolai-block"><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">From the model if already added by using </span><span class="inline-wrap"><a href="https://docs.spring.io/spring/docs/current/spring-framework-reference/web.html#mvc-ann-modelattrib-methods"><span>Model</span></a></span><span class="inline-wrap">.</span></li><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">From the HTTP session by using </span><span class="inline-wrap"><a href="https://docs.spring.io/spring/docs/current/spring-framework-reference/web.html#mvc-ann-sessionattributes"><span><code>@SessionAttributes</code></span></a></span><span class="inline-wrap">.</span></li><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">From a URI path variable passed through a </span><span class="inline-wrap"><code>Converter</code></span><span class="inline-wrap"> (see the next example).</span></li><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">From the invocation of a default constructor.</span></li><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">From the invocation of a “primary constructor” with arguments that match to Servlet request parameters. Argument names are determined through JavaBeans </span><span class="inline-wrap"><code>@ConstructorProperties</code></span><span class="inline-wrap"> or through runtime-retained parameter names in the bytecode.</span></li></ul><div class="wolai-block wolai-text"><div><span class="inline-wrap">虽然通常使用<span class="jill"></span>Model<span class="jill"></span>来构造模型，但另一种替代方法是依赖于<span class="jill"></span>Converter &lt;String，T&gt;和<span class="jill"></span>URI<span class="jill"></span>路径变量约定。 在以下示例中，模型属性名称<span class="jill"></span>account<span class="jill"></span>匹配<span class="jill"></span>URI<span class="jill"></span>路径变量<span class="jill"></span>account，并通过将<span class="jill"></span>String<span class="jill"></span>字符串编号传递到已注册的<span class="jill"></span>Converter &lt;String，Account&gt;来加载帐户：</span></div></div><code-block class="wolai-block"><div class="wolai-pre"><div data-lang="Java" class="marker"></div><pre><span class="token annotation punctuation">@PutMapping</span><span class="token punctuation">(</span><span class="token string">"/accounts/{account}"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">save</span><span class="token punctuation">(</span><span class="token annotation punctuation">@ModelAttribute</span><span class="token punctuation">(</span><span class="token string">"account"</span><span class="token punctuation">)</span> <span class="token class-name">Account</span> account<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
<span class="token punctuation">}</span></pre></div></code-block><div class="wolai-block wolai-text"><div><span class="inline-wrap">获取模型属性实例后，将进行数据绑定。 WebDataBinder<span class="jill"></span>类将<span class="jill"></span>Servlet<span class="jill"></span>请求参数名称（查询参数和表单字段）与目标<span class="jill"></span>Object<span class="jill"></span>上的字段名称进行匹配。 必要时，在应用类型转换后填充匹配字段。 有关数据绑定（和验证）的更多信息，请参阅 </span><span class="inline-wrap"><a href="https://docs.spring.io/spring/docs/current/spring-framework-reference/core.html#validation"><span>Validation</span></a></span><span class="inline-wrap">。 有关自定义数据绑定的更多信息，请参阅使用</span><span class="inline-wrap"><a href="https://docs.spring.io/spring/docs/current/spring-framework-reference/web.html#mvc-ann-initbinder"><span><code>DataBinder</code></span></a></span><span class="inline-wrap">。</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">数据绑定可能导致错误。 默认情况下，会引发<span class="jill"></span>BindException。 但是，要在控制器方法中检查此类错误，可以在<span class="jill"></span>@ModelAttribute<span class="jill"></span>旁边添加一个<span class="jill"></span>BindingResult<span class="jill"></span>参数，如以下示例所示：</span></div></div><code-block class="wolai-block"><div class="wolai-pre"><div data-lang="Java" class="marker"></div><pre><span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">"/owners/{ownerId}/pets/{petId}/edit"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">processSubmit</span><span class="token punctuation">(</span><span class="token annotation punctuation">@ModelAttribute</span><span class="token punctuation">(</span><span class="token string">"pet"</span><span class="token punctuation">)</span> <span class="token class-name">Pet</span> pet<span class="token punctuation">,</span> <span class="token class-name">BindingResult</span> result<span class="token punctuation">)</span> <span class="token punctuation">{</span> 
    <span class="token keyword">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">.</span><span class="token function">hasErrors</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">"petForm"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// ...</span>
<span class="token punctuation">}</span></pre></div></code-block><div class="wolai-block wolai-text"><div><span class="inline-wrap">在某些情况下，您可能希望在没有数据绑定的情况下访问模型属性。 对于这种情况，您可以将模型注入控制器并直接访问它，或者设置<span class="jill"></span>@ModelAttribute（binding = false），如下例所示：</span></div></div><code-block class="wolai-block"><div class="wolai-pre"><div data-lang="Java" class="marker"></div><pre><span class="token annotation punctuation">@ModelAttribute</span>
<span class="token keyword">public</span> <span class="token class-name">AccountForm</span> <span class="token function">setUpForm</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">AccountForm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token annotation punctuation">@ModelAttribute</span>
<span class="token keyword">public</span> <span class="token class-name">Account</span> <span class="token function">findAccount</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span> <span class="token class-name">String</span> accountId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> accountRepository<span class="token punctuation">.</span><span class="token function">findOne</span><span class="token punctuation">(</span>accountId<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">"update"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Valid</span> <span class="token class-name">AccountUpdateForm</span> form<span class="token punctuation">,</span> <span class="token class-name">BindingResult</span> result<span class="token punctuation">,</span>
        <span class="token annotation punctuation">@ModelAttribute</span><span class="token punctuation">(</span>binding<span class="token operator">=</span><span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token class-name">Account</span> account<span class="token punctuation">)</span> <span class="token punctuation">{</span> 
    <span class="token comment">// ...</span>
<span class="token punctuation">}</span></pre></div></code-block><div class="wolai-block wolai-text"><div><span class="inline-wrap">通过添加<span class="jill"></span>javax.validation.Valid<span class="jill"></span>注解或<span class="jill"></span>Spring<span class="jill"></span>的<span class="jill"></span>@Validated<span class="jill"></span>注解（ee Bean<span class="jill"></span>验证和<span class="jill"></span>Spring<span class="jill"></span>验证），您可以在数据绑定后自动应用验证。 以下示例显示了如何执行此操作：</span></div></div><code-block class="wolai-block"><div class="wolai-pre"><div data-lang="Java" class="marker"></div><pre><span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">"/owners/{ownerId}/pets/{petId}/edit"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">processSubmit</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Valid</span> <span class="token annotation punctuation">@ModelAttribute</span><span class="token punctuation">(</span><span class="token string">"pet"</span><span class="token punctuation">)</span> <span class="token class-name">Pet</span> pet<span class="token punctuation">,</span> <span class="token class-name">BindingResult</span> result<span class="token punctuation">)</span> <span class="token punctuation">{</span> 
    <span class="token keyword">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">.</span><span class="token function">hasErrors</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">"petForm"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// ...</span>
<span class="token punctuation">}</span></pre></div></code-block><div class="wolai-block wolai-text"><div><span class="inline-wrap">请注意，使用<span class="jill"></span>@ModelAttribute<span class="jill"></span>是可选的（例如，设置其属性）。 默认情况下，任何不是简单值类型的参数（由<span class="jill"></span>BeanUtils＃isSimpleProperty<span class="jill"></span>确定）并且未被任何其他参数解析器解析的参数都被视为使用<span class="jill"></span>@ModelAttribute<span class="jill"></span>进行注释。</span></div></div><h3 class="wolai-block"><span class="inline-wrap">请求属性 @RequestAttribute</span></h3><div class="wolai-block wolai-text"><div><span class="inline-wrap">与<span class="jill"></span>@SessionAttribute<span class="jill"></span>类似，您可以使用<span class="jill"></span>@RequestAttribute<span class="jill"></span>注解来访问先前创建的预先存在的请求属性（例如，通过<span class="jill"></span>Servlet<span class="jill"></span>过滤器或<span class="jill"></span>HandlerInterceptor）：</span></div></div><code-block class="wolai-block"><div class="wolai-pre"><div data-lang="Java" class="marker"></div><pre><span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">handle</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestAttribute</span> <span class="token class-name">Client</span> client<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
<span class="token punctuation">}</span></pre></div></code-block><h3 class="wolai-block"><span class="inline-wrap">重定向属性</span></h3><div class="wolai-block wolai-text"><div><span class="inline-wrap">在重定向<span class="jill"></span>URL<span class="jill"></span>中，所有模型属性默认视为<span class="jill"></span>URI<span class="jill"></span>模板变量。在其余属性中，原始类型或集合或基本类型数组的属性会自动附加为查询参数。</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">如果专门为重定向准备了模型实例，将原始类型属性作为查询参数是个不错的结果。但是，在带注释的控制器中，模型可以包含为渲染目的而添加的其他属性（例如，下拉字段值）。为了避免在<span class="jill"></span>URL<span class="jill"></span>中出现此类属性的可能性, </span><span class="inline-wrap"><code>@ RequestMapping</code></span><span class="inline-wrap">方法可以声明<span class="jill"></span>RedirectAttributes<span class="jill"></span>类型的参数，并使用它来指定可供<span class="jill"></span>RedirectView<span class="jill"></span>使用的确切属性。如果方法重定向，则使用<span class="jill"></span>RedirectAttributes<span class="jill"></span>的内容。否则，使用模型的内容。</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">RequestMappingHandlerAdapter<span class="jill"></span>提供了一个名为<span class="jill"></span>ignoreDefaultModelOnRedirect<span class="jill"></span>的标志，您可以使用该标志指示如果控制器方法重定向，则永远不应使用默认模型的内容。相反，控制器方法应声明<span class="jill"></span>RedirectAttributes<span class="jill"></span>类型的属性，如果不这样做，则不应将任何属性传递给<span class="jill"></span>RedirectView。 MVC<span class="jill"></span>命名空间和<span class="jill"></span>MVC Java<span class="jill"></span>配置都将此标志设置为<span class="jill"></span>false，以保持向后兼容性。但是，对于新应用程序，我们建议将其设置为<span class="jill"></span>true。</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">请注意，在展开重定向<span class="jill"></span>URL<span class="jill"></span>时，当前请求中的<span class="jill"></span>URI<span class="jill"></span>模板变量会自动可用，您需要通过<span class="jill"></span>Model<span class="jill"></span>或<span class="jill"></span>RedirectAttributes<span class="jill"></span>显式添加它们。以下示例显示如何定义重定向：</span></div></div><code-block class="wolai-block"><div class="wolai-pre"><div data-lang="Java" class="marker"></div><pre><span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">"/files/{path}"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">upload</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
    <span class="token keyword">return</span> <span class="token string">"redirect:files/{path}"</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></pre></div></code-block><div class="wolai-block wolai-text"><div><span class="inline-wrap">将数据传递到重定向目标的另一种方法是使用<span class="jill"></span>flash<span class="jill"></span>属性。 与其他重定向属性不同，Flash<span class="jill"></span>属性保存在<span class="jill"></span>HTTP<span class="jill"></span>会话中（因此，不会出现在<span class="jill"></span>URL<span class="jill"></span>中）。 有关更多信息，请参阅<span class="jill"></span>Flash<span class="jill"></span>属性。</span></div></div><h3 class="wolai-block"><span class="inline-wrap">Flash<span class="jill"></span>属性</span></h3><div class="wolai-block wolai-text"><div><span class="inline-wrap">Flash<span class="jill"></span>属性可以让一个请求存储另一个请求要使用的属性。重定向时最常需要这种方法 - 例如，Post-Redirect-Get<span class="jill"></span>模式。 Flash<span class="jill"></span>重定向（通常在会话中）之前临时保存<span class="jill"></span>Flash<span class="jill"></span>属性，以便在重定向后使请求可用，并立即删除。</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">Spring MVC<span class="jill"></span>有两个主要的抽象支持<span class="jill"></span>flash<span class="jill"></span>属性。 FlashMap<span class="jill"></span>用于保存<span class="jill"></span>Flash<span class="jill"></span>属性，而<span class="jill"></span>FlashMapManager<span class="jill"></span>用于存储，检索和管理<span class="jill"></span>FlashMap<span class="jill"></span>实例。</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">Flash<span class="jill"></span>属性支持始终处于“打开”状态，无需显式启用。但是，如果不使用，它永远不会导致<span class="jill"></span>HTTP<span class="jill"></span>会话创建。在每个请求中，都有一个“输入”FlashMap，其中包含从先前请求（如果有）传递的属性，以及一个“输出”FlashMap，其中包含要为后续请求保存的属性。两个<span class="jill"></span>FlashMap<span class="jill"></span>实例都可以通过<span class="jill"></span>RequestContextUtils<span class="jill"></span>中的静态方法从<span class="jill"></span>Spring MVC<span class="jill"></span>中的任何位置访问。</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">带注释的控制器通常不需要直接使用<span class="jill"></span>FlashMap。相反，@ RequestMapping<span class="jill"></span>方法可以接受<span class="jill"></span>RedirectAttributes<span class="jill"></span>类型的参数，并使用它为重定向方案添加<span class="jill"></span>flash<span class="jill"></span>属性。通过<span class="jill"></span>RedirectAttributes<span class="jill"></span>添加的<span class="jill"></span>Flash<span class="jill"></span>属性会自动传播到“输出”FlashMap。同样，在重定向之后，“输入”FlashMap<span class="jill"></span>中的属性会自动添加到为目标<span class="jill"></span>URL<span class="jill"></span>提供服务的控制器的模型中。</span></div></div><blockquote class="wolai-block"><span class="inline-wrap">Flash<span class="jill"></span>属性的概念存在于许多其他<span class="jill"></span>Web<span class="jill"></span>框架中，并且已经证明有时会暴露于并发问题。 这是因为，根据定义，闪存属性将被存储直到下一个请求。 但是，“下一个”请求可能不是预期的接收者而是另一个异步请求（例如，轮询或资源请求），在这种情况下，过早删除<span class="jill"></span>flash<span class="jill"></span>属性。</span><span class="inline-wrap">
</span><span class="inline-wrap">为了减少此类问题的可能性，RedirectView<span class="jill"></span>使用目标重定向<span class="jill"></span>URL<span class="jill"></span>的路径和查询参数自动“标记”FlashMap<span class="jill"></span>实例。 反过来，默认的<span class="jill"></span>FlashMapManager<span class="jill"></span>在查找“输入”FlashMap<span class="jill"></span>时将该信息与传入请求进行匹配。</span><span class="inline-wrap">
</span><span class="inline-wrap">这并不能完全消除并发问题的可能性，但会使用重定向<span class="jill"></span>URL<span class="jill"></span>中已有的信息大大减少并发问题。 因此，我们建议您主要使用<span class="jill"></span>Flash<span class="jill"></span>属性进行重定向方案。</span></blockquote><h3 class="wolai-block"><span class="inline-wrap">Multipart</span></h3><div class="wolai-block wolai-text"><div><span class="inline-wrap">启用</span><span class="inline-wrap"><code>MultipartResolver</code></span><span class="inline-wrap">后，将解析具有</span><span class="inline-wrap"><code>multipart / form-data</code></span><span class="inline-wrap">的<span class="jill"></span>POST<span class="jill"></span>请求的内容，并将其作为常规请求参数进行访问。 以下示例访问一个常规表单字段和一个上载文件：</span></div></div><code-block class="wolai-block"><div class="wolai-pre"><div data-lang="Java" class="marker"></div><pre><span class="token annotation punctuation">@Controller</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FileUploadController</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">"/form"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">handleFormUpload</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">)</span> <span class="token class-name">String</span> name<span class="token punctuation">,</span>
            <span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span><span class="token string">"file"</span><span class="token punctuation">)</span> <span class="token class-name">MultipartFile</span> file<span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>file<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> bytes <span class="token operator">=</span> file<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// store the bytes somewhere</span>
            <span class="token keyword">return</span> <span class="token string">"redirect:uploadSuccess"</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">return</span> <span class="token string">"redirect:uploadFailure"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span></pre></div></code-block><div class="wolai-block wolai-text"><div><span class="inline-wrap">当您使用<span class="jill"></span>Servlet 3.0<span class="jill"></span>多部分解析时，您也可以使用<span class="jill"></span>javax.servlet.http.Part<span class="jill"></span>而不是<span class="jill"></span>Spring<span class="jill"></span>的<span class="jill"></span>MultipartFile<span class="jill"></span>作为方法参数</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">您还可以将多部分内容用作绑定到命令对象的数据的一部分。 例如，前面示例中的表单字段和文件可以是表单对象上的字段，如以下示例所示：</span></div></div><code-block class="wolai-block"><div class="wolai-pre"><div data-lang="Java" class="marker"></div><pre><span class="token keyword">class</span> <span class="token class-name">MyForm</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">MultipartFile</span> file<span class="token punctuation">;</span>

    <span class="token comment">// ...</span>

<span class="token punctuation">}</span>

<span class="token annotation punctuation">@Controller</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FileUploadController</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">"/form"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">handleFormUpload</span><span class="token punctuation">(</span><span class="token class-name">MyForm</span> form<span class="token punctuation">,</span> <span class="token class-name">BindingResult</span> errors<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>form<span class="token punctuation">.</span><span class="token function">getFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> bytes <span class="token operator">=</span> form<span class="token punctuation">.</span><span class="token function">getFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// store the bytes somewhere</span>
            <span class="token keyword">return</span> <span class="token string">"redirect:uploadSuccess"</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token string">"redirect:uploadFailure"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span></pre></div></code-block><div class="wolai-block wolai-text"><div><span class="inline-wrap">还可以在<span class="jill"></span>RESTful<span class="jill"></span>服务方案中从非浏览器客户端提交多部分请求。 以下示例显示了带有<span class="jill"></span>JSON<span class="jill"></span>的文件：</span></div></div><code-block class="wolai-block"><div class="wolai-pre"><div data-lang="Java" class="marker"></div><pre>POST <span class="token operator">/</span>someUrl
<span class="token class-name">Content</span><span class="token operator">-</span><span class="token class-name">Type</span><span class="token operator">:</span> multipart<span class="token operator">/</span>mixed

<span class="token operator">--</span>edt7Tfrdusa7r3lNQc79vXuhIIMlatb7PQg7Vp
<span class="token class-name">Content</span><span class="token operator">-</span><span class="token class-name">Disposition</span><span class="token operator">:</span> form<span class="token operator">-</span>data<span class="token punctuation">;</span> name<span class="token operator">=</span><span class="token string">"meta-data"</span>
<span class="token class-name">Content</span><span class="token operator">-</span><span class="token class-name">Type</span><span class="token operator">:</span> application<span class="token operator">/</span>json<span class="token punctuation">;</span> charset<span class="token operator">=</span>UTF<span class="token operator">-</span><span class="token number">8</span>
<span class="token class-name">Content</span><span class="token operator">-</span><span class="token class-name">Transfer</span><span class="token operator">-</span><span class="token class-name">Encoding</span><span class="token operator">:</span> <span class="token number">8</span>bit

<span class="token punctuation">{</span>
    <span class="token string">"name"</span><span class="token operator">:</span> <span class="token string">"value"</span>
<span class="token punctuation">}</span>
<span class="token operator">--</span>edt7Tfrdusa7r3lNQc79vXuhIIMlatb7PQg7Vp
<span class="token class-name">Content</span><span class="token operator">-</span><span class="token class-name">Disposition</span><span class="token operator">:</span> form<span class="token operator">-</span>data<span class="token punctuation">;</span> name<span class="token operator">=</span><span class="token string">"file-data"</span><span class="token punctuation">;</span> filename<span class="token operator">=</span><span class="token string">"file.properties"</span>
<span class="token class-name">Content</span><span class="token operator">-</span><span class="token class-name">Type</span><span class="token operator">:</span> text<span class="token operator">/</span>xml
<span class="token class-name">Content</span><span class="token operator">-</span><span class="token class-name">Transfer</span><span class="token operator">-</span><span class="token class-name">Encoding</span><span class="token operator">:</span> <span class="token number">8</span>bit
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token class-name">File</span> <span class="token class-name">Data</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span></pre></div></code-block><div class="wolai-block wolai-text"><div><span class="inline-wrap">您可以使用<span class="jill"></span>@RequestParam<span class="jill"></span>作为<span class="jill"></span>String<span class="jill"></span>访问“元数据”部分，但您可能希望它从<span class="jill"></span>JSON<span class="jill"></span>反序列化（类似于<span class="jill"></span>@RequestBody）。 在使用<span class="jill"></span>HttpMessageConverter<span class="jill"></span>转换后，使用<span class="jill"></span>@RequestPart<span class="jill"></span>批注访问多部分：</span></div></div><code-block class="wolai-block"><div class="wolai-pre"><div data-lang="Java" class="marker"></div><pre><span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">handle</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestPart</span><span class="token punctuation">(</span><span class="token string">"meta-data"</span><span class="token punctuation">)</span> <span class="token class-name">MetaData</span> metadata<span class="token punctuation">,</span>
        <span class="token annotation punctuation">@RequestPart</span><span class="token punctuation">(</span><span class="token string">"file-data"</span><span class="token punctuation">)</span> <span class="token class-name">MultipartFile</span> file<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
<span class="token punctuation">}</span></pre></div></code-block><div class="wolai-block wolai-text"><div><span class="inline-wrap">您可以将<span class="jill"></span>@RequestPart<span class="jill"></span>与<span class="jill"></span>javax.validation.Valid<span class="jill"></span>结合使用，或使用<span class="jill"></span>Spring<span class="jill"></span>的<span class="jill"></span>@Validated<span class="jill"></span>注释，这两种注释都会导致应用标准<span class="jill"></span>Bean<span class="jill"></span>验证。 默认情况下，验证错误会导致<span class="jill"></span>MethodArgumentNotValidException，并将其转换为<span class="jill"></span>400（BAD_REQUEST）响应。 或者，您可以通过<span class="jill"></span>Errors<span class="jill"></span>或<span class="jill"></span>BindingResult<span class="jill"></span>参数在控制器内本地处理验证错误，如以下示例所示：</span></div></div><code-block class="wolai-block"><div class="wolai-pre"><div data-lang="Java" class="marker"></div><pre><span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">handle</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Valid</span> <span class="token annotation punctuation">@RequestPart</span><span class="token punctuation">(</span><span class="token string">"meta-data"</span><span class="token punctuation">)</span> <span class="token class-name">MetaData</span> metadata<span class="token punctuation">,</span>
        <span class="token class-name">BindingResult</span> result<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
<span class="token punctuation">}</span></pre></div></code-block><h3 class="wolai-block"><span class="inline-wrap">@RequestBody</span></h3><div class="wolai-block wolai-text"><div><span class="inline-wrap">您可以使用<span class="jill"></span>@RequestBody<span class="jill"></span>注解通过<span class="jill"></span>HttpMessageConverter<span class="jill"></span>将请求主体读取并反序列化为指定的<span class="jill"></span>Java<span class="jill"></span>对象。</span></div></div><code-block class="wolai-block"><div class="wolai-pre"><div data-lang="Java" class="marker"></div><pre><span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">"/accounts"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">handle</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestBody</span> <span class="token class-name">Account</span> account<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
<span class="token punctuation">}</span></pre></div></code-block><div class="wolai-block wolai-text"><div><span class="inline-wrap">您可以使用<span class="jill"></span>MVC<span class="jill"></span>配置的“</span><span class="inline-wrap"><a href="https://docs.spring.io/spring/docs/current/spring-framework-reference/web.html#mvc-config-message-converters"><span>Message Converters</span></a></span><span class="inline-wrap"> ”选项来配置或自定义消息转换。</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">您可以将<span class="jill"></span>@RequestBody<span class="jill"></span>与<span class="jill"></span>javax.validation<span class="jill"></span>的<span class="jill"></span>@Valid<span class="jill"></span>或<span class="jill"></span>Spring<span class="jill"></span>的<span class="jill"></span>@Validated<span class="jill"></span>注释结合使用，从而实现对数据的检验。 默认情况下，验证错误会导致<span class="jill"></span>MethodArgumentNotValidException，并将其转换为<span class="jill"></span>400（BAD_REQUEST）响应。 不过你可以通过<span class="jill"></span>Errors<span class="jill"></span>或<span class="jill"></span>BindingResult<span class="jill"></span>参数在控制器内本地处理验证错误，如下所示：</span></div></div><code-block class="wolai-block"><div class="wolai-pre"><div data-lang="Java" class="marker"></div><pre><span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">"/accounts"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">handle</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Valid</span> <span class="token annotation punctuation">@RequestBody</span> <span class="token class-name">Account</span> account<span class="token punctuation">,</span> <span class="token class-name">BindingResult</span> result<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
<span class="token punctuation">}</span></pre></div></code-block><h3 class="wolai-block"><span class="inline-wrap">HttpEntity</span></h3><div class="wolai-block wolai-text"><div><span class="inline-wrap">HttpEntity<span class="jill"></span>与使用<span class="jill"></span>@RequestBody<span class="jill"></span>或多或少相同，但基于公开请求标头和正文的容器对象。</span></div></div><code-block class="wolai-block"><div class="wolai-pre"><div data-lang="Java" class="marker"></div><pre><span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">"/accounts"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">handle</span><span class="token punctuation">(</span><span class="token class-name">HttpEntity</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Account</span><span class="token punctuation">></span></span> entity<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
<span class="token punctuation">}</span></pre></div></code-block><h3 class="wolai-block"><span class="inline-wrap">@ResponseBody</span></h3><div class="wolai-block wolai-text"><div><span class="inline-wrap">@ResponseBody<span class="jill"></span>注解修饰的方法，会使用<span class="jill"></span>HttpMessageConverter<span class="jill"></span>对返回值进行序列化作为响应结果。</span></div></div><code-block class="wolai-block"><div class="wolai-pre"><div data-lang="Java" class="marker"></div><pre><span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/accounts/{id}"</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@ResponseBody</span>
<span class="token keyword">public</span> <span class="token class-name">Account</span> <span class="token function">handle</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
<span class="token punctuation">}</span></pre></div></code-block><div class="wolai-block wolai-text"><div><span class="inline-wrap">类级别也支持<span class="jill"></span>@ResponseBody，在这种情况下，它由所有控制器方法继承。 这是<span class="jill"></span>@RestController<span class="jill"></span>的效果，它只不过是一个用<span class="jill"></span>@Controller<span class="jill"></span>和<span class="jill"></span>@ResponseBody<span class="jill"></span>标记的元注释。</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">您可以使用<span class="jill"></span>MVC<span class="jill"></span>配置的“</span><span class="inline-wrap"><a href="https://docs.spring.io/spring/docs/current/spring-framework-reference/web.html#mvc-config-message-converters"><span>Message Converters</span></a></span><span class="inline-wrap">”选项来配置或自定义消息转换。</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">您可以将<span class="jill"></span>@ResponseBody<span class="jill"></span>方法与<span class="jill"></span>JSON<span class="jill"></span>序列化视图结合使用。 有关详细信息，下面会讲。</span></div></div><h3 class="wolai-block"><span class="inline-wrap">ResponseEntity</span></h3><div class="wolai-block wolai-text"><div><span class="inline-wrap">ResponseEntity<span class="jill"></span>与使用<span class="jill"></span>@ResponseBody<span class="jill"></span>或多或少相同，但基于指定请求标头和正文的容器对象。</span></div></div><code-block class="wolai-block"><div class="wolai-pre"><div data-lang="Java" class="marker"></div><pre><span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">"/something"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">ResponseEntity</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> <span class="token function">handle</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
    <span class="token class-name">URI</span> location <span class="token operator">=</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token class-name">ResponseEntity</span><span class="token punctuation">.</span><span class="token function">created</span><span class="token punctuation">(</span>location<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></pre></div></code-block><h3 class="wolai-block"><span class="inline-wrap">Jackson JSON</span></h3><div class="wolai-block wolai-text"><div><span class="inline-wrap">Spring MVC<span class="jill"></span>为<span class="jill"></span>Jackson<span class="jill"></span>的序列化视图提供内置支持，允许仅渲染<span class="jill"></span>Object<span class="jill"></span>中所有字段的子集。 要将其与<span class="jill"></span>@ResponseBody<span class="jill"></span>或<span class="jill"></span>ResponseEntity<span class="jill"></span>控制器方法一起使用，您可以使用<span class="jill"></span>Jackson<span class="jill"></span>的<span class="jill"></span>@JsonView<span class="jill"></span>批注来激活序列化视图类，如以下示例所示：</span></div></div><code-block class="wolai-block"><div class="wolai-pre"><div data-lang="Java" class="marker"></div><pre><span class="token annotation punctuation">@RestController</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserController</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/user"</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@JsonView</span><span class="token punctuation">(</span><span class="token class-name">User<span class="token punctuation">.</span>WithoutPasswordView</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">User</span> <span class="token function">getUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token string">"eric"</span><span class="token punctuation">,</span> <span class="token string">"7!jd#h23"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">WithoutPasswordView</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">WithPasswordView</span> <span class="token keyword">extends</span> <span class="token class-name">WithoutPasswordView</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">String</span> username<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> password<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token class-name">String</span> username<span class="token punctuation">,</span> <span class="token class-name">String</span> password<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>username <span class="token operator">=</span> username<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>password <span class="token operator">=</span> password<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@JsonView</span><span class="token punctuation">(</span><span class="token class-name">WithoutPasswordView</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getUsername</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>username<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@JsonView</span><span class="token punctuation">(</span><span class="token class-name">WithPasswordView</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>password<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></pre></div></code-block><div class="wolai-block wolai-text"><div><span class="inline-wrap">@JsonView<span class="jill"></span>允许一组视图类，但每个控制器方法只能指定一个。 如果需要激活多个视图，可以使用复合接口。</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">对于依赖于视图解析器的控制器，可以将序列化视图类添加到模型中，如以下示例所示：</span></div></div><code-block class="wolai-block"><div class="wolai-pre"><div data-lang="Java" class="marker"></div><pre><span class="token annotation punctuation">@Controller</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserController</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractController</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/user"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getUser</span><span class="token punctuation">(</span><span class="token class-name">Model</span> model<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        model<span class="token punctuation">.</span><span class="token function">addAttribute</span><span class="token punctuation">(</span><span class="token string">"user"</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token string">"eric"</span><span class="token punctuation">,</span> <span class="token string">"7!jd#h23"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        model<span class="token punctuation">.</span><span class="token function">addAttribute</span><span class="token punctuation">(</span><span class="token class-name">JsonView</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">User<span class="token punctuation">.</span>WithoutPasswordView</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token string">"userView"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></pre></div></code-block><h2 class="wolai-block"><span class="inline-wrap">处理方法的数据绑定</span></h2><h2 class="wolai-block"><span class="inline-wrap">HttpMessageConverter</span></h2></article><footer></footer></body></html>