<!DOCTYPE html>
<html lang="zh-Hans-CN"><head><meta charset="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=Edge"/><link rel="stylesheet" type="text/css" href="../../../../../../css/modern-norm.min.css"/><link rel="stylesheet" type="text/css" href="../../../../../../css/prism.min.css"/><link rel="stylesheet" type="text/css" href="../../../../../../css/katex.min.css"/><link rel="stylesheet" type="text/css" href="../../../../../../css/wolai.css"/><title>深入理解SpringIoC容器-BeanFactory - wolai 笔记</title><link rel="shortcut icon" href="data:image/svg+xml,%3Csvg xmlns=&apos;http://www.w3.org/2000/svg&apos; viewBox=&apos;0 0 800 800&apos;%3E%3Cdefs%3E%3Cstyle%3E.cls-1%7Bfill:%23fff;%7D%3C/style%3E%3C/defs%3E%3Cg%3E%3Cpath class=&apos;cls-1&apos; d=&apos;M610.08,0c66,0,90,6.88,114.13,19.79a134.62,134.62,0,0,1,56,56l2.28,4.4C793.93,103,800,127.88,800,189.92V610.08l-.08,11.56c-.78,57.38-7.58,79.89-19.71,102.57a134.62,134.62,0,0,1-56,56l-4.4,2.28C697,793.93,672.12,800,610.08,800H189.92l-11.56-.08c-57.38-.78-79.89-7.58-102.57-19.71a134.62,134.62,0,0,1-56-56l-2.28-4.4C6.44,697.75.4,673.72,0,616L0,189.92c0-66,6.88-90,19.79-114.13a134.62,134.62,0,0,1,56-56l4.4-2.28C102.25,6.44,126.28.4,184,0Z&apos;/%3E%3Cpath d=&apos;M610.08,0c66,0,90,6.88,114.13,19.79a134.62,134.62,0,0,1,56,56l2.28,4.4C793.93,103,800,127.88,800,189.92V610.08l-.08,11.56c-.78,57.38-7.58,79.89-19.71,102.57a134.62,134.62,0,0,1-56,56l-4.4,2.28C697,793.93,672.12,800,610.08,800H189.92l-11.56-.08c-57.38-.78-79.89-7.58-102.57-19.71a134.62,134.62,0,0,1-56-56l-2.28-4.4C6.44,697.75.4,673.72,0,616L0,189.92c0-66,6.88-90,19.79-114.13a134.62,134.62,0,0,1,56-56l4.4-2.28C102.25,6.44,126.28.4,184,0Zm4.72,88.9H185.2L172.42,89c-32.78.62-43.68,3.24-54.71,9.14a45.84,45.84,0,0,0-19.54,19.54c-6.61,12.36-9.11,24.55-9.27,67.49V614.8L89,627.58c.62,32.78,3.24,43.68,9.14,54.71a45.84,45.84,0,0,0,19.54,19.54c12.36,6.61,24.55,9.11,67.49,9.27H610.08c46.79,0,59.41-2.44,72.21-9.28a45.84,45.84,0,0,0,19.54-19.54c6.61-12.36,9.11-24.55,9.27-67.49V189.92c0-46.79-2.44-59.41-9.28-72.21a45.84,45.84,0,0,0-19.54-19.54C669.93,91.56,657.74,89.06,614.8,88.9ZM233.33,493.33A73.34,73.34,0,1,1,160,566.67,73.35,73.35,0,0,1,233.33,493.33Z&apos;/%3E%3C/g%3E%3C/svg%3E"></link></head><body><header><div class="image"></div><div class="title"><div class="banner"><div class="icon"></div></div><div data-title="深入理解SpringIoC容器-BeanFactory" class="main-title"></div></div></header><article><div class="wolai-block wolai-text"><div><span class="inline-wrap">Spring<span class="jill"></span>的<span class="jill"></span>IoC<span class="jill"></span>容器有两个重要的接口，分别是</span><span class="inline-wrap"><code>BeanFactory</code></span><span class="inline-wrap">和</span><span class="inline-wrap"><code>ApplicationContext</code></span><span class="inline-wrap">。</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap"><code>BeanFactory</code></span><span class="inline-wrap">是最基础的容器，它规定了容器应该提供的基本服务。</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap"><code>ApplicationContext</code></span><span class="inline-wrap">是前者的扩展，它添加很多开发企业级应用需要用到的功能。</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">为了更好的区分，我把</span><span class="inline-wrap"><code>BeanFactory</code></span><span class="inline-wrap">称为低级容器，</span><span class="inline-wrap"><code>ApplicationContext</code></span><span class="inline-wrap">称为高级容器。</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">无论是</span><span class="inline-wrap"><code>BeanFactory</code></span><span class="inline-wrap">还是</span><span class="inline-wrap"><code>ApplicationContext</code></span><span class="inline-wrap">它们的工作流程都是大致相同的。</span></div></div><ul class="wolai-block"><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">获取配置文件</span></li><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">读取配置文件中定义的</span><span class="inline-wrap"><code>Bean</code></span><span class="inline-wrap">，然后转换成</span><span class="inline-wrap"><code>BeanDefinition</code></span><span class="inline-wrap">对象</span></li><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">在容器上注册</span><span class="inline-wrap"><code>BeanDefinition</code></span><span class="inline-wrap">对象（使用</span><span class="inline-wrap"><code>HashMap</code></span><span class="inline-wrap">）</span></li><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">根据</span><span class="inline-wrap"><code>BeanDefinition</code></span><span class="inline-wrap">完成</span><span class="inline-wrap"><code>Bean</code></span><span class="inline-wrap">的创建以及依赖注入</span></li></ul><h2 class="wolai-block"><span class="inline-wrap">DefaultListableBeanFactory</span></h2><div class="wolai-block wolai-text"><div><span class="inline-wrap"><code>DefaultListableBeanFactory</code></span><span class="inline-wrap">是简单容器</span><span class="inline-wrap"><code>BeanFactory</code></span><span class="inline-wrap">的一个基础实现。</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap"><code>XmlBeanFactory</code></span><span class="inline-wrap">在其基础上进行扩展，添加了读取<span class="jill"></span>XML<span class="jill"></span>配置生成</span><span class="inline-wrap"><code>BeanDefinition</code></span><span class="inline-wrap">的功能。</span></div></div><code-block class="wolai-block"><div class="wolai-pre"><div data-lang="Java" class="marker"></div><pre><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">XmlBeanFactory</span> <span class="token keyword">extends</span> <span class="token class-name">DefaultListableBeanFactory</span> <span class="token punctuation">{</span>
  <span class="token comment">// .......</span>
<span class="token punctuation">}</span></pre></div></code-block><div class="wolai-block wolai-text"><div><span class="inline-wrap"><code>GenericApplicationContext</code></span><span class="inline-wrap"> 通过组合它的方式实现容器的功能</span></div></div><code-block class="wolai-block"><div class="wolai-pre"><div data-lang="Java" class="marker"></div><pre><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GenericApplicationContext</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractApplicationContext</span> 
  <span class="token keyword">implements</span> <span class="token class-name">BeanDefinitionRegistry</span> <span class="token punctuation">{</span>

  <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">DefaultListableBeanFactory</span> beanFactory<span class="token punctuation">;</span>
  <span class="token comment">// .......</span>
<span class="token punctuation">}</span></pre></div></code-block><div class="wolai-block wolai-text"><div><span class="inline-wrap"><code>DefaultListableBeanFactory</code></span><span class="inline-wrap">关键的接口与类的介绍：</span></div></div><div class="wolai-block wolai-center"><figure style="width: 100%"><img src="media/defaultlistablebeanfactory%E7%BB%A7%E6%89%BF%E5%9B%BE.png" style="width: 760px"/></figure></div><ul class="wolai-block"><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>AliasRegistry</code></span><span class="inline-wrap">:</span><ul class="wolai-block"><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">别名注册：定义了对</span><span class="inline-wrap"><code>alias</code></span><span class="inline-wrap">的<span class="jill"></span>CRUD<span class="jill"></span>等操作。</span></li></ul></li><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>SimpleAliasRegistry</code></span><span class="inline-wrap">:</span><ul class="wolai-block"><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>AliasRegistry</code></span><span class="inline-wrap">的实现：使用</span><span class="inline-wrap"><code>ConcurrentHashMap</code></span><span class="inline-wrap">存储</span><span class="inline-wrap"><code>alias</code></span><span class="inline-wrap">。</span></li></ul></li><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>BeanDefinitionRegistry</code></span><span class="inline-wrap">：</span><ul class="wolai-block"><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>BeanDefinition</code></span><span class="inline-wrap">注册：定义了</span><span class="inline-wrap"><code>BeanDefinition</code></span><span class="inline-wrap">的<span class="jill"></span>CRUD<span class="jill"></span>等操作。</span></li></ul></li><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>SingletonBeanRegistry</code></span><span class="inline-wrap">：</span><ul class="wolai-block"><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">单例</span><span class="inline-wrap"><code>Bean</code></span><span class="inline-wrap">注册：定义了单例</span><span class="inline-wrap"><code>Bean</code></span><span class="inline-wrap">的注册和获取等操作。</span></li></ul></li><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>DefaultSingletonBeanRegistry</code></span><span class="inline-wrap">：</span><span class="inline-wrap"><code>SingletonBeanRegistry</code></span><span class="inline-wrap">的实现，</span></li><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>BeanFactory</code></span><span class="inline-wrap">：IoC<span class="jill"></span>容器的基础接口，定义了基本的获取<span class="jill"></span>Bean<span class="jill"></span>以及<span class="jill"></span>Bean<span class="jill"></span>属性的方法。</span></li><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>HierarchicalBeanFactory</code></span><span class="inline-wrap"> ：</span><ul class="wolai-block"><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">具有层级结构的</span><span class="inline-wrap"><code>BeanFactory</code></span><span class="inline-wrap">：让</span><span class="inline-wrap"><code>BeanFactory</code></span><span class="inline-wrap">拥有获取</span><span class="inline-wrap"><code>ParentBeanFactory</code></span><span class="inline-wrap">的能力。</span></li></ul></li><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>FactoryBeanRegistrySupport</code></span><span class="inline-wrap">：在</span><span class="inline-wrap"><code>DefaultSingletonBeanRegistry</code></span><span class="inline-wrap">的基础上添加了对</span><span class="inline-wrap"><code>FactoryBean</code></span><span class="inline-wrap">的特殊处理功能。</span></li><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>ConfigurableBeanFactory</code></span><span class="inline-wrap">：可配置的</span><span class="inline-wrap"><code>BeanFactory</code></span><span class="inline-wrap">：定义了配置</span><span class="inline-wrap"><code>BeanFactory</code></span><span class="inline-wrap">的各种方法。</span></li><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>ListableBeanFactory</code></span><span class="inline-wrap">：可监听的</span><span class="inline-wrap"><code>BeanFactory</code></span><span class="inline-wrap">，新增遍历所有</span><span class="inline-wrap"><code>Bean</code></span><span class="inline-wrap">实例的功能，不用一个一个的获取</span><span class="inline-wrap"><code>Bean</code></span><span class="inline-wrap">，如果具有父工厂，获取的</span><span class="inline-wrap"><code>Bean</code></span><span class="inline-wrap">不包括父工厂中的</span><span class="inline-wrap"><code>Bean</code></span><span class="inline-wrap">。</span></li><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>AutowireCapableBeanFactory</code></span><span class="inline-wrap">：提供创建</span><span class="inline-wrap"><code>Bean</code></span><span class="inline-wrap"> 自动注入   初始化以及应用</span><span class="inline-wrap"><code>Bean</code></span><span class="inline-wrap">的后处理功能。</span></li></ul><div class="wolai-block wolai-text"><div><span class="inline-wrap"></span><br/></div></div><h2 class="wolai-block"><span class="inline-wrap">Bean<span class="jill"></span>的生命周期</span></h2><div class="wolai-block wolai-center"><figure style="width: 100%"><img src="media/image.png" style="width: 732px"/></figure></div><h2 class="wolai-block"><span class="inline-wrap">源码笔记</span></h2><code-block class="wolai-block"><div class="wolai-pre"><div data-lang="Text" class="marker"></div><pre>org.springframework.beans.factory.support.AbstractBeanFactory#getBean(java.lang.String)</pre></div></code-block><div class="wolai-bookmark wolai-block"><a href="https://github.com/hyc125/read-spring/blob/master/spring-beans/src/main/java/org/springframework/beans/factory/support/AbstractBeanFactory.java">read-spring/AbstractBeanFactory.java at master · hyc125/read-spring</a><div class="info-box"><div class="text-pane"><div data-title="read-spring/AbstractBeanFactory.java at master · hyc125/read-spring"></div><div data-desc="阅读Spring源码. Contribute to hyc125/read-spring development by creating an account on GitHub."></div><div class="icon-host"><div class="icon icon-image" style="background-image: url(&quot;https://github.com/fluidicon.png&quot;)"></div><div data-hostname="github.com"></div></div></div><div class="preview-pane" style="background-image: url(https://opengraph.githubassets.com/ce8271b185dfbb0b7b7c54342642676e1eea14895bc2a6e7f75985a8a0a7eac2/hyc125/read-spring)"></div></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap"></span><br/></div></div><h2 class="wolai-block"><span class="inline-wrap">总结</span></h2><h3 class="wolai-block"><span class="inline-wrap">获取<span class="jill"></span>Bean<span class="jill"></span>的过程</span></h3><details class="wolai-block"><summary><div class="marker placeholder"></div><span class="inline-wrap">从缓存获取<span class="jill"></span>Bean</span></summary></details><details class="wolai-block"><summary><div class="marker placeholder"></div><span class="inline-wrap">获取成功，根据参数</span><span class="inline-wrap"><code>beanName</code></span><span class="inline-wrap">决定返回<span class="jill"></span>Bean<span class="jill"></span>或者工厂<span class="jill"></span>Bean</span></summary></details><details class="wolai-block"><summary><div class="marker placeholder"></div><span class="inline-wrap">获取失败，尝试从父容器获取<span class="jill"></span>Bean</span></summary></details><details class="wolai-block"><summary><div class="marker placeholder"></div><span class="inline-wrap">父容器也没有这个<span class="jill"></span>Bean，创建<span class="jill"></span>Bean</span></summary></details><details class="wolai-block"><summary><div class="marker placeholder"></div><span class="inline-wrap">检查<span class="jill"></span>Bean<span class="jill"></span>的类型是否符合要求，如果不符合，尝试进行类型转换</span></summary></details><div class="wolai-block wolai-text"><div><span class="inline-wrap"></span><br/></div></div><h3 class="wolai-block"><span class="inline-wrap">创建<span class="jill"></span>Bean<span class="jill"></span>的过程</span></h3><div class="wolai-block wolai-text"><div></div></div></article><footer></footer></body></html>