<!DOCTYPE html>
<html lang="zh-Hans-CN"><head><meta charset="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=Edge"/><link rel="stylesheet" type="text/css" href="../../../../../css/modern-norm.min.css"/><link rel="stylesheet" type="text/css" href="../../../../../css/prism.min.css"/><link rel="stylesheet" type="text/css" href="../../../../../css/katex.min.css"/><link rel="stylesheet" type="text/css" href="../../../../../css/wolai.css"/><title>Spring IoC容器与Bean - wolai 笔记</title><link rel="shortcut icon" href="data:image/svg+xml,%3Csvg xmlns=&apos;http://www.w3.org/2000/svg&apos; viewBox=&apos;0 0 800 800&apos;%3E%3Cdefs%3E%3Cstyle%3E.cls-1%7Bfill:%23fff;%7D%3C/style%3E%3C/defs%3E%3Cg%3E%3Cpath class=&apos;cls-1&apos; d=&apos;M610.08,0c66,0,90,6.88,114.13,19.79a134.62,134.62,0,0,1,56,56l2.28,4.4C793.93,103,800,127.88,800,189.92V610.08l-.08,11.56c-.78,57.38-7.58,79.89-19.71,102.57a134.62,134.62,0,0,1-56,56l-4.4,2.28C697,793.93,672.12,800,610.08,800H189.92l-11.56-.08c-57.38-.78-79.89-7.58-102.57-19.71a134.62,134.62,0,0,1-56-56l-2.28-4.4C6.44,697.75.4,673.72,0,616L0,189.92c0-66,6.88-90,19.79-114.13a134.62,134.62,0,0,1,56-56l4.4-2.28C102.25,6.44,126.28.4,184,0Z&apos;/%3E%3Cpath d=&apos;M610.08,0c66,0,90,6.88,114.13,19.79a134.62,134.62,0,0,1,56,56l2.28,4.4C793.93,103,800,127.88,800,189.92V610.08l-.08,11.56c-.78,57.38-7.58,79.89-19.71,102.57a134.62,134.62,0,0,1-56,56l-4.4,2.28C697,793.93,672.12,800,610.08,800H189.92l-11.56-.08c-57.38-.78-79.89-7.58-102.57-19.71a134.62,134.62,0,0,1-56-56l-2.28-4.4C6.44,697.75.4,673.72,0,616L0,189.92c0-66,6.88-90,19.79-114.13a134.62,134.62,0,0,1,56-56l4.4-2.28C102.25,6.44,126.28.4,184,0Zm4.72,88.9H185.2L172.42,89c-32.78.62-43.68,3.24-54.71,9.14a45.84,45.84,0,0,0-19.54,19.54c-6.61,12.36-9.11,24.55-9.27,67.49V614.8L89,627.58c.62,32.78,3.24,43.68,9.14,54.71a45.84,45.84,0,0,0,19.54,19.54c12.36,6.61,24.55,9.11,67.49,9.27H610.08c46.79,0,59.41-2.44,72.21-9.28a45.84,45.84,0,0,0,19.54-19.54c6.61-12.36,9.11-24.55,9.27-67.49V189.92c0-46.79-2.44-59.41-9.28-72.21a45.84,45.84,0,0,0-19.54-19.54C669.93,91.56,657.74,89.06,614.8,88.9ZM233.33,493.33A73.34,73.34,0,1,1,160,566.67,73.35,73.35,0,0,1,233.33,493.33Z&apos;/%3E%3C/g%3E%3C/svg%3E"></link></head><body><header><div class="image"></div><div class="title"><div class="banner"><div class="icon"></div></div><div data-title="Spring IoC容器与Bean" class="main-title"></div></div></header><article><div class="wolai-block wolai-text"><div><span class="inline-wrap">Spring IoC<span class="jill"></span>容器与<span class="jill"></span>Bean （在已有的基础上 整合 精通<span class="jill"></span>Spring 4.x<span class="jill"></span>即可）</span></div></div><ul class="wolai-block"><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">IoC<span class="jill"></span>与<span class="jill"></span>Bean</span></li><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">容器的创建和使用</span></li><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">给容器注入<span class="jill"></span>Bean</span></li><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">Bean<span class="jill"></span>的属性</span></li><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">Bean<span class="jill"></span>的生命周期回调</span></li><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">Bean<span class="jill"></span>的装配</span></li></ul><h1 class="wolai-block"><span class="inline-wrap">Spring IoC<span class="jill"></span>容器与<span class="jill"></span>Bean</span></h1><h2 class="wolai-block"><span class="inline-wrap">1.Spring IoC<span class="jill"></span>容器</span></h2><div class="wolai-block wolai-text"><div><span class="inline-wrap"><b>Spring IoC<span class="jill"></span>容器</b></span><span class="inline-wrap">是<span class="jill"></span>Spring<span class="jill"></span>对控制反转原则的实现。</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap"><b>控制反转</b></span><span class="inline-wrap"> IcC，Inversion of control，其目的是对依赖对象的创建和使用进行解耦。</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">在实际开发中，常常会有一个对象的功能的实现需要依赖另一个对象的情况，也就是说一个对象为了完成工作，必须获得另一个对象。如果对象获取其依赖对象的过程由它自身来完成，这个做法会导致代码冗余以及代码难以调试。而控制反转设计原则，则是把对象获取其依赖对象的过程，交由第三方来管理，通常我们称之为容器。容器为对象注入它所依赖的对象。由于获取依赖对象的方式被反转了，因此得名控制反转。</span></div></div><h2 class="wolai-block"><span class="inline-wrap">2.Bean</span></h2><div class="wolai-block wolai-text"><div><span class="inline-wrap">在软件开发中，习惯把可重用的组件叫做<span class="jill"></span>Bean。例如<span class="jill"></span>JavaBean<span class="jill"></span>其实就是可重用的组件，然后它还带有<span class="jill"></span>Java<span class="jill"></span>的色彩，所以就叫<span class="jill"></span>JavaBean。在<span class="jill"></span>Spring<span class="jill"></span>中，由<span class="jill"></span>IoC<span class="jill"></span>容器管理的是组成应用核心的组件就叫做<span class="jill"></span>Bean。</span></div></div><h2 class="wolai-block"><span class="inline-wrap">3.容器的创建和使用</span></h2><div class="wolai-block wolai-text"><div><span class="inline-wrap"><code>org.springframework.context.ApplicationContext</code></span><span class="inline-wrap">代表<span class="jill"></span>Spring IoC<span class="jill"></span>容器,它负责<span class="jill"></span>Bean<span class="jill"></span>的实例化、配置以及组装.</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">容器读取配置元数据了解需要创建哪些对象,以及如何配置和管理这些对象.配置元数据可以是<span class="jill"></span>XML<span class="jill"></span>文件也可以是<span class="jill"></span>Java<span class="jill"></span>代码.</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">spring<span class="jill"></span>提供了一些</span><span class="inline-wrap"><code>ApplicationContext</code></span><span class="inline-wrap">接口的实现类.分别是</span></div></div><ul class="wolai-block"><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>ClassPathXmlApplicationContext</code></span><span class="inline-wrap"> 容器从<span class="jill"></span>XML<span class="jill"></span>文件中读取配置信息</span></li><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>FileSystemXmlApplicationContext</code></span><span class="inline-wrap"> 容器从<span class="jill"></span>XML<span class="jill"></span>文件中读取配置信息</span></li><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>AnnotationConfigApplicationContext</code></span><span class="inline-wrap"> 容器从<span class="jill"></span>Java<span class="jill"></span>注解中读取配置信息</span></li></ul><h3 class="wolai-block"><span class="inline-wrap">3.1 创建容器</span></h3><div class="wolai-block wolai-text"><div><span class="inline-wrap">使用<span class="jill"></span>Java<span class="jill"></span>代码编写配置元数据</span></div></div><code-block class="wolai-block"><div class="wolai-pre"><div data-lang="Java" class="marker"></div><pre><span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AppConfig</span> <span class="token punctuation">{</span>
  <span class="token comment">// bean definition</span>
<span class="token punctuation">}</span></pre></div></code-block><div class="wolai-block wolai-text"><div><span class="inline-wrap">创建容器</span></div></div><code-block class="wolai-block"><div class="wolai-pre"><div data-lang="Java" class="marker"></div><pre><span class="token class-name">ApplicationContext</span> context <span class="token operator">=</span> 
    <span class="token keyword">new</span> <span class="token class-name">AnnotationConfigApplicationContext</span><span class="token punctuation">(</span><span class="token class-name">AppConfig</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">AnnotationConfigApplicationContext</span> ctx <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AnnotationConfigApplicationContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
ctx<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span><span class="token class-name">AppConfig</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">OtherConfig</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
ctx<span class="token punctuation">.</span><span class="token function">refresh</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></div></code-block><h3 class="wolai-block"><span class="inline-wrap">3.2 使用容器</span></h3><div class="wolai-block wolai-text"><div><span class="inline-wrap">容器提供了一个<span class="jill"></span>getBean<span class="jill"></span>方法，让我们可以从容器中获取<span class="jill"></span>Bean</span></div></div><code-block class="wolai-block"><div class="wolai-pre"><div data-lang="Java" class="marker"></div><pre><span class="token class-name">PetStoreService</span> service <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token string">"petStore"</span><span class="token punctuation">,</span> <span class="token class-name">PetStoreService</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></div></code-block><h2 class="wolai-block"><span class="inline-wrap">4.让容器创建<span class="jill"></span>Bean</span></h2><div class="wolai-block wolai-text"><div><span class="inline-wrap">这一节我们来讲解如何让容器创建和管理<span class="jill"></span>Bean。</span></div></div><h3 class="wolai-block"><span class="inline-wrap">@Configuration<span class="jill"></span>与<span class="jill"></span>@Bean</span></h3><div class="wolai-block wolai-text"><div><span class="inline-wrap">Spring IoC<span class="jill"></span>容器管理一到多个<span class="jill"></span>Bean.我们在配置元数据中对<span class="jill"></span>Bean<span class="jill"></span>进行定义。</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">@Configuration<span class="jill"></span>修饰的类就是配置类，是配置元数据的一种，另一种其实就是<span class="jill"></span>XML<span class="jill"></span>配置。</span></div></div><code-block class="wolai-block"><div class="wolai-pre"><div data-lang="Java" class="marker"></div><pre><span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AppConfig</span>  <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">Student</span> <span class="token function">student</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></pre></div></code-block><div class="wolai-block wolai-text"><div><span class="inline-wrap">上面的例子创建了一个<span class="jill"></span>Bean，Bean<span class="jill"></span>的名字是<span class="jill"></span>student。</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">Spring<span class="jill"></span>容器内部使用</span><span class="inline-wrap"><code>BeanDefinition</code></span><span class="inline-wrap">对象来代表这些<span class="jill"></span>Bean。</span><span class="inline-wrap"><a href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/beans/factory/config/BeanDefinition.html"><span>BeanDefinition API</span></a></span></div></div><h3 class="wolai-block"><span class="inline-wrap">@ComponentScan<span class="jill"></span>与<span class="jill"></span>@Component</span></h3><div class="wolai-block wolai-text"><div><span class="inline-wrap">@ComponentScan:扫描组件</span></div></div><code-block class="wolai-block"><div class="wolai-pre"><div data-lang="Java" class="marker"></div><pre><span class="token annotation punctuation">@ComponentScan</span>（value<span class="token operator">=</span><span class="token string">"com.hdr"</span><span class="token punctuation">,</span> includeFilters <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Filter</span><span class="token punctuation">(</span>type<span class="token operator">=</span><span class="token class-name">FilterType</span><span class="token punctuation">.</span>ANNOTATION<span class="token punctuation">,</span>classes<span class="token operator">=</span><span class="token punctuation">{</span><span class="token class-name">Controller</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token annotation punctuation">@Filter</span><span class="token punctuation">(</span>type<span class="token operator">=</span><span class="token class-name">FilterType</span><span class="token punctuation">.</span>ASSIGNABLE_TYPE<span class="token punctuation">,</span>classes<span class="token operator">=</span><span class="token punctuation">{</span><span class="token class-name">BookService</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>）</pre></div></code-block><div class="wolai-block wolai-text"><div><span class="inline-wrap">@Component:组件</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">@Controller @Service @Repository</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">上面三种注解都是用来注册<span class="jill"></span>Bean<span class="jill"></span>的,分表代表表现层的<span class="jill"></span>Bean,业务层的<span class="jill"></span>Bean,持久层的<span class="jill"></span>Bean.</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">查看源码会发现，这三个注解都是组合了<span class="jill"></span>@Component<span class="jill"></span>的。</span></div></div><h3 class="wolai-block"><span class="inline-wrap">@Conditional</span></h3><div class="wolai-block wolai-text"><div><span class="inline-wrap">制定条件，满足条件的<span class="jill"></span>Bean<span class="jill"></span>才注入容器</span></div></div><code-block class="wolai-block"><div class="wolai-pre"><div data-lang="Java" class="marker"></div><pre><span class="token annotation punctuation">@Target</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token class-name">ElementType</span><span class="token punctuation">.</span>TYPE<span class="token punctuation">,</span> <span class="token class-name">ElementType</span><span class="token punctuation">.</span>METHOD<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Retention</span><span class="token punctuation">(</span><span class="token class-name">RetentionPolicy</span><span class="token punctuation">.</span>RUNTIME<span class="token punctuation">)</span>
<span class="token annotation punctuation">@Documented</span>
<span class="token keyword">public</span> <span class="token annotation punctuation">@interface</span> <span class="token class-name">Conditional</span> <span class="token punctuation">{</span>

   <span class="token doc-comment comment">/**
    * All <span class="token punctuation">{</span><span class="token keyword">@link</span> <span class="token reference"><span class="token class-name">Condition</span></span> Conditions<span class="token punctuation">}</span> that must <span class="token punctuation">{</span><span class="token keyword">@linkplain</span> <span class="token reference"><span class="token class-name">Condition</span><span class="token punctuation">#</span><span class="token field">matches</span></span> match<span class="token punctuation">}</span>
    * in order for the component to be registered.
    */</span>
   <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">Condition</span><span class="token punctuation">></span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span></pre></div></code-block><div class="wolai-block wolai-text"><div><span class="inline-wrap">可以看到该注解需要一个</span><span class="inline-wrap"><code>Condition</code></span><span class="inline-wrap">类型的数组</span></div></div><code-block class="wolai-block"><div class="wolai-pre"><div data-lang="Java" class="marker"></div><pre><span class="token annotation punctuation">@FunctionalInterface</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Condition</span> <span class="token punctuation">{</span>

   <span class="token doc-comment comment">/**
    * Determine if the condition matches.
    * <span class="token keyword">@param</span> <span class="token parameter">context</span> the condition context
    * <span class="token keyword">@param</span> <span class="token parameter">metadata</span> metadata of the <span class="token punctuation">{</span><span class="token keyword">@link</span> <span class="token reference"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>core<span class="token punctuation">.</span>type<span class="token punctuation">.</span></span><span class="token class-name">AnnotationMetadata</span></span> class<span class="token punctuation">}</span>
    * or <span class="token punctuation">{</span><span class="token keyword">@link</span> <span class="token reference"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>core<span class="token punctuation">.</span>type<span class="token punctuation">.</span></span><span class="token class-name">MethodMetadata</span></span> method<span class="token punctuation">}</span> being checked
    * <span class="token keyword">@return</span> <span class="token punctuation">{</span><span class="token keyword">@code</span> <span class="token code-section"><span class="token code language-java"><span class="token boolean">true</span></span></span><span class="token punctuation">}</span> if the condition matches and the component can be registered,
    * or <span class="token punctuation">{</span><span class="token keyword">@code</span> <span class="token code-section"><span class="token code language-java"><span class="token boolean">false</span></span></span><span class="token punctuation">}</span> to veto the annotated component's registration
    */</span>
   <span class="token keyword">boolean</span> <span class="token function">matches</span><span class="token punctuation">(</span><span class="token class-name">ConditionContext</span> context<span class="token punctuation">,</span> <span class="token class-name">AnnotatedTypeMetadata</span> metadata<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span></pre></div></code-block><h3 class="wolai-block"><span class="inline-wrap">@Import</span></h3><h4 class="wolai-block"><span class="inline-wrap">1.导入<span class="jill"></span>@Configuration<span class="jill"></span>类</span></h4><h4 class="wolai-block"><span class="inline-wrap">2.导入<span class="jill"></span>ImportSelector<span class="jill"></span>类</span></h4><div class="wolai-block wolai-text"><div><span class="inline-wrap">该接口的实现类需要实现</span><span class="inline-wrap"><code>selectImports</code></span><span class="inline-wrap">方法，该方法返回一个字符串数组，该数组的元素是需要导入到容器中的<span class="jill"></span>bean<span class="jill"></span>的全类名。</span></div></div><code-block class="wolai-block"><div class="wolai-pre"><div data-lang="Java" class="marker"></div><pre><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyImportSelector</span> <span class="token keyword">implements</span> <span class="token class-name">ImportSelector</span> <span class="token punctuation">{</span>
  <span class="token annotation punctuation">@Override</span>
  <span class="token keyword">public</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">selectImports</span><span class="token punctuation">(</span><span class="token class-name">AnnotationMetadata</span> importingClassMetadata<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span><span class="token string">"com.hdr.learn.spring.bean.CustomManager"</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></pre></div></code-block><h4 class="wolai-block"><span class="inline-wrap">3.导入<span class="jill"></span>ImportBeanDefinitionRegistrar<span class="jill"></span>类</span></h4><div class="wolai-block wolai-text"><div><span class="inline-wrap">该接口的实现类需要实现</span><span class="inline-wrap"><code>registerBeanDefinitions</code></span><span class="inline-wrap">方法，该方法直接把<span class="jill"></span>Bean<span class="jill"></span>注册进容器。</span></div></div><code-block class="wolai-block"><div class="wolai-pre"><div data-lang="Java" class="marker"></div><pre><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyImportBeanDefinitionRegistrar</span> <span class="token keyword">implements</span> <span class="token class-name">ImportBeanDefinitionRegistrar</span> <span class="token punctuation">{</span>

   <span class="token annotation punctuation">@Override</span>
   <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">registerBeanDefinitions</span><span class="token punctuation">(</span><span class="token class-name">AnnotationMetadata</span> importingClassMetadata<span class="token punctuation">,</span> 
                                       <span class="token class-name">BeanDefinitionRegistry</span> registry<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token class-name">RootBeanDefinition</span> beanDefinition <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RootBeanDefinition</span><span class="token punctuation">(</span><span class="token class-name">CustomManager</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      registry<span class="token punctuation">.</span><span class="token function">registerBeanDefinition</span><span class="token punctuation">(</span><span class="token string">"MyCustomManager"</span><span class="token punctuation">,</span>beanDefinition<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span></pre></div></code-block><h3 class="wolai-block"><span class="inline-wrap">@ImportResource</span></h3><div class="wolai-block wolai-text"><div><span class="inline-wrap">导入<span class="jill"></span>XML<span class="jill"></span>配置</span></div></div><code-block class="wolai-block"><div class="wolai-pre"><div data-lang="Java" class="marker"></div><pre><span class="token annotation punctuation">@ImportResource</span><span class="token punctuation">(</span><span class="token string">"classpath:/com/acme/properties-config.xml"</span><span class="token punctuation">)</span></pre></div></code-block><h3 class="wolai-block"><span class="inline-wrap">FactoryBean</span></h3><div class="wolai-block wolai-text"><div><span class="inline-wrap">把该接口的实现类注册为<span class="jill"></span>Bean，从容器中获取到的<span class="jill"></span>Bean，不是该<span class="jill"></span>Bean，而是该实现类的</span><span class="inline-wrap"><code>getObject</code></span><span class="inline-wrap">方法返回的对象。</span></div></div><code-block class="wolai-block"><div class="wolai-pre"><div data-lang="Java" class="marker"></div><pre><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CustomManagerFactoryBean</span> <span class="token keyword">implements</span> <span class="token class-name">FactoryBean</span> <span class="token punctuation">{</span>
   <span class="token annotation punctuation">@Override</span>
   <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">getObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">CustomManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   <span class="token annotation punctuation">@Override</span>
   <span class="token keyword">public</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">></span></span> <span class="token function">getObjectType</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token class-name">CustomManager</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span></pre></div></code-block><div class="wolai-block wolai-text"><div><span class="inline-wrap">BeanFactory<span class="jill"></span>与<span class="jill"></span>FactoryBean</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">BeanFactory<span class="jill"></span>是一个工厂用来生产<span class="jill"></span>Bean，FactoryBean<span class="jill"></span>本身就是一个<span class="jill"></span>Bean，它是一个工厂，用来提供<span class="jill"></span>Bean。</span></div></div><h2 class="wolai-block"><span class="inline-wrap">5.Bean<span class="jill"></span>的属性</span></h2><h3 class="wolai-block"><span class="inline-wrap">Bean<span class="jill"></span>的命名与描述</span></h3><code-block class="wolai-block"><div class="wolai-pre"><div data-lang="Java" class="marker"></div><pre><span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AppConfig</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Bean</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"myThing"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">Thing</span> <span class="token function">thing</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Thing</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Bean</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token string">"dataSource"</span><span class="token punctuation">,</span> <span class="token string">"subsystemA-dataSource"</span><span class="token punctuation">,</span> <span class="token string">"subsystemB-dataSource"</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">DataSource</span> <span class="token function">dataSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// instantiate, configure and return DataSource bean...</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token annotation punctuation">@Description</span><span class="token punctuation">(</span><span class="token string">"Provides a basic example of a bean"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">Thing</span> <span class="token function">thing</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Thing</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></pre></div></code-block><h3 class="wolai-block"><span class="inline-wrap">Bean<span class="jill"></span>的作用域</span></h3><ul class="wolai-block"><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">singleton   单例</span></li><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">prototype   每次获取，都是一个新的<span class="jill"></span>Bean</span></li><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">request      一次新的请求，创建一个新的<span class="jill"></span>Bean</span></li><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">session      一次新的会话，创建一个新的<span class="jill"></span>Bean</span></li><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">application  一个新的<span class="jill"></span>Servlet<span class="jill"></span>上下文，创建一个新的<span class="jill"></span>Bean</span></li><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">WebSocket 一个新的<span class="jill"></span>WebSocket，创建一个新的<span class="jill"></span>Bean</span></li></ul><code-block class="wolai-block"><div class="wolai-pre"><div data-lang="Java" class="marker"></div><pre><span class="token annotation punctuation">@Bean</span>
<span class="token annotation punctuation">@Scope</span><span class="token punctuation">(</span>SCOPE_PROTOTYPE<span class="token punctuation">)</span>  <span class="token comment">// 默认singleton</span>
<span class="token comment">// ConfigurableBeanFactory.SCOPE_PROTOTYPE, ConfigurableBeanFactory.SCOPE_SINGLETON, WebApplicationContext.SCOPE_REQUEST, WebApplicationContext.SCOPE_SESSION,</span>
<span class="token keyword">public</span> <span class="token class-name">Wheel</span> <span class="token function">wheel</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Wheel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token annotation punctuation">@RequestScope</span>
<span class="token annotation punctuation">@SessionScope</span>
<span class="token annotation punctuation">@ApplicationScope</span></pre></div></code-block><h3 class="wolai-block"><span class="inline-wrap">懒加载<span class="jill"></span>Bean</span></h3><div class="wolai-block wolai-text"><div><span class="inline-wrap">懒加载<span class="jill"></span>Bean，在需要用到这个<span class="jill"></span>Bean<span class="jill"></span>的时候，才初始化这个<span class="jill"></span>Bean。</span></div></div><code-block class="wolai-block"><div class="wolai-pre"><div data-lang="Java" class="marker"></div><pre><span class="token annotation punctuation">@Bean</span>
<span class="token annotation punctuation">@Lazy</span>
<span class="token keyword">public</span> <span class="token class-name">Wheel</span> <span class="token function">wheel</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Wheel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></pre></div></code-block><h2 class="wolai-block"><span class="inline-wrap">6.Bean<span class="jill"></span>的生命周期回调</span></h2><div class="wolai-block wolai-text"><div><span class="inline-wrap">Bean<span class="jill"></span>的生命周期回调允许我们在<span class="jill"></span>Bean<span class="jill"></span>创建完毕和销毁之前执行某些操作。</span></div></div><h4 class="wolai-block"><span class="inline-wrap">1.initMethod<span class="jill"></span>与<span class="jill"></span>destroyMethod</span></h4><code-block class="wolai-block"><div class="wolai-pre"><div data-lang="Java" class="marker"></div><pre><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Bean</span> <span class="token punctuation">{</span>
  <span class="token comment">// 创建该Bean的时候调用</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// initialization logic</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 摧毁该Bean的时候调用</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">cleanup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// destruction logic</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AppConfig</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Bean</span><span class="token punctuation">(</span>initMethod <span class="token operator">=</span> <span class="token string">"init"</span><span class="token punctuation">,</span> destroyMethod <span class="token operator">=</span> <span class="token string">"cleanup"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">Bean</span> <span class="token function">bean</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Bean</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span></pre></div></code-block><h4 class="wolai-block"><span class="inline-wrap">2.InitializingBean<span class="jill"></span>与<span class="jill"></span>DisposableBean</span></h4><code-block class="wolai-block"><div class="wolai-pre"><div data-lang="Java" class="marker"></div><pre><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">InitializingBean</span> <span class="token punctuation">{</span>
   <span class="token keyword">void</span> <span class="token function">afterPropertiesSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">DisposableBean</span> <span class="token punctuation">{</span>
  <span class="token keyword">void</span> <span class="token function">destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></pre></div></code-block><h4 class="wolai-block"><span class="inline-wrap">3.@PostConstruct 与 @PreDestroy</span></h4><code-block class="wolai-block"><div class="wolai-pre"><div data-lang="Java" class="marker"></div><pre><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CustomerService</span>
<span class="token punctuation">{</span>
  <span class="token class-name">String</span> message<span class="token punctuation">;</span>
  
  <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> message<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setMessage</span><span class="token punctuation">(</span><span class="token class-name">String</span> message<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>message <span class="token operator">=</span> message<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  
  <span class="token annotation punctuation">@PostConstruct</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">initIt</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Init method after properties are set : "</span> <span class="token operator">+</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  
  <span class="token annotation punctuation">@PreDestroy</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">cleanUp</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Spring Container is destroy! Customer clean up"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  
<span class="token punctuation">}</span></pre></div></code-block><h2 class="wolai-block"><span class="inline-wrap">6.Bean<span class="jill"></span>的组装</span></h2><code-block class="wolai-block"><div class="wolai-pre"><div data-lang="Java" class="marker"></div><pre><span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">Wheel</span> <span class="token function">wheel</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Wheel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">Car</span> <span class="token function">car</span><span class="token punctuation">(</span><span class="token class-name">Wheel</span> wheel<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 通过方法参数的方式获取依赖,一般用于从容器中获取依赖</span>
  <span class="token class-name">Car</span> car <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Car</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  car<span class="token punctuation">.</span><span class="token function">setWheel</span><span class="token punctuation">(</span>wheel<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> car<span class="token punctuation">;</span>
<span class="token punctuation">}</span>  

<span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">Car</span> <span class="token function">car</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token class-name">Car</span> car <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Car</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 通过调用方法的方式获取依赖,一般是调用配置类中的其他创建Bean的方法。</span>
  car<span class="token punctuation">.</span><span class="token function">setWheel</span><span class="token punctuation">(</span><span class="token function">wheel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> car<span class="token punctuation">;</span>
<span class="token punctuation">}</span></pre></div></code-block><h2 class="wolai-block"><span class="inline-wrap">7.方法注入</span></h2><code-block class="wolai-block"><div class="wolai-pre"><div data-lang="Java" class="marker"></div><pre><span class="token comment">// 方法注入 实现从Singleton类型的Bean中获取prototype类型的Bean</span>
<span class="token comment">// @Lookup 修饰的方法逻辑上会被替换为调用getBean方法</span>
<span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MethodLookupTest</span> <span class="token punctuation">{</span>
    
  <span class="token annotation punctuation">@Component</span>
  <span class="token annotation punctuation">@Scope</span><span class="token punctuation">(</span><span class="token string">"prototype"</span><span class="token punctuation">)</span>
  <span class="token keyword">class</span> <span class="token class-name">SchoolNotification</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token class-name">SchoolNotification</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">LocalTime</span><span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">" new notice created"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token annotation punctuation">@Component</span>
  <span class="token keyword">class</span> <span class="token class-name">StudentServices</span> <span class="token punctuation">{</span>
    <span class="token comment">// 逻辑上该方法被替换为 ctx.getBean(SchoolNotification.class)</span>
    <span class="token annotation punctuation">@Lookup</span>
    <span class="token keyword">public</span> <span class="token class-name">SchoolNotification</span> <span class="token function">getNotification</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">ApplicationContext</span> ctx <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AnnotationConfigApplicationContext</span><span class="token punctuation">(</span><span class="token class-name">MethodLookupTest</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">StudentServices</span> studentServices <span class="token operator">=</span>  ctx<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token class-name">StudentServices</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    studentServices<span class="token punctuation">.</span><span class="token function">getNotification</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    studentServices<span class="token punctuation">.</span><span class="token function">getNotification</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span></pre></div></code-block><h2 class="wolai-block"><span class="inline-wrap">8.Bean<span class="jill"></span>依赖注入后处理器</span></h2><code-block class="wolai-block"><div class="wolai-pre"><div data-lang="Java" class="marker"></div><pre><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">BeanPostProcessor</span> <span class="token punctuation">{</span>
  <span class="token comment">// Initialization之前执行（就是上面提到的init方法）</span>
  <span class="token annotation punctuation">@Nullable</span>
  <span class="token keyword">default</span> <span class="token class-name">Object</span> <span class="token function">postProcessBeforeInitialization</span><span class="token punctuation">(</span><span class="token class-name">Object</span> bean<span class="token punctuation">,</span> <span class="token class-name">String</span> beanName<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">BeansException</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> bean<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// Initialization之后执行（就是上面提到的init方法）</span>
  <span class="token annotation punctuation">@Nullable</span>
  <span class="token keyword">default</span> <span class="token class-name">Object</span> <span class="token function">postProcessAfterInitialization</span><span class="token punctuation">(</span><span class="token class-name">Object</span> bean<span class="token punctuation">,</span> <span class="token class-name">String</span> beanName<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">BeansException</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> bean<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span></pre></div></code-block><div class="wolai-block wolai-center"><figure style="width: 100%"><img src="media/springbean%E5%88%9D%E5%A7%8B%E5%8C%96%E6%B5%81%E7%A8%8B.jpg" style="width: 760px"/></figure></div><div class="wolai-block wolai-center"><figure style="width: 100%"><img src="media/bean%E7%9A%84%E5%88%9B%E5%BB%BA%E5%88%9D%E5%A7%8B%E5%8C%96%E8%BF%87%E7%A8%8B.jpg" style="width: 760px"/></figure></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">容器创建 -&gt; 加载<span class="jill"></span>Bean<span class="jill"></span>定义 -&gt; Bean<span class="jill"></span>定义后置处理 -&gt; 容器后置处理 -&gt; 创建<span class="jill"></span>Bean<span class="jill"></span>实例 -&gt; 依赖注入 -&gt; BPP -&gt; Init -&gt; BPP -&gt; SmartInitializingSingleton#afterSingletonsInstantiated -&gt;准备好的<span class="jill"></span>Bean</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap"><code>BeanDefinitionRegistryPostProcessor</code></span><span class="inline-wrap">：</span><span class="inline-wrap"><code>BeanFactoryPostProcessor</code></span><span class="inline-wrap">的子接口，在执行</span><span class="inline-wrap"><code>BeanFactoryPostProcessor</code></span><span class="inline-wrap">之前执行，可以往容器添加更多的<span class="jill"></span>Bean<span class="jill"></span>定义</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap"><code>BeanFactoryPostProcessor</code></span><span class="inline-wrap">： </span><span class="inline-wrap"><code>BeanFactoryPostProcessor</code></span><span class="inline-wrap">的实现会在加载完所有</span><span class="inline-wrap"><code>BeanDefinition</code></span><span class="inline-wrap">但未创建任何<span class="jill"></span>Bean<span class="jill"></span>时被调用。通过它你可以对<span class="jill"></span>BeanDefinition<span class="jill"></span>进行修改，甚至提前初始化<span class="jill"></span>Bean</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap"><code>BeanPostProcessor</code></span><span class="inline-wrap"> ：A bean implementing </span><span class="inline-wrap"><code>BeanPostProcessor</code></span><span class="inline-wrap"> operate on bean (or object) instances which means that when the Spring IoC container instantiates a bean instance then BeanPostProcessor interfaces do their work.</span></div></div><div class="wolai-block wolai-text"><div></div></div></article><footer></footer></body></html>