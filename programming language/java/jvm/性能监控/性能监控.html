<!DOCTYPE html>
<html lang="zh-Hans-CN"><head><meta charset="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=Edge"/><link rel="stylesheet" type="text/css" href="../../../../css/modern-norm.min.css"/><link rel="stylesheet" type="text/css" href="../../../../css/prism.min.css"/><link rel="stylesheet" type="text/css" href="../../../../css/katex.min.css"/><link rel="stylesheet" type="text/css" href="../../../../css/wolai.css"/><title>性能监控 - wolai 笔记</title><link rel="shortcut icon"></link></head><body><header><div class="image"></div><div class="title"><div class="banner"><div class="icon"></div></div><div data-title="性能监控" class="main-title"></div></div></header><article><h2 class="wolai-block"><span class="inline-wrap">进程监控工具</span></h2><details class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">top</span></summary><code-block class="wolai-block"><div class="wolai-pre"><div data-lang="PowerShell" class="marker"></div><pre><span class="token comment"># 查看所有进程</span>
top 
<span class="token comment"># 查看指定进程</span>
top <span class="token operator">-</span>p pid
<span class="token comment"># 查看指定进程及其线程（线程模式）</span>
top <span class="token operator">-</span>H <span class="token operator">-</span>p pid</pre></div></code-block></details><details class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">htop</span></summary><div class="wolai-block wolai-center"><figure><img src="media/htop%E7%AE%80%E4%BB%8B.png" style="width: 760px"/></figure></div><ul class="wolai-block"><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">最上面依次显示的是各<span class="jill"></span>CPU<span class="jill"></span>核心的使用情况，内存使用情况，交换区使用情况</span></li><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">PID：进程<span class="jill"></span>ID</span></li><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">USER：启动该程序的用户</span></li><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">PRI：进程的优先级</span></li><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">NI： </span><span class="inline-wrap"><a href="https://askubuntu.com/questions/656771/process-niceness-vs-priority"><span>Process &#39;niceness&#39; vs. &#39;priority&#39;</span></a></span><ul class="wolai-block"><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>NI</b></span><span class="inline-wrap"> is the nice value, which is a user-space concept.</span></li><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>PR</b></span><span class="inline-wrap"> is the process&#39;s actual priority, as viewed by the Linux kernel.</span></li></ul></li><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">VIRT：虚拟内存使用情况</span></li><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">RES：常驻内存大小</span></li><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">SHR：共享内存大小</span></li><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">自从上次屏幕更新后的 CPU 使用率</span></li><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">自从上次屏幕更新后的 </span><span class="inline-wrap"><code>RES</code></span><span class="inline-wrap"> 常驻内存使用率</span></li><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">程序启动至今占用的<span class="jill"></span>CPU<span class="jill"></span>时间</span></li></ul><div class="wolai-block wolai-text"><div><span class="inline-wrap">确切知道 </span><span class="inline-wrap"><code>VIRT</code></span><span class="inline-wrap">，</span><span class="inline-wrap"><code>RES</code></span><span class="inline-wrap"> 和 </span><span class="inline-wrap"><code>SHR</code></span><span class="inline-wrap"> 值代表什么在日常操作中并不重要。重要的是要知道 </span><span class="inline-wrap"><code>VIRT</code></span><span class="inline-wrap"> 值最高的进程就是内存使用最多的进程。</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">除了界面列出的快捷键以外，还有一些带有其它功能的快捷键，例如：</span></div></div><ul class="wolai-block"><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>u</code></span><span class="inline-wrap"> 可以选择显示某个用户的进程。</span></li><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>Shift+m</code></span><span class="inline-wrap"> 可以按照内存使用量对进程列表排序。</span></li><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>Shift+p</code></span><span class="inline-wrap"> 可以按照 CPU 使用量对进程列表排序。</span></li><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>Shit+t</code></span><span class="inline-wrap"> 可以按照进程启动时间对进程列表排序。</span></li><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>CTRL+l</code></span><span class="inline-wrap"> 刷新界面</span></li></ul></details><h2 class="wolai-block"><span class="inline-wrap">网络监工具</span></h2><details class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">netstat</span></summary><code-block class="wolai-block"><div class="wolai-pre"><div data-lang="PowerShell" class="marker"></div><pre><span class="token comment"># 列出正在监听的端口</span>
netstat <span class="token operator">-</span>l
<span class="token comment"># 列出正在监听的端口，对域名进行解析</span>
netstat <span class="token operator">-</span>ln
<span class="token comment"># 列出使用TCP协议的正在监听的端口，对域名进行解析</span>
netstat <span class="token operator">-</span>lnt
<span class="token comment"># 列出正在监听的端口，以及监听该端口的进程名称和Id (root用户可以显示所有，其它用户只能看到自己启动的进程名称和Id)</span>
netstat <span class="token operator">-</span><span class="token function">lp</span></pre></div></code-block></details><details class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">tcpdump</span></summary><div class="wolai-block wolai-text"><div><span class="inline-wrap"><a href="https://www.cnblogs.com/chyingp/p/linux-command-tcpdump.html"><span>https://www.cnblogs.com/chyingp/p/linux-command-tcpdump.html</span></a></span></div></div></details><ul class="wolai-block"><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">ifconfig</span></li><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">nslookup</span></li><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">ping</span></li><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">traceroute</span></li></ul><hr class="wolai-block"/><h2 class="wolai-block"><span class="inline-wrap">Java<span class="jill"></span>性能监控</span></h2><div class="wolai-block wolai-text"><div><span class="inline-wrap">在图形化工具方面，感觉<span class="jill"></span>VisualVM<span class="jill"></span>比<span class="jill"></span>JMC<span class="jill"></span>好用且稳定，但是<span class="jill"></span>VisualVM<span class="jill"></span>在<span class="jill"></span>JFR<span class="jill"></span>方面有所欠缺，所以两者配合着用吧。在实际操作中，一般是不允许<span class="jill"></span>GUI<span class="jill"></span>工具连接线上虚拟机的，所以要掌握一些核心命令，通过命令导出分析数据，再配合图形化工具进行分析。</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap"></span><br/></div></div><details class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">Java<span class="jill"></span>性能监控基础知识</span></summary><div class="wolai-block wolai-text"><div><span class="inline-wrap">Used、Committed、Max Memory</span></div></div><div class="wolai-bookmark wolai-block"><a href="https://stackoverflow.com/questions/41468670/difference-in-used-committed-and-max-heap-memory">Difference in Used, Committed and Max Heap Memory</a><div class="info-box"><div class="text-pane"><div data-title="Difference in Used, Committed and Max Heap Memory"></div><div data-desc="I am monitoring a spark executor JVM of a OutOfMemoryException. I used Jconsole to connect to executor JVM. Following is the snapshot of Jconsole:
In the image used memory is shown as 3.8G and com..."></div><div class="icon-host"><div class="icon icon-image" style="background-image: url(&quot;https://cdn.sstatic.net/Sites/stackoverflow/Img/apple-touch-icon.png?v=c78bd457575a&quot;)"></div><div data-hostname="stackoverflow.com"></div></div></div><div class="preview-pane" style="background-image: url(https://cdn.sstatic.net/Sites/stackoverflow/Img/apple-touch-icon.png?v=c78bd457575a)"></div></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">Sampler &amp; Profiler</span></div></div><div class="wolai-bookmark wolai-block"><a href="https://stackoverflow.com/questions/39655945/whats-the-difference-between-sampler-and-profiler-in-jvisualvm/39655977">what&#39;s the difference between sampler and profiler in JvisualVM?</a><div class="info-box"><div class="text-pane"><div data-title="what&apos;s the difference between sampler and profiler in JvisualVM?"></div><div data-desc="I found there are two plug-in in JvisualVM, one is  sampler  and another is profiler. 

I also found they have a similar UI, however the results have a big difference, so what&apos;s the difference mean..."></div><div class="icon-host"><div class="icon icon-image" style="background-image: url(&quot;https://cdn.sstatic.net/Sites/stackoverflow/Img/apple-touch-icon.png?v=c78bd457575a&quot;)"></div><div data-hostname="stackoverflow.com"></div></div></div><div class="preview-pane" style="background-image: url(https://cdn.sstatic.net/Sites/stackoverflow/Img/apple-touch-icon.png?v=c78bd457575a)"></div></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">MBean</span></div></div><div class="wolai-bookmark wolai-block"><a href="https://docs.oracle.com/javase/tutorial/jmx/mbeans/index.html">Lesson: Introducing MBeans (The Java™ Tutorials &gt; Java Management Extensions (JMX))</a><div class="info-box"><div class="text-pane"><div data-title="Lesson: Introducing MBeans (The Java™ Tutorials &gt; Java Management Extensions (JMX))"></div><div data-desc="This JMX Java tutorial describes the Java Management Extensions (JMX) technology - mbeans, notifications, and remote management"></div><div class="icon-host"><div class="icon icon-image" style="background-image: url(&quot;https://docs.oracle.com/favicon.ico&quot;)"></div><div data-hostname="docs.oracle.com"></div></div></div><div class="preview-pane"></div></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">Flame Graphis</span></div></div><div class="wolai-bookmark wolai-block"><a href="https://www.brendangregg.com/flamegraphs.html">Flame Graphs</a><div class="info-box"><div class="text-pane"><div data-title="Flame Graphs"></div><div data-desc="Homepage for Flame Graphs: a visualization for stack traces."></div><div class="icon-host"><div class="icon icon-image" style="background-image: url(&quot;https://www.brendangregg.com/favicon.ico&quot;)"></div><div data-hostname="www.brendangregg.com"></div></div></div><div class="preview-pane"></div></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">为什么<span class="jill"></span>heap dump<span class="jill"></span>大小看着有点奇怪？</span></div></div><div class="wolai-bookmark wolai-block"><a href="https://stackoverflow.com/questions/32271731/why-is-my-java-heap-dump-size-much-smaller-than-used-memory">Why is my Java heap dump size much smaller than used memory?</a><div class="info-box"><div class="text-pane"><div data-title="Why is my Java heap dump size much smaller than used memory?"></div><div data-desc="Problem

We are trying to find the culprit of a big memory leak in our web application. We have pretty limited experience with finding a memory leak, but we found out how to make a java heap dump u..."></div><div class="icon-host"><div class="icon icon-image" style="background-image: url(&quot;https://cdn.sstatic.net/Sites/stackoverflow/Img/apple-touch-icon.png?v=c78bd457575a&quot;)"></div><div data-hostname="stackoverflow.com"></div></div></div><div class="preview-pane" style="background-image: url(https://cdn.sstatic.net/Sites/stackoverflow/Img/apple-touch-icon.png?v=c78bd457575a)"></div></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap"></span><br/></div></div></details><h3 class="wolai-block"><span class="inline-wrap">Java<span class="jill"></span>监控命令</span></h3><details class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">jcmd (重点) (用于发送诊断命令给<span class="jill"></span>JVM) </span></summary><div class="wolai-block wolai-text"><div><span class="inline-wrap">查看本机运行中的<span class="jill"></span>Java<span class="jill"></span>程序</span></div></div><code-block class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre>jcmd
</pre></div></code-block><div class="wolai-block wolai-text"><div><span class="inline-wrap">查看指定的<span class="jill"></span>Java<span class="jill"></span>程序可以执行哪些诊断命令</span></div></div><code-block class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre>jcmd java_pid <span class="token builtin class-name">help</span> 
<span class="token comment"># 不同JDK版本的程序能使用的诊断命令有点区别</span>
<span class="token comment"># 总的来说，常用的诊断命令，主要有4类：</span>
<span class="token comment"># - 虚拟机相关的</span>
<span class="token comment"># - 垃圾回收相关的</span>
<span class="token comment"># - 线程相关的</span>
<span class="token comment"># - 飞行记录相关的(Java Flight Recorder)</span>
</pre></div></code-block><div class="wolai-block wolai-text"><div><span class="inline-wrap">查看具体命令的使用</span></div></div><code-block class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre><span class="token comment"># 不同JDK版本的程序能使用的诊断命令有点区别</span>
<span class="token comment"># 使用的时候，要以该命令输出的使用方式为准</span>
jcmd java_pid <span class="token builtin class-name">help</span> command_name</pre></div></code-block><details class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap"><b>Java Flight Recorder</b></span></summary><code-block class="wolai-block"><div class="wolai-pre"><div data-lang="PowerShell" class="marker"></div><pre><span class="token comment"># Java飞行记录(Java Flight Recorder)是一个低开销的用于收集Java程序运行时的诊断和侧写信息的框架。</span>
<span class="token comment"># 飞行记录功能是JDK内置的，可以在应用启动时开始记录，也可以在程序运行时开始记录。</span>
JFR<span class="token punctuation">.</span><span class="token function">start</span>
JFR<span class="token punctuation">.</span>stop
JFR<span class="token punctuation">.</span>dump
JFR<span class="token punctuation">.</span>check
JFR<span class="token punctuation">.</span>configure</pre></div></code-block><div class="wolai-block wolai-text"><div><span class="inline-wrap"><b>启动应用时开启飞行记录</b></span></div></div><code-block class="wolai-block"><div class="wolai-pre"><div data-lang="PowerShell" class="marker"></div><pre><span class="token comment"># JVM启动时后开启飞行记录功能，记录120秒，信息记录在myrecording.jfr文件</span>
<span class="token comment"># 更多参数请看https://docs.oracle.com/en/java/javase/14/docs/specs/man/java.html#advanced-runtime-options-for-java</span>
<span class="token comment"># https://docs.oracle.com/javase/10/tools/java.htm#JSWOR624</span>
<span class="token comment">#-XX:+|-FlightRecorder: Enables Java Flight Recorder (not required for JDK 8u40 and later)</span>
<span class="token comment">#-XX:FlightRecorderOptions: Sets the parameters for Java Flight Recorder</span>
<span class="token comment">#-XX:StartFlightRecording: Starts a recording with the provided parameters, or with the default values</span>

java <span class="token operator">-</span>jar app<span class="token punctuation">.</span>jar <span class="token operator">-</span>XX:StartFlightRecording=duration=120s<span class="token punctuation">,</span>filename=myrecording<span class="token punctuation">.</span>jfr</pre></div></code-block><div class="wolai-block wolai-text"><div><span class="inline-wrap"><b>启动中的应用开启飞行记录</b></span></div></div><code-block class="wolai-block"><div class="wolai-pre"><div data-lang="PowerShell" class="marker"></div><pre><span class="token comment"># 启动飞行记录</span>
jcmd java_process_id JFR<span class="token punctuation">.</span><span class="token function">start</span> <span class="token namespace">[options]</span>
<span class="token comment"># 选项</span>
name= <span class="token comment"># 本次飞行记录的名称</span>
delay=x <span class="token comment"># 等待x(s/m/h)后开始记录</span>
duration=x <span class="token comment"># 记录持续x(s/m/h) (0s表示一直记录)</span>
disk=true<span class="token operator">/</span>false <span class="token comment"># 是否把记录数据写到磁盘</span>
filename= <span class="token comment"># 停止记录时，把记录的数据写入到指定的文件中</span>
maxage= <span class="token comment">#</span>
maxsize= <span class="token comment">#</span>
settings= <span class="token comment"># 飞行记录配置文件的路径</span>
path<span class="token operator">-</span>to<span class="token operator">-</span><span class="token function">gc</span><span class="token operator">-</span>root=true<span class="token operator">/</span>false <span class="token comment"># </span>

<span class="token comment"># 停止飞行记录</span>
jcmd java_process_id JFR<span class="token punctuation">.</span>stop <span class="token namespace">[options]</span>
<span class="token comment"># 选项</span>
name= <span class="token comment"># 本次飞行记录的名称</span>
filename= <span class="token comment"># 停止记录时，把记录的数据写入到指定的文件中</span>

<span class="token comment"># 转储</span>
jcmd java_process_id JFR<span class="token punctuation">.</span>dump <span class="token namespace">[options]</span>
<span class="token comment"># 选项</span>
<span class="token comment"># 其它看https://docs.oracle.com/en/java/javase/14/docs/specs/man/jcmd.html吧，难得搬了</span></pre></div></code-block><details class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap"><b>Java Flight Recording<span class="jill"></span>实战</b></span></summary><code-block class="wolai-block"><div class="wolai-pre"><div data-lang="PowerShell" class="marker"></div><pre>jcmd java_pid JFR<span class="token punctuation">.</span><span class="token function">start</span> name=jfr duration=1h disk=true filename=$<span class="token punctuation">(</span><span class="token function">pwd</span><span class="token punctuation">)</span><span class="token operator">/</span>$<span class="token punctuation">(</span>date <span class="token string">"+%Y-%m-%dT%H:%M:%S"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>jfr</pre></div></code-block><code-block class="wolai-block"><div class="wolai-pre"><div data-lang="PowerShell" class="marker"></div><pre>jcmd java_pid JFR<span class="token punctuation">.</span>dump filename=$<span class="token punctuation">(</span><span class="token function">pwd</span><span class="token punctuation">)</span><span class="token operator">/</span>$<span class="token punctuation">(</span>date <span class="token string">"+%Y-%m-%dT%H:%M:%S"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>jfr</pre></div></code-block></details></details></details><details class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">arthas (重点)</span></summary><div class="wolai-block wolai-text"><div><span class="inline-wrap"><a href="http://hengyunabc.github.io/arthas-online-hotswap/"><span>Arthas<span class="jill"></span>实践--jad/mc/redefine<span class="jill"></span>线上热更新一条龙</span></a></span></div></div></details><details class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">old-fashioned</span></summary><details class="wolai-block"><summary><div class="marker placeholder"></div><span class="inline-wrap">jps：查看<span class="jill"></span>java<span class="jill"></span>进程，直接用<span class="jill"></span>jcmd<span class="jill"></span>就可以了</span></summary></details><details class="wolai-block"><summary><div class="marker placeholder"></div><span class="inline-wrap">jstack：用来生成所有线程以及相应的堆栈跟踪。直接用<span class="jill"></span>jcmd<span class="jill"></span>就可以了</span></summary></details><details class="wolai-block"><summary><div class="marker placeholder"></div><span class="inline-wrap">jhat：(Java Heap Analysis Tool) 从<span class="jill"></span>JDK9<span class="jill"></span>开始移除。直接用<span class="jill"></span>jcmd<span class="jill"></span>就可以了</span></summary></details><details class="wolai-block"><summary><div class="marker placeholder"></div><span class="inline-wrap">jmap：用来生成堆转储文件(heap dump)。直接用<span class="jill"></span>jcmd<span class="jill"></span>就可以了</span></summary></details></details><details class="wolai-block"><summary><div class="marker placeholder"></div><span class="inline-wrap">jstat<span class="jill"></span>与<span class="jill"></span>jstatd ?</span></summary></details><h3 class="wolai-block"><span class="inline-wrap">Java<span class="jill"></span>监控图形化工具</span></h3><details class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">VisualVM</span></summary><div class="wolai-bookmark wolai-block"><a href="https://marknienaber.medium.com/how-to-monitor-your-java-applications-jvm-70d7bddea668">https://marknienaber.medium.com/how-to-monitor-your-java-applications-jvm-70d7bddea668</a><div class="info-box"><div class="text-pane"><div data-title="marknienaber.medium.com"></div><div class="icon-host"><div data-hostname="marknienaber.medium.com"></div></div></div><div class="preview-pane"></div></div></div></details><details class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">JMC</span></summary><div class="wolai-bookmark wolai-block"><a href="https://www.youtube.com/watch?v=n65XC0eceSM">https://www.youtube.com/watch?v=n65XC0eceSM</a><div class="info-box"><div class="text-pane"><div data-title="www.youtube.com"></div><div class="icon-host"><div data-hostname="www.youtube.com"></div></div></div><div class="preview-pane"></div></div></div></details><ul class="wolai-block"><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">MAT</span></li><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><a href="https://heaphero.io/heap-index.jsp"><span>heap-hero 一个分析<span class="jill"></span>heap dump<span class="jill"></span>的网站</span></a></span></li><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><a href="https://fastthread.io/"><span>fastthread 一个分析<span class="jill"></span>thread dump<span class="jill"></span>的网站</span></a></span></li><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><a href="https://jstack.review/#tda_1_dump"><span>jstack 一个分析<span class="jill"></span>thread dump<span class="jill"></span>的网站</span></a></span></li><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><a href="https://gceasy.io/"><span>gceasy 一个分析<span class="jill"></span>GC<span class="jill"></span>日志的网站</span></a></span></li></ul><div class="wolai-block wolai-text"><div><span class="inline-wrap"></span><br/></div></div><h3 class="wolai-block"><span class="inline-wrap">实战</span></h3><details class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">实战：排查<span class="jill"></span>CPU<span class="jill"></span>占用率高</span></summary><ul class="wolai-block"><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">找出占用<span class="jill"></span>CPU<span class="jill"></span>高的线程，然后<span class="jill"></span>jcmd<span class="jill"></span>获取<span class="jill"></span>thread dump，找出对应线程当前代码</span></li></ul></details><details class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">实战：死锁排查</span></summary><ul class="wolai-block"><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">直接<span class="jill"></span>jcmd<span class="jill"></span>获取<span class="jill"></span>thread dump，扔去网站分析</span></li></ul><details class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">怎么写一个死锁？</span></summary><code-block class="wolai-block"><div class="wolai-pre"><div data-lang="纯文本" class="marker"></div><pre>o1<span class="token punctuation">,</span>o2<span class="token punctuation">;</span>

<span class="token constant">T1</span><span class="token operator">:</span>
<span class="token function">lock</span><span class="token punctuation">(</span><span class="token parameter">o1</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token comment">// do something</span>
  <span class="token function">lock</span><span class="token punctuation">(</span><span class="token parameter">o2</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token comment">// do something</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token constant">T2</span><span class="token operator">:</span>
<span class="token function">lock</span><span class="token punctuation">(</span><span class="token parameter">o2</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token comment">// do something</span>
  <span class="token function">lock</span><span class="token punctuation">(</span><span class="token parameter">o1</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token comment">// do something</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></pre></div></code-block></details></details><details class="wolai-block"><summary><div class="marker placeholder"></div><span class="inline-wrap">实战：OOM<span class="jill"></span>分析</span></summary></details><details class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">实战：内存泄露</span></summary><div class="wolai-bookmark wolai-block"><a href="https://www.zhihu.com/question/484689143/answer/2251908039?utm_source=wechat_session&amp;utm_medium=social&amp;utm_oi=560497139592011776&amp;utm_content=group3_Answer&amp;utm_campaign=shareopn">如何排查 Java 应用内存泄漏问题？ - 知乎</a><div class="info-box"><div class="text-pane"><div data-title="如何排查 Java 应用内存泄漏问题？ - 知乎"></div><div data-desc="前言最近翻看以前写的 PPT， 发现了在2019年做的一次技术分享，关于 Java 问题排查，由于没什么公司机密…"></div><div class="icon-host"><div class="icon icon-image" style="background-image: url(&quot;https://static.zhihu.com/heifetz/assets/apple-touch-icon-152.a53ae37b.png&quot;)"></div><div data-hostname="www.zhihu.com"></div></div></div><div class="preview-pane"></div></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap"></span><br/></div></div></details><div class="wolai-block wolai-text"><div><span class="inline-wrap"></span><br/></div></div><h2 class="wolai-block"><span class="inline-wrap">Java<span class="jill"></span>参数</span></h2><div class="wolai-block wolai-text"><div><span class="inline-wrap"><b>Java<span class="jill"></span>的官方文档中将启动参数分为如下三类：</b></span></div></div><div class="wolai-block wolai-simple-table"><table><thead><tr><th style="width: 185px"><span class="inline-wrap">配置 参数</span></th><th style="width: 185px"><span class="inline-wrap">类型</span></th><th style="width: 185px"><span class="inline-wrap">说明</span></th><th style="width: 185px"><span class="inline-wrap">举例</span></th></tr></thead><tbody><tr><td><span class="inline-wrap">-</span></td><td><span class="inline-wrap">standard</span></td><td><span class="inline-wrap">这些参数是标准参数，所有的虚拟机实现都需要支持这些参数</span></td><td><br/></td></tr><tr><td><span class="inline-wrap">-X</span></td><td><span class="inline-wrap">non-standard</span></td><td><span class="inline-wrap">这些参数不是虚拟机规范规定的。因此，不是所有<span class="jill"></span>VM<span class="jill"></span>的实现(如:HotSpot,JRockit,J9<span class="jill"></span>等)都支持这些配置参数。</span></td><td><span class="inline-wrap">-Xmx、-Xms、-Xmn、-Xss</span></td></tr><tr><td><span class="inline-wrap">-XX</span></td><td><span class="inline-wrap">not-stable</span></td><td><span class="inline-wrap">这些参数被称为不稳定参数，是因为这类参数的设置会引起<span class="jill"></span>JVM<span class="jill"></span>运行时性能上的差异，配置得当可以提高<span class="jill"></span>JVM<span class="jill"></span>性能，配置不当则会使<span class="jill"></span>JVM<span class="jill"></span>出现各种问题, 甚至造成<span class="jill"></span>JVM<span class="jill"></span>崩溃。</span></td><td><span class="inline-wrap">-XX:SurvivorRatio、-XX:+UseParNewGc</span></td></tr></tbody></table></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">补充: -X<span class="jill"></span>和-XX<span class="jill"></span>两种参数都可能随着<span class="jill"></span>JDK<span class="jill"></span>版本的变更而发生变化，有些参数可以能会被废弃掉，有些参数的功能会发生改变，但是<span class="jill"></span>JDK<span class="jill"></span>官方不会通知开发者这些变化，需要使用者注意。</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">对于-XX<span class="jill"></span>类型的配置选项，虚拟机规范有一些惯例，针对不同的平台虚拟机也会提供不同的默认值。</span></div></div><ul class="wolai-block"><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">对于布尔(Boolean)类型的配置选项，通过</span><span class="inline-wrap"><code>-XX:+&lt;option&gt;</code></span><span class="inline-wrap">来开启，通过</span><span class="inline-wrap"><code>-XX:-&lt;option&gt;</code></span><span class="inline-wrap">来关闭。</span></li><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">对于数字(Numberic)类型的配置选项，通过</span><span class="inline-wrap"><code>-XX:&lt;option&gt;=&lt;number&gt;</code></span><span class="inline-wrap">来配置。</span><span class="inline-wrap"><code>&lt;number&gt;</code></span><span class="inline-wrap">后面可以携带单位字母，比如: &#39;k&#39;或者&#39;K&#39;代表千字节，&#39;m&#39;或者&#39;M&#39;代表兆字节，&#39;g&#39;或者&#39;G&#39;代表千兆字节。</span></li><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">对于字符串(String)类型的配置选项，通过</span><span class="inline-wrap"><code>-XX:&lt;option&gt;=&lt;string&gt;</code></span><span class="inline-wrap">来配置。这种配置通过用来指定文件，路径或者命令列表。</span></li></ul><div class="wolai-block wolai-text"><div><span class="inline-wrap"><b>系统属性、环境变量、程序参数、Java<span class="jill"></span>参数</b></span></div></div><ul class="wolai-block"><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>System properties</b></span><span class="inline-wrap"> are set on the Java command line using the </span><span class="inline-wrap"><code>-Dpropertyname=value</code></span><span class="inline-wrap"> syntax. They can also be added at runtime using </span><span class="inline-wrap"><a href="http://docs.oracle.com/javase/8/docs/api/java/lang/System.html#setProperty-java.lang.String-java.lang.String-"><span><code>System.setProperty(String key, String value)</code></span></a></span><span class="inline-wrap"> or via the various </span><span class="inline-wrap"><a href="http://docs.oracle.com/javase/8/docs/api/java/util/Properties.html#load-java.io.InputStream-"><span><code>System.getProperties().load()</code></span></a></span><span class="inline-wrap"> methods.To get a specific </span><span class="inline-wrap"><i>system property</i></span><span class="inline-wrap"> you can use </span><span class="inline-wrap"><a href="http://docs.oracle.com/javase/8/docs/api/java/lang/System.html#getProperty-java.lang.String-"><span><code>System.getProperty(String key)</code></span></a></span><span class="inline-wrap"> or </span><span class="inline-wrap"><a href="http://docs.oracle.com/javase/8/docs/api/java/lang/System.html#getProperty-java.lang.String-java.lang.String-"><span><code>System.getProperty(String key, String def)</code></span></a></span><span class="inline-wrap">.</span></li><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>Environment variables</b></span><span class="inline-wrap"> are set in the OS, e.g. in Linux </span><span class="inline-wrap"><code>export HOME=/Users/myusername</code></span><span class="inline-wrap"> or on Windows </span><span class="inline-wrap"><code>SET WINDIR=C:\Windows</code></span><span class="inline-wrap"> etc, and, unlike properties, may </span><span class="inline-wrap"><i>not</i></span><span class="inline-wrap"> be set at runtime.
To get a specific </span><span class="inline-wrap"><i>environment variable</i></span><span class="inline-wrap"> you can use </span><span class="inline-wrap"><a href="http://docs.oracle.com/javase/8/docs/api/java/lang/System.html#getenv-java.lang.String-"><span><code>System.getenv(String name)</code></span></a></span><span class="inline-wrap">.</span></li><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>Program arguments</b></span><span class="inline-wrap"> 会传递到<span class="jill"></span>main<span class="jill"></span>方法的<span class="jill"></span>args<span class="jill"></span>变量</span></li><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>Java<span class="jill"></span>参数</b></span></li></ul><div class="wolai-block wolai-text"><div></div></div></article><footer></footer></body></html>