<!DOCTYPE html>
<html lang="zh-Hans-CN"><head><meta charset="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=Edge"/><link rel="stylesheet" type="text/css" href="../../../css/modern-norm.min.css"/><link rel="stylesheet" type="text/css" href="../../../css/prism.min.css"/><link rel="stylesheet" type="text/css" href="../../../css/katex.min.css"/><link rel="stylesheet" type="text/css" href="../../../css/wolai.css"/><title>面向对象 - wolai 笔记</title><link rel="shortcut icon" href="data:image/svg+xml,%3Csvg xmlns=&apos;http://www.w3.org/2000/svg&apos; viewBox=&apos;0 0 800 800&apos;%3E%3Cdefs%3E%3Cstyle%3E.cls-1%7Bfill:%23fff;%7D%3C/style%3E%3C/defs%3E%3Cg%3E%3Cpath class=&apos;cls-1&apos; d=&apos;M610.08,0c66,0,90,6.88,114.13,19.79a134.62,134.62,0,0,1,56,56l2.28,4.4C793.93,103,800,127.88,800,189.92V610.08l-.08,11.56c-.78,57.38-7.58,79.89-19.71,102.57a134.62,134.62,0,0,1-56,56l-4.4,2.28C697,793.93,672.12,800,610.08,800H189.92l-11.56-.08c-57.38-.78-79.89-7.58-102.57-19.71a134.62,134.62,0,0,1-56-56l-2.28-4.4C6.44,697.75.4,673.72,0,616L0,189.92c0-66,6.88-90,19.79-114.13a134.62,134.62,0,0,1,56-56l4.4-2.28C102.25,6.44,126.28.4,184,0Z&apos;/%3E%3Cpath d=&apos;M610.08,0c66,0,90,6.88,114.13,19.79a134.62,134.62,0,0,1,56,56l2.28,4.4C793.93,103,800,127.88,800,189.92V610.08l-.08,11.56c-.78,57.38-7.58,79.89-19.71,102.57a134.62,134.62,0,0,1-56,56l-4.4,2.28C697,793.93,672.12,800,610.08,800H189.92l-11.56-.08c-57.38-.78-79.89-7.58-102.57-19.71a134.62,134.62,0,0,1-56-56l-2.28-4.4C6.44,697.75.4,673.72,0,616L0,189.92c0-66,6.88-90,19.79-114.13a134.62,134.62,0,0,1,56-56l4.4-2.28C102.25,6.44,126.28.4,184,0Zm4.72,88.9H185.2L172.42,89c-32.78.62-43.68,3.24-54.71,9.14a45.84,45.84,0,0,0-19.54,19.54c-6.61,12.36-9.11,24.55-9.27,67.49V614.8L89,627.58c.62,32.78,3.24,43.68,9.14,54.71a45.84,45.84,0,0,0,19.54,19.54c12.36,6.61,24.55,9.11,67.49,9.27H610.08c46.79,0,59.41-2.44,72.21-9.28a45.84,45.84,0,0,0,19.54-19.54c6.61-12.36,9.11-24.55,9.27-67.49V189.92c0-46.79-2.44-59.41-9.28-72.21a45.84,45.84,0,0,0-19.54-19.54C669.93,91.56,657.74,89.06,614.8,88.9ZM233.33,493.33A73.34,73.34,0,1,1,160,566.67,73.35,73.35,0,0,1,233.33,493.33Z&apos;/%3E%3C/g%3E%3C/svg%3E"></link></head><body><header><div class="image"></div><div class="title"><div class="banner"><div class="icon"></div></div><div data-title="面向对象" class="main-title"></div></div></header><article><h2 class="wolai-block"><span class="inline-wrap">对象</span></h2><ul class="wolai-block"><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">定义</span></li><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">对象直接量</span></li><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">对象的属性</span></li><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">对象的特殊属性 prototype</span></li><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">对象方法</span></li><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">对象的序列化</span></li></ul><div class="wolai-block wolai-text"><div><span class="inline-wrap"><b>定义</b></span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">简单说，对象就是一组“键值对”（key-value）的集合，是一种无序的复合数据集合。</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap"><b>创建对象的三种方法</b></span></div></div><code-block class="wolai-block"><div class="wolai-pre"><div data-lang="Javascript" class="marker"></div><pre># 对象直接量
<span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
  foo<span class="token operator">:</span> <span class="token string">'Hello'</span><span class="token punctuation">,</span>
  bar<span class="token operator">:</span> <span class="token string">'World'</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

# <span class="token keyword">new</span>

# <span class="token known-class-name class-name">Object</span><span class="token punctuation">.</span><span class="token method function property-access">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 两个参数：对象的原型，对对象属性进行xxx
<span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token known-class-name class-name">Object</span><span class="token punctuation">.</span><span class="token method function property-access">create</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">"x"</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"y"</span><span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// obj 继承了属性x和y</span>
<span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token known-class-name class-name">Object</span><span class="token punctuation">.</span><span class="token method function property-access">create</span><span class="token punctuation">(</span><span class="token class-name">Object</span><span class="token punctuation">.</span><span class="token property-access">prototype</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 创建普通对象</span></pre></div></code-block><div class="wolai-block wolai-text"><div><span class="inline-wrap">属性可以动态创建，不必在对象声明时就指定。</span></div></div><code-block class="wolai-block"><div class="wolai-pre"><div data-lang="Javascript" class="marker"></div><pre>obj<span class="token punctuation">.</span><span class="token property-access">age</span> <span class="token operator">=</span> <span class="token number">18</span><span class="token punctuation">;</span></pre></div></code-block><div class="wolai-block wolai-text"><div><span class="inline-wrap"><b>属性的<span class="jill"></span>CRUD</b></span></div></div><code-block class="wolai-block"><div class="wolai-pre"><div data-lang="Javascript" class="marker"></div><pre># 读取属性
obj<span class="token punctuation">.</span><span class="token property-access">foo</span>
obj<span class="token punctuation">[</span><span class="token string">'bar'</span><span class="token punctuation">]</span>
# 添加属性
obj<span class="token punctuation">.</span><span class="token property-access">foo</span> <span class="token operator">=</span> <span class="token string">'Hello'</span><span class="token punctuation">;</span>
obj<span class="token punctuation">[</span><span class="token string">'bar'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'World'</span><span class="token punctuation">;</span>
# 修改属性
同上
# 删除属性  <span class="token keyword">delete</span>命令只能删除对象本身的属性，无法删除继承的属性
<span class="token keyword">delete</span> obj<span class="token punctuation">.</span><span class="token property-access">foo</span>
# 查看是否具有属性
<span class="token string">'p'</span> <span class="token keyword">in</span> obj 
obj<span class="token punctuation">.</span><span class="token method function property-access">hasOwnProperty</span><span class="token punctuation">(</span><span class="token string">'toString'</span><span class="token punctuation">)</span> # 只查看自身具有的属性
# 遍历属性
<span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>a<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> b<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> c<span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword control-flow">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token keyword">in</span> obj<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'键名：'</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'键值：'</span><span class="token punctuation">,</span> obj<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
# 它遍历的是对象所有可遍历（enumerable）的属性，会跳过不可遍历的属性。
# 它不仅遍历对象自身的属性，还遍历继承的属性。</pre></div></code-block><h2 class="wolai-block"><span class="inline-wrap">面向对象</span></h2><h3 class="wolai-block"><span class="inline-wrap">构造函数</span></h3><div class="wolai-block wolai-text"><div><span class="inline-wrap">JS<span class="jill"></span>中使用构造函数来作为创建对象的模板。构造函数顾名思义就是一个函数，不过它有自己的特征和用法。</span></div></div><code-block class="wolai-block"><div class="wolai-pre"><div data-lang="Javascript" class="marker"></div><pre><span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Vehicle</span></span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token string">'use strict'</span><span class="token punctuation">;</span> # 使用严格模式，避免没有使用<span class="token keyword">new</span> 关键字调用构造函数
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">price</span> <span class="token operator">=</span> <span class="token number">1000</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
# 或者
<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Fubar</span></span><span class="token punctuation">(</span><span class="token parameter">foo<span class="token punctuation">,</span> bar</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token keyword">this</span> <span class="token keyword">instanceof</span> <span class="token class-name">Fubar</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">return</span> <span class="token keyword">new</span> <span class="token class-name">Fubar</span><span class="token punctuation">(</span>foo<span class="token punctuation">,</span> bar<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">_foo</span> <span class="token operator">=</span> foo<span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">_bar</span> <span class="token operator">=</span> bar<span class="token punctuation">;</span>
<span class="token punctuation">}</span></pre></div></code-block><div class="wolai-block wolai-text"><div><span class="inline-wrap">上面代码中，</span><span class="inline-wrap"><code>Vehicle</code></span><span class="inline-wrap">就是构造函数。为了与普通函数区别，构造函数名字的第一个字母通常大写。</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">构造函数的特点有两个。</span></div></div><ul class="wolai-block"><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">函数体内部使用了</span><span class="inline-wrap"><code>this</code></span><span class="inline-wrap">关键字，代表了所要生成的对象实例。</span></li><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">生成对象的时候，必须使用</span><span class="inline-wrap"><code>new</code></span><span class="inline-wrap">命令。</span></li></ul><h3 class="wolai-block"><span class="inline-wrap">new<span class="jill"></span>关键字</span></h3><div class="wolai-block wolai-text"><div><span class="inline-wrap"><code>new</code></span><span class="inline-wrap">命令的作用，就是执行构造函数，返回一个实例对象。</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">使用</span><span class="inline-wrap"><code>new</code></span><span class="inline-wrap">命令时，它后面的函数依次执行下面的步骤。</span></div></div><ol class="wolai-block"><li><div class="marker"></div><span class="inline-wrap">创建一个空对象，作为将要返回的对象实例。</span></li><li><div class="marker"></div><span class="inline-wrap">将这个空对象的原型，指向构造函数的</span><span class="inline-wrap"><code>prototype</code></span><span class="inline-wrap">属性。</span></li><li><div class="marker"></div><span class="inline-wrap">将这个空对象赋值给函数内部的</span><span class="inline-wrap"><code>this</code></span><span class="inline-wrap">关键字。</span></li><li><div class="marker"></div><span class="inline-wrap">开始执行构造函数内部的代码。</span></li></ol><div class="wolai-block wolai-text"><div><span class="inline-wrap">也就是说，构造函数内部，</span><span class="inline-wrap"><code>this</code></span><span class="inline-wrap">指的是一个新生成的空对象，所有针对</span><span class="inline-wrap"><code>this</code></span><span class="inline-wrap">的操作，都会发生在这个空对象上。构造函数之所以叫“构造函数”，就是说这个函数的目的，就是操作一个空对象（即</span><span class="inline-wrap"><code>this</code></span><span class="inline-wrap">对象），将其“构造”为需要的样子。</span></div></div><code-block class="wolai-block"><div class="wolai-pre"><div data-lang="Javascript" class="marker"></div><pre><span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Person</span></span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token string">'use strict'</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">name</span> <span class="token operator">=</span> name<span class="token punctuation">;</span>
    <span class="token keyword">var</span> _age<span class="token punctuation">;</span>
    
    <span class="token comment">// getter</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token method-variable function-variable method function property-access">getAge</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword control-flow">return</span> _age<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    
    <span class="token comment">// setter</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token method-variable function-variable method function property-access">setAge</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">age</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>age <span class="token operator">>=</span> <span class="token number">120</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">"too damn old !"</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword control-flow">else</span> <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>age <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">"r u fucking kidding me ?"</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword control-flow">else</span> <span class="token punctuation">{</span>
            _age <span class="token operator">=</span> age<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span></pre></div></code-block><h3 class="wolai-block"><span class="inline-wrap">this<span class="jill"></span>关键字</span></h3><code-block class="wolai-block"><div class="wolai-pre"><div data-lang="Javascript" class="marker"></div><pre><span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span> foo<span class="token operator">:</span>  <span class="token number">5</span> <span class="token punctuation">}</span><span class="token punctuation">;</span></pre></div></code-block><div class="wolai-block wolai-text"><div><span class="inline-wrap">上面的代码将一个对象赋值给变量</span><span class="inline-wrap"><code>obj</code></span><span class="inline-wrap">。JavaScript 引擎会先在内存里面，生成一个对象</span><span class="inline-wrap"><code>{ foo: 5 }</code></span><span class="inline-wrap">，然后把这个对象的内存地址赋值给变量</span><span class="inline-wrap"><code>obj</code></span><span class="inline-wrap">。也就是说，变量</span><span class="inline-wrap"><code>obj</code></span><span class="inline-wrap">是一个地址（reference）。后面如果要读取</span><span class="inline-wrap"><code>obj.foo</code></span><span class="inline-wrap">，引擎先从</span><span class="inline-wrap"><code>obj</code></span><span class="inline-wrap">拿到内存地址，然后再从该地址读出原始的对象，返回它的</span><span class="inline-wrap"><code>foo</code></span><span class="inline-wrap">属性。</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">原始的对象以</span><span class="inline-wrap"><b>字典结构</b></span><span class="inline-wrap">保存，每一个属性名都对应一个</span><span class="inline-wrap"><b>属性描述对象</b></span><span class="inline-wrap">。举例来说，上面例子的</span><span class="inline-wrap"><code>foo</code></span><span class="inline-wrap">属性，实际上是以下面的形式保存的。</span></div></div><code-block class="wolai-block"><div class="wolai-pre"><div data-lang="纯文本" class="marker"></div><pre><span class="token punctuation">{</span>
  foo<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token punctuation">[</span><span class="token punctuation">[</span>value<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token number">5</span>
    <span class="token punctuation">[</span><span class="token punctuation">[</span>writable<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">[</span><span class="token punctuation">[</span>enumerable<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">[</span><span class="token punctuation">[</span>configurable<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></pre></div></code-block><div class="wolai-block wolai-text"><div><span class="inline-wrap">注意，</span><span class="inline-wrap"><code>foo</code></span><span class="inline-wrap">属性的值保存在属性描述对象的</span><span class="inline-wrap"><code>value</code></span><span class="inline-wrap">属性里面。</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">这样的结构是很清晰的，问题在于属性的值可能是一个函数。</span></div></div><code-block class="wolai-block"><div class="wolai-pre"><div data-lang="Javascript" class="marker"></div><pre><span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token function-variable function">foo</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">;</span></pre></div></code-block><div class="wolai-block wolai-text"><div><span class="inline-wrap">这时，引擎会将函数单独保存在内存中，然后再将函数的地址赋值给</span><span class="inline-wrap"><code>foo</code></span><span class="inline-wrap">属性的</span><span class="inline-wrap"><code>value</code></span><span class="inline-wrap">属性。</span></div></div><code-block class="wolai-block"><div class="wolai-pre"><div data-lang="Javascript" class="marker"></div><pre><span class="token punctuation">{</span>
  foo<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token punctuation">[</span><span class="token punctuation">[</span>value<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token operator">:</span> 函数的地址
    <span class="token spread operator">...</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></pre></div></code-block><div class="wolai-block wolai-text"><div><span class="inline-wrap">由于函数是一个单独的值，所以它可以在不同的环境（上下文）执行。</span></div></div><code-block class="wolai-block"><div class="wolai-pre"><div data-lang="Javascript" class="marker"></div><pre><span class="token keyword">var</span> <span class="token function-variable function">f</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span> f<span class="token operator">:</span> f <span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 单独执行</span>
<span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// obj 环境执行</span>
obj<span class="token punctuation">.</span><span class="token method function property-access">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></div></code-block><div class="wolai-block wolai-text"><div><span class="inline-wrap">JavaScript 允许在函数体内部，引用当前环境的其他变量。</span></div></div><code-block class="wolai-block"><div class="wolai-pre"><div data-lang="Javascript" class="marker"></div><pre><span class="token keyword">var</span> <span class="token function-variable function">f</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></pre></div></code-block><div class="wolai-block wolai-text"><div><span class="inline-wrap">上面代码中，函数体里面使用了变量</span><span class="inline-wrap"><code>x</code></span><span class="inline-wrap">。该变量由运行环境提供。</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">现在问题就来了，由于函数可以在不同的运行环境执行，所以需要有一种机制，能够在函数体内部获得当前的运行环境（context）。所以，</span><span class="inline-wrap"><code>this</code></span><span class="inline-wrap">就出现了，它的设计目的就是在函数体内部，指代函数当前的运行环境。</span></div></div><code-block class="wolai-block"><div class="wolai-pre"><div data-lang="Javascript" class="marker"></div><pre><span class="token keyword">function</span> <span class="token function">sayHi</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">name</span> <span class="token operator">!=</span> <span class="token keyword null nil">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">"Hello I am "</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">name</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token keyword control-flow">else</span><span class="token punctuation">{</span>
        <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">"Hello"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> tom <span class="token operator">=</span> <span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token string">"tom"</span><span class="token punctuation">,</span>
    sayHi<span class="token operator">:</span> sayHi
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token function">sayHi</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
tom<span class="token punctuation">.</span><span class="token method function property-access">sayHi</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></div></code-block><h3 class="wolai-block"><span class="inline-wrap">对象的继承</span></h3><div class="wolai-block wolai-text"><div><span class="inline-wrap">构造函数有一个缺点，同一个构造函数的多个实例之间，无法共享属性，从而造成对系统资源的浪费。例如一个构造函数中的方法，每个对象都会创建这些方法，从而导致内存的浪费。为了解决这个问题，我们需要使用继承。</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">JavaScript 继承机制的设计思想就是，原型对象的所有属性和方法，都能被实例对象共享。也就是说，如果属性和方法定义在原型上，那么所有实例对象就能共享，不仅节省了内存，还体现了实例对象之间的联系。</span></div></div><code-block class="wolai-block"><div class="wolai-pre"><div data-lang="Javascript" class="marker"></div><pre><span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Animal</span></span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">name</span> <span class="token operator">=</span> name<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">typeof</span> <span class="token class-name">Animal</span><span class="token punctuation">.</span><span class="token property-access">prototype</span><span class="token punctuation">;</span> <span class="token comment">// object</span>
<span class="token class-name">Animal</span><span class="token punctuation">.</span><span class="token property-access">prototype</span><span class="token punctuation">.</span><span class="token property-access">color</span> <span class="token operator">=</span> <span class="token string">'white'</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> cat1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Animal</span><span class="token punctuation">(</span><span class="token string">'大毛'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> cat2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Animal</span><span class="token punctuation">(</span><span class="token string">'二毛'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
cat1<span class="token punctuation">.</span><span class="token property-access">color</span> <span class="token comment">// 'white'</span>
cat2<span class="token punctuation">.</span><span class="token property-access">color</span> <span class="token comment">// 'white'</span></pre></div></code-block><div class="wolai-block wolai-text"><div><span class="inline-wrap">原型对象的属性不是实例对象自身的属性。只要修改原型对象，变动就立刻会体现在</span><span class="inline-wrap"><b>所有</b></span><span class="inline-wrap">实例对象上。</span></div></div><h2 class="wolai-block"><span class="inline-wrap">异步操作</span></h2><h3 class="wolai-block"><span class="inline-wrap">定时器</span></h3><h4 class="wolai-block"><span class="inline-wrap">setTimeout()</span></h4><div class="wolai-block wolai-text"><div><span class="inline-wrap"><code>setTimeout</code></span><span class="inline-wrap">函数用来指定某个函数或某段代码，在多少毫秒之后执行。它返回一个整数，表示定时器的编号，以后可以用来取消这个定时器。</span></div></div><code-block class="wolai-block"><div class="wolai-pre"><div data-lang="Javascript" class="marker"></div><pre><span class="token keyword">var</span> timerId <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span>func<span class="token operator">|</span>code<span class="token punctuation">,</span> delay<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">setTimeout</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span>
<span class="token comment">// 等同于</span>
<span class="token function">setTimeout</span><span class="token punctuation">(</span>f<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
<span class="token comment">// 除了前两个参数，setTimeout还允许更多的参数。它们将依次传入推迟执行的函数（回调函数）。</span>
<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span>b</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span>a <span class="token operator">+</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 上面代码中，setTimeout共有4个参数。最后那两个参数，将在1000毫秒之后回调函数执行时，作为回调函数的参数。</span>
<span class="token comment">//如果回调函数是对象的方法，那么setTimeout使得方法内部的this关键字指向全局环境，而不是定义时所在的那个对象。</span>
<span class="token keyword">var</span> x <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
  x<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
  <span class="token function-variable function">y</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">x</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token function">setTimeout</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span><span class="token property-access">y</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span> <span class="token comment">// 1</span>
<span class="token comment">// 为了防止出现这个问题，一种解决方法是将obj.y放入函数。</span>
<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  obj<span class="token punctuation">.</span><span class="token method function property-access">y</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 2</span>
<span class="token comment">// 另一种解决方法是，使用bind方法，将obj.y这个方法绑定在obj上面。</span>
<span class="token function">setTimeout</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span><span class="token method function property-access">y</span><span class="token punctuation">.</span><span class="token method function property-access">bind</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span></pre></div></code-block><h4 class="wolai-block"><span class="inline-wrap">setInterval()</span></h4><div class="wolai-block wolai-text"><div><span class="inline-wrap"><code>setInterval</code></span><span class="inline-wrap">函数的用法与</span><span class="inline-wrap"><code>setTimeout</code></span><span class="inline-wrap">完全一致，区别仅仅在于</span><span class="inline-wrap"><code>setInterval</code></span><span class="inline-wrap">指定某个任务每隔一段时间就执行一次，也就是无限次的定时执行。</span></div></div><code-block class="wolai-block"><div class="wolai-pre"><div data-lang="Javascript" class="marker"></div><pre><span class="token keyword">var</span> $div <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"div"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> opacity <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> fader <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>opacity <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        $div<span class="token punctuation">.</span><span class="token method function property-access">css</span><span class="token punctuation">(</span><span class="token string">"opacity"</span><span class="token punctuation">,</span> opacity <span class="token operator">-=</span> <span class="token number">0.1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword control-flow">else</span> <span class="token punctuation">{</span>
        <span class="token function">clearInterval</span><span class="token punctuation">(</span>fader<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// clearTimeout()，clearInterval()</span></pre></div></code-block><div class="wolai-block wolai-text"><div><span class="inline-wrap"></span><br/></div></div><hr class="wolai-block"/><h1 class="wolai-block"><span class="inline-wrap">对象</span></h1><div class="wolai-block wolai-text"><div><span class="inline-wrap">简单来说，对象就是属性的集合。</span></div></div><aside class="bg-cultured wolai-block"><div data-symbol="❄️" class="icon"></div><span class="inline-wrap">JS<span class="jill"></span>的函数也是对象，所以也能作为属性</span></aside><div class="wolai-block wolai-text"><div><span class="inline-wrap">对象的创建有三种方法。对象字面量、构造函数、ES5<span class="jill"></span>的<span class="jill"></span>Object.create()。</span></div></div><h2 class="wolai-block"><span class="inline-wrap">对象字面量</span></h2><code-block class="wolai-block"><div class="wolai-pre"><div data-lang="Javascript" class="marker"></div><pre><span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token string">"name"</span><span class="token operator">:</span> <span class="token string">"hdr"</span><span class="token punctuation">,</span>
    <span class="token string">"sayHi"</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">"Hello World"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>，
<span class="token punctuation">}</span><span class="token punctuation">;</span>

obj<span class="token punctuation">.</span><span class="token property-access">age</span><span class="token operator">=</span><span class="token number">24</span><span class="token punctuation">;</span> <span class="token comment">// 添加属性</span>
<span class="token keyword">delete</span> user<span class="token punctuation">.</span><span class="token property-access">age</span><span class="token punctuation">;</span> <span class="token comment">// 删除属性</span>
obj<span class="token punctuation">.</span><span class="token property-access">age</span><span class="token punctuation">;</span> <span class="token comment">// 访问属性</span>
obj<span class="token punctuation">[</span>age<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 访问属性</span></pre></div></code-block><div class="wolai-block wolai-text"><div><span class="inline-wrap">对象直接量是一个表达式，每次执行该表达式都会创建并初始化一个新的对象。</span></div></div><h2 class="wolai-block"><span class="inline-wrap">构造函数</span></h2><code-block class="wolai-block"><div class="wolai-pre"><div data-lang="Javascript" class="marker"></div><pre><span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Person</span></span> <span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">name</span> <span class="token operator">=</span> name<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token string">"hdr"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></div></code-block><h2 class="wolai-block"><span class="inline-wrap">Object.create()</span></h2><div class="wolai-block wolai-text"><div><span class="inline-wrap">ES5<span class="jill"></span>定义了一个名为<span class="jill"></span>Object.create()的方法，用于创建一个新对象。该方法有两个重载。</span></div></div><code-block class="wolai-block"><div class="wolai-pre"><div data-lang="Typescript" class="marker"></div><pre><span class="token function">create</span><span class="token punctuation">(</span>o<span class="token operator">:</span> object <span class="token operator">|</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">;</span>
<span class="token function">create</span><span class="token punctuation">(</span>o<span class="token operator">:</span> object <span class="token operator">|</span> <span class="token keyword">null</span><span class="token punctuation">,</span> properties<span class="token operator">:</span> PropertyDescriptorMap <span class="token operator">&amp;</span> ThisType<span class="token operator">&lt;</span><span class="token builtin">any</span><span class="token operator">></span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">;</span></pre></div></code-block><div class="wolai-block wolai-text"><div><span class="inline-wrap">第一个参数是提供一个</span><span class="inline-wrap"><b>原型对象</b></span><span class="inline-wrap">。第二个参数设置属性的特性。</span></div></div><h3 class="wolai-block"><span class="inline-wrap">原型对象</span></h3><div class="wolai-block wolai-text"><div><span class="inline-wrap">函数具有一个</span><span class="inline-wrap"><code>prototype</code></span><span class="inline-wrap">属性，对象具有一个</span><span class="inline-wrap"><code>__proto__</code></span><span class="inline-wrap">属性，这两个属性指向一个对象，这个对象就是原型对象。</span></div></div><code-block class="wolai-block"><div class="wolai-pre"><div data-lang="Javascript" class="marker"></div><pre><span class="token keyword">typeof</span> <span class="token class-name">Object</span><span class="token punctuation">.</span><span class="token property-access">prototype</span><span class="token punctuation">;</span> <span class="token comment">// object</span>
<span class="token keyword">typeof</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token property-access">__proto__</span><span class="token punctuation">;</span> <span class="token comment">// object</span></pre></div></code-block><div class="wolai-block wolai-text"><div><span class="inline-wrap">原型对象的意义：原型对象的属性和方法会被共享。</span></div></div><code-block class="wolai-block"><div class="wolai-pre"><div data-lang="Javascript" class="marker"></div><pre><span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Animal</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">name</span> <span class="token operator">=</span> <span class="token string">"animal"</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token method-variable function-variable method function property-access">sayHi</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">"hello world"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Dog</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token class-name">Dog</span><span class="token punctuation">.</span><span class="token property-access">prototype</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Animal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 修改原型对象，让Dog具有Animal对象的属性和方法</span>
<span class="token class-name">Dog</span><span class="token punctuation">.</span><span class="token property-access">prototype</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Animal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 所有 new Dog()创建的对象，原型对象都是Animal对象。</span>
<span class="token comment">// dog.__proto__ = new Animal(); 只有该Dog对象的原型是Animal对象。</span>
<span class="token keyword">var</span> dog <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Dog</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span>dog<span class="token punctuation">.</span><span class="token property-access">name</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
dog<span class="token punctuation">.</span><span class="token method function property-access">sayHi</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></div></code-block><h3 class="wolai-block"><span class="inline-wrap">属性的特性</span></h3><div class="wolai-block wolai-text"><div><span class="inline-wrap">从<span class="jill"></span>ES5<span class="jill"></span>开始，对属性进行了抽象，提供了一个<span class="jill"></span>PropertyDescriptor<span class="jill"></span>对象(属性描述符)。它有<span class="jill"></span>4<span class="jill"></span>个属性，分别是值、可写性、可枚举性、可配置性。</span></div></div><code-block class="wolai-block"><div class="wolai-pre"><div data-lang="Typescript" class="marker"></div><pre><span class="token keyword">interface</span> <span class="token class-name">PropertyDescriptor</span> <span class="token punctuation">{</span>
    configurable<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">;</span>
    enumerable<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">;</span>
    value<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">;</span>
    writable<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">;</span>
    get<span class="token operator">?</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">;</span>
    set<span class="token operator">?</span><span class="token punctuation">(</span>v<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></pre></div></code-block><div class="wolai-block wolai-text"><div><span class="inline-wrap">通过调用</span><span class="inline-wrap"><code>Object.getOwnPropertyDescriptor()</code></span><span class="inline-wrap">可以获取某个对象特定属性的属性描述符。</span></div></div><code-block class="wolai-block"><div class="wolai-pre"><div data-lang="Javascript" class="marker"></div><pre><span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">"name"</span><span class="token operator">:</span> <span class="token string">"hdr"</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token known-class-name class-name">Object</span><span class="token punctuation">.</span><span class="token method function property-access">getOwnPropertyDescriptor</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span><span class="token string">"name"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// {value: hdr, writable: true, enumerable: true, configurable: true}</span>
<span class="token comment">// 让属性不可修改</span>
<span class="token known-class-name class-name">Object</span><span class="token punctuation">.</span><span class="token method function property-access">defineProperty</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span><span class="token string">"age"</span><span class="token punctuation">,</span>
                      <span class="token punctuation">{</span>value<span class="token operator">:</span> <span class="token number">22</span><span class="token punctuation">,</span> writable<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> enumerable<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> configurable<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
obj<span class="token punctuation">.</span><span class="token property-access">age</span> <span class="token operator">=</span> <span class="token number">18</span><span class="token punctuation">;</span> <span class="token comment">// 操作失败</span></pre></div></code-block><div class="wolai-block wolai-text"><div><span class="inline-wrap"></span><br/></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap"></span><br/></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">继承的思想就是儿子可以拥有父亲已拥有的东西，JavaScript<span class="jill"></span>中没有类的概念，JavaScript<span class="jill"></span>中的继承是子对象继承父对象，这个父对象叫做</span><span class="inline-wrap"><b>原型对象</b></span><span class="inline-wrap">。</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">一个对象具有一个原型对象，该对象会继承原型对象的属性和方法。</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">原型链：原型对象也是对象，它也会有原型对象，这样层层递进，形成了一条链，称为原型链。</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">那怎么设置对象的原型对象呢？关键就是<span class="jill"></span>prototype<span class="jill"></span>属性。</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">JavaScript 规定，每个函数都有一个</span><span class="inline-wrap"><code>prototype</code></span><span class="inline-wrap">属性，指向一个对象。</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">对于普通函数来说，该属性基本无用。但是，对于构造函数来说，生成实例对象的时候，prototype<span class="jill"></span>属性指向的对象会成为该实例对象的原型。</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap"><b>JavaScript<span class="jill"></span>没有类的概念，继承不是继承类，而是继承对象！</b></span></div></div><code-block class="wolai-block"><div class="wolai-pre"><div data-lang="Javascript" class="marker"></div><pre><span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Animal</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">name</span> <span class="token operator">=</span> <span class="token string">"animal"</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Dog</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
<span class="token comment">// 设置Dog的原型对象</span>
<span class="token class-name">Dog</span><span class="token punctuation">.</span><span class="token property-access">prototype</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Animal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> dog <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Dog</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span>dog<span class="token punctuation">.</span><span class="token property-access">name</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></div></code-block><div class="wolai-block wolai-text"><div><span class="inline-wrap"><b>总结一下</b></span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap"><b>构造函数的<span class="jill"></span>prototype<span class="jill"></span>属性指向一个对象，该对象会成为构造函数所创建出来的实例对象的原型</b></span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap"><b>原型对象的意义：让原型是它的实例对象共享它的属性和方法</b></span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap"><b>修改原型对象时，一般要同时修改</b></span><span class="inline-wrap">**</span><span class="inline-wrap"><code>constructor</code></span><span class="inline-wrap">**</span><span class="inline-wrap"><b>属性的指向</b></span></div></div><code-block class="wolai-block"><div class="wolai-pre"><div data-lang="Javascript" class="marker"></div><pre><span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Person</span></span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">name</span> <span class="token operator">=</span> name<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token class-name">Person</span><span class="token punctuation">.</span><span class="token property-access">prototype</span><span class="token punctuation">.</span><span class="token property-access">constructor</span> <span class="token operator">===</span> <span class="token maybe-class-name">Person</span> <span class="token comment">// true</span>

<span class="token class-name">Person</span><span class="token punctuation">.</span><span class="token property-access">prototype</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">method</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token class-name">Person</span><span class="token punctuation">.</span><span class="token property-access">prototype</span><span class="token punctuation">.</span><span class="token property-access">constructor</span> <span class="token operator">===</span> <span class="token maybe-class-name">Person</span> <span class="token comment">// false</span>
<span class="token class-name">Person</span><span class="token punctuation">.</span><span class="token property-access">prototype</span><span class="token punctuation">.</span><span class="token property-access">constructor</span> <span class="token operator">===</span> <span class="token known-class-name class-name">Object</span> <span class="token comment">// true</span></pre></div></code-block><div class="wolai-block wolai-text"><div><span class="inline-wrap">上面代码中，构造函数</span><span class="inline-wrap"><code>Person</code></span><span class="inline-wrap">的原型对象改掉了，但是没有修改</span><span class="inline-wrap"><code>constructor</code></span><span class="inline-wrap">属性，导致这个属性不再指向</span><span class="inline-wrap"><code>Person</code></span><span class="inline-wrap">。由于</span><span class="inline-wrap"><code>Person</code></span><span class="inline-wrap">的新原型是一个普通对象，而普通对象的</span><span class="inline-wrap"><code>constructor</code></span><span class="inline-wrap">属性指向</span><span class="inline-wrap"><code>Object</code></span><span class="inline-wrap">构造函数，导致</span><span class="inline-wrap"><code>Person.prototype.constructor</code></span><span class="inline-wrap">变成了</span><span class="inline-wrap"><code>Object</code></span><span class="inline-wrap">。</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap"><b><code>prototype</code></b></span><span class="inline-wrap"><b>与</b></span><span class="inline-wrap"><code>__proto__</code></span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap"><code>prototype</code></span><span class="inline-wrap">是函数的属性，</span><span class="inline-wrap"><code>__proto__</code></span><span class="inline-wrap">是对象的属性，两者作用都一样，用来指向原型对象。</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap"></span><br/></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap"></span><br/></div></div><hr class="wolai-block"/><h2 class="wolai-block"><span class="inline-wrap">闭包</span></h2><div class="wolai-block wolai-text"><div><span class="inline-wrap">闭包就是能够读取其他函数内部变量的函数，在<span class="jill"></span>JS<span class="jill"></span>中可以把闭包简单理解成“定义在一个函数内部的函数”，通过函数<span class="jill"></span>A<span class="jill"></span>中的函数<span class="jill"></span>B<span class="jill"></span>来操作函数<span class="jill"></span>A<span class="jill"></span>中的变量。</span></div></div><code-block class="wolai-block"><div class="wolai-pre"><div data-lang="Javascript" class="marker"></div><pre><span class="token keyword">function</span> <span class="token function">createIncrementor</span><span class="token punctuation">(</span><span class="token parameter">start</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> <span class="token function-variable function">counter</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword control-flow">return</span> <span class="token operator">++</span>start<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">return</span> counter<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> inc <span class="token operator">=</span> <span class="token function">createIncrementor</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token function">inc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 6</span>
<span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token function">inc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 7</span>

<span class="token keyword">var</span> inc2 <span class="token operator">=</span> <span class="token function">createIncrementor</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token function">inc2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 11</span>

<span class="token keyword">function</span> <span class="token function">counter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">var</span> n <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">return</span> <span class="token punctuation">{</span>
        <span class="token function-variable function">count</span> <span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword control-flow">return</span> n<span class="token operator">++</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token function-variable function">reset</span> <span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>n <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></pre></div></code-block><div class="wolai-block wolai-text"><div><span class="inline-wrap"><b>理解闭包所需的两个关键点</b></span></div></div><ul class="wolai-block"><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">函数定义时的作用域链到函数执行时依然有效。</span></li><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">每次调用<span class="jill"></span>JS<span class="jill"></span>函数的时候，都会为之创建一个新的对象用来保存局部变量，在闭包作用下，该对象因为被引用，所以不会被垃圾回收，所以能存活下来。</span></li></ul><div class="wolai-block wolai-text"><div><span class="inline-wrap"></span><br/></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap"></span><br/></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap"><b>闭包</b></span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">函数内部可以访问函数外部的变量，反过来则不行。如果我们非要从函数外部读取函数内部的数据呢，那要怎么实现？这就要使用闭包了，闭包就是能够读取其他函数内部变量的函数，在<span class="jill"></span>JS<span class="jill"></span>中可以把闭包简单理解成“定义在一个函数内部的函数”，原理就是通过函数<span class="jill"></span>A<span class="jill"></span>中的函数<span class="jill"></span>B<span class="jill"></span>来操作函数<span class="jill"></span>A<span class="jill"></span>中的变量。</span></div></div><code-block class="wolai-block"><div class="wolai-pre"><div data-lang="Javascript" class="marker"></div><pre><span class="token keyword">function</span> <span class="token constant">A</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> name <span class="token operator">=</span> <span class="token string">"黄大仁"</span><span class="token punctuation">;</span>

    <span class="token keyword">function</span> <span class="token constant">B</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword control-flow">return</span> <span class="token constant">B</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></pre></div></code-block><div class="wolai-block wolai-text"><div><span class="inline-wrap">闭包的最大用处有两个，一个是可以读取函数内部的变量，另一个就是让这些内部变量始终保持在内存中。</span></div></div><code-block class="wolai-block"><div class="wolai-pre"><div data-lang="Java" class="marker"></div><pre>function <span class="token function">createIncrementor</span><span class="token punctuation">(</span>start<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> function <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token operator">++</span>start<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> inc <span class="token operator">=</span> <span class="token function">createIncrementor</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">inc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 6</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">inc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 7</span>

<span class="token keyword">var</span> inc2 <span class="token operator">=</span> <span class="token function">createIncrementor</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">inc2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 11</span></pre></div></code-block><div class="wolai-block wolai-text"><div><span class="inline-wrap">上面代码中，</span><span class="inline-wrap"><code>start</code></span><span class="inline-wrap">是函数</span><span class="inline-wrap"><code>createIncrementor</code></span><span class="inline-wrap">的内部变量。通过闭包，</span><span class="inline-wrap"><code>start</code></span><span class="inline-wrap">的状态被保留了，每一次调用都是在上一次调用的基础上进行计算。从中可以看到，闭包</span><span class="inline-wrap"><code>inc</code></span><span class="inline-wrap">使得函数</span><span class="inline-wrap"><code>createIncrementor</code></span><span class="inline-wrap">的内部环境，一直存在。为什么会这样呢？原因就在于</span><span class="inline-wrap"><code>inc</code></span><span class="inline-wrap">始终在内存中，而</span><span class="inline-wrap"><code>inc</code></span><span class="inline-wrap">的存在依赖于</span><span class="inline-wrap"><code>createIncrementor</code></span><span class="inline-wrap">，因此也始终在内存中，不会在调用结束后，被垃圾回收机制回收。</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">闭包的另一个用处，是封装对象的私有属性和私有方法。</span></div></div><code-block class="wolai-block"><div class="wolai-pre"><div data-lang="Java" class="marker"></div><pre>function <span class="token class-name">Person</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> _age<span class="token punctuation">;</span>
  function <span class="token function">setAge</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    _age <span class="token operator">=</span> n<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  function <span class="token function">getAge</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> _age<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    name<span class="token operator">:</span> name<span class="token punctuation">,</span>
    getAge<span class="token operator">:</span> getAge<span class="token punctuation">,</span>
    setAge<span class="token operator">:</span> setAge
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> p1 <span class="token operator">=</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token string">'张三'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
p1<span class="token punctuation">.</span><span class="token function">setAge</span><span class="token punctuation">(</span><span class="token number">25</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
p1<span class="token punctuation">.</span><span class="token function">getAge</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 25</span></pre></div></code-block></article><footer></footer></body></html>