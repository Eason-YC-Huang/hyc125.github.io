<!DOCTYPE html>
<html lang="zh-Hans-CN"><head><meta charset="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=Edge"/><link rel="stylesheet" type="text/css" href="../../css/modern-norm.min.css"/><link rel="stylesheet" type="text/css" href="../../css/prism.min.css"/><link rel="stylesheet" type="text/css" href="../../css/katex.min.css"/><link rel="stylesheet" type="text/css" href="../../css/wolai.css"/><title>C - wolai 笔记</title><link rel="shortcut icon"></link></head><body><header><div class="image"></div><div class="title"><div class="banner"><div class="icon"></div></div><div data-title="C" class="main-title"></div></div></header><article><div class="wolai-bookmark wolai-block"><a href="https://github.com/wangdoc/clang-tutorial">GitHub - wangdoc/clang-tutorial: C 语言教程</a><div class="info-box"><div class="text-pane"><div data-title="GitHub - wangdoc/clang-tutorial: C 语言教程"></div><div data-desc="C 语言教程. Contribute to wangdoc/clang-tutorial development by creating an account on GitHub."></div><div class="icon-host"><div class="icon icon-image" style="background-image: url(&quot;https://github.com/fluidicon.png&quot;)"></div><div data-hostname="github.com"></div></div></div><div class="preview-pane" style="background-image: url(https://opengraph.githubassets.com/4dee12d3b776d5ea03a98fe52d866357bfe9f11582ee45eb0a854e70733df5ed/wangdoc/clang-tutorial)"></div></div></div><h2 class="wolai-block"><span class="inline-wrap">大纲</span></h2><code-block class="wolai-block"><div class="wolai-pre"><div data-lang="PowerShell" class="marker"></div><pre>C预处理器
<span class="token operator">-</span> 头文件
<span class="token operator">-</span> 文件包含
<span class="token operator">-</span> 宏替换
<span class="token operator">-</span> 条件包含
变量
<span class="token operator">-</span> 普通变量
<span class="token operator">-</span> extern
<span class="token operator">-</span> static
<span class="token operator">-</span> const
<span class="token operator">-</span> 寄存器变量
函数
类型
<span class="token operator">-</span> 类型转换
<span class="token operator">-</span> 数组
<span class="token operator">-</span> 结构
<span class="token operator">-</span> 指针</pre></div></code-block><h2 class="wolai-block"><span class="inline-wrap">C<span class="jill"></span>预处理器</span></h2><div class="wolai-block wolai-text"><div><span class="inline-wrap">C<span class="jill"></span>语言通过预处理器提供了一些语言功能。从概念上讲，预处理器实编译过程中单独执行的第一个步骤。两个常用的预处理器指令是：</span><span class="inline-wrap"><code>#include</code></span><span class="inline-wrap">执行（用于在编译期间把指定文件的内容包含进当前文件中）和</span><span class="inline-wrap"><code>#define</code></span><span class="inline-wrap">执行（用任意字符序列替代一个标记-宏替换）</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap"><b>导入文件内容</b></span></div></div><code-block class="wolai-block"><div class="wolai-pre"><div data-lang="C" class="marker"></div><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>
<span class="token comment">// 在预处理后 #include &lt;stdio.h> 会被替换成stdio.h文件中的内容。</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"my_func.h"</span></span>
<span class="token comment">// 如果文件名用引号引起来，则在源文件所在位置查找该文件，如果在该位置没有找到文件，或者文件名用尖括号括起来的，则根据相应的规则查找该文件，这个规则跟具体的C实现有关。</span>
<span class="token comment">//被包含的文件本身也可以包含#include指令</span></pre></div></code-block><div class="wolai-block wolai-text"><div><span class="inline-wrap"><b>宏替换</b></span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">普通宏定义</span></div></div><code-block class="wolai-block"><div class="wolai-pre"><div data-lang="纯文本" class="marker"></div><pre>#define <span class="token constant">NAME</span> hyc</pre></div></code-block><div class="wolai-block wolai-text"><div><span class="inline-wrap">宏定义还可以带有参数</span></div></div><code-block class="wolai-block"><div class="wolai-pre"><div data-lang="C" class="marker"></div><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">max</span><span class="token expression"><span class="token punctuation">(</span>A<span class="token punctuation">,</span>B<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>A<span class="token punctuation">)</span><span class="token operator">></span><span class="token punctuation">(</span>B<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token punctuation">(</span>A<span class="token punctuation">)</span><span class="token operator">:</span><span class="token punctuation">(</span>B<span class="token punctuation">)</span><span class="token punctuation">)</span></span></span>
<span class="token comment">// max(p+q,r+s); 会被替换成 max((p+q)>(r+s) ? (p+q):(r+s))</span></pre></div></code-block><div class="wolai-block wolai-text"><div><span class="inline-wrap">可以通过</span><span class="inline-wrap"><code>#undef</code></span><span class="inline-wrap">指令取消名字的宏定义</span></div></div><code-block class="wolai-block"><div class="wolai-pre"><div data-lang="纯文本" class="marker"></div><pre>#undef <span class="token constant">NAME</span></pre></div></code-block><div class="wolai-block wolai-text"><div><span class="inline-wrap"><b>条件包括</b></span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">通过条件语句可以对预处理本身进行控制，条件语句的值是在预处理执行的过程进行计算。</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">为了保证</span><span class="inline-wrap"><code>hdr.h</code></span><span class="inline-wrap">文件的内容只被包含一次，可以将该文件的内容包含在下列形式的条件语句中</span></div></div><code-block class="wolai-block"><div class="wolai-pre"><div data-lang="C" class="marker"></div><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">if</span> <span class="token expression"><span class="token operator">!</span><span class="token function">defined</span><span class="token punctuation">(</span>HDR<span class="token punctuation">)</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">HDR</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"hdr.h"</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span></pre></div></code-block><div class="wolai-block wolai-text"><div><span class="inline-wrap">C<span class="jill"></span>语言专门定义了两个预处理语句</span><span class="inline-wrap"><code>#ifdef</code></span><span class="inline-wrap">与</span><span class="inline-wrap"><code>#ifndef</code></span><span class="inline-wrap">，用来测试某个名字是否已经定义</span></div></div><code-block class="wolai-block"><div class="wolai-pre"><div data-lang="C" class="marker"></div><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifndef</span> <span class="token expression">HDR</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">HDR</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"hdr.h"</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span></pre></div></code-block><code-block class="wolai-block"><div class="wolai-pre"><div data-lang="C" class="marker"></div><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">if</span> <span class="token expression">SYSTEM <span class="token operator">==</span> LINUX</span></span>
  <span class="token comment">// ...</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">elif</span> <span class="token expression">SYSTEM <span class="token operator">==</span> WINDOWS</span></span>
  <span class="token comment">// ...</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">elif</span> <span class="token expression">SYSTEM <span class="token operator">==</span> MAXOS</span></span>
  <span class="token comment">// ...</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">else</span></span>
  <span class="token comment">// ...</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span></pre></div></code-block><div class="wolai-block wolai-text"><div><span class="inline-wrap"><b>头文件</b></span></div></div><hr class="wolai-block"/><h2 class="wolai-block"><span class="inline-wrap">变量</span></h2><div class="wolai-block wolai-text"><div><span class="inline-wrap"><b>普通变量</b></span></div></div><code-block class="wolai-block"><div class="wolai-pre"><div data-lang="C" class="marker"></div><pre><span class="token keyword">int</span> age <span class="token operator">=</span> <span class="token number">23</span><span class="token punctuation">;</span></pre></div></code-block><div class="wolai-block wolai-text"><div><span class="inline-wrap"><b>extern<span class="jill"></span>关键字</b></span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">通过</span><span class="inline-wrap"><code>extern</code></span><span class="inline-wrap">关键字，我们可以引用另一个文件中非</span><span class="inline-wrap"><code>static</code></span><span class="inline-wrap">修饰的变量和函数</span></div></div><code-block class="wolai-block"><div class="wolai-pre"><div data-lang="C" class="marker"></div><pre><span class="token comment">// person.c</span>
<span class="token keyword">char</span> <span class="token operator">*</span>name <span class="token operator">=</span> <span class="token string">"hdr"</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> age <span class="token operator">=</span> <span class="token number">18</span><span class="token punctuation">;</span>

<span class="token comment">// main.c</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>

<span class="token keyword">extern</span> <span class="token keyword">char</span> <span class="token operator">*</span>name<span class="token punctuation">;</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">extern</span> <span class="token keyword">int</span> age<span class="token punctuation">;</span> <span class="token comment">// extern在函数外、函数内都能用</span>
    <span class="token comment">// extern关键字只需要指明类型和变量名就行了，不能再重新赋值</span>
    <span class="token comment">// extern int age = 100;  这是不允许的</span>
    <span class="token comment">// 但是在声明之后可以使用变量名进行修改</span>
    age <span class="token operator">=</span> <span class="token number">2333</span><span class="token punctuation">;</span>
    <span class="token comment">// 如果不想这个变量的值被修改，可以在定义时用const关键字进行修饰</span>
    <span class="token comment">// const int age = 18;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"name:%s \nage:%d"</span><span class="token punctuation">,</span>name<span class="token punctuation">,</span>age<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></pre></div></code-block><blockquote class="wolai-block"><span class="inline-wrap">extern<span class="jill"></span>不仅能用来引用外部变量，还能用来引用函数</span></blockquote><div class="wolai-block wolai-text"><div><span class="inline-wrap"><b>static<span class="jill"></span>关键字</b></span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">用</span><span class="inline-wrap"><code>static</code></span><span class="inline-wrap">修饰的变量与函数，可以将其后声明的对象的作用域限定为被编译源文件的剩余部分</span></div></div><code-block class="wolai-block"><div class="wolai-pre"><div data-lang="C" class="marker"></div><pre><span class="token comment">// person.c</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>
<span class="token keyword">static</span> <span class="token keyword">char</span> <span class="token operator">*</span>name <span class="token operator">=</span> <span class="token string">"hdr"</span><span class="token punctuation">;</span>
<span class="token keyword">static</span> <span class="token keyword">int</span> age <span class="token operator">=</span> <span class="token number">18</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">sayHi</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"hi "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// main.c</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>
<span class="token comment">// 因为name和age都被static修饰，无法被别的文件访问，所以下面两条语句是不允许的</span>
<span class="token keyword">extern</span> <span class="token keyword">char</span> <span class="token operator">*</span>name<span class="token punctuation">;</span>
<span class="token keyword">extern</span> <span class="token keyword">int</span> age<span class="token punctuation">;</span> 
<span class="token comment">// 因为函数sayHi没有被static修饰，所以是可以被引用的</span>
<span class="token keyword">extern</span> <span class="token keyword">void</span> <span class="token function">sayHi</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token function">sayHi</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"name:%s \nage:%d"</span><span class="token punctuation">,</span>name<span class="token punctuation">,</span>age<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></pre></div></code-block><div class="wolai-block wolai-text"><div><span class="inline-wrap"><b>注意：</b></span></div></div><code-block class="wolai-block"><div class="wolai-pre"><div data-lang="C" class="marker"></div><pre><span class="token comment">// person.c</span>
<span class="token keyword">static</span> <span class="token keyword">char</span> <span class="token operator">*</span>name <span class="token operator">=</span> <span class="token string">"hdr"</span><span class="token punctuation">;</span>
<span class="token keyword">static</span> <span class="token keyword">int</span> age <span class="token operator">=</span> <span class="token number">18</span><span class="token punctuation">;</span>

<span class="token comment">// main.c</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"person.c"</span></span>

<span class="token comment">// 通过include导入person.c，使得person.c和main.c在同一个文件内</span>
<span class="token comment">// 所以这里可以使用 extern引用person.c中定义的两个static变量</span>
<span class="token keyword">extern</span> <span class="token keyword">char</span> <span class="token operator">*</span>name<span class="token punctuation">;</span>
<span class="token keyword">extern</span> <span class="token keyword">int</span> age<span class="token punctuation">;</span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"name:%s \nage:%d"</span><span class="token punctuation">,</span>name<span class="token punctuation">,</span>age<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></pre></div></code-block><div class="wolai-block wolai-text"><div><span class="inline-wrap"><b>const<span class="jill"></span>关键字</b></span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap"><b>寄存器变量</b></span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">使用</span><span class="inline-wrap"><code>register</code></span><span class="inline-wrap">修饰的变量叫做寄存器变量，其思想是将变量放在<span class="jill"></span>CPU<span class="jill"></span>的寄存器中，这样可以使程序跟小，执行速度更快。但是编译器可以胡略此选项。</span></div></div><h2 class="wolai-block"><span class="inline-wrap">类型系统</span></h2><div class="wolai-block wolai-text"><div><span class="inline-wrap"><b>类型转换</b></span></div></div><code-block class="wolai-block"><div class="wolai-pre"><div data-lang="C" class="marker"></div><pre><span class="token keyword">int</span> num <span class="token operator">=</span> <span class="token number">233</span><span class="token punctuation">;</span>
<span class="token keyword">float</span> f <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">float</span><span class="token punctuation">)</span> num<span class="token punctuation">;</span></pre></div></code-block><div class="wolai-block wolai-text"><div><span class="inline-wrap"><b>数组</b></span></div></div><code-block class="wolai-block"><div class="wolai-pre"><div data-lang="C" class="marker"></div><pre><span class="token keyword">int</span> nums<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
nums<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
nums<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> money<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">}</span></pre></div></code-block><div class="wolai-block wolai-text"><div><span class="inline-wrap"><b>指针</b></span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">变量存储在内存中，指针表示一个变量在内存中的地址</span></div></div><code-block class="wolai-block"><div class="wolai-pre"><div data-lang="C" class="marker"></div><pre><span class="token comment">// 定义指针</span>
<span class="token keyword">int</span> <span class="token operator">*</span>ip<span class="token punctuation">;</span>
<span class="token keyword">char</span> <span class="token operator">*</span>cp<span class="token punctuation">;</span>
<span class="token comment">// 为什么需要用到int、char</span>
<span class="token comment">// ip、cp的值仅仅是变量的起始地址，我们还需要知道变量的终止地址</span>
<span class="token comment">// 终止地址=起始地址+该变量类型在内存中占用空间大小</span>
<span class="token comment">// 所以我们需要用到int、char说明变量的大小</span></pre></div></code-block><div class="wolai-block wolai-text"><div><span class="inline-wrap">通过一元运算符</span><span class="inline-wrap"><code>&amp;</code></span><span class="inline-wrap">，可以获取变量的指针</span></div></div><code-block class="wolai-block"><div class="wolai-pre"><div data-lang="C" class="marker"></div><pre><span class="token keyword">int</span> num <span class="token operator">=</span> <span class="token number">2333</span><span class="token punctuation">;</span>
<span class="token comment">// 获取变量num所在的内存地址</span>
<span class="token keyword">int</span> <span class="token operator">*</span>p <span class="token operator">=</span> <span class="token operator">&amp;</span>num<span class="token punctuation">;</span>
<span class="token comment">// 打印p的值（也就是变量num所在的内存地址）</span>
<span class="token comment">// 因为p是指针类型，没办法直接打印，所以要先把它转成int类型</span>
<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%d"</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>p<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 获取指针指向地址所存储的值</span>
<span class="token keyword">int</span> n <span class="token operator">=</span> <span class="token operator">*</span>p<span class="token punctuation">;</span></pre></div></code-block><div class="wolai-block wolai-text"><div><span class="inline-wrap"><b>指针与数组</b></span></div></div><code-block class="wolai-block"><div class="wolai-pre"><div data-lang="C" class="marker"></div><pre><span class="token comment">// 数组的名称表示的就是数组的第一个元素的地址</span>
<span class="token keyword">int</span> nums<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> <span class="token operator">*</span>p <span class="token operator">=</span> nums<span class="token punctuation">;</span>
<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%d = %d\n"</span><span class="token punctuation">,</span><span class="token operator">*</span>nums<span class="token punctuation">,</span><span class="token operator">*</span>p<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 数组的名称跟指针的区别在于</span>
<span class="token comment">// 指针对应的地址可以修改，但是数组名对应的地址不可以修改</span>
<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%d = %d\n"</span><span class="token punctuation">,</span>nums<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token operator">*</span><span class="token punctuation">(</span>nums<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 上面的写法是错误的，因为不允许对nums进行自增操作，但是指针可以</span>
<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%d = %d\n"</span><span class="token punctuation">,</span>nums<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token operator">++</span>p<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></div></code-block><div class="wolai-block wolai-text"><div><span class="inline-wrap"><b>sizeof</b></span></div></div><div class="wolai-block wolai-text"><div></div></div></article><footer></footer></body></html>