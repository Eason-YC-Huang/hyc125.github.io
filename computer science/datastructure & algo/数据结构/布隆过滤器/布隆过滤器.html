<!DOCTYPE html>
<html lang="zh-Hans-CN"><head><meta charset="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=Edge"/><link rel="stylesheet" type="text/css" href="../../../../css/modern-norm.min.css"/><link rel="stylesheet" type="text/css" href="../../../../css/prism.min.css"/><link rel="stylesheet" type="text/css" href="../../../../css/katex.min.css"/><link rel="stylesheet" type="text/css" href="../../../../css/wolai.css"/><title>布隆过滤器 - wolai 笔记</title><link rel="shortcut icon"></link></head><body class="font-kai"><header><div class="image has" style="background-position-y: 50%; background-image: url(&quot;https://cdn.wostatic.cn/cover/watercolor/jvCdHu4FXfSE8GoMhTRo8H.jpg&quot;)"></div><div class="title"><div class="banner"><div class="icon"></div></div><div data-title="布隆过滤器" class="main-title"></div></div></header><article><h2 class="wolai-block"><span class="inline-wrap">前言</span></h2><div class="wolai-block wolai-text"><div><span class="inline-wrap">很久之前就听说过布隆过滤器，但是一直没有去了解，今天趁着有空就去学习了一下，顺便记录记录。</span></div></div><h2 class="wolai-block"><span class="inline-wrap">简介</span></h2><div class="wolai-block wolai-text"><div><span class="inline-wrap">布隆过滤器，本质就是哈希函数<span class="jill"></span>+<span class="jill"></span>位图组成的一种数据结构，作用是判断某个元素是否在一个集合中，优点是空间效率和查询时间都非常高，缺点是有一定的误判率和不能删除。</span></div></div><aside class="bg-cultured wolai-block"><div data-symbol="❄️" class="icon"></div><span class="inline-wrap">布隆说不存在肯定不存在，说存在可能存在也可能不存在</span></aside><h2 class="wolai-block"><span class="inline-wrap">原理</span></h2><div class="wolai-block wolai-text"><div><span class="inline-wrap">当给定一个待查询的元素时，这个元素会被一系列哈希函数计算映射出一系列的值，所有的值在位数组的偏移量设置为<span class="jill"></span>1。如下图所示：</span></div></div><div class="wolai-block wolai-center"><figure><img src="media/bloom-filter.jpg" style="width: 760px"/></figure></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">如何判断某个元素是否在这个集合中呢？</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">元素经过相同的哈希函数计算后得到所有的偏移位置，若这些位置全都为<span class="jill"></span>1，则判断这个元素</span><span class="inline-wrap"><b>可能</b></span><span class="inline-wrap">在这个集合中，若有一个不为<span class="jill"></span>1，则判断这个元素</span><span class="inline-wrap"><b>肯定</b></span><span class="inline-wrap">不在这个集合中。</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap"><b>优点：</b></span><span class="inline-wrap">可以看到就是节省空间，采用位数组，2<span class="jill"></span>的<span class="jill"></span>32<span class="jill"></span>次方=4294967296 可以看到<span class="jill"></span>42<span class="jill"></span>亿长度的位数组占用 4294967296/8/1024/1024=512MB 只需占用<span class="jill"></span>512MB<span class="jill"></span>的内存空间</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap"><b>缺点：</b></span><span class="inline-wrap">有一定的误判，有可能把不在这个集合中的误判为在这个集合中</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap"><b>误报概率：</b></span><span class="inline-wrap"> 给定一个 m 位大小，k 个哈希函数的布隆过滤器，插入 n 个元素，则误报的概率为</span><span class="inline-wrap"><code>（1 – e^(-kn/m)）^k </code></span><span class="inline-wrap">。</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap"><b>最优哈希函数个数：</b></span><span class="inline-wrap"> 最优哈希函数个数为 *</span><span class="inline-wrap"><i>0.7 </i></span><span class="inline-wrap"><i>(m/n)</i></span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">有一个文件存了 10 亿条 URL，每条 64 字节左右。限定<span class="jill"></span>2G<span class="jill"></span>内存，使用布隆过滤器找出重复的 URL，误报概率是多少？</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">给 2 G 空间，k 的最优解为：</span><span class="inline-wrap"><code>((2*1024*1024*1024*8)/1000000000)*0.7 = 12</code></span><span class="inline-wrap">
误报概率为：</span><span class="inline-wrap"><code>(1-(1/e^(12*1000000000/(2*1024*1024*1024*8))))^12</code></span><span class="inline-wrap">
误报个数为： 260223</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">对于上面的问题其实有固定的套路，扫描文件 ==&gt; hash(URL) % N 。将文件切分到 N 个不同的小文件中（原来一个文件太大约 60 G，普通机器的内存存不下。N 可以是任何正整数，只要切分后满足内存限制的要求，如 100，1000，10000<span class="jill"></span>等）并且相同的 URL 会存储在同一个小文件中。之后单独处理每一个小文件即可。/</span></div></div><h2 class="wolai-block"><span class="inline-wrap">Java<span class="jill"></span>实现</span></h2><div class="wolai-block wolai-text"><div><span class="inline-wrap">在<span class="jill"></span>Google<span class="jill"></span>的<span class="jill"></span>Guava<span class="jill"></span>包中提供了布隆过滤器的相关工具类。</span></div></div><h2 class="wolai-block"><span class="inline-wrap">Redis<span class="jill"></span>实现</span></h2><div class="wolai-bookmark wolai-block"><a href="https://www.cnblogs.com/ysocean/p/12594982.html">Redis详解（十三）------ Redis布隆过滤器 - YSOcean - 博客园</a><div class="info-box"><div class="text-pane"><div data-title="Redis详解（十三）------ Redis布隆过滤器 - YSOcean - 博客园"></div><div data-desc="大数据量集合，如何准确快速的判断某个数据是否在大数据量集合中"></div><div class="icon-host"><div class="icon icon-image" style="background-image: url(&quot;https://common.cnblogs.com/favicon.svg&quot;)"></div><div data-hostname="www.cnblogs.com"></div></div></div><div class="preview-pane"></div></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap"></span><br/></div></div></article><footer></footer></body></html>