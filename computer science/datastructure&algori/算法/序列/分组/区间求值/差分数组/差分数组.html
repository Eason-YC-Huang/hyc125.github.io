<!DOCTYPE html>
<html lang="zh-Hans-CN"><head><meta charset="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=Edge"/><link rel="stylesheet" type="text/css" href="../../../../../../../css/modern-norm.min.css"/><link rel="stylesheet" type="text/css" href="../../../../../../../css/prism.min.css"/><link rel="stylesheet" type="text/css" href="../../../../../../../css/katex.min.css"/><link rel="stylesheet" type="text/css" href="../../../../../../../css/wolai.css"/><title>差分数组 - wolai 笔记</title><link rel="shortcut icon"></link></head><body><header><div class="image"></div><div class="title"><div class="banner"><div class="icon"></div></div><div data-title="差分数组" class="main-title"></div></div></header><article><div class="wolai-block wolai-text"><div><span class="inline-wrap"><b>差分基本概念</b></span></div></div><code-block class="wolai-block"><div class="wolai-pre"><div data-lang="纯文本" class="marker"></div><pre>原数组
nums<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>nums<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token spread operator">...</span><span class="token punctuation">,</span>nums<span class="token punctuation">[</span>i<span class="token punctuation">]</span>

差分数组
diff<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">=</span>nums<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
diff<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span>nums<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">-</span>nums<span class="token punctuation">[</span>i<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>

原数组就是差分数组的前缀和
diff<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">+</span>diff<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">+</span>…<span class="token operator">+</span>diff<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
  <span class="token operator">=</span>nums<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">+</span>nums<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">-</span>nums<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">+</span>nums<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token operator">-</span>nums<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">.</span><span class="token property-access">…</span><span class="token operator">+</span>nums<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">-</span>nums<span class="token punctuation">[</span>i<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>
  <span class="token operator">=</span>nums<span class="token punctuation">[</span>i<span class="token punctuation">]</span>

通过差分数组可以反推出原始数组
int<span class="token punctuation">[</span><span class="token punctuation">]</span> nums <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">int</span><span class="token punctuation">[</span>diff<span class="token punctuation">.</span><span class="token property-access">length</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
nums<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> diff<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword control-flow">for</span> <span class="token punctuation">(</span>int i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> diff<span class="token punctuation">.</span><span class="token property-access">length</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    nums<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> nums<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">+</span> diff<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</pre></div></code-block><div class="wolai-block wolai-text"><div><span class="inline-wrap"><b>差分数组的主要适用场景是频繁</b></span><span class="bg-lightpink inline-wrap"><b>对原始数组的某个区间的元素进行增减</b></span><span class="inline-wrap">。</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">现在有一个任务，在区间</span><span class="inline-wrap"><code>[lo,hi]</code></span><span class="inline-wrap">上加一个常数</span><span class="inline-wrap"><code>c</code></span><span class="inline-wrap">。</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">那么只需要让 </span><span class="inline-wrap"><code>diff[lo] += c</code></span><span class="inline-wrap">，然后再让 </span><span class="inline-wrap"><code>diff[hi+1] -=c </code></span><span class="inline-wrap">即可。</span></div></div><hr class="wolai-block"/><div class="wolai-block wolai-text"><div><span class="inline-wrap"><b>原理很简单，回想 </b></span><span class="inline-wrap"><b><code>diff</code></b></span><span class="inline-wrap"><b> 数组反推 </b></span><span class="inline-wrap"><b><code>nums</code></b></span><span class="inline-wrap"><b> 数组的过程，</b></span><span class="inline-wrap"><b><code>diff[i] += 3</code></b></span><span class="inline-wrap"><b> 意味着给 </b></span><span class="inline-wrap"><b><code>nums[i..]</code></b></span><span class="inline-wrap"><b> 所有的元素都加了 3，然后 </b></span><span class="inline-wrap"><b><code>diff[j+1] -= 3</code></b></span><span class="inline-wrap"><b> 又意味着对于 </b></span><span class="inline-wrap"><b><code>nums[j+1..]</code></b></span><span class="inline-wrap"><b> 所有元素再减 3，那综合起来，反推出来的</b></span><span class="inline-wrap"><b><code>nums</code></b></span><span class="inline-wrap"><b>数组在 </b></span><span class="inline-wrap"><b><code>nums[i..j]</code></b></span><span class="inline-wrap"><b> 中的所有元素都加 3 了</b></span><span class="inline-wrap">。</span></div></div><hr class="wolai-block"/><div class="wolai-block wolai-text"><div><span class="inline-wrap">只要花费 </span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mn>1</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(1)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord">1</span><span class="mclose">)</span></span></span></span></span><span class="inline-wrap"> 的时间修改 </span><span class="inline-wrap"><code>diff</code></span><span class="inline-wrap"> 数组，就相当于给 </span><span class="inline-wrap"><code>nums</code></span><span class="inline-wrap"> 的整个区间做了修改。多次修改 </span><span class="inline-wrap"><code>diff</code></span><span class="inline-wrap">，然后通过 </span><span class="inline-wrap"><code>diff</code></span><span class="inline-wrap"> 数组反推，即可得到 </span><span class="inline-wrap"><code>nums</code></span><span class="inline-wrap"> 修改后的结果。（把原序列的“区间操作”转化为差分序列的“单点操作”，从而降低算法的时间复杂度）</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap"></span><br/></div></div></article><footer></footer></body></html>