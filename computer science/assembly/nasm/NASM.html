<!DOCTYPE html>
<html lang="zh-Hans-CN"><head><meta charset="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=Edge"/><link rel="stylesheet" type="text/css" href="../../../css/modern-norm.min.css"/><link rel="stylesheet" type="text/css" href="../../../css/prism.min.css"/><link rel="stylesheet" type="text/css" href="../../../css/katex.min.css"/><link rel="stylesheet" type="text/css" href="../../../css/wolai.css"/><title>NASM - wolai 笔记</title><link rel="shortcut icon" href="data:image/svg+xml,%3Csvg xmlns=&apos;http://www.w3.org/2000/svg&apos; viewBox=&apos;0 0 800 800&apos;%3E%3Cdefs%3E%3Cstyle%3E.cls-1%7Bfill:%23fff;%7D%3C/style%3E%3C/defs%3E%3Cg%3E%3Cpath class=&apos;cls-1&apos; d=&apos;M610.08,0c66,0,90,6.88,114.13,19.79a134.62,134.62,0,0,1,56,56l2.28,4.4C793.93,103,800,127.88,800,189.92V610.08l-.08,11.56c-.78,57.38-7.58,79.89-19.71,102.57a134.62,134.62,0,0,1-56,56l-4.4,2.28C697,793.93,672.12,800,610.08,800H189.92l-11.56-.08c-57.38-.78-79.89-7.58-102.57-19.71a134.62,134.62,0,0,1-56-56l-2.28-4.4C6.44,697.75.4,673.72,0,616L0,189.92c0-66,6.88-90,19.79-114.13a134.62,134.62,0,0,1,56-56l4.4-2.28C102.25,6.44,126.28.4,184,0Z&apos;/%3E%3Cpath d=&apos;M610.08,0c66,0,90,6.88,114.13,19.79a134.62,134.62,0,0,1,56,56l2.28,4.4C793.93,103,800,127.88,800,189.92V610.08l-.08,11.56c-.78,57.38-7.58,79.89-19.71,102.57a134.62,134.62,0,0,1-56,56l-4.4,2.28C697,793.93,672.12,800,610.08,800H189.92l-11.56-.08c-57.38-.78-79.89-7.58-102.57-19.71a134.62,134.62,0,0,1-56-56l-2.28-4.4C6.44,697.75.4,673.72,0,616L0,189.92c0-66,6.88-90,19.79-114.13a134.62,134.62,0,0,1,56-56l4.4-2.28C102.25,6.44,126.28.4,184,0Zm4.72,88.9H185.2L172.42,89c-32.78.62-43.68,3.24-54.71,9.14a45.84,45.84,0,0,0-19.54,19.54c-6.61,12.36-9.11,24.55-9.27,67.49V614.8L89,627.58c.62,32.78,3.24,43.68,9.14,54.71a45.84,45.84,0,0,0,19.54,19.54c12.36,6.61,24.55,9.11,67.49,9.27H610.08c46.79,0,59.41-2.44,72.21-9.28a45.84,45.84,0,0,0,19.54-19.54c6.61-12.36,9.11-24.55,9.27-67.49V189.92c0-46.79-2.44-59.41-9.28-72.21a45.84,45.84,0,0,0-19.54-19.54C669.93,91.56,657.74,89.06,614.8,88.9ZM233.33,493.33A73.34,73.34,0,1,1,160,566.67,73.35,73.35,0,0,1,233.33,493.33Z&apos;/%3E%3C/g%3E%3C/svg%3E"></link></head><body><header><div class="image"></div><div class="title"><div class="banner"><div class="icon"></div></div><div data-title="NASM" class="main-title"></div></div></header><article><div class="wolai-block wolai-text"><div><span class="inline-wrap"><a href="https://cs.lmu.edu/~ray/notes/nasmtutorial/"><span>NASM<span class="jill"></span>入门</span></a></span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap"><a href="https://www.tutorialspoint.com/assembly_programming/assembly_introduction.htm"><span>NASM<span class="jill"></span>教程</span></a></span></div></div><h2 class="wolai-block"><span class="inline-wrap">汇编</span></h2><div class="wolai-block wolai-text"><div><span class="inline-wrap"><b>div</b></span></div></div><code-block class="wolai-block"><div class="wolai-pre"><div data-lang="6502 Assembly" class="marker"></div><pre><span class="token punctuation">;</span>div 指令是<span class="token number">8086</span>汇编中的除法运算指令，它的结果不是浮点数，而是两个整数：商和余数。
<span class="token punctuation">;</span><span class="token constant">A</span> <span class="token operator">/</span> <span class="token constant">B</span>，<span class="token constant">A</span>是被除数，<span class="token constant">B</span>是除数
<span class="token punctuation">;</span>被除数<span class="token constant">A</span>默认存放在<span class="token constant">AX</span>中（<span class="token number">16</span>位以内）
<span class="token punctuation">;</span>或 <span class="token constant">AX</span> 和 <span class="token constant">DX</span> 中（<span class="token number">32</span>位，<span class="token constant">DX</span>存放高<span class="token number">16</span>位，<span class="token constant">AX</span>存放低<span class="token number">16</span>位）
<span class="token punctuation">;</span>除数<span class="token constant">B</span>有<span class="token number">8</span>位和<span class="token number">16</span>位两种，保存在一个寄存器里或是内存单元中，
<span class="token punctuation">;</span>如果除数 <span class="token constant">B</span> 是<span class="token number">8</span>位，那么除法的结果<span class="token constant">AL</span>保存商，<span class="token constant">AH</span>保存余数，
<span class="token punctuation">;</span>如果除数 <span class="token constant">B</span> 是<span class="token number">16</span>位，那么除法的结果 <span class="token constant">AX</span>保存商，<span class="token constant">DX</span>保存余数。</pre></div></code-block><div class="wolai-block wolai-text"><div><span class="inline-wrap"><b>push 和 pop</b></span></div></div><hr class="wolai-block"/><div class="wolai-block wolai-text"><div><span class="inline-wrap">一个汇编程序主要分成三节(section):</span></div></div><ul class="wolai-block"><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">data<span class="jill"></span>节：声明常量和初始化数据，在运行时该节的数据不会被改变</span></li><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">bss<span class="jill"></span>节：声明变量</span></li><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">text<span class="jill"></span>节：文本节，编写代码的地方</span></li></ul><code-block class="wolai-block"><div class="wolai-pre"><div data-lang="6502 Assembly" class="marker"></div><pre><span class="token punctuation">;</span> hello<span class="token punctuation">.</span><span class="token property-access">asm</span>
section  <span class="token punctuation">.</span><span class="token property-access">data</span>
msg db <span class="token string">'Hello, world!'</span><span class="token punctuation">,</span> <span class="token number">0xa</span>  <span class="token punctuation">;</span><span class="token number">0xa</span> 换行符的ascii码
len equ $ <span class="token operator">-</span> msg     <span class="token punctuation">;</span>length <span class="token keyword">of</span> the string

section  <span class="token punctuation">.</span><span class="token property-access">text</span>
   global _start    <span class="token punctuation">;</span>must be declared <span class="token keyword control-flow">for</span> <span class="token function">linker</span> <span class="token punctuation">(</span>ld<span class="token punctuation">)</span>
  
_start<span class="token operator">:</span>              <span class="token punctuation">;</span>tells linker entry point
   mov  edx<span class="token punctuation">,</span>len     <span class="token punctuation">;</span>message length
   mov  ecx<span class="token punctuation">,</span>msg     <span class="token punctuation">;</span>message to write
   mov  ebx<span class="token punctuation">,</span><span class="token number">1</span>       <span class="token punctuation">;</span>file <span class="token function">descriptor</span> <span class="token punctuation">(</span>stdout<span class="token punctuation">)</span>
   mov  eax<span class="token punctuation">,</span><span class="token number">4</span>       <span class="token punctuation">;</span>system call <span class="token function">number</span> <span class="token punctuation">(</span>sys_write<span class="token punctuation">)</span>
   int  <span class="token number">0x80</span>        <span class="token punctuation">;</span>call kernel
  
   mov  eax<span class="token punctuation">,</span><span class="token number">1</span>       <span class="token punctuation">;</span>system call <span class="token function">number</span> <span class="token punctuation">(</span>sys_exit<span class="token punctuation">)</span>
   int  <span class="token number">0x80</span>        <span class="token punctuation">;</span>call kernel
</pre></div></code-block><code-block class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre>nasm -f elf hello.asm -o hello.o
ld -m elf_i386 -s -o hello hello.o</pre></div></code-block><div class="wolai-block wolai-text"><div><span class="inline-wrap"><b>内存分段</b></span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">A segmented memory model divides the system memory into groups of independent segments referenced by pointers located in the segment registers. Each segment is used to contain a specific type of data. One segment is used to contain instruction codes, another segment stores the data elements, and a third segment keeps the program stack.</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">常见的内存分段：</span></div></div><ul class="wolai-block"><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">数据段：It is represented by </span><span class="inline-wrap"><b>.data</b></span><span class="inline-wrap"> section and the </span><span class="inline-wrap"><b>.bss</b></span><span class="inline-wrap">.</span><ul class="wolai-block"><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">The .data section is used to declare the memory region, where data elements are stored for the program. This section cannot be expanded after the data elements are declared, and it remains static throughout the program.</span></li><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">The .bss section is also a static memory section that contains buffers for data to be declared later in the program. This buffer memory is zero-filled.</span></li></ul></li><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">代码段：It is represented by </span><span class="inline-wrap"><b>.text</b></span><span class="inline-wrap"> section. This defines an area in memory that stores the instruction codes. This is also a fixed area.</span></li><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">栈：This segment contains data values passed to functions and procedures within the program.</span></li></ul><code-block class="wolai-block"><div class="wolai-pre"><div data-lang="6502 Assembly" class="marker"></div><pre><span class="token punctuation">;</span> 读取键盘输入的数据，然后输出到屏幕
</pre></div></code-block><code-block class="wolai-block"><div class="wolai-pre"><div data-lang="6502 Assembly" class="marker"></div><pre><span class="token punctuation">;</span> nasm编译器使用汇编指令“section”和“segment”来定义段
<span class="token punctuation">;</span> 格式 section 段名称 <span class="token punctuation">[</span>align<span class="token punctuation">]</span> <span class="token punctuation">[</span>vstart<span class="token punctuation">]</span>
section header align<span class="token operator">=</span><span class="token number">16</span> vstart<span class="token operator">=</span><span class="token number">0x7c00</span>
<span class="token punctuation">;</span> 一旦定义段，那么后面的内容都属于该段，除非出现了另一个段的定义

<span class="token punctuation">;</span> 每个段都有一个汇编地址，它是相对于整个程序开头的，nasm编译提供了表达式方便取得段的汇编地址
section<span class="token punctuation">.</span><span class="token property-access">head</span><span class="token punctuation">.</span><span class="token property-access">start</span>

<span class="token punctuation">;</span> 标号
mv_15_to_ax<span class="token operator">:</span> mov ax <span class="token number">0x0f</span>

<span class="token punctuation">;</span> db定义字节类型变量，一个字节数据占<span class="token number">1</span>个字节单元，读完一个，偏移量加<span class="token number">1</span>
<span class="token punctuation">;</span> dw定义字类型变量，一个字数据占<span class="token number">2</span>个字节单元，读完一个，偏移量加<span class="token number">2</span>
<span class="token punctuation">;</span> dd定义双字类型变量，一个双字数据占<span class="token number">4</span>个字节单元，读完一个，偏移量加<span class="token number">4</span></pre></div></code-block></article><footer></footer></body></html>