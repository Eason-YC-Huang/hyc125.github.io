<!DOCTYPE html>
<html lang="zh-Hans-CN"><head><meta charset="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=Edge"/><link rel="stylesheet" type="text/css" href="../../../../css/modern-norm.min.css"/><link rel="stylesheet" type="text/css" href="../../../../css/prism.min.css"/><link rel="stylesheet" type="text/css" href="../../../../css/katex.min.css"/><link rel="stylesheet" type="text/css" href="../../../../css/wolai.css"/><title>网际控制报文协议ICMP - wolai 笔记</title><link rel="shortcut icon" href="data:image/svg+xml,%3Csvg xmlns=&apos;http://www.w3.org/2000/svg&apos; viewBox=&apos;0 0 800 800&apos;%3E%3Cdefs%3E%3Cstyle%3E.cls-1%7Bfill:%23fff;%7D%3C/style%3E%3C/defs%3E%3Cg%3E%3Cpath class=&apos;cls-1&apos; d=&apos;M610.08,0c66,0,90,6.88,114.13,19.79a134.62,134.62,0,0,1,56,56l2.28,4.4C793.93,103,800,127.88,800,189.92V610.08l-.08,11.56c-.78,57.38-7.58,79.89-19.71,102.57a134.62,134.62,0,0,1-56,56l-4.4,2.28C697,793.93,672.12,800,610.08,800H189.92l-11.56-.08c-57.38-.78-79.89-7.58-102.57-19.71a134.62,134.62,0,0,1-56-56l-2.28-4.4C6.44,697.75.4,673.72,0,616L0,189.92c0-66,6.88-90,19.79-114.13a134.62,134.62,0,0,1,56-56l4.4-2.28C102.25,6.44,126.28.4,184,0Z&apos;/%3E%3Cpath d=&apos;M610.08,0c66,0,90,6.88,114.13,19.79a134.62,134.62,0,0,1,56,56l2.28,4.4C793.93,103,800,127.88,800,189.92V610.08l-.08,11.56c-.78,57.38-7.58,79.89-19.71,102.57a134.62,134.62,0,0,1-56,56l-4.4,2.28C697,793.93,672.12,800,610.08,800H189.92l-11.56-.08c-57.38-.78-79.89-7.58-102.57-19.71a134.62,134.62,0,0,1-56-56l-2.28-4.4C6.44,697.75.4,673.72,0,616L0,189.92c0-66,6.88-90,19.79-114.13a134.62,134.62,0,0,1,56-56l4.4-2.28C102.25,6.44,126.28.4,184,0Zm4.72,88.9H185.2L172.42,89c-32.78.62-43.68,3.24-54.71,9.14a45.84,45.84,0,0,0-19.54,19.54c-6.61,12.36-9.11,24.55-9.27,67.49V614.8L89,627.58c.62,32.78,3.24,43.68,9.14,54.71a45.84,45.84,0,0,0,19.54,19.54c12.36,6.61,24.55,9.11,67.49,9.27H610.08c46.79,0,59.41-2.44,72.21-9.28a45.84,45.84,0,0,0,19.54-19.54c6.61-12.36,9.11-24.55,9.27-67.49V189.92c0-46.79-2.44-59.41-9.28-72.21a45.84,45.84,0,0,0-19.54-19.54C669.93,91.56,657.74,89.06,614.8,88.9ZM233.33,493.33A73.34,73.34,0,1,1,160,566.67,73.35,73.35,0,0,1,233.33,493.33Z&apos;/%3E%3C/g%3E%3C/svg%3E"></link></head><body><header><div class="image"></div><div class="title"><div class="banner"><div class="icon"></div></div><div data-title="网际控制报文协议ICMP" class="main-title"></div></div></header><article><h1 class="wolai-block"><span class="inline-wrap">网际控制报文协议<span class="jill"></span>ICMP</span></h1><div class="wolai-block wolai-text"><div><span class="inline-wrap">为了更有效的转发<span class="jill"></span>IP<span class="jill"></span>数据报和提高交付成功的机会，在网际层使用了网际控制报文协议<span class="jill"></span>ICMP（Internet Control Message Protocol）。ICMP<span class="jill"></span>允许主机或路由器</span><span class="inline-wrap"><b>报告差错情况和提供有关异常情况的报告</b></span><span class="inline-wrap">。</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">ICMP<span class="jill"></span>报文装在<span class="jill"></span>IP<span class="jill"></span>数据报中，作为其中的数据部分，下图是<span class="jill"></span>ICMP<span class="jill"></span>报文的格式。</span></div></div><div class="wolai-block wolai-center"><figure><img src="media/icmp%E6%8A%A5%E6%96%87%E7%9A%84%E6%A0%BC%E5%BC%8F.png" style="width: 759.5px"/></figure></div><h2 class="wolai-block"><span class="inline-wrap">ICMP<span class="jill"></span>报文的种类</span></h2><div class="wolai-block wolai-text"><div><span class="inline-wrap">ICMP<span class="jill"></span>报文分为两类：ICMP<span class="jill"></span>差错报告报文和<span class="jill"></span>ICMP<span class="jill"></span>询问报文。</span></div></div><div class="wolai-block wolai-center"><figure><img src="media/%E5%B8%B8%E8%A7%81%E7%9A%84icmp%E6%8A%A5%E6%96%87%E5%88%86%E7%B1%BB.png" style="width: 759.5px"/></figure></div><div class="wolai-block wolai-text"><div><span class="inline-wrap"><b>ICMP<span class="jill"></span>差错报告报文</b></span></div></div><ul class="wolai-block"><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">终点不可达：当路由器或主机不能交付数据报时就向源点发送终点不可达报文</span></li><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">时间超过：</span><ul class="wolai-block"><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">当路由器收到生存时间为零的数据报时，除了丢弃该数据报外，还要向源点发送时间超过报文。</span></li><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">当终点在预先规定的时间内不能收到一个数据报的全部数据报片时，就把已收到的数据报片都丢弃，并向源点发送时间超过报文。</span></li></ul></li><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">参数问题：当路由器或目的主机收到的数据报的首部中有的字段的值不正确时，丢弃该数据报，向源点发送参数问题报文。</span></li><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">改变路由：路由器把改变路由报文发送给主机，让主机知道下次应将数据报发送给另外的路由器。</span></li></ul><div class="wolai-block wolai-center"><figure><img src="media/icmp%E5%B7%AE%E9%94%99%E6%8A%A5%E5%91%8A%E6%8A%A5%E6%96%87.png" style="width: 759.5px"/></figure></div><div class="wolai-block wolai-text"><div><span class="inline-wrap"><b>PS：提取<span class="jill"></span>IP<span class="jill"></span>数据报数据部分的前<span class="jill"></span>8<span class="jill"></span>个字节是为了获得传输层的端口号（对于<span class="jill"></span>TCP<span class="jill"></span>和<span class="jill"></span>UDP）以及运输层报文的发送序号（对于<span class="jill"></span>TCP）</b></span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap"><b>ICMP<span class="jill"></span>询问报文</b></span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">常用的<span class="jill"></span>ICMP<span class="jill"></span>询问报文有两种：</span></div></div><ul class="wolai-block"><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">回送请求和回答：ICMP<span class="jill"></span>回送请求报文时主机或路由器向特定的目的主机发出询问，收到此报文的主机必须给源主机或路由器发送<span class="jill"></span>ICMP<span class="jill"></span>回送回答报文。</span><span class="inline-wrap"><b>其实就是用来测试目的主机是否可达以及了解其有关状态。</b></span><span class="inline-wrap"> 我们常用的<span class="jill"></span>PING<span class="jill"></span>命令就是使用了它，PING<span class="jill"></span>是应用层直接使用了网络层<span class="jill"></span>ICMP<span class="jill"></span>的一个例子，它没有它通过运输层的<span class="jill"></span>TCP<span class="jill"></span>或<span class="jill"></span>UDP。</span></li><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">时间戳请求和回答：要求另一台设备返回它当前的日期和时间。</span></li></ul></article><footer></footer></body></html>