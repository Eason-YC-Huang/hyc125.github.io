<!DOCTYPE html>
<html lang="zh-Hans-CN"><head><meta charset="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=Edge"/><link rel="stylesheet" type="text/css" href="../../../../css/modern-norm.min.css"/><link rel="stylesheet" type="text/css" href="../../../../css/prism.min.css"/><link rel="stylesheet" type="text/css" href="../../../../css/katex.min.css"/><link rel="stylesheet" type="text/css" href="../../../../css/wolai.css"/><title>网际协议 - wolai 笔记</title><link rel="shortcut icon" href="data:image/svg+xml,%3Csvg xmlns=&apos;http://www.w3.org/2000/svg&apos; viewBox=&apos;0 0 800 800&apos;%3E%3Cdefs%3E%3Cstyle%3E.cls-1%7Bfill:%23fff;%7D%3C/style%3E%3C/defs%3E%3Cg%3E%3Cpath class=&apos;cls-1&apos; d=&apos;M610.08,0c66,0,90,6.88,114.13,19.79a134.62,134.62,0,0,1,56,56l2.28,4.4C793.93,103,800,127.88,800,189.92V610.08l-.08,11.56c-.78,57.38-7.58,79.89-19.71,102.57a134.62,134.62,0,0,1-56,56l-4.4,2.28C697,793.93,672.12,800,610.08,800H189.92l-11.56-.08c-57.38-.78-79.89-7.58-102.57-19.71a134.62,134.62,0,0,1-56-56l-2.28-4.4C6.44,697.75.4,673.72,0,616L0,189.92c0-66,6.88-90,19.79-114.13a134.62,134.62,0,0,1,56-56l4.4-2.28C102.25,6.44,126.28.4,184,0Z&apos;/%3E%3Cpath d=&apos;M610.08,0c66,0,90,6.88,114.13,19.79a134.62,134.62,0,0,1,56,56l2.28,4.4C793.93,103,800,127.88,800,189.92V610.08l-.08,11.56c-.78,57.38-7.58,79.89-19.71,102.57a134.62,134.62,0,0,1-56,56l-4.4,2.28C697,793.93,672.12,800,610.08,800H189.92l-11.56-.08c-57.38-.78-79.89-7.58-102.57-19.71a134.62,134.62,0,0,1-56-56l-2.28-4.4C6.44,697.75.4,673.72,0,616L0,189.92c0-66,6.88-90,19.79-114.13a134.62,134.62,0,0,1,56-56l4.4-2.28C102.25,6.44,126.28.4,184,0Zm4.72,88.9H185.2L172.42,89c-32.78.62-43.68,3.24-54.71,9.14a45.84,45.84,0,0,0-19.54,19.54c-6.61,12.36-9.11,24.55-9.27,67.49V614.8L89,627.58c.62,32.78,3.24,43.68,9.14,54.71a45.84,45.84,0,0,0,19.54,19.54c12.36,6.61,24.55,9.11,67.49,9.27H610.08c46.79,0,59.41-2.44,72.21-9.28a45.84,45.84,0,0,0,19.54-19.54c6.61-12.36,9.11-24.55,9.27-67.49V189.92c0-46.79-2.44-59.41-9.28-72.21a45.84,45.84,0,0,0-19.54-19.54C669.93,91.56,657.74,89.06,614.8,88.9ZM233.33,493.33A73.34,73.34,0,1,1,160,566.67,73.35,73.35,0,0,1,233.33,493.33Z&apos;/%3E%3C/g%3E%3C/svg%3E"></link></head><body><header><div class="image"></div><div class="title"><div class="banner"><div class="icon"></div></div><div data-title="网际协议" class="main-title"></div></div></header><article><div class="wolai-block wolai-text"><div><span class="inline-wrap">重点：</span></div></div><ul class="wolai-block"><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">IP<span class="jill"></span>协议的作用</span></li><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">IP<span class="jill"></span>地址的划分</span></li><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">ARP、ICMP、IGMP<span class="jill"></span>作用</span></li><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">IP<span class="jill"></span>分组的路由</span></li><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">IP<span class="jill"></span>数据报分片</span></li></ul><div class="wolai-block wolai-text"><div><span class="inline-wrap">Internet Protocol(网际协议)是<span class="jill"></span>TCP/IP<span class="jill"></span>体系中最主要的协议之一，与<span class="jill"></span>IP<span class="jill"></span>协议配套使用的还有三个协议：</span></div></div><ul class="wolai-block"><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">网际控制报文协议 （Internet Control Message Protocol）</span></li><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">网际组管理协议（Internet Group Management Protocol）</span></li><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">地址解析协议 （Address Resolution Protocol）</span></li></ul><div class="wolai-block wolai-center"><figure style="width: 100%"><img src="media/%E7%BD%91%E9%99%85%E5%8D%8F%E8%AE%AEip%E5%8F%8A%E5%85%B6%E9%85%8D%E5%A5%97%E5%8D%8F%E8%AE%AE.png" style="width: 615.5px"/></figure></div><h3 class="wolai-block"><span class="inline-wrap">IP<span class="jill"></span>数据报的格式</span></h3><div class="wolai-block wolai-center"><figure style="width: 100%"><img src="media/ip%E6%95%B0%E6%8D%AE%E6%8A%A5%E6%A0%BC%E5%BC%8F.png" style="width: 759.5px"/></figure></div><ul class="wolai-block"><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">版本(4<span class="jill"></span>位)：IP<span class="jill"></span>协议的版本号。</span></li><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">首部长度(4<span class="jill"></span>位)：单位是(4<span class="jill"></span>字节)，(24 - 1) * 4 = 60(字节)，IP4<span class="jill"></span>协议首部对多<span class="jill"></span>60<span class="jill"></span>字节。</span></li><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">区分服务(8<span class="jill"></span>位)：</span></li><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">总长度(16<span class="jill"></span>位)：整个<span class="jill"></span>IP<span class="jill"></span>数据报的长度，单位是字节。</span></li><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">标识(16<span class="jill"></span>位)：每产生一个<span class="jill"></span>IP<span class="jill"></span>数据报，标志加<span class="jill"></span>1，如果<span class="jill"></span>IP<span class="jill"></span>数据报封装成帧后，长度超过了最大传送单元(MTU)，需要对帧进行分片，分片时，这个标识字段的值被复制到所有的数据报片的标识字段中。</span></li><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">标志(3<span class="jill"></span>位)：只有两位有意义</span><ul class="wolai-block"><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">最低位是<span class="jill"></span>MF(More Frame)，MF=1<span class="jill"></span>表示还有分片，MF=0<span class="jill"></span>表示这是最后一个分片</span></li><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">中间位是<span class="jill"></span>DF，DF=1<span class="jill"></span>表示不允许分片，DF=0<span class="jill"></span>表示允许分片</span></li></ul></li><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">片偏移：指出分片后，某片在原分组中的相对位置，片偏移以<span class="jill"></span>8<span class="jill"></span>个字节为偏移单位，也就是说除了最后一个分片，每个分片的长度一定是<span class="jill"></span>8<span class="jill"></span>字节的整数倍。</span></li><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">生存时间：数据报在网络中最大存活时间，每经过一个路由器，生存时间-1。</span></li></ul><h3 class="wolai-block"><span class="inline-wrap">IP<span class="jill"></span>地址及其表示方法</span></h3><div class="wolai-block wolai-text"><div><span class="inline-wrap">整个互联网就是一个单一的、抽象的网络。IP<span class="jill"></span>地址就是给互联网上的每一台主机（或路由器）的每一个接口分配一个在全世界范围内是唯一的<span class="jill"></span>32<span class="jill"></span>位的标识符。IP<span class="jill"></span>地址的结构应该方便我们在互联网上进行寻址。</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">IP<span class="jill"></span>地址的编址方法共经历了三个历史阶段：</span></div></div><ul class="wolai-block"><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">分类的<span class="jill"></span>IP<span class="jill"></span>地址：最基本的编址方法</span></li><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">子网的划分：对最基本的编址方法的改进</span></li><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">构成超网：无分类编址方法</span></li></ul><h3 class="wolai-block"><span class="inline-wrap">分类的<span class="jill"></span>IP<span class="jill"></span>地址</span></h3><div class="wolai-block wolai-text"><div><span class="inline-wrap">所谓“分类的<span class="jill"></span>IP<span class="jill"></span>地址”就是将<span class="jill"></span>IP<span class="jill"></span>地址</span><span class="inline-wrap"><b>分类</b></span><span class="inline-wrap">，每一类地址都由</span><span class="inline-wrap"><b>两个固定长度的字段组成</b></span><span class="inline-wrap">，其中第一个字段是</span><span class="inline-wrap"><b>网络号</b></span><span class="inline-wrap">，它标志主机（或路由器）所连接的网络，一个网络号在整个互联网范围内必须是唯一的。第二个字段是</span><span class="inline-wrap"><b>主机号</b></span><span class="inline-wrap">，它标志该主机（或路由器）。</span></div></div><div class="wolai-block wolai-center"><figure style="width: 100%"><img src="media/ip%E5%9C%B0%E5%9D%80%E4%B8%AD%E7%9A%84%E7%BD%91%E7%BB%9C%E5%8F%B7%E5%AD%97%E6%AE%B5%E5%92%8C%E4%B8%BB%E6%9C%BA%E5%8F%B7%E5%AD%97%E6%AE%B5.png" style="width: 759.5px"/></figure></div><blockquote class="wolai-block"><span class="inline-wrap">由于近年来已经广泛使用无分类<span class="jill"></span>IP<span class="jill"></span>地址进行路由选择，A<span class="jill"></span>类、B<span class="jill"></span>类、C<span class="jill"></span>类地址的区分已成为历史，但是为了更好的了解<span class="jill"></span>IP<span class="jill"></span>地址，我们还是从分类的<span class="jill"></span>IP<span class="jill"></span>地址讲起。</span></blockquote><div class="wolai-block wolai-center"><figure style="width: 100%"><img src="media/ip%E5%9C%B0%E5%9D%80%E7%9A%84%E6%8C%87%E6%B4%BE%E8%8C%83%E5%9B%B4.png" style="width: 760px"/></figure></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">为什么<span class="jill"></span>A<span class="jill"></span>类网络，网络数要减<span class="jill"></span>2，因为有两个特殊的<span class="jill"></span>IP<span class="jill"></span>地址</span></div></div><ul class="wolai-block"><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">网络号<span class="jill"></span>0（00000000）表示本网络。</span></li><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">网络号<span class="jill"></span>127（01111111）保留作为本地软件环回测试（本主机的进程之间的通信），若主机发送一个目的地址为环回地址（例如<span class="jill"></span>127.0.0.1）的<span class="jill"></span>IP<span class="jill"></span>数据报，则本主机中的协议软件就处理数据报中的数据，而不会把数据报发送到任何网络。</span></li></ul><div class="wolai-block wolai-center"><figure style="width: 100%"><img src="media/%E4%B8%80%E8%88%AC%E4%B8%8D%E4%BD%BF%E7%94%A8%E7%9A%84%E7%89%B9%E6%AE%8Aip%E5%9C%B0%E5%9D%80.png" style="width: 759.5px"/></figure></div><blockquote class="wolai-block"><span class="inline-wrap"><code>127.0.0.1</code></span><span class="inline-wrap">与</span><span class="inline-wrap"><code>localhost</code></span><span class="inline-wrap">
</span><span class="inline-wrap"><code>localhost</code></span><span class="inline-wrap">是一个域名，在过去它指向 </span><span class="inline-wrap"><a href="https://www.baidu.com/s?wd=127.0.0.1&amp;tn=SE_PcZhidaonwhc_ngpagmjz&amp;rsv_dl=gh_pc_zhidao"><span>127.0.0.1</span></a></span><span class="inline-wrap"> 这个<span class="jill"></span>IP<span class="jill"></span>地址。在操作系统支持 ipv6 后，它同时还指向<span class="jill"></span>ipv6 的地址 [::1]
这个域名是预定义的，在<span class="jill"></span>Windows<span class="jill"></span>中，从 </span><span class="inline-wrap"><code>hosts</code></span><span class="inline-wrap"> 文件中可以看出，而在 Linux 中，其定义位于 </span><span class="inline-wrap"><code>/etc/hosts</code></span><span class="inline-wrap"> 。</span></blockquote><h3 class="wolai-block"><span class="inline-wrap">子网与子网掩码</span></h3><div class="wolai-block wolai-text"><div><span class="inline-wrap"><b>子网划分</b></span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">早期<span class="jill"></span>IP<span class="jill"></span>地址的划分设计的不够合理，有以下缺点：</span></div></div><ol class="wolai-block"><li><div class="marker"></div><span class="inline-wrap">IP<span class="jill"></span>地址空间的利用率有时很低</span><span class="inline-wrap">
</span><span class="inline-wrap">有的单位申请到了一个<span class="jill"></span>B<span class="jill"></span>类地址网络，但所连接的主机数并不多，可是又不愿意申请一个足够使用的<span class="jill"></span>C<span class="jill"></span>类地址，理由是考虑到今后可能的发展，这就导致了大量的<span class="jill"></span>IP<span class="jill"></span>地址被浪费了。</span></li><li><div class="marker"></div><span class="inline-wrap">路由表变得太大使得网络性能变坏
例如一个<span class="jill"></span>A<span class="jill"></span>类网络，可以分配</span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mn>2</mn><mn>24</mn></msup></mrow><annotation encoding="application/x-tex">2^{24}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8141em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">24</span></span></span></span></span></span></span></span></span></span></span></span></span><span class="inline-wrap"> - 2<span class="jill"></span>个<span class="jill"></span>IP，路由表中的项目数越多，查找路由时耗费时间越多，同时路由器之间定期交换的路由信息也很大，从而是路由器和整个网络的性能都下降了</span></li><li><div class="marker"></div><span class="inline-wrap">不够灵活</span><span class="inline-wrap">
</span><span class="inline-wrap">有时情况紧急，一个单位需要在新的地点马上开通一个新的网络，但是在申请到一个新的<span class="jill"></span>IP<span class="jill"></span>之前，新增的网络是不可能连接到互联网上工作的。</span></li></ol><div class="wolai-block wolai-text"><div><span class="inline-wrap">为了解决这个问题，从<span class="jill"></span>1985<span class="jill"></span>年在<span class="jill"></span>IP<span class="jill"></span>地址新增了“子网号字段”，从原来主机号中借用若干位作为子网号。（ip={<span class="jill"></span>网络号 子网号 主机号<span class="jill"></span>}）</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">例如一个<span class="jill"></span>B<span class="jill"></span>类网络（192.168.0.0）可以划分为子网<span class="jill"></span>1<span class="jill"></span>和子网<span class="jill"></span>2......
子网<span class="jill"></span>1（192.168.1-0000000.00000000）
子网<span class="jill"></span>2（192.186.10-000000.00000000）</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap"><b>子网掩码</b></span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">现在剩下的问题就是：假定有一个数据报（目的<span class="jill"></span>IP<span class="jill"></span>是<span class="jill"></span>145.13.00000011.00000010），怎么知道它属于哪个子网呢？</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">这时候就要用子网掩码，把目的<span class="jill"></span>IP<span class="jill"></span>与子网掩码进行与运算，就能得到目的<span class="jill"></span>IP<span class="jill"></span>的子网地址</span></div></div><div class="wolai-block wolai-center"><figure style="width: 100%"><img src="media/%E5%AD%90%E7%BD%91%E6%8E%A9%E7%A0%81.png" style="width: 759.5px"/></figure></div><h3 class="wolai-block"><span class="inline-wrap">无分类编址<span class="jill"></span>CIDR</span></h3><div class="wolai-block wolai-text"><div><span class="inline-wrap">CIDR<span class="jill"></span>消除了传统的<span class="jill"></span>IP<span class="jill"></span>分类和划分子网的概念，它把<span class="jill"></span>32<span class="jill"></span>位<span class="jill"></span>IP<span class="jill"></span>地址分为两部分，前面时</span><span class="inline-wrap"><b>网络前缀</b></span><span class="inline-wrap">，后面则是</span><span class="inline-wrap"><b>主机号</b></span><span class="inline-wrap">。CIDR<span class="jill"></span>使用斜线记法，在<span class="jill"></span>IP<span class="jill"></span>地址后面加上斜线，表示网络前缀所占的位数。（233.233.233.233/12）网络前缀是前<span class="jill"></span>12<span class="jill"></span>位。</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">CIDR<span class="jill"></span>也使用地址掩码，掩码由一串<span class="jill"></span>1<span class="jill"></span>和<span class="jill"></span>0<span class="jill"></span>组成，而<span class="jill"></span>1<span class="jill"></span>的个数就是网络前缀的长度。</span></div></div><h3 class="wolai-block"><span class="inline-wrap">IP<span class="jill"></span>地址与硬件地址</span></h3><div class="wolai-block wolai-text"><div><span class="red inline-wrap">网络层的下一层是链路层，链路层中传输的数据单元叫做帧，帧的首部写有数据接收方的硬件地址，链路层上的设备在收到<span class="jill"></span>MAC<span class="jill"></span>帧时，根据<span class="jill"></span>MAC<span class="jill"></span>帧首部中的硬件地址决定收下或者丢弃。</span></div></div><div class="wolai-block wolai-center"><figure style="width: 100%"><img src="media/ip%E5%9C%B0%E5%9D%80%E4%B8%8E%E7%A1%AC%E4%BB%B6%E5%9C%B0%E5%9D%80%E7%9A%84%E5%8C%BA%E5%88%AB.png" style="width: 760px"/></figure></div><div class="wolai-block wolai-text"><div><span class="inline-wrap"><b>地址解析协议 ARP</b></span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">那么这个硬件地址是怎么来的呢？这就是<span class="jill"></span>ARP<span class="jill"></span>要解决的问题，它把网络层的<span class="jill"></span>IP<span class="jill"></span>地址解析为链路层的硬件地址</span></div></div><ol class="wolai-block"><li><div class="marker"></div><span class="inline-wrap">ARP<span class="jill"></span>进程在本局域网上广播发送一个<span class="jill"></span>ARP<span class="jill"></span>请求，大致内容是：“我的<span class="jill"></span>IP<span class="jill"></span>地址是<span class="jill"></span>x.x.x.x，硬件地址是<span class="jill"></span>00-00-C0-15-AD-18”，我想知道<span class="jill"></span>IP<span class="jill"></span>地址为<span class="jill"></span>x.x.x.y<span class="jill"></span>的主机的硬件地址。</span></li><li><div class="marker"></div><span class="inline-wrap">本局域网上其它主机的<span class="jill"></span>ARP<span class="jill"></span>进程都收到此<span class="jill"></span>ARP<span class="jill"></span>请求。</span></li><li><div class="marker"></div><span class="inline-wrap">如果自己的<span class="jill"></span>IP<span class="jill"></span>地址与请求中要查询的<span class="jill"></span>IP<span class="jill"></span>地址一致，就收下这个<span class="jill"></span>ARP<span class="jill"></span>请求，并向请求方发送<span class="jill"></span>ARP<span class="jill"></span>响应，响应包含自己的硬件地址</span></li></ol><aside class="bg-cultured wolai-block"><div data-symbol="🚀" class="icon"></div><span class="inline-wrap">ARP<span class="jill"></span>解决同一个局域网上设备的<span class="jill"></span>IPv4<span class="jill"></span>地址和硬件地址的映射问题。
IPv6<span class="jill"></span>使用邻居发现协议。</span></aside><div class="wolai-block wolai-text"><div><span class="inline-wrap"></span><br/></div></div><h3 class="wolai-block"><span class="inline-wrap">IP<span class="jill"></span>层转发分组的流程</span></h3><div class="wolai-block wolai-text"><div><span class="inline-wrap">设备会维护一个路由表，它存储了本地设备可以到达的网络目的地址范围和如何到达的路由信息</span></div></div><div class="wolai-block wolai-center"><figure style="width: 100%"><img src="media/%E8%B7%AF%E7%94%B1%E8%A1%A8.png" style="width: 760px"/></figure></div><div class="wolai-block wolai-center"><figure style="width: 100%"><img src="media/%E8%B7%AF%E7%94%B1%E8%A1%A82.png" style="width: 759.5px"/></figure></div><div class="wolai-block wolai-center"><figure style="width: 100%"><img src="media/%E8%B7%AF%E7%94%B1%E8%A1%A83.png" style="width: 759.5px"/></figure></div><div class="wolai-block wolai-center"><figure style="width: 100%"><img src="media/%E5%88%86%E7%BB%84%E8%BD%AC%E5%8F%91%E6%B5%81%E7%A8%8B.png" style="width: 759.5px"/></figure></div><div class="wolai-block wolai-text"><div><span class="inline-wrap"><b>使用子网时分组的转发</b></span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">在划分子网的情况下，分组转发的算法必须做相应的改动。</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">路由表必须包含以下三项内容：</span><span class="inline-wrap"><b>目的网络地址</b></span><span class="inline-wrap">、</span><span class="inline-wrap"><b>子网掩码</b></span><span class="inline-wrap">、</span><span class="inline-wrap"><b>下一跳地址</b></span><span class="inline-wrap">。</span></div></div><div class="wolai-block wolai-center"><figure style="width: 100%"><img src="media/%E5%88%92%E5%88%86%E5%AD%90%E7%BD%91%E6%97%B6%E5%88%86%E7%BB%84%E7%9A%84%E8%BD%AC%E5%8F%91.png" style="width: 759.5px"/></figure></div><div class="wolai-block wolai-text"><div><span class="inline-wrap"></span><br/></div></div><ol class="wolai-block"><li><div class="marker"></div><span class="inline-wrap">发送方要发消息。接收方在同一个局域网内。发送方连接的是交换机。</span><div class="wolai-block wolai-text"><div><span class="inline-wrap">发送方通过<span class="jill"></span>ARP<span class="jill"></span>获取接收方的<span class="jill"></span>MAC<span class="jill"></span>地址。</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">发送方利用该<span class="jill"></span>MAC<span class="jill"></span>地址创建帧。</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">交换机会根据帧上面的<span class="jill"></span>MAC<span class="jill"></span>地址，把帧转发给对应接收方。</span></div></div></li><li><div class="marker"></div><span class="inline-wrap">发送方要发消息。接收方在同一个局域网内。发送方连接的是路由器。</span><div class="wolai-block wolai-text"><div><span class="inline-wrap">发送方通过<span class="jill"></span>ARP<span class="jill"></span>获取接收方的<span class="jill"></span>MAC<span class="jill"></span>地址。</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">发送方利用该<span class="jill"></span>MAC<span class="jill"></span>地址创建帧。</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">路由器会根据帧上面的<span class="jill"></span>MAC<span class="jill"></span>地址，把帧转发给对应接收方。</span></div></div></li><li><div class="marker"></div><span class="inline-wrap">发送方要发消息。接收方不在同一个局域网内。</span><div class="wolai-block wolai-text"><div><span class="inline-wrap">发送方利用路由器的<span class="jill"></span>MAC<span class="jill"></span>地址创建帧。</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">路由器接收到帧，根据里面<span class="jill"></span>IP<span class="jill"></span>分组的信息，把<span class="jill"></span>IP<span class="jill"></span>分组转发到下一跳路由。</span></div></div></li></ol><div class="wolai-bookmark wolai-block"><a href="https://www.youtube.com/watch?v=zhlMLRNY5-4">https://www.youtube.com/watch?v=zhlMLRNY5-4</a><div class="info-box"><div class="text-pane"><div data-title="www.youtube.com"></div><div class="icon-host"><div data-hostname="www.youtube.com"></div></div></div><div class="preview-pane"></div></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap"></span><br/></div></div></article><footer></footer></body></html>