<!DOCTYPE html>
<html lang="zh-Hans-CN"><head><meta charset="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=Edge"/><link rel="stylesheet" type="text/css" href="../../../../css/modern-norm.min.css"/><link rel="stylesheet" type="text/css" href="../../../../css/prism.min.css"/><link rel="stylesheet" type="text/css" href="../../../../css/katex.min.css"/><link rel="stylesheet" type="text/css" href="../../../../css/wolai.css"/><title>UDP - wolai 笔记</title><link rel="shortcut icon" href="data:image/svg+xml,%3Csvg xmlns=&apos;http://www.w3.org/2000/svg&apos; viewBox=&apos;0 0 800 800&apos;%3E%3Cdefs%3E%3Cstyle%3E.cls-1%7Bfill:%23fff;%7D%3C/style%3E%3C/defs%3E%3Cg%3E%3Cpath class=&apos;cls-1&apos; d=&apos;M610.08,0c66,0,90,6.88,114.13,19.79a134.62,134.62,0,0,1,56,56l2.28,4.4C793.93,103,800,127.88,800,189.92V610.08l-.08,11.56c-.78,57.38-7.58,79.89-19.71,102.57a134.62,134.62,0,0,1-56,56l-4.4,2.28C697,793.93,672.12,800,610.08,800H189.92l-11.56-.08c-57.38-.78-79.89-7.58-102.57-19.71a134.62,134.62,0,0,1-56-56l-2.28-4.4C6.44,697.75.4,673.72,0,616L0,189.92c0-66,6.88-90,19.79-114.13a134.62,134.62,0,0,1,56-56l4.4-2.28C102.25,6.44,126.28.4,184,0Z&apos;/%3E%3Cpath d=&apos;M610.08,0c66,0,90,6.88,114.13,19.79a134.62,134.62,0,0,1,56,56l2.28,4.4C793.93,103,800,127.88,800,189.92V610.08l-.08,11.56c-.78,57.38-7.58,79.89-19.71,102.57a134.62,134.62,0,0,1-56,56l-4.4,2.28C697,793.93,672.12,800,610.08,800H189.92l-11.56-.08c-57.38-.78-79.89-7.58-102.57-19.71a134.62,134.62,0,0,1-56-56l-2.28-4.4C6.44,697.75.4,673.72,0,616L0,189.92c0-66,6.88-90,19.79-114.13a134.62,134.62,0,0,1,56-56l4.4-2.28C102.25,6.44,126.28.4,184,0Zm4.72,88.9H185.2L172.42,89c-32.78.62-43.68,3.24-54.71,9.14a45.84,45.84,0,0,0-19.54,19.54c-6.61,12.36-9.11,24.55-9.27,67.49V614.8L89,627.58c.62,32.78,3.24,43.68,9.14,54.71a45.84,45.84,0,0,0,19.54,19.54c12.36,6.61,24.55,9.11,67.49,9.27H610.08c46.79,0,59.41-2.44,72.21-9.28a45.84,45.84,0,0,0,19.54-19.54c6.61-12.36,9.11-24.55,9.27-67.49V189.92c0-46.79-2.44-59.41-9.28-72.21a45.84,45.84,0,0,0-19.54-19.54C669.93,91.56,657.74,89.06,614.8,88.9ZM233.33,493.33A73.34,73.34,0,1,1,160,566.67,73.35,73.35,0,0,1,233.33,493.33Z&apos;/%3E%3C/g%3E%3C/svg%3E"></link></head><body><header><div class="image"></div><div class="title"><div class="banner"><div class="icon"></div></div><div data-title="UDP" class="main-title"></div></div></header><article><div class="wolai-block wolai-text"><div><span class="inline-wrap">UDP(User Datagram Protocol) 用户数据报协议</span></div></div><h3 class="wolai-block"><span class="inline-wrap">UDP<span class="jill"></span>的主要特点</span></h3><ul class="wolai-block"><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">UDP<span class="jill"></span>是无连接的</span></li><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">UDP<span class="jill"></span>不保证可靠交付</span></li><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">UDP<span class="jill"></span>是面向报文的</span></li><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">UDP<span class="jill"></span>的首部开销小</span></li><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">UDP<span class="jill"></span>支持多种交互通信</span></li><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">UDP<span class="jill"></span>没有拥塞控制</span></li></ul><div class="wolai-block wolai-text"><div><span class="inline-wrap"><b>无连接</b></span><span class="inline-wrap">：发送数据前不需要建立连接，减少了开销和发送数据之前的等待时间</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap"><b>面向报文</b></span><span class="inline-wrap">：</span></div></div><ul class="wolai-block"><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">UDP<span class="jill"></span>对应用层下交的报文只是添加<span class="jill"></span>UDP<span class="jill"></span>首部，然后就交付给<span class="jill"></span>IP<span class="jill"></span>层</span></li><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">UDP<span class="jill"></span>对应用层下交的报文，既不合并，也不拆分，就是有多少发多少</span></li><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">UDP<span class="jill"></span>对<span class="jill"></span>IP<span class="jill"></span>层上交的报文只是去掉首部，然后就交付给应用层</span></li></ul><div class="wolai-block wolai-center"><figure style="width: 100%"><img src="media/udp%E6%98%AF%E9%9D%A2%E5%90%91%E6%8A%A5%E6%96%87%E7%9A%84.png" style="width: 759.5px"/></figure></div><div class="wolai-block wolai-text"><div><span class="inline-wrap"><b>多种交互通信</b></span><span class="inline-wrap">：UDP<span class="jill"></span>支持一对一，一对多，多对一，多对多的交互通信  </span><span class="inline-wrap"><a href="https://www.cnblogs.com/jingliming/p/4477264.html"><span>UDP 单播 多播 广播</span></a></span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap"><b>UDP<span class="jill"></span>的首部开销小</b></span><span class="inline-wrap">：UDP<span class="jill"></span>的首部只有<span class="jill"></span>8<span class="jill"></span>个字节。</span></div></div><h2 class="wolai-block"><span class="inline-wrap">UDP<span class="jill"></span>的首部格式</span></h2><div class="wolai-block wolai-text"><div><span class="inline-wrap">UDP<span class="jill"></span>报文分为两个部分：首部和数据部分。</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">UDP<span class="jill"></span>首部由四个字段组成，分别是</span><span class="inline-wrap"><b>源端口</b></span><span class="inline-wrap">，</span><span class="inline-wrap"><b>目的端口</b></span><span class="inline-wrap">，</span><span class="inline-wrap"><b>长度</b></span><span class="inline-wrap">，</span><span class="inline-wrap"><b>校验和</b></span><span class="inline-wrap">，每个字段的长度都是两个字节。</span></div></div><ul class="wolai-block"><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">源端口：让对方把回复信息发送到指定端口，不需要回复时可用全<span class="jill"></span>0</span></li><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">目的端口：当运输层从<span class="jill"></span>IP<span class="jill"></span>收到<span class="jill"></span>UDP<span class="jill"></span>数据报时，就是根据目的端口，把数据报通过相应的端口，上交给应用进程</span></li><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">长度：整个<span class="jill"></span>UDP<span class="jill"></span>报文的长度，单位是字节，其最小值时<span class="jill"></span>8（仅有头部的时候）</span></li><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">校验和：检测<span class="jill"></span>UDP<span class="jill"></span>用户数据报在传输中是否有错，有错就丢掉</span></li></ul><div class="wolai-block wolai-center"><figure style="width: 100%"><img src="media/udp%E5%A4%B4%E9%83%A8%E7%BB%93%E6%9E%84.png" style="width: 759.5px"/></figure></div><h3 class="wolai-block"><span class="inline-wrap">用户数据报的检验</span></h3><div class="wolai-block wolai-text"><div><span class="inline-wrap">在上图中我们会看到一个<span class="jill"></span>12<span class="jill"></span>字节的伪首部，它是在计算校验时临时添加的，既不下传也不上传。</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap"><b>发送方：</b></span></div></div><ul class="wolai-block"><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">设置校验和字段里面<span class="jill"></span>16<span class="jill"></span>位全部置为<span class="jill"></span>0</span></li><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">把伪首部和<span class="jill"></span>UDP<span class="jill"></span>用户数据报看作一个整体，以两个字节为边界进行分割</span></li><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">如果数据部分的字节数是奇数，那就添加一个全<span class="jill"></span>0<span class="jill"></span>的字节  （该字节并不会发送出去）</span></li><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">使用二进制反码计算对这些分割好的数据进行求和（按位取反然后相加）</span></li><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">将此和的二进制反码写入校验和字段</span></li><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">发送该<span class="jill"></span>UDP<span class="jill"></span>用户数据报（不包括伪首部）</span></li></ul><div class="wolai-block wolai-text"><div><span class="inline-wrap"><b>接收方：</b></span></div></div><ul class="wolai-block"><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">把伪首部和<span class="jill"></span>UDP<span class="jill"></span>用户数据报看作一个整体，以两个字节为边界进行分割</span></li><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">同样的，如果数据部分的字节数是奇数，那就添加一个全<span class="jill"></span>0<span class="jill"></span>的字节</span></li><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">使用二进制反码计算对这些分割好的数据进行求和</span></li><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">当无差错时，其结果全为<span class="jill"></span>1</span></li><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">如果有不为<span class="jill"></span>1<span class="jill"></span>的，要么抛弃该报文，要么上交给应用层，但是要附上出错的警告</span></li></ul><div class="wolai-block wolai-text"><div><span class="inline-wrap"><b>注意：高位产生的进位一定要再加回来，就是把进位<span class="jill"></span>1<span class="jill"></span>去掉，然后最低位加<span class="jill"></span>1</b></span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">下面自己动手算一下。。。。。。</span></div></div><div class="wolai-block wolai-center"><figure style="width: 100%"><img src="media/udp%E6%A0%A1%E9%AA%8C%E5%92%8C%E4%BE%8B%E5%AD%90.png" style="width: 759.5px"/></figure></div><div class="wolai-block wolai-text"><div></div></div></article><footer></footer></body></html>