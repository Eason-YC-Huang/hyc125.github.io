<!DOCTYPE html>
<html lang="zh-Hans-CN"><head><meta charset="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=Edge"/><link rel="stylesheet" type="text/css" href="../../../../css/modern-norm.min.css"/><link rel="stylesheet" type="text/css" href="../../../../css/prism.min.css"/><link rel="stylesheet" type="text/css" href="../../../../css/katex.min.css"/><link rel="stylesheet" type="text/css" href="../../../../css/wolai.css"/><title>3.HTTPS - wolai 笔记</title><link rel="shortcut icon"></link></head><body><header><div class="image"></div><div class="title"><div class="banner"><div class="icon"></div></div><div data-title="3.HTTPS" class="main-title"></div></div></header><article><ul class="wolai-block"><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>HTTP<span class="jill"></span>为什么不安全？</b></span></li><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>理解<span class="jill"></span>HTTPS</b></span></li><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>用了 HTTPS 就一定安全吗？</b></span></li></ul><h2 class="wolai-block"><span class="inline-wrap">HTTP<span class="jill"></span>为什么不安全？</span></h2><ul class="wolai-block"><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">HTTP<span class="jill"></span>消息是明文传输的，没有对消息进行任何的加密，然后帧在链路层传输时，任何设备都可以接收这个帧，从而窃取里面的信息</span></li><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">客户端无法验证服务器的身份，容易出现中间人攻击，就是无法确保跟他通信的人，真的就是那个人</span></li></ul><h2 class="wolai-block"><span class="inline-wrap">对称加密与非对称加密</span></h2><div class="wolai-block wolai-text"><div><span class="inline-wrap">对称密钥加密是指加密和解密使用同一个密钥的方式，这种方式存在的最大问题就是如何保证密钥安全的发送给接收方。</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">非对称加密是指使用一对非对称密钥，即公钥和私钥，公钥可以随意发布，但私钥只有接收方知道。发送方使用接收方的公钥对密文进行加密处理，接收方接收到加密信息后，使用自己的私钥进行解密。</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">虽然非对称加密很安全，但是它很慢，所以我们通过非对称加密来传递对称加密的秘钥，然后用对称加密进行通信。</span></div></div><blockquote class="wolai-block"><span class="inline-wrap">具体详情请看</span><span class="inline-wrap"><a href="https://www.wolai.com/8fbbxqFzSiQroibFkXtKD3#8fbbxqFzSiQroibFkXtKD3" class="wolai-bi-link"><span class="embed-page">常用加密算法</span></a></span></blockquote><h2 class="wolai-block"><span class="inline-wrap">理解<span class="jill"></span>HTTPS</span></h2><div class="wolai-block wolai-text"><div><span class="inline-wrap">HTTPS<span class="jill"></span>是添加了加密和认证机制的<span class="jill"></span>HTTP，运行于<span class="jill"></span>SSL<span class="jill"></span>上，SSL<span class="jill"></span>运行于<span class="jill"></span>TCP<span class="jill"></span>之上。</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">既然<span class="jill"></span>HTTP<span class="jill"></span>不安全的其中一个原因是<span class="jill"></span>HTTP<span class="jill"></span>消息是明文传输的。那么我就对<span class="jill"></span>HTTP<span class="jill"></span>消息进行加密，现在问题来了，怎么加密？怎么解密？</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap"><b>对消息使用对称加密</b></span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">我们采取对称加密算法，发送方和接收方使用同一个密钥对消息进行加解密操作。客户端给服务端发起请求，请求中携带密钥，后续双方使用该密钥对信息进行加解密。</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap"><b>问题</b></span><span class="inline-wrap">：密钥传输过程没有加密，别人可以窃取到密钥，还是会有安全问题。</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap"><b>在密钥传输时采用非对称加密</b></span></div></div><ol class="wolai-block"><li><div class="marker"></div><span class="inline-wrap">客户端向服务端发起请求</span></li><li><div class="marker"></div><span class="inline-wrap">服务端把公钥发送给客户端</span></li><li><div class="marker"></div><span class="inline-wrap">客户端生成对称加密的密钥，然后用收到的公钥进行加密</span></li><li><div class="marker"></div><span class="inline-wrap">客户端把加密后的密钥发送给服务端</span></li><li><div class="marker"></div><span class="inline-wrap">服务端利用私钥解密，获取对称加密的密钥</span></li><li><div class="marker"></div><span class="inline-wrap">后续双方使用该密钥对信息进行加解密</span></li></ol><div class="wolai-block wolai-text"><div><span class="inline-wrap"><b>问题</b></span><span class="inline-wrap">：在客户端向服务器发起请求，和服务器发送公钥给客户端这两个过程，都可能被中间人拦截，并返回一个假的公钥给客户端。</span><span class="inline-wrap"><b>客户端需要一套验证机制，确保它收到的公钥，真的是目标服务器发送给他的。</b></span></div></div><div class="wolai-block wolai-text"><div><span class="bg-lightpink inline-wrap">这时候，轮到数字证书颁发机构（certificate authority CA）和数字证书出场</span></div></div><ol class="wolai-block"><li><div class="marker"></div><span class="inline-wrap">网站服务器生成密钥对和</span><span class="inline-wrap"><b>证书签名请求</b></span><span class="inline-wrap">(CSR)，CSR<span class="jill"></span>包含网站的相关信息，包括公钥</span></li><li><div class="marker"></div><span class="inline-wrap">网站服务器把<span class="jill"></span>CSR<span class="jill"></span>发送给证书机构(CA)</span></li><li><div class="marker"></div><span class="inline-wrap">CA<span class="jill"></span>接收<span class="jill"></span>CSR，并对其中的内容进行检查</span></li><li><div class="marker"></div><span class="inline-wrap">检查通过后，CA<span class="jill"></span>会生成</span><span class="inline-wrap"><b>明文数字证书</b></span><span class="inline-wrap"> （明文数字证书包含网站服务器的公钥）</span></li><li><div class="marker"></div><span class="inline-wrap">CA<span class="jill"></span>对明文数字证书运行<span class="jill"></span>Hash<span class="jill"></span>算法，生成</span><span class="inline-wrap"><b>明文数字证书的信息摘要</b></span></li><li><div class="marker"></div><span class="inline-wrap">CA<span class="jill"></span>用它自己的私钥加密信息摘要，生成</span><span class="inline-wrap"><b>数字签名</b></span></li><li><div class="marker"></div><span class="inline-wrap"><b>明文数字证书</b></span><span class="inline-wrap"> + </span><span class="inline-wrap"><b>数字签名</b></span><span class="inline-wrap"> 就是</span><span class="inline-wrap"><b>数字证书（Certificate）</b></span></li><li><div class="marker"></div><span class="inline-wrap">网站服务器把数字证书发给客户端（通常是浏览器）</span></li><li><div class="marker"></div><span class="inline-wrap">客户端查看数字证书的颁发机构（CA），然后找对该机构对应的公钥</span></li><li><div class="marker"></div><span class="inline-wrap">客户端使用公钥对数字签名进行解密，得出信息摘要</span></li><li><div class="marker"></div><span class="inline-wrap">客户端对明文数字证书进行相同的<span class="jill"></span>Hash<span class="jill"></span>算法，得到本地信息摘要</span></li><li><div class="marker"></div><span class="inline-wrap">客户端把两个信息摘要做对比，如果相同，表示数字证书没有被篡改，安全可信</span></li><li><div class="marker"></div><span class="inline-wrap">客户端生成对称加密的密钥，利用明文数字证书中的公钥对密钥进行加密，把结果返回给服务器</span></li><li><div class="marker"></div><span class="inline-wrap">服务器利用私钥解密，得到对称加密的密钥，从此服务器和浏览器过上了用对称加密通信的日子</span></li></ol><h2 class="wolai-block"><span class="inline-wrap">如何查看证书</span></h2><div class="wolai-bookmark wolai-block"><a href="https://blog.csdn.net/ever_peng/article/details/93720072">谷歌（chrome）浏览器如何查看网页的证书_沉默的鹏先生-CSDN博客_谷歌浏览器找不到管理证书</a><div class="info-box"><div class="text-pane"><div data-title="谷歌（chrome）浏览器如何查看网页的证书_沉默的鹏先生-CSDN博客_谷歌浏览器找不到管理证书"></div><div data-desc="1、打开https的网页，点击URL后面的锁（有些显示的是安全或者不安全）2、点击证书。3、查看证书信息"></div><div class="icon-host"><div class="icon icon-image" style="background-image: url(&quot;https://g.csdnimg.cn/static/logo/favicon32.ico&quot;)"></div><div data-hostname="blog.csdn.net"></div></div></div><div class="preview-pane"></div></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">todo 证书内容解释</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap"></span><br/></div></div><h2 class="wolai-block"><span class="inline-wrap">证书的生成和使用</span></h2><div class="wolai-block wolai-text"><div><span class="inline-wrap"><b>常见英文单词</b></span></div></div><details class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">certificate：</span></summary><ul class="wolai-block"><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">n.证明；证明书；合格证书；文凭</span></li><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">v.发给结业证书；（尤指）发给职业培训证书</span></li></ul></details><details class="wolai-block"><summary><div class="marker placeholder"></div><span class="inline-wrap">cryptography：密码学</span></summary></details><details class="wolai-block"><summary><div class="marker placeholder"></div><span class="inline-wrap">encrypt：v.把…加密（或编码）</span></summary></details><div class="wolai-block wolai-text"><div><span class="inline-wrap"><b>专业术语</b></span></div></div><details class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">X.509</span></summary><div class="wolai-block wolai-text"><div><span class="inline-wrap">In </span><span class="inline-wrap"><a href="https://en.wikipedia.org/wiki/Cryptography"><span>cryptography</span></a></span><span class="inline-wrap">, </span><span class="inline-wrap"><b>X.509</b></span><span class="inline-wrap"> is an </span><span class="inline-wrap"><a href="https://en.wikipedia.org/wiki/International_Telecommunication_Union"><span>International Telecommunication Union (ITU)</span></a></span><span class="inline-wrap"> standard defining the format of </span><span class="inline-wrap"><a href="https://en.wikipedia.org/wiki/Public_key_certificate"><span>public key certificates</span></a></span><span class="inline-wrap">.</span></div></div></details><details class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">PKCS 12</span></summary><div class="wolai-block wolai-text"><div><span class="inline-wrap">In </span><span class="inline-wrap"><a href="https://en.wikipedia.org/wiki/Cryptography"><span>cryptography</span></a></span><span class="inline-wrap">, </span><span class="inline-wrap"><b>PKCS #12</b></span><span class="inline-wrap"> defines an </span><span class="inline-wrap"><a href="https://en.wikipedia.org/wiki/Archive_file"><span>archive file format</span></a></span><span class="inline-wrap"> for storing many cryptography objects as a single file. It is commonly used to bundle a </span><span class="inline-wrap"><a href="https://en.wikipedia.org/wiki/Private_key"><span>private key</span></a></span><span class="inline-wrap"> with its </span><span class="inline-wrap"><a href="https://en.wikipedia.org/wiki/X.509"><span>X.509</span></a></span><span class="inline-wrap"> certificate or to bundle all the members of a </span><span class="inline-wrap"><a href="https://en.wikipedia.org/wiki/Chain_of_trust"><span>chain of trust</span></a></span><span class="inline-wrap">.</span></div></div></details><div class="wolai-bookmark wolai-block"><a href="https://serverfault.com/questions/9708/what-is-a-pem-file-and-how-does-it-differ-from-other-openssl-generated-key-file/9717#9717?newreg=d6a6a3b635bd48f49256949443a722e0">What is a Pem file and how does it differ from other OpenSSL Generated Key File Formats?</a><div class="info-box"><div class="text-pane"><div data-title="What is a Pem file and how does it differ from other OpenSSL Generated Key File Formats?"></div><div data-desc="I am responsible for maintaining two Debian servers. Every time I have to do anything with security certificates, I Google for tutorials and beat away until it finally works.

However, in my search..."></div><div class="icon-host"><div class="icon icon-image" style="background-image: url(&quot;https://cdn.sstatic.net/Sites/serverfault/Img/apple-touch-icon.png?v=6c3100d858bb&quot;)"></div><div data-hostname="serverfault.com"></div></div></div><div class="preview-pane" style="background-image: url(https://cdn.sstatic.net/Sites/serverfault/Img/apple-touch-icon.png?v=6c3100d858bb)"></div></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap"><b>生成密钥对和证书签名请求</b></span></div></div><code-block class="wolai-block"><div class="wolai-pre"><div data-lang="PowerShell" class="marker"></div><pre><span class="token comment"># pri.key：非对称加密的私钥</span>
<span class="token comment"># csr.pem：证书签名请求</span>
openssl req <span class="token operator">-</span>newkey rsa:1024<span class="token operator">-</span>nodes <span class="token operator">-</span>keyout pri<span class="token punctuation">.</span>key <span class="token operator">-</span>out csr<span class="token punctuation">.</span>pem
<span class="token comment"># 执行上面的命令后，它会通过交互式的方式，要求你填写网站相关的信息</span>
<span class="token comment"># 注意，下面这行是要你输入网址，别写错了，这里我写了www.huangdaren.com</span>
Common Name <span class="token punctuation">(</span>e<span class="token punctuation">.</span>g<span class="token punctuation">.</span> server FQDN or YOUR name<span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>:www<span class="token punctuation">.</span>huangdaren<span class="token punctuation">.</span>com</pre></div></code-block><div class="wolai-block wolai-text"><div><span class="inline-wrap"><b>证书签名</b></span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">证书签名一般都是由证书机构做的，但是我们也能自己搞，只不过自己搞出来的数字证书，客户端不认而已，一样会说你这个网站不安全</span></div></div><code-block class="wolai-block"><div class="wolai-pre"><div data-lang="PowerShell" class="marker"></div><pre><span class="token comment"># 生成数字证书：cert.pem</span>
openssl x509 <span class="token operator">-</span>signkey pri<span class="token punctuation">.</span>key <span class="token operator">-in</span> csr<span class="token punctuation">.</span>pem <span class="token operator">-</span>req <span class="token operator">-</span>days 365 <span class="token operator">-</span>out cert<span class="token punctuation">.</span>pem</pre></div></code-block><div class="wolai-block wolai-text"><div><span class="inline-wrap"><b>配置<span class="jill"></span>Nginx</b></span></div></div><code-block class="wolai-block"><div class="wolai-pre"><div data-lang="Nginx" class="marker"></div><pre><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">listen</span>       <span class="token number">80</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server_name</span>  localhost</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">rewrite</span>      ^ www.huangdaren.com</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">listen</span>       <span class="token number">443</span> ssl</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server_name</span>  www.huangdaren.com</span><span class="token punctuation">;</span>

    <span class="token directive"><span class="token keyword">ssl_certificate</span>      /home/hyc/Desktop/cert.pem</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">ssl_certificate_key</span>  /home/hyc/Desktop/pri.key</span><span class="token punctuation">;</span>

    <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">root</span>   /usr/share/nginx/html</span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">index</span>  index.html index.htm</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></pre></div></code-block><div class="wolai-block wolai-text"><div><span class="inline-wrap"><b>配置一下本地的域名解析</b></span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">因为我没有服务器，没有域名，所以自己弄一个域名解析，骗一下浏览器</span></div></div><code-block class="wolai-block"><div class="wolai-pre"><div data-lang="纯文本" class="marker"></div><pre># <span class="token operator">/</span>etc<span class="token operator">/</span>hosts
<span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>  www<span class="token punctuation">.</span><span class="token property-access">huangdaren</span><span class="token punctuation">.</span><span class="token property-access">com</span></pre></div></code-block><div class="wolai-block wolai-text"><div><span class="inline-wrap">更多阅读：</span><span class="inline-wrap"><a href="https://letsencrypt.org/zh-cn/how-it-works/"><span>使用<span class="jill"></span>Let&#39;s Encrypt<span class="jill"></span>生成数字证书</span></a></span></div></div><h2 class="wolai-block"><span class="inline-wrap">SSH、SSL/TLS</span></h2><div class="wolai-block wolai-text"><div><span class="inline-wrap">SSH<span class="jill"></span>与<span class="jill"></span>SSL<span class="jill"></span>其实是两个东西，共同点是都用了对称加密和非对称加密，但<span class="jill"></span>SSH<span class="jill"></span>没有证书这回事，需要用户自己校验服务器的公钥。</span></div></div><div class="wolai-bookmark wolai-block"><a href="https://www.cnblogs.com/ppybear/p/12462449.html">RSA和AES 的区别， 及ssh工作原理 - ppybear - 博客园</a><div class="info-box"><div class="text-pane"><div data-title="RSA和AES 的区别， 及ssh工作原理 - ppybear - 博客园"></div><div data-desc="1. AES 对称加密 （1）加密方和解密方适用同一个秘钥 （2）加密解密的速度比较快，适合数据比较长时使用 （3）秘钥传输过程不安全，而且秘钥管理也麻烦 2.RSA 非对称加密 （1）算法强度复杂，"></div><div class="icon-host"><div class="icon icon-image" style="background-image: url(&quot;https://common.cnblogs.com/favicon.svg&quot;)"></div><div data-hostname="www.cnblogs.com"></div></div></div><div class="preview-pane"></div></div></div><div class="wolai-bookmark wolai-block"><a href="https://blog.xizhibei.me/2021/02/03/https-two-way-authentication-with-certificates/">HTTPS 双向证书认证 | 须臾之学</a><div class="info-box"><div class="text-pane"><div data-title="HTTPS 双向证书认证 | 须臾之学"></div><div data-desc="技术分享 | Node.js | kubernetes | ansible | Docker | DevOps | 思维与认知"></div><div class="icon-host"><div class="icon icon-image" style="background-image: url(&quot;https://blog.xizhibei.me/favicon.ico&quot;)"></div><div data-hostname="blog.xizhibei.me"></div></div></div><div class="preview-pane"></div></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap"></span><br/></div></div><h2 class="wolai-block"><span class="inline-wrap">Java<span class="jill"></span>密钥管理</span></h2><div class="wolai-block wolai-text"><div><span class="inline-wrap">Java<span class="jill"></span>提供了</span><span class="inline-wrap"><code>KeySotre</code></span><span class="inline-wrap">来管理密钥。</span><span class="inline-wrap"><code>KeyStore</code></span><span class="inline-wrap">存放的是</span><span class="inline-wrap"><code>Entry</code></span><span class="inline-wrap">。</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap"><code>Entry</code></span><span class="inline-wrap">与三种实现：</span></div></div><ul class="wolai-block"><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">KeyStore.SecretKeyEntry  对称加密的密钥</span></li><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">KeyStore.PrivateKeyEntry 非对称加密的密钥</span></li><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">KeyStore.TrustedCertificateEntry 信任的证书</span></li></ul><div class="wolai-block wolai-text"><div><span class="inline-wrap">比较坑的地方在于，1.它不支持单独存放公钥，必须要存证书，2.设置密钥时，需要一同设置该密钥所对应的公钥(证书)。</span></div></div><div class="wolai-block wolai-text"><div></div></div></article><footer></footer></body></html>