<!DOCTYPE html>
<html lang="zh-Hans-CN"><head><meta charset="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=Edge"/><link rel="stylesheet" type="text/css" href="../../../../css/modern-norm.min.css"/><link rel="stylesheet" type="text/css" href="../../../../css/prism.min.css"/><link rel="stylesheet" type="text/css" href="../../../../css/katex.min.css"/><link rel="stylesheet" type="text/css" href="../../../../css/wolai.css"/><title>1.HTTP简介 - wolai 笔记</title><link rel="shortcut icon" href="data:image/svg+xml,%3Csvg xmlns=&apos;http://www.w3.org/2000/svg&apos; viewBox=&apos;0 0 800 800&apos;%3E%3Cdefs%3E%3Cstyle%3E.cls-1%7Bfill:%23fff;%7D%3C/style%3E%3C/defs%3E%3Cg%3E%3Cpath class=&apos;cls-1&apos; d=&apos;M610.08,0c66,0,90,6.88,114.13,19.79a134.62,134.62,0,0,1,56,56l2.28,4.4C793.93,103,800,127.88,800,189.92V610.08l-.08,11.56c-.78,57.38-7.58,79.89-19.71,102.57a134.62,134.62,0,0,1-56,56l-4.4,2.28C697,793.93,672.12,800,610.08,800H189.92l-11.56-.08c-57.38-.78-79.89-7.58-102.57-19.71a134.62,134.62,0,0,1-56-56l-2.28-4.4C6.44,697.75.4,673.72,0,616L0,189.92c0-66,6.88-90,19.79-114.13a134.62,134.62,0,0,1,56-56l4.4-2.28C102.25,6.44,126.28.4,184,0Z&apos;/%3E%3Cpath d=&apos;M610.08,0c66,0,90,6.88,114.13,19.79a134.62,134.62,0,0,1,56,56l2.28,4.4C793.93,103,800,127.88,800,189.92V610.08l-.08,11.56c-.78,57.38-7.58,79.89-19.71,102.57a134.62,134.62,0,0,1-56,56l-4.4,2.28C697,793.93,672.12,800,610.08,800H189.92l-11.56-.08c-57.38-.78-79.89-7.58-102.57-19.71a134.62,134.62,0,0,1-56-56l-2.28-4.4C6.44,697.75.4,673.72,0,616L0,189.92c0-66,6.88-90,19.79-114.13a134.62,134.62,0,0,1,56-56l4.4-2.28C102.25,6.44,126.28.4,184,0Zm4.72,88.9H185.2L172.42,89c-32.78.62-43.68,3.24-54.71,9.14a45.84,45.84,0,0,0-19.54,19.54c-6.61,12.36-9.11,24.55-9.27,67.49V614.8L89,627.58c.62,32.78,3.24,43.68,9.14,54.71a45.84,45.84,0,0,0,19.54,19.54c12.36,6.61,24.55,9.11,67.49,9.27H610.08c46.79,0,59.41-2.44,72.21-9.28a45.84,45.84,0,0,0,19.54-19.54c6.61-12.36,9.11-24.55,9.27-67.49V189.92c0-46.79-2.44-59.41-9.28-72.21a45.84,45.84,0,0,0-19.54-19.54C669.93,91.56,657.74,89.06,614.8,88.9ZM233.33,493.33A73.34,73.34,0,1,1,160,566.67,73.35,73.35,0,0,1,233.33,493.33Z&apos;/%3E%3C/g%3E%3C/svg%3E"></link></head><body class="font-serif"><header><div class="image"></div><div class="title"><div class="banner"><div class="icon"></div></div><div data-title="1.HTTP简介" class="main-title"></div></div></header><article><div class="wolai-block wolai-text"><div><span class="inline-wrap">HTTP (Hypertext transfer protocol 超文本传输协议) ，是互联网上最普遍使用的应用层协议。</span></div></div><ul class="wolai-block"><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">在<span class="jill"></span>1991<span class="jill"></span>年发布了<span class="jill"></span>HTTP 0.9<span class="jill"></span>版</span></li><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">在<span class="jill"></span>1996<span class="jill"></span>年发布<span class="jill"></span>1.0<span class="jill"></span>版</span></li><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">1997<span class="jill"></span>年是<span class="jill"></span>1.1<span class="jill"></span>版，是到今天为止传输最广泛的版本</span></li><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">2015<span class="jill"></span>年发布了<span class="jill"></span>2.0<span class="jill"></span>版，其极大的优化了<span class="jill"></span>HTTP/1.1<span class="jill"></span>的性能和安全性</span></li><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">2018<span class="jill"></span>年发布的<span class="jill"></span>3.0<span class="jill"></span>版，优化<span class="jill"></span>HTTP/2，并使用<span class="jill"></span>UDP<span class="jill"></span>取代<span class="jill"></span>TCP<span class="jill"></span>协议</span></li></ul><hr class="wolai-block"/><h2 class="wolai-block"><span class="inline-wrap">HTTP 0.9 ：只有一行的协议</span></h2><div class="wolai-block wolai-text"><div><span class="inline-wrap">1991<span class="jill"></span>年，Tim Berners-Lee 概述了这个新协议的动机，并罗列了几条宏观的设计目标：</span><span class="inline-wrap"><b>支持文件传输</b></span><span class="inline-wrap">、</span><span class="inline-wrap"><b>能够请求对超文本文档的索引搜索</b></span><span class="inline-wrap">、</span><span class="inline-wrap"><b>格式化协商机制</b></span><span class="inline-wrap">，</span><span class="inline-wrap"><b>能够把客户端引导至不同的服务器</b></span><span class="inline-wrap">。</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">为了实际验证这个理论，他构建了一个简单的原型，实现了建议的部分功能：</span></div></div><ul class="wolai-block"><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">客户端请求是一个 ASCII 字符串</span></li><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">客户端请求由一个回车符（CRLF）结尾</span></li><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">服务器响应是一个 ASCII 字符流</span></li><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">服务器响应的是一种超文本标记语言（HTML）</span></li><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">连接在文档传输完毕后断开</span></li></ul><div class="wolai-block wolai-text"><div><span class="inline-wrap">请求只有一行，包括<span class="jill"></span>GET 方法和要请求的文档的路径。响应是一个超文本文档，没有首部，也没有其他元数据，只有<span class="jill"></span>HTML。鉴于以上交互行为只实现了部分预期目标，因此相应的协议也被非官方地称为<span class="jill"></span>HTTP 0.9。</span></div></div><hr class="wolai-block"/><h2 class="wolai-block"><span class="inline-wrap">HTTP 1.0 ：参考性的<span class="jill"></span>RFC</span></h2><div class="wolai-block wolai-text"><div><span class="inline-wrap">随着人们对新兴<span class="jill"></span>Web 的需求越来越多，HTTP 0.9 的很多根本性不足便暴露出来。相应地，新兴的<span class="jill"></span>Web 开发者社区为满足这些需求，推出了大量实验性的<span class="jill"></span>HTTP 服务器和客户端实现，在这些实验性开发的基础上，出现了一套最佳实践和共用模式。于是，1996 年，HTTP 工作组发布了<span class="jill"></span>RFC 1945，解释说明了当时很多<span class="jill"></span>HTTP 1.0 实现的“公共用法”。不过，这个<span class="jill"></span>RFC 只是参考性的。HTTP 1.0 并不是一个正式的规范或互联网标准！</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">对比<span class="jill"></span>0.9<span class="jill"></span>版本，1.0<span class="jill"></span>版本的最要变化如下：</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">• 请求可以由于多行首部字段构成；
• 响应对象前面添加了一个响应状态行；
• 响应对象也有自己的由换行符分隔的首部字段；
• 响应对象不局限于超文本；
• 服务器与客户端之间的连接在每次请求之后都会关闭。</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">请求和响应首部都使用<span class="jill"></span>ASCII 编码，但响应对象本身可以是任何类型：HTML 文件、纯文本文件、图片，或其他内容类型。事实上，HTTP 中的“HTT”（Hypertext Transfer，超文本传输）在协议出现后不久就已经用词不当了。在实践中，HTTP 迅
速发展为超媒体传输协议，但最初的名字则沿用至今。</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">除了媒体类型协商，RFC 还解释了很多已经被实现的其他功能：内容编码、字符集支持、多部分类型、认证、缓存、代理行为、日期格式，等等。</span></div></div><hr class="wolai-block"/><h2 class="wolai-block"><span class="inline-wrap">☆ HTTP 1.1：互联网标准</span></h2><div class="wolai-block wolai-text"><div><span class="inline-wrap">在<span class="jill"></span>HTTP1.0 发布大约<span class="jill"></span>6 个月之后，也就是<span class="jill"></span>1997 年<span class="jill"></span>1 月，定义正式<span class="jill"></span>HTTP 1.1 标准的<span class="jill"></span>RFC 2068 也发布了。又过了两年半，即到了<span class="jill"></span>1999 年<span class="jill"></span>6 月<span class="jill"></span>RFC 2616 发布，又在标准中集合了很多改进和更新。</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">HTTP 1.1 标准厘清了之前版本中很多有歧义的地方，而且还加入了很多重要的性能优化：持久连接、分块编码传输、字节范围请求、增强的缓存机制、传输编码及请求管道。</span></div></div><blockquote class="wolai-block"><span class="inline-wrap">要详细了解<span class="jill"></span>HTTP 协议的内部工作原理，请参考<span class="jill"></span>David Gourley 和<span class="jill"></span>Brian Totty 合著的《HTTP 权威指南》</span></blockquote><hr class="wolai-block"/><h2 class="wolai-block"><span class="inline-wrap">☆ HTTP 2.0：改进传输性能</span></h2><div class="wolai-block wolai-text"><div><span class="inline-wrap">HTTP 2.0 的主要目标是改进传输性能，实现低延迟和高吞吐量。主版本号的增加听起来像是要做大的改进，从性能角度说的确如此。但从另一方面看，HTTP 的高层协议语义并不会因为这次版本升级而受影响。所有<span class="jill"></span>HTTP 首部、值，以及它们的使用场景都不会变。</span></div></div><hr class="wolai-block"/><h2 class="wolai-block"><span class="inline-wrap">☆ HTTP 3.0：从<span class="jill"></span>TCP<span class="jill"></span>到<span class="jill"></span>UDP</span></h2><div class="wolai-block wolai-text"><div><span class="inline-wrap"><b>互联网通信发展史其实是人类与<span class="jill"></span>RTT<span class="jill"></span>斗争的历史</b></span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap"><b>RTT</b></span><span class="inline-wrap">是</span><span class="inline-wrap"><b>Round Trip Time</b></span><span class="inline-wrap">的缩写，通俗地说，就是通信一来一回的时间（往返时间）。</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap"><i><b>TCP<span class="jill"></span>建立连接时间</b></i></span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">最早大家使用<span class="jill"></span>TCP<span class="jill"></span>来运输<span class="jill"></span>HTTP，TCP<span class="jill"></span>需要三次握手来建立<span class="jill"></span>TCP<span class="jill"></span>虚拟通道，三次握手<span class="jill"></span>1.5 RTT 。</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap"><i><b>HTTP<span class="jill"></span>交易时间</b></i></span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">用户在浏览器里输入的网址<span class="jill"></span>URL，直到时间流逝了<span class="jill"></span>1.5RTT<span class="jill"></span>之后，TCP<span class="jill"></span>才开始运输<span class="jill"></span>HTTP Request，浏览器收到服务器的<span class="jill"></span>HTTP Response，这又要等待<span class="jill"></span>1RTT。</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">HTTP<span class="jill"></span>通信时间总和= TCP<span class="jill"></span>连接时间 + HTTP<span class="jill"></span>交易时间 = 1.5 RTT + 1 RTT = 2.5 RTT</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap"><i><b>安全加密通信 SSL 与 TLS</b></i></span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">随着互联网的爆发式增长，人类发现完全明文传输的<span class="jill"></span>HTTP<span class="jill"></span>通信很不安全。互联网先驱<span class="jill"></span>Netscape<span class="jill"></span>公司，创造性发明了</span><span class="inline-wrap"><b>SSL（Secure Socket Layer）</b></span><span class="inline-wrap">。SSL<span class="jill"></span>位于<span class="jill"></span>TCP<span class="jill"></span>与<span class="jill"></span>HTTP<span class="jill"></span>之间，做为<span class="jill"></span>HTTP<span class="jill"></span>的安全供应商，全权负责<span class="jill"></span>HTTP<span class="jill"></span>的安全加密工作。</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">随着<span class="jill"></span>SSL<span class="jill"></span>的名气攀升，互联网标准化组织<span class="jill"></span>IETF，觉得<span class="jill"></span>SSL<span class="jill"></span>是一个好东西，就拿来用了。</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">IETF<span class="jill"></span>在<span class="jill"></span>SSL 3.0<span class="jill"></span>版本的基础上，重新设计并命名了这个协议，其全新的名字为</span><span class="inline-wrap"><b>TLS（Transport Layer Security）</b></span><span class="inline-wrap">，最初的版本为<span class="jill"></span>1.0<span class="jill"></span>版本。从其名字就可以看出，其核心使命就是保证传输层的安全。</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap"><i><b>HTTPS</b></i></span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">通常将<span class="jill"></span>TLS<span class="jill"></span>安全保护的<span class="jill"></span>HTTP<span class="jill"></span>通信，称之为<span class="jill"></span>HTTPS，以区别于没有<span class="jill"></span>TLS<span class="jill"></span>安全防护的<span class="jill"></span>HTTP<span class="jill"></span>明文通信。引入了<span class="jill"></span>TLS<span class="jill"></span>安全防护，HTTPS<span class="jill"></span>通信的<span class="jill"></span>RTT<span class="jill"></span>又是多少呢？</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">以<span class="jill"></span>TLS1.2 版本为例，建立<span class="jill"></span>TLS<span class="jill"></span>连接时间为<span class="jill"></span>1.5RTT，所以一次<span class="jill"></span>HTTPS<span class="jill"></span>通信时间总和 = TCP<span class="jill"></span>连接时间 + TLS 连接时间 + HTTP<span class="jill"></span>交易时间 = 1.5 RTT + 1.5 RTT + 1 RTT = 4 RTT</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap"><i><b>HTTP 1.x</b></i></span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">和很多人想象不一样的是，浏览器从服务器获取的一个页面，通常由很多资源链接所组成。</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">服务器给浏览器推送的第一个页面，页面里通常嵌入了图片资源文本链接、以及动态页面资源链接、或第三方网站的链接资源等等，还需要浏览器根据这些文本链接内容，去链接所对应的服务器，继续下载链接所对应的内容。</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">Http 1.0<span class="jill"></span>采用的流程是，重新建立一个<span class="jill"></span>TCP<span class="jill"></span>连接、TLS<span class="jill"></span>连接、HTTP<span class="jill"></span>交易。</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">这又是一个漫长的<span class="jill"></span>4RTT<span class="jill"></span>等待过程，因此用户看到浏览器完整页面的时间为<span class="jill"></span>4RTT * 2 = 8RTT</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">既然后面请求的资源跟前面请求的资源是同一个网站服务器，如果重用前面的<span class="jill"></span>TCP<span class="jill"></span>连接，就可以减少<span class="jill"></span>1.5 RTT + 1.5 RTT = 3 RTT<span class="jill"></span>的时间。Http 1.1<span class="jill"></span>新的请求可以在上次建立的<span class="jill"></span>tcp<span class="jill"></span>连接之上发送,连接可以复用。</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap"><i><b>HTTP/2</b></i></span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">虽然<span class="jill"></span>HTTP/1.1 可以重用<span class="jill"></span>TCP<span class="jill"></span>链接，但是请求还是一个一个串行发的，需要保证其顺序。然而，大量的网页请求中都是些资源类的东西，这些东西占了整个<span class="jill"></span>HTTP<span class="jill"></span>请求中最多的传输数据量。所以，理论上来说，如果能够并行这些请求，那就会增加更大的网络吞吐和性能。</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap"><i><b>HTTP/3</b></i></span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">这个世界没有完美的解决方案，HTTP/2<span class="jill"></span>也不例外，其主要的问题是：若干个<span class="jill"></span>HTTP<span class="jill"></span>的请求在复用一个<span class="jill"></span>TCP<span class="jill"></span>的连接，底层的<span class="jill"></span>TCP<span class="jill"></span>协议是不知道上层有多少个<span class="jill"></span>HTTP<span class="jill"></span>的请求的，所以，一旦发生丢包，造成的问题就是所有的<span class="jill"></span>HTTP<span class="jill"></span>请求都必需等待这个丢了的包被重传。这就是</span><span class="inline-wrap"><b>头部阻塞（Head of line Blocking）。</b></span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">HTTP/1.1<span class="jill"></span>中的<span class="jill"></span>pipeline<span class="jill"></span>中如果有一个请求<span class="jill"></span>block<span class="jill"></span>了，那么队列后请求也统统被<span class="jill"></span>block<span class="jill"></span>住了；HTTP/2 多请求复用一个<span class="jill"></span>TCP<span class="jill"></span>连接，一旦发生丢包，就会<span class="jill"></span>block<span class="jill"></span>住所有的<span class="jill"></span>HTTP<span class="jill"></span>请求。这样的问题很讨厌。好像基本无解了。</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">是的<span class="jill"></span>TCP<span class="jill"></span>是无解了，但是<span class="jill"></span>UDP<span class="jill"></span>是有解的 ！</span><span class="inline-wrap"><b>于是<span class="jill"></span>HTTP/3<span class="jill"></span>破天荒地把<span class="jill"></span>HTTP<span class="jill"></span>底层的<span class="jill"></span>TCP<span class="jill"></span>协议改成了<span class="jill"></span>UDP！</b></span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">Google<span class="jill"></span>研发了一个<span class="jill"></span>QUIC （Quick UDP Internet Connections），QUIC<span class="jill"></span>是一个在<span class="jill"></span>UDP<span class="jill"></span>之上的伪<span class="jill"></span>TCP +TLS +HTTP/2<span class="jill"></span>的多路复用的协议。</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap"></span><br/></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap"></span><br/></div></div><blockquote class="wolai-block"><span class="inline-wrap">参考文献
</span><span class="inline-wrap"><a href="https://zhuanlan.zhihu.com/p/28850798"><span>TLS1.3<span class="jill"></span>科普</span></a></span><span class="inline-wrap">
</span><span class="inline-wrap"><a href="https://zhuanlan.zhihu.com/p/102561034"><span>HTTP 1/2/3</span></a></span></blockquote><div class="wolai-block wolai-text"><div><span class="inline-wrap"></span><br/></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap"></span><br/></div></div><div class="wolai-block wolai-text"><div></div></div></article><footer></footer></body></html>