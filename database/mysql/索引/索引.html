<!DOCTYPE html>
<html lang="zh-Hans-CN"><head><meta charset="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=Edge"/><link rel="stylesheet" type="text/css" href="../../../css/modern-norm.min.css"/><link rel="stylesheet" type="text/css" href="../../../css/prism.min.css"/><link rel="stylesheet" type="text/css" href="../../../css/katex.min.css"/><link rel="stylesheet" type="text/css" href="../../../css/wolai.css"/><title>索引 - wolai 笔记</title><link rel="shortcut icon" href="data:image/svg+xml,%3Csvg xmlns=&apos;http://www.w3.org/2000/svg&apos; viewBox=&apos;0 0 800 800&apos;%3E%3Cdefs%3E%3Cstyle%3E.cls-1%7Bfill:%23fff;%7D%3C/style%3E%3C/defs%3E%3Cg%3E%3Cpath class=&apos;cls-1&apos; d=&apos;M610.08,0c66,0,90,6.88,114.13,19.79a134.62,134.62,0,0,1,56,56l2.28,4.4C793.93,103,800,127.88,800,189.92V610.08l-.08,11.56c-.78,57.38-7.58,79.89-19.71,102.57a134.62,134.62,0,0,1-56,56l-4.4,2.28C697,793.93,672.12,800,610.08,800H189.92l-11.56-.08c-57.38-.78-79.89-7.58-102.57-19.71a134.62,134.62,0,0,1-56-56l-2.28-4.4C6.44,697.75.4,673.72,0,616L0,189.92c0-66,6.88-90,19.79-114.13a134.62,134.62,0,0,1,56-56l4.4-2.28C102.25,6.44,126.28.4,184,0Z&apos;/%3E%3Cpath d=&apos;M610.08,0c66,0,90,6.88,114.13,19.79a134.62,134.62,0,0,1,56,56l2.28,4.4C793.93,103,800,127.88,800,189.92V610.08l-.08,11.56c-.78,57.38-7.58,79.89-19.71,102.57a134.62,134.62,0,0,1-56,56l-4.4,2.28C697,793.93,672.12,800,610.08,800H189.92l-11.56-.08c-57.38-.78-79.89-7.58-102.57-19.71a134.62,134.62,0,0,1-56-56l-2.28-4.4C6.44,697.75.4,673.72,0,616L0,189.92c0-66,6.88-90,19.79-114.13a134.62,134.62,0,0,1,56-56l4.4-2.28C102.25,6.44,126.28.4,184,0Zm4.72,88.9H185.2L172.42,89c-32.78.62-43.68,3.24-54.71,9.14a45.84,45.84,0,0,0-19.54,19.54c-6.61,12.36-9.11,24.55-9.27,67.49V614.8L89,627.58c.62,32.78,3.24,43.68,9.14,54.71a45.84,45.84,0,0,0,19.54,19.54c12.36,6.61,24.55,9.11,67.49,9.27H610.08c46.79,0,59.41-2.44,72.21-9.28a45.84,45.84,0,0,0,19.54-19.54c6.61-12.36,9.11-24.55,9.27-67.49V189.92c0-46.79-2.44-59.41-9.28-72.21a45.84,45.84,0,0,0-19.54-19.54C669.93,91.56,657.74,89.06,614.8,88.9ZM233.33,493.33A73.34,73.34,0,1,1,160,566.67,73.35,73.35,0,0,1,233.33,493.33Z&apos;/%3E%3C/g%3E%3C/svg%3E"></link></head><body><header><div class="image"></div><div class="title"><div class="banner"><div class="icon"></div></div><div data-title="索引" class="main-title"></div></div></header><article><div class="wolai-block wolai-text"><div><span class="inline-wrap">什么是索引？数据库索引是帮助数据库高效获取数据的一种数据结构。</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">由于<span class="jill"></span>MySQL<span class="jill"></span>支持多种存储引擎，不同的存储引擎对索引的实现也不尽相同，本文主要讲<span class="jill"></span>InnoDB<span class="jill"></span>索引。</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">InnoDB<span class="jill"></span>支持以下三种索引：</span><span class="inline-wrap"><code>B+<span class="jill"></span>树索引</code></span><span class="inline-wrap">、</span><span class="inline-wrap"><code>Hash<span class="jill"></span>索引</code></span><span class="inline-wrap">、</span><span class="inline-wrap"><code>全文索引</code></span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">其中<span class="jill"></span>Hash<span class="jill"></span>索引由数据库自身创建和使用，DBA<span class="jill"></span>本身并不能对其进行干预。对于字典类型的查询，Hash<span class="jill"></span>索引的查询速度非常快，但是无法进行范围查询。</span></div></div><h2 class="wolai-block"><span class="inline-wrap">1.深入理解<span class="jill"></span>B-Tree、B+Tree<span class="jill"></span>索引</span></h2><div class="wolai-block wolai-text"><div><span class="inline-wrap">B-Tree<span class="jill"></span>属于多叉树又名多路平衡查找树，能减少从磁盘获取数据时磁盘<span class="jill"></span>IO<span class="jill"></span>次数。</span></div></div><h3 class="wolai-block"><span class="inline-wrap">扇区、块、InnoDB<span class="jill"></span>页</span></h3><div class="wolai-block wolai-text"><div><span class="inline-wrap"><b>扇区</b></span><span class="inline-wrap">：扇区是磁盘的最小存储单位，每个扇区的大小是固定的，为 512Byte。</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap"><b>块</b></span><span class="inline-wrap">：操作系统从磁盘读取数据到内存时是以块（block）为基本单位的，块是一个虚拟概念，并不是真是存在于磁盘上，位于同一个磁盘块中的数据会被一次性读取出来。因为磁盘进行读写的基本单位是扇区，而操作系统与磁盘之间是块，所以系统想进行读写，最节省的方式就是扇区的整数倍。现在块的大小一般都是<span class="jill"></span>4K（4096Byte）。</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap"><b>InnoDB<span class="jill"></span>页</b></span><span class="inline-wrap">：InnoDB<span class="jill"></span>存储引擎也有自己的最小储存单元，页（Page），一个页的默认大小是<span class="jill"></span>16K。也就是说<span class="jill"></span>InnoDB<span class="jill"></span>存储引擎读取文件时，一次读取会获得<span class="jill"></span>16K<span class="jill"></span>的数据。查看<span class="jill"></span>InnoDB<span class="jill"></span>的数据文件（后缀为<span class="jill"></span>ibd<span class="jill"></span>的文件）你会发现文件大小始终都是<span class="jill"></span>InnoDB<span class="jill"></span>页的整数倍。</span></div></div><h3 class="wolai-block"><span class="inline-wrap">B-Tree</span></h3><div class="wolai-block wolai-text"><div><span class="inline-wrap">一棵<span class="jill"></span>m<span class="jill"></span>阶的<span class="jill"></span>B-Tree<span class="jill"></span>有如下特性：</span></div></div><ol class="wolai-block"><li><div class="marker"></div><span class="inline-wrap">每个节点最多有<span class="jill"></span>m<span class="jill"></span>个子结点。</span></li><li><div class="marker"></div><span class="inline-wrap">除了根节点和叶子节点，每个节点至少有<span class="jill"></span>Ceil(m/2)个子结点。</span></li><li><div class="marker"></div><span class="inline-wrap">若根节点不是叶子节点，则至少有<span class="jill"></span>2<span class="jill"></span>个子结点</span></li><li><div class="marker"></div><span class="inline-wrap">非叶子节点，持有<span class="jill"></span>k<span class="jill"></span>个子结点，则持有<span class="jill"></span>k-1<span class="jill"></span>个<span class="jill"></span>key</span></li></ol><div class="wolai-block wolai-text"><div><span class="inline-wrap">B-Tree<span class="jill"></span>中的每个节点根据实际情况可以包含大量的</span><span class="inline-wrap"><b>数据</b></span><span class="inline-wrap">和</span><span class="inline-wrap"><b>指向子结点的指针</b></span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">下图是一个<span class="jill"></span>3<span class="jill"></span>阶的<span class="jill"></span>B-Tree：</span></div></div><div class="wolai-block wolai-center"><figure style="width: 100%"><img src="media/b-tree.png" style="width: 760px"/></figure></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">模拟查找关键字<span class="jill"></span>29<span class="jill"></span>的过程：</span></div></div><ol class="wolai-block"><li><div class="marker"></div><span class="inline-wrap">根据根节点找到磁盘块<span class="jill"></span>1，读入内存。【磁盘<span class="jill"></span>I/O<span class="jill"></span>操作第<span class="jill"></span>1<span class="jill"></span>次】</span></li><li><div class="marker"></div><span class="inline-wrap">比较关键字<span class="jill"></span>29<span class="jill"></span>在区间（17,35），找到磁盘块<span class="jill"></span>1<span class="jill"></span>的指针<span class="jill"></span>P2。</span></li><li><div class="marker"></div><span class="inline-wrap">根据<span class="jill"></span>P2<span class="jill"></span>指针找到磁盘块<span class="jill"></span>3，读入内存。【磁盘<span class="jill"></span>I/O<span class="jill"></span>操作第<span class="jill"></span>2<span class="jill"></span>次】</span></li><li><div class="marker"></div><span class="inline-wrap">比较关键字<span class="jill"></span>29<span class="jill"></span>在区间（26,30），找到磁盘块<span class="jill"></span>3<span class="jill"></span>的指针<span class="jill"></span>P2。</span></li><li><div class="marker"></div><span class="inline-wrap">根据<span class="jill"></span>P2<span class="jill"></span>指针找到磁盘块<span class="jill"></span>8，读入内存。【磁盘<span class="jill"></span>I/O<span class="jill"></span>操作第<span class="jill"></span>3<span class="jill"></span>次】</span></li><li><div class="marker"></div><span class="inline-wrap">在磁盘块<span class="jill"></span>8<span class="jill"></span>中的关键字列表中找到关键字<span class="jill"></span>29。</span></li></ol><h3 class="wolai-block"><span class="inline-wrap">B+Tree</span></h3><div class="wolai-block wolai-text"><div><span class="inline-wrap">B+Tree<span class="jill"></span>是在<span class="jill"></span>B-Tree<span class="jill"></span>基础上的一种优化，使其更适合实现外存储索引结构，InnoDB<span class="jill"></span>存储引擎就是用<span class="jill"></span>B+Tree<span class="jill"></span>实现其索引结构。</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">从上面的<span class="jill"></span>B-Tree<span class="jill"></span>结构图中可以看到每个节点中不仅包含数据的<span class="jill"></span>key<span class="jill"></span>值，还有<span class="jill"></span>data<span class="jill"></span>值。而每一个页的存储空间是有限的，如果<span class="jill"></span>data<span class="jill"></span>数据较大时将会导致每个节点（即一个页）能存储的<span class="jill"></span>key<span class="jill"></span>的数量很小，当存储的数据量很大时同样会导致<span class="jill"></span>B-Tree<span class="jill"></span>的深度较大，增大查询时的磁盘<span class="jill"></span>I/O<span class="jill"></span>次数，进而影响查询效率。</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">在<span class="jill"></span>B+Tree<span class="jill"></span>中，所有数据记录节点都是按照键值大小顺序存放在同一层的叶子节点上，而非叶子节点上只存储<span class="jill"></span>key<span class="jill"></span>值信息，这样可以大大加大每个非叶子节点存储的<span class="jill"></span>key<span class="jill"></span>值数量，降低<span class="jill"></span>B+Tree<span class="jill"></span>的高度。</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">InnoDB<span class="jill"></span>的<span class="jill"></span>B+<span class="jill"></span>树在经典<span class="jill"></span>B+Tree<span class="jill"></span>的基础上进行了优化，增加了顺序访问指针。</span></div></div><div class="wolai-block wolai-center"><figure style="width: 100%"><img src="media/b+tree.png" style="width: 760px"/></figure></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">如上图所示，在<span class="jill"></span>B+Tree<span class="jill"></span>的每个叶子节点增加一个指向相邻叶子节点的指针，就形成了带有顺序访问指针的<span class="jill"></span>B+Tree。</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">例如如果要查询<span class="jill"></span>key<span class="jill"></span>为从<span class="jill"></span>17<span class="jill"></span>到<span class="jill"></span>79<span class="jill"></span>的所有数据记录，当找到<span class="jill"></span>17<span class="jill"></span>后，只需顺着节点和指针顺序遍历就可以一次性访问到所有数据节点，极大提到了区间查询效率。</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap"><b>思考：通常一棵<span class="jill"></span>B+<span class="jill"></span>树可以存放多少行数据？</b></span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">这里我们先假设<span class="jill"></span>B+<span class="jill"></span>树高为<span class="jill"></span>2，即存在一个根节点和若干个叶子节点，那么这棵<span class="jill"></span>B+<span class="jill"></span>树的存放总记录数为：叶子节点的数量*单个叶子节点记录数</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">假设一行记录的数据大小为<span class="jill"></span>1k，实际上现在很多互联网业务数据记录大小通常就是<span class="jill"></span>1K<span class="jill"></span>左右，则单个叶子节点的记录数为<span class="jill"></span>16(16K/1K)。</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap"><b>那么现在需要计算出有多少个子节点？</b></span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">其实这也很好算，假设主键<span class="jill"></span>ID<span class="jill"></span>为<span class="jill"></span>bigint<span class="jill"></span>类型，长度为<span class="jill"></span>8<span class="jill"></span>字节，而指针大小在<span class="jill"></span>InnoDB<span class="jill"></span>源码中设置为<span class="jill"></span>6<span class="jill"></span>字节，这样一共<span class="jill"></span>14<span class="jill"></span>字节</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">我们一个页中能存放多少这样的单元，其实就代表有个子结点，即</span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>16384</mn><mi mathvariant="normal">/</mi><mn>14</mn><mo>=</mo><mn>1170</mn></mrow><annotation encoding="application/x-tex">16384/14=1170</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">16384/14</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1170</span></span></span></span></span><span class="inline-wrap">。</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">那么可以算出一棵高度为<span class="jill"></span>2<span class="jill"></span>的<span class="jill"></span>B+<span class="jill"></span>树，能存放</span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1170</mn><mo>∗</mo><mn>16</mn><mo>=</mo><mn>18720</mn></mrow><annotation encoding="application/x-tex">1170*16=18720</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1170</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">16</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">18720</span></span></span></span></span><span class="inline-wrap">条这样的数据记录。</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">根据同样的原理可以算出一个高度为<span class="jill"></span>3<span class="jill"></span>的<span class="jill"></span>B+<span class="jill"></span>树可以存放：</span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1170</mn><mo>∗</mo><mn>1170</mn><mo>∗</mo><mn>16</mn><mo>=</mo><mn>21902400</mn></mrow><annotation encoding="application/x-tex">1170*1170*16=21902400</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1170</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1170</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">16</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">21902400</span></span></span></span></span><span class="inline-wrap">条这样的记录。</span></div></div><h3 class="wolai-block"><span class="inline-wrap">为什么使用<span class="jill"></span>B+Tree</span></h3><div class="wolai-block wolai-text"><div><span class="inline-wrap"><b>对比<span class="jill"></span>B-Tree</b></span></div></div><ul class="wolai-block"><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">B+Tree<span class="jill"></span>非叶子节点不存储数据，大大增加了每个非叶子节点存储<span class="jill"></span>key<span class="jill"></span>和指针的数量</span></li><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">B+<span class="jill"></span>树通过在叶子节点中添加指向相邻叶子节点的指针，解决元素遍历效率低下问题，B+<span class="jill"></span>树只需要去遍历叶子节点就可以实现整棵树的遍历。</span></li></ul><div class="wolai-block wolai-text"><div><span class="inline-wrap"><b>对比红黑树</b></span></div></div><ul class="wolai-block"><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">相同的数据量，红黑树深度更深，磁盘的<span class="jill"></span>IO<span class="jill"></span>次数更多，查询性能不如<span class="jill"></span>B-树、B+<span class="jill"></span>树</span></li><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">如果<span class="jill"></span>where<span class="jill"></span>是一个范围，B+<span class="jill"></span>更合理。 想一想如果条件是 between 1 and 100，红黑树要回溯多少次才能都找出来。</span></li></ul><div class="wolai-block wolai-text"><div><span class="inline-wrap"><a href="https://www.youtube.com/watch?v=aZjYr87r1b8"><span>YouTube : B Trees and B+ Trees. How they are useful in Databases</span></a></span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap"><a href="https://www.cnblogs.com/vianzhang/p/7922426.html"><span>B-Tree<span class="jill"></span>和<span class="jill"></span>B+Tree<span class="jill"></span>详解</span></a></span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap"><a href="https://mp.weixin.qq.com/s?__biz=MzIxMjE5MTE1Nw==&amp;mid=2653190965&amp;idx=1&amp;sn=53f78fa037386f85531832cd5322d2a0&amp;chksm=8c9909efbbee80f90512f0c36356c31cc74c388c46388dc2317d43c8f8597298f233ca9c29e9&amp;mpshare=1&amp;scene=1&amp;srcid=0208vXq0iykJaOwBpC4bU3yg&amp;pass_ticket=qVqRQ6IA2qnC2lusXuKfz2YsImRgP4BK3i4JjVNiMtdxqCK6NdhpP%2BNLsI0I39hk#rd"><span>漫画：什么是<span class="jill"></span>B-树</span></a></span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap"><a href="https://mp.weixin.qq.com/s?__biz=MzIxMjE5MTE1Nw==&amp;mid=2653191027&amp;idx=1&amp;sn=4ba22e3ec8bd149f69fc0aba72e4347e&amp;chksm=8c9909a9bbee80bfa1d8497ff0525df130414c1731b5aa5287bf16ea1cf86c8d8e6f20782184&amp;mpshare=1&amp;scene=1&amp;srcid=0208vH4JXmzbpOV8odFaAi8D&amp;pass_ticket=qVqRQ6IA2qnC2lusXuKfz2YsImRgP4BK3i4JjVNiMtdxqCK6NdhpP%2BNLsI0I39hk#rd"><span>漫画：什么是<span class="jill"></span>B+<span class="jill"></span>树</span></a></span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap"><a href="http://blog.codinglabs.org/articles/theory-of-mysql-index.html"><span>MySQL<span class="jill"></span>索引背后的数据结构与算法原理</span></a></span></div></div><h2 class="wolai-block"><span class="inline-wrap">2.全文检索</span></h2><div class="wolai-block wolai-text"><div><span class="inline-wrap">从<span class="jill"></span>InnoDB 1.2.x<span class="jill"></span>版本开始，InnoDB<span class="jill"></span>开始支持全文检索。</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">全文检索通常使用倒排索引来实现，倒排索引有两种表现形式：</span></div></div><ul class="wolai-block"><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">inverted file index(倒排文件索引) :</span><ul class="wolai-block"><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">{<span class="jill"></span>单词:[单词所在文档的<span class="jill"></span>ID,单词所在的文档的<span class="jill"></span>ID]}</span></li></ul></li><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">full inverted index(全倒排索引) :</span><ul class="wolai-block"><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">{<span class="jill"></span>单词:[(单词所在文档的<span class="jill"></span>ID，在文档中的具体位置),]}</span></li></ul></li></ul><div class="wolai-block wolai-text"><div><span class="inline-wrap">InnoDB<span class="jill"></span>采用的是<span class="jill"></span>full inverted index，只支持对<span class="jill"></span>char、varchar、text<span class="jill"></span>类型进行全文索引</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">全文索引跟别的索引不一样，要通过特殊语法才能使用全文索引</span></div></div><code-block class="wolai-block"><div class="wolai-pre"><div data-lang="Mysql" class="marker"></div><pre><span class="token operator">--</span> <span class="token constant">MATCH</span> <span class="token punctuation">(</span>col1<span class="token punctuation">,</span>col2<span class="token punctuation">,</span><span class="token spread operator">...</span><span class="token punctuation">)</span> <span class="token constant">AGAINST</span> <span class="token punctuation">(</span>expr <span class="token punctuation">[</span>search_modifier<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token operator">--</span> col1<span class="token punctuation">,</span>col2 需要进行全文搜索的列
<span class="token operator">--</span> expr 需要匹配的字符
<span class="token operator">--</span> search_modifier 查询修饰符（可选的）
   <span class="token operator">--</span> <span class="token constant">IN</span> <span class="token constant">NATURAL</span> <span class="token constant">LANGUAGE</span> <span class="token constant">MODE</span>
   <span class="token operator">--</span> <span class="token constant">IN</span> <span class="token constant">NATURAL</span> <span class="token constant">LANGUAGE</span> <span class="token constant">MODE</span> <span class="token constant">WITH</span> <span class="token constant">QUERY</span> <span class="token constant">EXPANSION</span>
   <span class="token operator">--</span> <span class="token constant">IN</span> <span class="token constant">BOOLEAN</span> <span class="token constant">MODE</span>
   <span class="token operator">--</span> <span class="token constant">WITH</span> <span class="token constant">QUERY</span> <span class="token constant">EXPANSION</span></pre></div></code-block><h2 class="wolai-block"><span class="inline-wrap">3.索引的<span class="jill"></span>CURD</span></h2><div class="wolai-block wolai-text"><div><span class="inline-wrap"><b>PRIMARY KEY<span class="jill"></span>主键索引</b></span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">不允许出现相同的值,且不能为<span class="jill"></span>NULL<span class="jill"></span>值,一个表只能有一个主键索引</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap"><b>UNIQUE<span class="jill"></span>唯一索引</b></span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">不可以出现相同的值,可以有<span class="jill"></span>NULL<span class="jill"></span>值</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap"><b>INDEX<span class="jill"></span>普通索引</b></span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">允许出现相同的索引内容,可以有<span class="jill"></span>NULL<span class="jill"></span>值</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap"><b>FULLTEXT INDEX 全文索引</b></span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">上述三种索引都是针对列的值发挥作用,但全文索引,可以针对值中的某个单词,比如一篇文章中的某个词.</span></div></div><h3 class="wolai-block"><span class="inline-wrap">3.1<span class="jill"></span>创建索引</span></h3><code-block class="wolai-block"><div class="wolai-pre"><div data-lang="Sql" class="marker"></div><pre><span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> table_name <span class="token keyword">ADD</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> index_name <span class="token punctuation">(</span>index_columns<span class="token punctuation">)</span>；
<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> table_name <span class="token keyword">ADD</span> <span class="token keyword">UNIQUE</span> index_name <span class="token punctuation">(</span>index_columns<span class="token punctuation">)</span>；
<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> table_name <span class="token keyword">ADD</span> <span class="token keyword">INDEX</span> index_name <span class="token punctuation">(</span>index_columns<span class="token punctuation">)</span>；
<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> table_name <span class="token keyword">ADD</span> FULLTEXT index_name <span class="token punctuation">(</span>index_columns<span class="token punctuation">)</span>；

<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> opening_lines <span class="token punctuation">(</span>
       id <span class="token keyword">INT</span> <span class="token keyword">UNSIGNED</span> <span class="token keyword">AUTO_INCREMENT</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span><span class="token punctuation">,</span>
       opening_line <span class="token keyword">TEXT</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
       author <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
       title <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
       FULLTEXT idx <span class="token punctuation">(</span>opening_line<span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token operator">=</span><span class="token number">2</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8mb4<span class="token punctuation">;</span></pre></div></code-block><h3 class="wolai-block"><span class="inline-wrap">3.2<span class="jill"></span>查看索引</span></h3><code-block class="wolai-block"><div class="wolai-pre"><div data-lang="Sql" class="marker"></div><pre><span class="token keyword">SHOW</span> <span class="token keyword">INDEX</span> <span class="token keyword">FROM</span> tablename；</pre></div></code-block><h3 class="wolai-block"><span class="inline-wrap">3.3<span class="jill"></span>删除索引</span></h3><code-block class="wolai-block"><div class="wolai-pre"><div data-lang="SQL" class="marker"></div><pre><span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> table_name <span class="token keyword">DROP</span> <span class="token keyword">INDEX</span> index_name<span class="token punctuation">;</span></pre></div></code-block><h3 class="wolai-block"><span class="inline-wrap">4.4<span class="jill"></span>修改索引</span></h3><div class="wolai-block wolai-text"><div><span class="inline-wrap">在<span class="jill"></span>MySQL<span class="jill"></span>中并没有提供修改索引的直接指令，一般情况下，我们需要先删除掉原索引，再根据需要创建一个同名的索引，从而变相地实现修改索引操作。</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap"><a href="http://blog.codinglabs.org/articles/theory-of-mysql-index.html"><span>http://blog.codinglabs.org/articles/theory-of-mysql-index.html</span></a></span></div></div><h2 class="wolai-block"><span class="inline-wrap">4.索引的使用技巧</span></h2><ol class="wolai-block"><li><div class="marker"></div><span class="inline-wrap">维度高的列创建索引，数据列中</span><span class="inline-wrap"><b>不重复值</b></span><span class="inline-wrap">的个数越多，维度就越高。</span></li><li><div class="marker"></div><span class="inline-wrap">对 </span><span class="inline-wrap"><b>where,on,group by,order by</b></span><span class="inline-wrap"> 中出现的列使用索引</span></li><li><div class="marker"></div><span class="inline-wrap">对较小的数据列使用索引,这样会使索引文件更小,同时内存中也可以装载更多的索引键</span></li><li><div class="marker"></div><span class="inline-wrap">为较长的字符串使用</span><span class="inline-wrap"><b>前缀索引</b></span></li><li><div class="marker"></div><span class="inline-wrap">不要过多创建索引,除了增加额外的磁盘空间外,对于</span><span class="inline-wrap"><code>DML</code></span><span class="inline-wrap">操作的速度影响很大,因为其每增删改一次就得从新建立索引</span></li><li><div class="marker"></div><span class="inline-wrap">使用</span><span class="inline-wrap"><b>联合索引</b></span><span class="inline-wrap">,可以减少文件索引大小,在使用时速度要优于多个单列索引</span></li></ol><h3 class="wolai-block"><span class="inline-wrap">4.1<span class="jill"></span>联合索引与前缀索引</span></h3><div class="wolai-block wolai-text"><div><span class="inline-wrap"><b>注意,这两种称呼是对建立索引技巧的一种称呼,并非索引的类型。</b></span></div></div><h4 class="wolai-block"><span class="inline-wrap">4.1.1<span class="jill"></span>联合索引</span></h4><div class="wolai-block wolai-text"><div><span class="inline-wrap">MySQL<span class="jill"></span>单列索引和组合索引究竟有何区别呢？</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">为了形象地对比两者,先建一个表：</span></div></div><code-block class="wolai-block"><div class="wolai-pre"><div data-lang="Sql" class="marker"></div><pre><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token punctuation">`</span>myIndex<span class="token punctuation">`</span> <span class="token punctuation">(</span>
  <span class="token punctuation">`</span>i_testID<span class="token punctuation">`</span> <span class="token keyword">INT</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token punctuation">,</span> 
  <span class="token punctuation">`</span>vc_Name<span class="token punctuation">`</span> <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span> 
  <span class="token punctuation">`</span>vc_City<span class="token punctuation">`</span> <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span> 
  <span class="token punctuation">`</span>i_Age<span class="token punctuation">`</span> <span class="token keyword">INT</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span> 
  <span class="token punctuation">`</span>i_SchoolID<span class="token punctuation">`</span> <span class="token keyword">INT</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span> 
  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>i_testID<span class="token punctuation">`</span><span class="token punctuation">)</span> 
<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></div></code-block><div class="wolai-block wolai-text"><div><span class="inline-wrap">假设表内已有<span class="jill"></span>1000<span class="jill"></span>条数据,在这 10000 条记录里面分布了 5 条</span><span class="inline-wrap"><code> vc_Name=&quot;erquan&quot;</code></span><span class="inline-wrap"> 的记录,只不过 </span><span class="inline-wrap"><code>city</code></span><span class="inline-wrap">,</span><span class="inline-wrap"><code>age</code></span><span class="inline-wrap">,</span><span class="inline-wrap"><code>school</code></span><span class="inline-wrap"> 的组合各不相同。
来看这条 T-SQL：</span></div></div><code-block class="wolai-block"><div class="wolai-pre"><div data-lang="Sql" class="marker"></div><pre><span class="token keyword">SELECT</span> <span class="token punctuation">`</span>i_testID<span class="token punctuation">`</span> <span class="token keyword">FROM</span> <span class="token punctuation">`</span>myIndex<span class="token punctuation">`</span> <span class="token keyword">WHERE</span> <span class="token punctuation">`</span>vc_Name<span class="token punctuation">`</span><span class="token operator">=</span><span class="token string">'erquan'</span> <span class="token operator">AND</span> <span class="token punctuation">`</span>vc_City<span class="token punctuation">`</span><span class="token operator">=</span><span class="token string">'郑州'</span> <span class="token operator">AND</span> <span class="token punctuation">`</span>i_Age<span class="token punctuation">`</span><span class="token operator">=</span><span class="token number">25</span><span class="token punctuation">;</span> <span class="token comment">-- 关联搜索;</span></pre></div></code-block><div class="wolai-block wolai-text"><div><span class="inline-wrap"><b>首先考虑建<span class="jill"></span>MySQL<span class="jill"></span>单列索引：</b></span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">在 </span><span class="inline-wrap"><code>vc_Name</code></span><span class="inline-wrap"> 列上建立了索引。执行 </span><span class="inline-wrap"><code>T-SQL</code></span><span class="inline-wrap">时,</span><span class="inline-wrap"><code>MYSQL</code></span><span class="inline-wrap"> 很快将目标锁定在了 </span><span class="inline-wrap"><code>vc_Name=erquan</code></span><span class="inline-wrap">的 5 条记录上,取出来放到一中间结果集。在这个结果集里,先排除掉 </span><span class="inline-wrap"><code>vc_City</code></span><span class="inline-wrap"> 不等于&quot;郑州&quot;的记录,再排除 </span><span class="inline-wrap"><code>i_Age</code></span><span class="inline-wrap">不等于 25 的记录,最后筛选出唯一的符合条件的记录。
虽然在 </span><span class="inline-wrap"><code>vc_Name</code></span><span class="inline-wrap"> 上建立了索引,查询时</span><span class="inline-wrap"><code>MYSQL</code></span><span class="inline-wrap">不用扫描整张表,效率有所提高,但离我们的要求还有一定的距离。同样的,在 </span><span class="inline-wrap"><code>vc_City</code></span><span class="inline-wrap"> 和</span><span class="inline-wrap"><code>i_Age</code></span><span class="inline-wrap">分别建立的<span class="jill"></span>MySQL<span class="jill"></span>单列索引的效率相似。</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">为了进一步榨取 MySQL 的效率,就要考虑建立组合索引。</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">就是将</span><span class="inline-wrap"><code>vc_Name,vc_City,i_Age</code></span><span class="inline-wrap">建到一个索引里：</span></div></div><code-block class="wolai-block"><div class="wolai-pre"><div data-lang="Sql" class="marker"></div><pre> <span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> <span class="token punctuation">`</span>myIndex<span class="token punctuation">`</span> <span class="token keyword">ADD</span> <span class="token keyword">INDEX</span> <span class="token punctuation">`</span>name_city_age<span class="token punctuation">`</span> <span class="token punctuation">(</span>vc_Name<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span>vc_City<span class="token punctuation">,</span>i_Age<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></div></code-block><div class="wolai-block wolai-text"><div><span class="inline-wrap">建表时</span><span class="inline-wrap"><code>vc_Name</code></span><span class="inline-wrap"> 长度为 50,这里为什么用 10 呢？这就是下文要说到的前缀索引,因为一般情况下名字的长度不会超过 10,这样会加速索引查询速度,还会减少索引文件的大小,提高 INSERT 的更新速度。</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">执行 T-SQL 时,MySQL 无须扫描任何记录就到找到唯一的记录！！</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">如果分别在 </span><span class="inline-wrap"><code>vc_Name</code></span><span class="inline-wrap">,</span><span class="inline-wrap"><code>vc_City</code></span><span class="inline-wrap">,</span><span class="inline-wrap"><code>i_Age</code></span><span class="inline-wrap"> 上建立单列索引,让该表有 3 个单列索引,查询时和上述的组合索引效率一样吗？答案是大不一样,远远低于我们的组合索引。虽然此时有了三个索引,</span><span class="inline-wrap"><b>但 MySQL 只能用到其中的那个它认为似乎是最有效率的单列索引,另外两个是用不到的</b></span><span class="inline-wrap">。</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">建立这样的组合索引,其实是相当于分别建立了</span></div></div><code-block class="wolai-block"><div class="wolai-pre"><div data-lang="纯文本" class="marker"></div><pre>vc_Name<span class="token punctuation">,</span>vc_City<span class="token punctuation">,</span>i_Age
vc_Name<span class="token punctuation">,</span>vc_City
vc_Name</pre></div></code-block><div class="wolai-block wolai-text"><div><span class="inline-wrap">这样的三个组合索引！为什么没有 </span><span class="inline-wrap"><code>vc_City</code></span><span class="inline-wrap">,</span><span class="inline-wrap"><code>i_Age</code></span><span class="inline-wrap"> 等这样的组合索引呢？这是因为 mysql 组合索引</span><span class="inline-wrap"><b>最左前缀</b></span><span class="inline-wrap">的结果。简单的理解就是只从最左面的开始组合。并不是只要包含这三列的查询都会用到该组合索引,下面的几个 T-SQL 会用到：</span></div></div><code-block class="wolai-block"><div class="wolai-pre"><div data-lang="纯文本" class="marker"></div><pre><span class="token constant">SELECT</span> <span class="token operator">*</span> <span class="token constant">FROM</span> myIndex <span class="token constant">WHREE</span> vc_Name<span class="token operator">=</span><span class="token string">"erquan"</span> <span class="token constant">AND</span> vc_City<span class="token operator">=</span><span class="token string">"郑州"</span>
<span class="token constant">SELECT</span> <span class="token operator">*</span> <span class="token constant">FROM</span> myIndex <span class="token constant">WHREE</span> vc_Name<span class="token operator">=</span><span class="token string">"erquan"</span></pre></div></code-block><div class="wolai-block wolai-text"><div><span class="inline-wrap">而下面几个则不会用到：</span></div></div><code-block class="wolai-block"><div class="wolai-pre"><div data-lang="纯文本" class="marker"></div><pre><span class="token constant">SELECT</span> <span class="token operator">*</span> <span class="token constant">FROM</span> myIndex <span class="token constant">WHREE</span> i_Age<span class="token operator">=</span><span class="token number">20</span> <span class="token constant">AND</span> vc_City<span class="token operator">=</span><span class="token string">"郑州"</span>
<span class="token constant">SELECT</span> <span class="token operator">*</span> <span class="token constant">FROM</span> myIndex <span class="token constant">WHREE</span> vc_City<span class="token operator">=</span><span class="token string">"郑州"</span></pre></div></code-block><div class="wolai-block wolai-text"><div><span class="inline-wrap"><b>也就是</b></span><span class="inline-wrap"><b><code>name_city_age (vc_Name(10),vc_City,i_Age) </code></b></span><span class="inline-wrap"><b>从左到右进行索引,如果没有左前索引<span class="jill"></span>Mysql<span class="jill"></span>不执行索引查询</b></span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap"></span><br/></div></div><aside class="bg-cultured wolai-block"><div data-symbol="🚀" class="icon"></div><span class="inline-wrap">TODO 联合索引的<span class="jill"></span>B+<span class="jill"></span>树结构</span></aside><div class="wolai-bookmark wolai-block"><a href="https://www.modb.pro/db/50037">MySQL B+树如何实现联合索引 - 墨天轮</a><div class="info-box"><div class="text-pane"><div data-title="MySQL B+树如何实现联合索引 - 墨天轮"></div><div data-desc="同学，你来画一下MySQL的B+树如何实现联合索引的？"></div><div class="icon-host"><div class="icon icon-image" style="background-image: url(&quot;https://oss-emcsprod-public.modb.pro/modb_imgs/favicon.ico&quot;)"></div><div data-hostname="www.modb.pro"></div></div></div><div class="preview-pane"></div></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap"></span><br/></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap"></span><br/></div></div><h4 class="wolai-block"><span class="inline-wrap">4.1.2<span class="jill"></span>前缀索引</span></h4><div class="wolai-block wolai-text"><div><span class="inline-wrap">如果索引列长度过长,这种列索引时将会产生很大的索引文件,不便于操作,可以使用前缀索引方式进行索引
前缀索引应该控制在一个合适的点,控制在<span class="jill"></span>0.31<span class="jill"></span>黄金值即可(大于这个值就可以创建)</span></div></div><code-block class="wolai-block"><div class="wolai-pre"><div data-lang="Sql" class="marker"></div><pre><span class="token keyword">SELECT</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token keyword">DISTINCT</span><span class="token punctuation">(</span><span class="token keyword">LEFT</span><span class="token punctuation">(</span><span class="token punctuation">`</span>title<span class="token punctuation">`</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">FROM</span> Arctic<span class="token punctuation">;</span> 
<span class="token comment">-- 这个值大于0.31就可以创建前缀索引,Distinct去重复</span>

<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> <span class="token punctuation">`</span><span class="token keyword">user</span><span class="token punctuation">`</span> <span class="token keyword">ADD</span> <span class="token keyword">INDEX</span> <span class="token punctuation">`</span>uname<span class="token punctuation">`</span><span class="token punctuation">(</span>title<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">-- 增加前缀索引SQL,将人名的索引建立在10,这样可以减少索引文件大小,加快索引查询速度</span></pre></div></code-block><h3 class="wolai-block"><span class="inline-wrap">4.2<span class="jill"></span>不用索引的<span class="jill"></span>SQL</span></h3><ol class="wolai-block"><li><div class="marker"></div><span class="inline-wrap">索引列参与计算</span><code-block class="wolai-block"><div class="wolai-pre"><div data-lang="SQL" class="marker"></div><pre><span class="token keyword">SELECT</span> <span class="token punctuation">`</span>sname<span class="token punctuation">`</span> <span class="token keyword">FROM</span> <span class="token punctuation">`</span>stu<span class="token punctuation">`</span> <span class="token keyword">WHERE</span> <span class="token punctuation">`</span>age<span class="token punctuation">`</span><span class="token operator">+</span><span class="token number">10</span><span class="token operator">=</span><span class="token number">30</span><span class="token punctuation">;</span>
<span class="token keyword">SELECT</span> <span class="token punctuation">`</span>sname<span class="token punctuation">`</span> <span class="token keyword">FROM</span> <span class="token punctuation">`</span>stu<span class="token punctuation">`</span> <span class="token keyword">WHERE</span> <span class="token keyword">LEFT</span><span class="token punctuation">(</span><span class="token punctuation">`</span><span class="token keyword">date</span><span class="token punctuation">`</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span><span class="token number">1990</span><span class="token punctuation">;</span> 
</pre></div></code-block></li><li><div class="marker"></div><span class="inline-wrap">模糊前缀匹配</span><code-block class="wolai-block"><div class="wolai-pre"><div data-lang="SQL" class="marker"></div><pre><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> <span class="token punctuation">`</span>houdunwang<span class="token punctuation">`</span> <span class="token keyword">WHERE</span> <span class="token punctuation">`</span>uname<span class="token punctuation">`</span> <span class="token operator">LIKE</span> <span class="token string">'后盾%'</span> <span class="token comment">-- 走索引</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> <span class="token punctuation">`</span>houdunwang<span class="token punctuation">`</span> <span class="token keyword">WHERE</span> <span class="token punctuation">`</span>uname<span class="token punctuation">`</span> <span class="token operator">LIKE</span> <span class="token string">"%后盾%"</span> <span class="token comment">-- 不走索引</span>
</pre></div></code-block><div class="wolai-block wolai-text"><div><span class="inline-wrap">其实也不一定不走索引</span></div></div><div class="wolai-bookmark wolai-block"><a href="https://www.cnblogs.com/xiaolincoding/p/15843572.html">MySQL 使用 like &quot;%x&quot;，索引一定会失效吗？ - 小林coding - 博客园</a><div class="info-box"><div class="text-pane"><div data-title="MySQL 使用 like &quot;%x&quot;，索引一定会失效吗？ - 小林coding - 博客园"></div><div data-desc="大家好，我是小林。 昨天发了一篇关于索引失效的文章：谁还没碰过索引失效呢 我在文末留了一个有点意思的思考题： 图片 这个思考题其实是出自于，我之前这篇文章「一条 SQL 语句引发的思考」中留言区一位读"></div><div class="icon-host"><div class="icon icon-image" style="background-image: url(&quot;https://common.cnblogs.com/favicon.svg&quot;)"></div><div data-hostname="www.cnblogs.com"></div></div></div><div class="preview-pane"></div></div></div></li><li><div class="marker"></div><span class="inline-wrap">正则表达式不使用索引,这也是为什么在<span class="jill"></span>SQL<span class="jill"></span>中很难看到<span class="jill"></span>regexp<span class="jill"></span>关键字的原因</span></li><li><div class="marker"></div><span class="inline-wrap">字符串与数字比较不使用索引（数字和字符串比较走不走索引？）</span><code-block class="wolai-block"><div class="wolai-pre"><div data-lang="SQL" class="marker"></div><pre><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token punctuation">`</span>a<span class="token punctuation">`</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>a<span class="token punctuation">`</span> <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">EXPLAIN</span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> <span class="token punctuation">`</span>a<span class="token punctuation">`</span> <span class="token keyword">WHERE</span> <span class="token punctuation">`</span>a<span class="token punctuation">`</span><span class="token operator">=</span><span class="token string">"1"</span> <span class="token comment">-- 走索引</span>
<span class="token keyword">EXPLAIN</span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> <span class="token punctuation">`</span>a<span class="token punctuation">`</span> <span class="token keyword">WHERE</span> <span class="token punctuation">`</span>a<span class="token punctuation">`</span><span class="token operator">=</span><span class="token number">1</span> <span class="token comment">-- 不走索引</span></pre></div></code-block></li><li><div class="marker"></div><span class="inline-wrap">非所有字段都有索引的<span class="jill"></span>or<span class="jill"></span>语句</span><code-block class="wolai-block"><div class="wolai-pre"><div data-lang="Sql" class="marker"></div><pre><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> dept <span class="token keyword">where</span> dname<span class="token operator">=</span><span class="token string">'xxx'</span> <span class="token operator">or</span> loc<span class="token operator">=</span><span class="token string">'xx'</span> <span class="token operator">or</span> deptno<span class="token operator">=</span><span class="token number">45</span> 
<span class="token comment">--如果条件中有or,即使其中有条件带索引也不会使用。</span>
<span class="token comment">--换言之,就是要求使用的所有字段,都必须建立索引, 我们建议大家尽量避免使用or关键字</span></pre></div></code-block></li><li><div class="marker"></div><span class="inline-wrap">排序的列(order by)同时也在<span class="jill"></span>WHERE<span class="jill"></span>中时，MYSQL<span class="jill"></span>将无法使用索引</span><code-block class="wolai-block"><div class="wolai-pre"><div data-lang="SQL" class="marker"></div><pre><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token keyword">user</span> <span class="token keyword">where</span> user_id <span class="token operator">in</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span> <span class="token keyword">order</span> <span class="token keyword">by</span> user_id<span class="token punctuation">;</span></pre></div></code-block></li><li><div class="marker"></div><span class="inline-wrap">如果<span class="jill"></span>mysql<span class="jill"></span>估计使用全表扫描要比使用索引快,则不使用索引</span></li></ol><aside class="bg-cultured wolai-block"><div data-symbol="🍄" class="icon"></div><span class="inline-wrap">mysql<span class="jill"></span>一次查询只能使用一个索引。如果要对多个字段使用索引，建立复合索引。</span></aside><h3 class="wolai-block"><span class="inline-wrap">4.3 Offset Limit 操作</span></h3><code-block class="wolai-block"><div class="wolai-pre"><div data-lang="SQL" class="marker"></div><pre><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> myTable <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> id <span class="token keyword">LIMIT</span> <span class="token number">1000000</span><span class="token punctuation">,</span> <span class="token number">30</span></pre></div></code-block><div class="wolai-block wolai-text"><div><span class="inline-wrap">写出这样<span class="jill"></span>SQL<span class="jill"></span>语句的人肯定心里是这样想的：MySQL<span class="jill"></span>数据库会直接定位到符合条件的第<span class="jill"></span>1000000<span class="jill"></span>位，然后再取<span class="jill"></span>30<span class="jill"></span>条数据。 然而，实际上<span class="jill"></span>MySQL<span class="jill"></span>不是这样工作的。LIMIT 1000000, 30 的意思是：扫描满足条件的<span class="jill"></span>1000030<span class="jill"></span>行，扔掉前面的<span class="jill"></span>1000000<span class="jill"></span>行，然后返回最后的<span class="jill"></span>30<span class="jill"></span>行。</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">mysql 的 limit 给分页带来了极大的方便，但数据偏移量一大，limit 的性能就急剧下降。</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">以下是两条查询语句，都是取<span class="jill"></span>10<span class="jill"></span>条数据，但性能就相去甚远。</span></div></div><code-block class="wolai-block"><div class="wolai-pre"><div data-lang="SQL" class="marker"></div><pre><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> table_name <span class="token keyword">limit</span> <span class="token number">10000</span><span class="token punctuation">,</span><span class="token number">10</span>


<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> table_name a
<span class="token keyword">inner</span> <span class="token keyword">join</span> <span class="token punctuation">(</span> <span class="token keyword">select</span> id <span class="token keyword">from</span> table_name <span class="token keyword">where</span> <span class="token punctuation">(</span>col <span class="token operator">=</span> xxx<span class="token punctuation">)</span> <span class="token keyword">limit</span> <span class="token number">10000</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">)</span> b 
<span class="token keyword">on</span> a<span class="token punctuation">.</span>id <span class="token operator">=</span> b<span class="token punctuation">.</span>id</pre></div></code-block><h3 class="wolai-block"><span class="inline-wrap">4.3<span class="jill"></span>索引的弊端</span></h3><div class="wolai-block wolai-text"><div><span class="inline-wrap">不要盲目的创建索引,只为查询操作频繁的列创建索引,创建索引会使查询操作变得更加快速,但是会降低增加、删除、更新操作的速度,因为执行这些操作的同时会对索引文件进行重新排序或更新;</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">但是,在互联网应用中,查询的语句远远大于<span class="jill"></span>DML<span class="jill"></span>的语句,甚至可以占到<span class="jill"></span>80%~90%,所以也不要太在意,只是在大数据导入时,可以先删除索引,再批量插入数据,最后再添加索引;</span></div></div><div class="wolai-bookmark wolai-block"><a href="https://jishuin.proginn.com/p/763bfbd2c9a7">
        MySQL8.0大表秒加字段，是真的吗？-技术圈
    </a><div class="info-box"><div class="text-pane"><div data-title="
        MySQL8.0大表秒加字段，是真的吗？-技术圈
    "></div><div data-desc="前言：很早就听说 MySQL8.0 支持快速加列，可以实现大表秒级加字段。笔者自己本地也有8.0环境，但一直未进行测试。本篇文章我们就一起来看下 M"></div><div class="icon-host"><div class="icon icon-image" style="background-image: url(&quot;https://stacdn.proginn.com/favicon_new.ico&quot;)"></div><div data-hostname="jishuin.proginn.com"></div></div></div><div class="preview-pane"></div></div></div><h2 class="wolai-block"><span class="inline-wrap">5.查询优化</span></h2><div class="wolai-block wolai-center"><figure style="width: 100%"><img src="media/%E6%9F%A5%E8%AF%A2%E4%BC%98%E5%8C%96%E7%9A%84%E6%80%9D%E8%B7%AF.png" style="width: 760px"/></figure></div><h3 class="wolai-block"><span class="inline-wrap">执行计划</span></h3><div class="wolai-block wolai-text"><div><span class="inline-wrap">执行计划指的是一条<span class="jill"></span>SQL<span class="jill"></span>语句是如何执行的。我们可以通过</span><span class="inline-wrap"><code>EXPLAIN</code></span><span class="inline-wrap"> 关键字查看一条<span class="jill"></span>SQL<span class="jill"></span>语句的执行过程。</span></div></div><code-block class="wolai-block"><div class="wolai-pre"><div data-lang="SQL" class="marker"></div><pre>mysql<span class="token operator">></span> <span class="token keyword">explain</span> <span class="token keyword">select</span> <span class="token number">1</span><span class="token punctuation">;</span>

<span class="token operator">+</span><span class="token comment">----+-------------+--------+------------+--------+---------------+--------+---------+--------+--------+----------+----------------+</span>
<span class="token operator">|</span> id <span class="token operator">|</span> select_type <span class="token operator">|</span> <span class="token keyword">table</span>  <span class="token operator">|</span> partitions <span class="token operator">|</span> <span class="token keyword">type</span>   <span class="token operator">|</span> possible_keys <span class="token operator">|</span> <span class="token keyword">key</span>    <span class="token operator">|</span> key_len <span class="token operator">|</span> ref    <span class="token operator">|</span> <span class="token keyword">rows</span>   <span class="token operator">|</span> filtered <span class="token operator">|</span> Extra          <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+-------------+--------+------------+--------+---------------+--------+---------+--------+--------+----------+----------------+</span>
<span class="token operator">|</span> <span class="token number">1</span>  <span class="token operator">|</span> <span class="token keyword">SIMPLE</span>      <span class="token operator">|</span> <span class="token operator">&lt;</span><span class="token boolean">null</span><span class="token operator">></span> <span class="token operator">|</span> <span class="token operator">&lt;</span><span class="token boolean">null</span><span class="token operator">></span>     <span class="token operator">|</span> <span class="token operator">&lt;</span><span class="token boolean">null</span><span class="token operator">></span> <span class="token operator">|</span> <span class="token operator">&lt;</span><span class="token boolean">null</span><span class="token operator">></span>        <span class="token operator">|</span> <span class="token operator">&lt;</span><span class="token boolean">null</span><span class="token operator">></span> <span class="token operator">|</span> <span class="token operator">&lt;</span><span class="token boolean">null</span><span class="token operator">></span>  <span class="token operator">|</span> <span class="token operator">&lt;</span><span class="token boolean">null</span><span class="token operator">></span> <span class="token operator">|</span> <span class="token operator">&lt;</span><span class="token boolean">null</span><span class="token operator">></span> <span class="token operator">|</span> <span class="token operator">&lt;</span><span class="token boolean">null</span><span class="token operator">></span>   <span class="token operator">|</span> <span class="token keyword">No</span> <span class="token keyword">tables</span> used <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+-------------+--------+------------+--------+---------------+--------+---------+--------+--------+----------+----------------+</span>
</pre></div></code-block><h3 class="wolai-block"><span class="inline-wrap">id</span></h3><div class="wolai-block wolai-text"><div><span class="inline-wrap">每个</span><span class="inline-wrap"><code>select</code></span><span class="inline-wrap">关键字对应一个唯一的</span><span class="inline-wrap"><code>id</code></span></div></div><aside class="bg-cultured wolai-block"><div data-symbol="🚀" class="icon"></div><span class="inline-wrap">查询优化器可能会进行<span class="jill"></span>SQL<span class="jill"></span>重写，把子查询变成半连接，导致两个</span><span class="inline-wrap"><code>select</code></span><span class="inline-wrap">关键字只有一个</span><span class="inline-wrap"><code>id</code></span></aside><div class="wolai-bookmark wolai-block"><a href="https://blog.csdn.net/horses/article/details/108152329">连接查询你一定不陌生，但你知道还有半连接和反连接吗？_Tony.Dong的专栏-CSDN博客_半连接 反连接</a><div class="info-box"><div class="text-pane"><div data-title="连接查询你一定不陌生，但你知道还有半连接和反连接吗？_Tony.Dong的专栏-CSDN博客_半连接 反连接"></div><div data-desc="半连接（Semi Join）返回左表中与右表至少匹配一次的数据行，通常体现为 EXISTS 或者 IN 子查询，反连接（Anti Join）返回左表中与右表不匹配的数据行，通常体现为 NOT EXISTS 或者 NOT IN 子查询。"></div><div class="icon-host"><div class="icon icon-image" style="background-image: url(&quot;https://g.csdnimg.cn/static/logo/favicon32.ico&quot;)"></div><div data-hostname="blog.csdn.net"></div></div></div><div class="preview-pane"></div></div></div><h3 class="wolai-block"><span class="inline-wrap">select_type</span></h3><div class="wolai-block wolai-text"><div><span class="red inline-wrap">simple</span><span class="inline-wrap">：查询语句中不包含<span class="jill"></span>union<span class="jill"></span>和子查询的都算作<span class="jill"></span>simple<span class="jill"></span>类型。(连接也算<span class="jill"></span>simple)</span></div></div><code-block class="wolai-block"><div class="wolai-pre"><div data-lang="SQL" class="marker"></div><pre><span class="token keyword">explain</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> s1 <span class="token keyword">inner</span> <span class="token keyword">join</span> s2<span class="token punctuation">;</span>

<span class="token operator">+</span><span class="token comment">----+-------------+-------+------------+------+---------------+--------+---------+--------+------+----------+-------------------------------+</span>
<span class="token operator">|</span> id <span class="token operator">|</span> select_type <span class="token operator">|</span> <span class="token keyword">table</span> <span class="token operator">|</span> partitions <span class="token operator">|</span> <span class="token keyword">type</span> <span class="token operator">|</span> possible_keys <span class="token operator">|</span> <span class="token keyword">key</span>    <span class="token operator">|</span> key_len <span class="token operator">|</span> ref    <span class="token operator">|</span> <span class="token keyword">rows</span> <span class="token operator">|</span> filtered <span class="token operator">|</span> Extra                         <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+-------------+-------+------------+------+---------------+--------+---------+--------+------+----------+-------------------------------+</span>
<span class="token operator">|</span> <span class="token number">1</span>  <span class="token operator">|</span> <span class="token keyword">SIMPLE</span>      <span class="token operator">|</span> s1    <span class="token operator">|</span> <span class="token operator">&lt;</span><span class="token boolean">null</span><span class="token operator">></span>     <span class="token operator">|</span> <span class="token keyword">ALL</span>  <span class="token operator">|</span> <span class="token operator">&lt;</span><span class="token boolean">null</span><span class="token operator">></span>        <span class="token operator">|</span> <span class="token operator">&lt;</span><span class="token boolean">null</span><span class="token operator">></span> <span class="token operator">|</span> <span class="token operator">&lt;</span><span class="token boolean">null</span><span class="token operator">></span>  <span class="token operator">|</span> <span class="token operator">&lt;</span><span class="token boolean">null</span><span class="token operator">></span> <span class="token operator">|</span> <span class="token number">633</span>  <span class="token operator">|</span> <span class="token number">100.0</span>    <span class="token operator">|</span> <span class="token operator">&lt;</span><span class="token boolean">null</span><span class="token operator">></span>                        <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">1</span>  <span class="token operator">|</span> <span class="token keyword">SIMPLE</span>      <span class="token operator">|</span> s2    <span class="token operator">|</span> <span class="token operator">&lt;</span><span class="token boolean">null</span><span class="token operator">></span>     <span class="token operator">|</span> <span class="token keyword">ALL</span>  <span class="token operator">|</span> <span class="token operator">&lt;</span><span class="token boolean">null</span><span class="token operator">></span>        <span class="token operator">|</span> <span class="token operator">&lt;</span><span class="token boolean">null</span><span class="token operator">></span> <span class="token operator">|</span> <span class="token operator">&lt;</span><span class="token boolean">null</span><span class="token operator">></span>  <span class="token operator">|</span> <span class="token operator">&lt;</span><span class="token boolean">null</span><span class="token operator">></span> <span class="token operator">|</span> <span class="token number">633</span>  <span class="token operator">|</span> <span class="token number">100.0</span>    <span class="token operator">|</span> <span class="token keyword">Using</span> <span class="token keyword">join</span> buffer <span class="token punctuation">(</span><span class="token keyword">hash</span> <span class="token keyword">join</span><span class="token punctuation">)</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+-------------+-------+------------+------+---------------+--------+---------+--------+------+----------+-------------------------------+</span>
</pre></div></code-block><div class="wolai-block wolai-text"><div><span class="red inline-wrap">primary</span><span class="inline-wrap">：对于包含</span><span class="inline-wrap"><code>union</code></span><span class="inline-wrap">或子查询的</span><span class="inline-wrap"><code>sql</code></span><span class="inline-wrap">来说，最左边的那个查询的</span><span class="inline-wrap"><code>select_type</code></span><span class="inline-wrap">的值就是</span><span class="inline-wrap"><code>primary</code></span></div></div><div class="wolai-block wolai-text"><div><span class="red inline-wrap">union</span><span class="inline-wrap">：对于包含</span><span class="inline-wrap"><code>union</code></span><span class="inline-wrap">或子查询的</span><span class="inline-wrap"><code>sql</code></span><span class="inline-wrap">来说，除了</span><span class="inline-wrap"><code>primary</code></span><span class="inline-wrap">其余都是</span><span class="inline-wrap"><code>union</code></span></div></div><div class="wolai-block wolai-text"><div><span class="red inline-wrap">union result</span><span class="inline-wrap">：因为<span class="jill"></span>union<span class="jill"></span>需要去重，所以需要一个临时表，用来存储去重的结果</span></div></div><code-block class="wolai-block"><div class="wolai-pre"><div data-lang="SQL" class="marker"></div><pre>mysql<span class="token operator">></span> <span class="token keyword">explain</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> s1 <span class="token keyword">union</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> s2<span class="token punctuation">;</span>

<span class="token operator">+</span><span class="token comment">--------+--------------+------------+------------+------+---------------+--------+---------+--------+--------+----------+-----------------+</span>
<span class="token operator">|</span> id     <span class="token operator">|</span> select_type  <span class="token operator">|</span> <span class="token keyword">table</span>      <span class="token operator">|</span> partitions <span class="token operator">|</span> <span class="token keyword">type</span> <span class="token operator">|</span> possible_keys <span class="token operator">|</span> <span class="token keyword">key</span>    <span class="token operator">|</span> key_len <span class="token operator">|</span> ref    <span class="token operator">|</span> <span class="token keyword">rows</span>   <span class="token operator">|</span> filtered <span class="token operator">|</span> Extra           <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">--------+--------------+------------+------------+------+---------------+--------+---------+--------+--------+----------+-----------------+</span>
<span class="token operator">|</span> <span class="token number">1</span>      <span class="token operator">|</span> <span class="token keyword">PRIMARY</span>      <span class="token operator">|</span> s1         <span class="token operator">|</span> <span class="token operator">&lt;</span><span class="token boolean">null</span><span class="token operator">></span>     <span class="token operator">|</span> <span class="token keyword">ALL</span>  <span class="token operator">|</span> <span class="token operator">&lt;</span><span class="token boolean">null</span><span class="token operator">></span>        <span class="token operator">|</span> <span class="token operator">&lt;</span><span class="token boolean">null</span><span class="token operator">></span> <span class="token operator">|</span> <span class="token operator">&lt;</span><span class="token boolean">null</span><span class="token operator">></span>  <span class="token operator">|</span> <span class="token operator">&lt;</span><span class="token boolean">null</span><span class="token operator">></span> <span class="token operator">|</span> <span class="token number">633</span>    <span class="token operator">|</span> <span class="token number">100.0</span>    <span class="token operator">|</span> <span class="token operator">&lt;</span><span class="token boolean">null</span><span class="token operator">></span>          <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">2</span>      <span class="token operator">|</span> <span class="token keyword">UNION</span>        <span class="token operator">|</span> s2         <span class="token operator">|</span> <span class="token operator">&lt;</span><span class="token boolean">null</span><span class="token operator">></span>     <span class="token operator">|</span> <span class="token keyword">ALL</span>  <span class="token operator">|</span> <span class="token operator">&lt;</span><span class="token boolean">null</span><span class="token operator">></span>        <span class="token operator">|</span> <span class="token operator">&lt;</span><span class="token boolean">null</span><span class="token operator">></span> <span class="token operator">|</span> <span class="token operator">&lt;</span><span class="token boolean">null</span><span class="token operator">></span>  <span class="token operator">|</span> <span class="token operator">&lt;</span><span class="token boolean">null</span><span class="token operator">></span> <span class="token operator">|</span> <span class="token number">633</span>    <span class="token operator">|</span> <span class="token number">100.0</span>    <span class="token operator">|</span> <span class="token operator">&lt;</span><span class="token boolean">null</span><span class="token operator">></span>          <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token operator">&lt;</span><span class="token boolean">null</span><span class="token operator">></span> <span class="token operator">|</span> <span class="token keyword">UNION</span> RESULT <span class="token operator">|</span> <span class="token operator">&lt;</span>union1<span class="token punctuation">,</span><span class="token number">2</span><span class="token operator">></span> <span class="token operator">|</span> <span class="token operator">&lt;</span><span class="token boolean">null</span><span class="token operator">></span>     <span class="token operator">|</span> <span class="token keyword">ALL</span>  <span class="token operator">|</span> <span class="token operator">&lt;</span><span class="token boolean">null</span><span class="token operator">></span>        <span class="token operator">|</span> <span class="token operator">&lt;</span><span class="token boolean">null</span><span class="token operator">></span> <span class="token operator">|</span> <span class="token operator">&lt;</span><span class="token boolean">null</span><span class="token operator">></span>  <span class="token operator">|</span> <span class="token operator">&lt;</span><span class="token boolean">null</span><span class="token operator">></span> <span class="token operator">|</span> <span class="token operator">&lt;</span><span class="token boolean">null</span><span class="token operator">></span> <span class="token operator">|</span> <span class="token operator">&lt;</span><span class="token boolean">null</span><span class="token operator">></span>   <span class="token operator">|</span> <span class="token keyword">Using</span> <span class="token keyword">temporary</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">--------+--------------+------------+------------+------+---------------+--------+---------+--------+--------+----------+-----------------+</span>

mysql<span class="token operator">></span> <span class="token keyword">explain</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> s1 <span class="token keyword">union</span> <span class="token keyword">all</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> s2<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">----+-------------+-------+------------+------+---------------+--------+---------+--------+------+----------+--------+</span>
<span class="token operator">|</span> id <span class="token operator">|</span> select_type <span class="token operator">|</span> <span class="token keyword">table</span> <span class="token operator">|</span> partitions <span class="token operator">|</span> <span class="token keyword">type</span> <span class="token operator">|</span> possible_keys <span class="token operator">|</span> <span class="token keyword">key</span>    <span class="token operator">|</span> key_len <span class="token operator">|</span> ref    <span class="token operator">|</span> <span class="token keyword">rows</span> <span class="token operator">|</span> filtered <span class="token operator">|</span> Extra  <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+-------------+-------+------------+------+---------------+--------+---------+--------+------+----------+--------+</span>
<span class="token operator">|</span> <span class="token number">1</span>  <span class="token operator">|</span> <span class="token keyword">PRIMARY</span>     <span class="token operator">|</span> s1    <span class="token operator">|</span> <span class="token operator">&lt;</span><span class="token boolean">null</span><span class="token operator">></span>     <span class="token operator">|</span> <span class="token keyword">ALL</span>  <span class="token operator">|</span> <span class="token operator">&lt;</span><span class="token boolean">null</span><span class="token operator">></span>        <span class="token operator">|</span> <span class="token operator">&lt;</span><span class="token boolean">null</span><span class="token operator">></span> <span class="token operator">|</span> <span class="token operator">&lt;</span><span class="token boolean">null</span><span class="token operator">></span>  <span class="token operator">|</span> <span class="token operator">&lt;</span><span class="token boolean">null</span><span class="token operator">></span> <span class="token operator">|</span> <span class="token number">633</span>  <span class="token operator">|</span> <span class="token number">100.0</span>    <span class="token operator">|</span> <span class="token operator">&lt;</span><span class="token boolean">null</span><span class="token operator">></span> <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">2</span>  <span class="token operator">|</span> <span class="token keyword">UNION</span>       <span class="token operator">|</span> s2    <span class="token operator">|</span> <span class="token operator">&lt;</span><span class="token boolean">null</span><span class="token operator">></span>     <span class="token operator">|</span> <span class="token keyword">ALL</span>  <span class="token operator">|</span> <span class="token operator">&lt;</span><span class="token boolean">null</span><span class="token operator">></span>        <span class="token operator">|</span> <span class="token operator">&lt;</span><span class="token boolean">null</span><span class="token operator">></span> <span class="token operator">|</span> <span class="token operator">&lt;</span><span class="token boolean">null</span><span class="token operator">></span>  <span class="token operator">|</span> <span class="token operator">&lt;</span><span class="token boolean">null</span><span class="token operator">></span> <span class="token operator">|</span> <span class="token number">633</span>  <span class="token operator">|</span> <span class="token number">100.0</span>    <span class="token operator">|</span> <span class="token operator">&lt;</span><span class="token boolean">null</span><span class="token operator">></span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+-------------+-------+------------+------+---------------+--------+---------+--------+------+----------+--------+</span>
<span class="token comment">-- 可以看出union all是没有临时表的</span>
</pre></div></code-block><div class="wolai-block wolai-text"><div><span class="red inline-wrap">subquery</span><span class="inline-wrap">：如果包含子查询的查询语句不能转化为半连接形式，该子查询的第一个</span><span class="inline-wrap"><code>select</code></span><span class="inline-wrap">关键字所代表的那个查询就是</span><span class="inline-wrap"><code>subquery</code></span></div></div><code-block class="wolai-block"><div class="wolai-pre"><div data-lang="SQL" class="marker"></div><pre>mysql<span class="token operator">></span> <span class="token keyword">explain</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> s1 <span class="token keyword">where</span> seq_id <span class="token operator">in</span> <span class="token punctuation">(</span><span class="token keyword">select</span> seq_id <span class="token keyword">from</span> s2<span class="token punctuation">)</span> <span class="token operator">or</span> sex<span class="token operator">=</span><span class="token string">'N'</span><span class="token punctuation">;</span>

<span class="token operator">+</span><span class="token comment">----+-------------+-------+------------+-------+---------------+---------+---------+--------+------+----------+-------------+</span>
<span class="token operator">|</span> id <span class="token operator">|</span> select_type <span class="token operator">|</span> <span class="token keyword">table</span> <span class="token operator">|</span> partitions <span class="token operator">|</span> <span class="token keyword">type</span>  <span class="token operator">|</span> possible_keys <span class="token operator">|</span> <span class="token keyword">key</span>     <span class="token operator">|</span> key_len <span class="token operator">|</span> ref    <span class="token operator">|</span> <span class="token keyword">rows</span> <span class="token operator">|</span> filtered <span class="token operator">|</span> Extra       <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+-------------+-------+------------+-------+---------------+---------+---------+--------+------+----------+-------------+</span>
<span class="token operator">|</span> <span class="token number">1</span>  <span class="token operator">|</span> <span class="token keyword">PRIMARY</span>     <span class="token operator">|</span> s1    <span class="token operator">|</span> <span class="token operator">&lt;</span><span class="token boolean">null</span><span class="token operator">></span>     <span class="token operator">|</span> <span class="token keyword">ALL</span>   <span class="token operator">|</span> <span class="token operator">&lt;</span><span class="token boolean">null</span><span class="token operator">></span>        <span class="token operator">|</span> <span class="token operator">&lt;</span><span class="token boolean">null</span><span class="token operator">></span>  <span class="token operator">|</span> <span class="token operator">&lt;</span><span class="token boolean">null</span><span class="token operator">></span>  <span class="token operator">|</span> <span class="token operator">&lt;</span><span class="token boolean">null</span><span class="token operator">></span> <span class="token operator">|</span> <span class="token number">633</span>  <span class="token operator">|</span> <span class="token number">100.0</span>    <span class="token operator">|</span> <span class="token keyword">Using</span> <span class="token keyword">where</span> <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">2</span>  <span class="token operator">|</span> SUBQUERY    <span class="token operator">|</span> s2    <span class="token operator">|</span> <span class="token operator">&lt;</span><span class="token boolean">null</span><span class="token operator">></span>     <span class="token operator">|</span> <span class="token keyword">index</span> <span class="token operator">|</span> <span class="token keyword">PRIMARY</span>       <span class="token operator">|</span> <span class="token keyword">PRIMARY</span> <span class="token operator">|</span> <span class="token number">8</span>       <span class="token operator">|</span> <span class="token operator">&lt;</span><span class="token boolean">null</span><span class="token operator">></span> <span class="token operator">|</span> <span class="token number">633</span>  <span class="token operator">|</span> <span class="token number">100.0</span>    <span class="token operator">|</span> <span class="token keyword">Using</span> <span class="token keyword">index</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+-------------+-------+------------+-------+---------------+---------+---------+--------+------+----------+-------------+</span>
</pre></div></code-block><div class="wolai-block wolai-text"><div><span class="red inline-wrap">dependent subquery</span><span class="inline-wrap">与</span><span class="red inline-wrap">dependent union</span><span class="inline-wrap">：如果一个子查询或</span><span class="inline-wrap"><code>union</code></span><span class="inline-wrap">查询涉及到的表，在别的查询中也有被使用，那么这个子查询或</span><span class="inline-wrap"><code>union</code></span><span class="inline-wrap">查询就叫</span><span class="inline-wrap"><code>dependent subquery</code></span><span class="inline-wrap">与</span><span class="inline-wrap"><code>dependent union</code></span></div></div><code-block class="wolai-block"><div class="wolai-pre"><div data-lang="SQL" class="marker"></div><pre>mysql<span class="token operator">></span> <span class="token keyword">explain</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> s1 <span class="token keyword">where</span> seq_id <span class="token operator">in</span> <span class="token punctuation">(</span> <span class="token keyword">select</span> seq_id <span class="token keyword">from</span> s1 <span class="token keyword">union</span> <span class="token keyword">all</span> <span class="token keyword">select</span> seq_id <span class="token keyword">from</span> s2<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token operator">+</span><span class="token comment">----+--------------------+-------+------------+--------+---------------+---------+---------+--------+------+----------+-------------+</span>
<span class="token operator">|</span> id <span class="token operator">|</span> select_type        <span class="token operator">|</span> <span class="token keyword">table</span> <span class="token operator">|</span> partitions <span class="token operator">|</span> <span class="token keyword">type</span>   <span class="token operator">|</span> possible_keys <span class="token operator">|</span> <span class="token keyword">key</span>     <span class="token operator">|</span> key_len <span class="token operator">|</span> ref    <span class="token operator">|</span> <span class="token keyword">rows</span> <span class="token operator">|</span> filtered <span class="token operator">|</span> Extra       <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+--------------------+-------+------------+--------+---------------+---------+---------+--------+------+----------+-------------+</span>
<span class="token operator">|</span> <span class="token number">1</span>  <span class="token operator">|</span> <span class="token keyword">PRIMARY</span>            <span class="token operator">|</span> s1    <span class="token operator">|</span> <span class="token operator">&lt;</span><span class="token boolean">null</span><span class="token operator">></span>     <span class="token operator">|</span> <span class="token keyword">ALL</span>    <span class="token operator">|</span> <span class="token operator">&lt;</span><span class="token boolean">null</span><span class="token operator">></span>        <span class="token operator">|</span> <span class="token operator">&lt;</span><span class="token boolean">null</span><span class="token operator">></span>  <span class="token operator">|</span> <span class="token operator">&lt;</span><span class="token boolean">null</span><span class="token operator">></span>  <span class="token operator">|</span> <span class="token operator">&lt;</span><span class="token boolean">null</span><span class="token operator">></span> <span class="token operator">|</span> <span class="token number">633</span>  <span class="token operator">|</span> <span class="token number">100.0</span>    <span class="token operator">|</span> <span class="token keyword">Using</span> <span class="token keyword">where</span> <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">2</span>  <span class="token operator">|</span> DEPENDENT SUBQUERY <span class="token operator">|</span> s1    <span class="token operator">|</span> <span class="token operator">&lt;</span><span class="token boolean">null</span><span class="token operator">></span>     <span class="token operator">|</span> eq_ref <span class="token operator">|</span> <span class="token keyword">PRIMARY</span>       <span class="token operator">|</span> <span class="token keyword">PRIMARY</span> <span class="token operator">|</span> <span class="token number">8</span>       <span class="token operator">|</span> func   <span class="token operator">|</span> <span class="token number">1</span>    <span class="token operator">|</span> <span class="token number">100.0</span>    <span class="token operator">|</span> <span class="token keyword">Using</span> <span class="token keyword">index</span> <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">3</span>  <span class="token operator">|</span> DEPENDENT <span class="token keyword">UNION</span>    <span class="token operator">|</span> s2    <span class="token operator">|</span> <span class="token operator">&lt;</span><span class="token boolean">null</span><span class="token operator">></span>     <span class="token operator">|</span> eq_ref <span class="token operator">|</span> <span class="token keyword">PRIMARY</span>       <span class="token operator">|</span> <span class="token keyword">PRIMARY</span> <span class="token operator">|</span> <span class="token number">8</span>       <span class="token operator">|</span> func   <span class="token operator">|</span> <span class="token number">1</span>    <span class="token operator">|</span> <span class="token number">100.0</span>    <span class="token operator">|</span> <span class="token keyword">Using</span> <span class="token keyword">index</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+--------------------+-------+------------+--------+---------------+---------+---------+--------+------+----------+-------------+</span></pre></div></code-block><div class="wolai-block wolai-text"><div><span class="red inline-wrap">UNCACHEABLE SUBQUERY</span><span class="inline-wrap">：子查询，其结果无法缓存，必须针对外部查询的每一行进行评估  
</span></div></div><div class="wolai-block wolai-text"><div><span class="red inline-wrap">UNCACHEABLE UNION</span><span class="inline-wrap">：在<span class="jill"></span>UNION<span class="jill"></span>里的第二个或最后一个表属于不可缓存的子查询</span></div></div><h3 class="wolai-block"><span class="inline-wrap">临时表，派生表，物化表
</span></h3><div class="wolai-block wolai-text"><div><span class="inline-wrap">临时表，派生表，物化表这三个其实是一样的东西，只不过所处环境不同名字不一样。</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">临时表是<span class="jill"></span>Mysql<span class="jill"></span>自己生成的表，比如<span class="jill"></span>UNION RESULT<span class="jill"></span>就是临时表，是名字都不配有的表。</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">当用户赋予临时表名字的时候，就变成了派生表。</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">但无论是临时表还是派生表，空间都比较小，查询起来比较方便，可以放在内存中。一旦两种表过大，必须加上索引，就被称为物化表。</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">物化表有没有名字都无所谓，只要被生成了索引就是物化表，其中物化表又可以分为内存物化表(哈希索引)和磁盘物化表(B+<span class="jill"></span>树索引)。</span></div></div><div class="wolai-block wolai-text"><div><span class="red inline-wrap">派生表</span><span class="inline-wrap">：用于存储</span><span class="inline-wrap"><code>from</code></span><span class="inline-wrap">关键字后面紧跟的</span><span class="inline-wrap"><code>子查询</code></span><span class="inline-wrap">产生的结果的临时表。</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">本质上来说，派生表也是临时表，它和临时表的区别在于：用户无法看到临时表，仅仅能够通过</span><span class="inline-wrap"><code>explain</code></span><span class="inline-wrap">关键字查找到一个</span><span class="inline-wrap"><code>sql</code></span><span class="inline-wrap">的某些步骤使用了临时表。而派生表则是有名字的临时表，这个名字就是用户在</span><span class="inline-wrap"><code>sql</code></span><span class="inline-wrap">中赋予的。</span></div></div><code-block class="wolai-block"><div class="wolai-pre"><div data-lang="SQL" class="marker"></div><pre>mysql<span class="token operator">></span> <span class="token keyword">explain</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span> <span class="token keyword">as</span> t<span class="token punctuation">;</span>

<span class="token operator">+</span><span class="token comment">----+-------------+------------+------------+--------+---------------+--------+---------+--------+--------+----------+----------------+</span>
<span class="token operator">|</span> id <span class="token operator">|</span> select_type <span class="token operator">|</span> <span class="token keyword">table</span>      <span class="token operator">|</span> partitions <span class="token operator">|</span> <span class="token keyword">type</span>   <span class="token operator">|</span> possible_keys <span class="token operator">|</span> <span class="token keyword">key</span>    <span class="token operator">|</span> key_len <span class="token operator">|</span> ref    <span class="token operator">|</span> <span class="token keyword">rows</span>   <span class="token operator">|</span> filtered <span class="token operator">|</span> Extra          <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+-------------+------------+------------+--------+---------------+--------+---------+--------+--------+----------+----------------+</span>
<span class="token operator">|</span> <span class="token number">1</span>  <span class="token operator">|</span> <span class="token keyword">PRIMARY</span>     <span class="token operator">|</span> <span class="token operator">&lt;</span>derived2<span class="token operator">></span> <span class="token operator">|</span> <span class="token operator">&lt;</span><span class="token boolean">null</span><span class="token operator">></span>     <span class="token operator">|</span> system <span class="token operator">|</span> <span class="token operator">&lt;</span><span class="token boolean">null</span><span class="token operator">></span>        <span class="token operator">|</span> <span class="token operator">&lt;</span><span class="token boolean">null</span><span class="token operator">></span> <span class="token operator">|</span> <span class="token operator">&lt;</span><span class="token boolean">null</span><span class="token operator">></span>  <span class="token operator">|</span> <span class="token operator">&lt;</span><span class="token boolean">null</span><span class="token operator">></span> <span class="token operator">|</span> <span class="token number">1</span>      <span class="token operator">|</span> <span class="token number">100.0</span>    <span class="token operator">|</span> <span class="token operator">&lt;</span><span class="token boolean">null</span><span class="token operator">></span>         <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">2</span>  <span class="token operator">|</span> DERIVED     <span class="token operator">|</span> <span class="token operator">&lt;</span><span class="token boolean">null</span><span class="token operator">></span>     <span class="token operator">|</span> <span class="token operator">&lt;</span><span class="token boolean">null</span><span class="token operator">></span>     <span class="token operator">|</span> <span class="token operator">&lt;</span><span class="token boolean">null</span><span class="token operator">></span> <span class="token operator">|</span> <span class="token operator">&lt;</span><span class="token boolean">null</span><span class="token operator">></span>        <span class="token operator">|</span> <span class="token operator">&lt;</span><span class="token boolean">null</span><span class="token operator">></span> <span class="token operator">|</span> <span class="token operator">&lt;</span><span class="token boolean">null</span><span class="token operator">></span>  <span class="token operator">|</span> <span class="token operator">&lt;</span><span class="token boolean">null</span><span class="token operator">></span> <span class="token operator">|</span> <span class="token operator">&lt;</span><span class="token boolean">null</span><span class="token operator">></span> <span class="token operator">|</span> <span class="token operator">&lt;</span><span class="token boolean">null</span><span class="token operator">></span>   <span class="token operator">|</span> <span class="token keyword">No</span> <span class="token keyword">tables</span> used <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+-------------+------------+------------+--------+---------------+--------+---------+--------+--------+----------+----------------+</span></pre></div></code-block><div class="wolai-block wolai-text"><div><span class="inline-wrap">上面的子查询放在</span><span class="inline-wrap"><code>from</code></span><span class="inline-wrap">的后面，它的结果相当于一个派生表，表的名称是</span><span class="inline-wrap"><code>t</code></span><span class="inline-wrap">，有</span><span class="inline-wrap"><code>1,2,3</code></span><span class="inline-wrap">三个字段。</span></div></div><div class="wolai-block wolai-text"><div><span class="red inline-wrap">物化表</span><span class="inline-wrap">：用于存储</span><span class="inline-wrap"><code>WHERE</code></span><span class="inline-wrap"> 子句中查询条件里的子查询产生的结果的临时表。</span></div></div><code-block class="wolai-block"><div class="wolai-pre"><div data-lang="SQL" class="marker"></div><pre>mysql<span class="token operator">></span> <span class="token keyword">explain</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> s1 <span class="token keyword">where</span> sex <span class="token operator">in</span> <span class="token punctuation">(</span><span class="token keyword">select</span> sex <span class="token keyword">from</span> s2 <span class="token keyword">where</span> seq_id <span class="token operator">></span> <span class="token number">100</span> <span class="token operator">and</span> seq_id <span class="token operator">&lt;</span> <span class="token number">1000000000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token operator">+</span><span class="token comment">----+--------------+-------------+------------+--------+---------------------+---------------------+---------+---------------------+------+----------+-------------+</span>
<span class="token operator">|</span> id <span class="token operator">|</span> select_type  <span class="token operator">|</span> <span class="token keyword">table</span>       <span class="token operator">|</span> partitions <span class="token operator">|</span> <span class="token keyword">type</span>   <span class="token operator">|</span> possible_keys       <span class="token operator">|</span> <span class="token keyword">key</span>                 <span class="token operator">|</span> key_len <span class="token operator">|</span> ref                 <span class="token operator">|</span> <span class="token keyword">rows</span> <span class="token operator">|</span> filtered <span class="token operator">|</span> Extra       <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+--------------+-------------+------------+--------+---------------------+---------------------+---------+---------------------+------+----------+-------------+</span>
<span class="token operator">|</span> <span class="token number">1</span>  <span class="token operator">|</span> <span class="token keyword">SIMPLE</span>       <span class="token operator">|</span> s1          <span class="token operator">|</span> <span class="token operator">&lt;</span><span class="token boolean">null</span><span class="token operator">></span>     <span class="token operator">|</span> <span class="token keyword">ALL</span>    <span class="token operator">|</span> <span class="token operator">&lt;</span><span class="token boolean">null</span><span class="token operator">></span>              <span class="token operator">|</span> <span class="token operator">&lt;</span><span class="token boolean">null</span><span class="token operator">></span>              <span class="token operator">|</span> <span class="token operator">&lt;</span><span class="token boolean">null</span><span class="token operator">></span>  <span class="token operator">|</span> <span class="token operator">&lt;</span><span class="token boolean">null</span><span class="token operator">></span>              <span class="token operator">|</span> <span class="token number">633</span>  <span class="token operator">|</span> <span class="token number">100.0</span>    <span class="token operator">|</span> <span class="token operator">&lt;</span><span class="token boolean">null</span><span class="token operator">></span>      <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">1</span>  <span class="token operator">|</span> <span class="token keyword">SIMPLE</span>       <span class="token operator">|</span> <span class="token operator">&lt;</span>subquery2<span class="token operator">></span> <span class="token operator">|</span> <span class="token operator">&lt;</span><span class="token boolean">null</span><span class="token operator">></span>     <span class="token operator">|</span> eq_ref <span class="token operator">|</span> <span class="token operator">&lt;</span>auto_distinct_key<span class="token operator">></span> <span class="token operator">|</span> <span class="token operator">&lt;</span>auto_distinct_key<span class="token operator">></span> <span class="token operator">|</span> <span class="token number">6</span>       <span class="token operator">|</span> order_centre<span class="token punctuation">.</span>s1<span class="token punctuation">.</span>sex <span class="token operator">|</span> <span class="token number">1</span>    <span class="token operator">|</span> <span class="token number">100.0</span>    <span class="token operator">|</span> <span class="token operator">&lt;</span><span class="token boolean">null</span><span class="token operator">></span>      <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">2</span>  <span class="token operator">|</span> MATERIALIZED <span class="token operator">|</span> s2          <span class="token operator">|</span> <span class="token operator">&lt;</span><span class="token boolean">null</span><span class="token operator">></span>     <span class="token operator">|</span> range  <span class="token operator">|</span> <span class="token keyword">PRIMARY</span>             <span class="token operator">|</span> <span class="token keyword">PRIMARY</span>             <span class="token operator">|</span> <span class="token number">8</span>       <span class="token operator">|</span> <span class="token operator">&lt;</span><span class="token boolean">null</span><span class="token operator">></span>              <span class="token operator">|</span> <span class="token number">624</span>  <span class="token operator">|</span> <span class="token number">100.0</span>    <span class="token operator">|</span> <span class="token keyword">Using</span> <span class="token keyword">where</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+--------------+-------------+------------+--------+---------------------+---------------------+---------+---------------------+------+----------+-------------+</span></pre></div></code-block><aside class="bg-cultured wolai-block"><div data-symbol="🚀" class="icon"></div><span class="inline-wrap">TODO 深入物化表、子查询优化</span></aside><h3 class="wolai-block"><span class="inline-wrap">table</span></h3><div class="wolai-block wolai-text"><div><span class="inline-wrap">查询的是哪个表</span></div></div><h3 class="wolai-block"><span class="inline-wrap">partitions</span></h3><div class="wolai-block wolai-text"><div><span class="inline-wrap">该参数用于记录使用的分区信息，NULL<span class="jill"></span>表示该表不是分区表。没怎么用过分区表，先跳过了。</span></div></div><h3 class="wolai-block"><span class="inline-wrap">type</span></h3><aside class="bg-cultured wolai-block"><div data-symbol="🚀" class="icon"></div><span class="inline-wrap"><b>覆盖索引</b></span><span class="inline-wrap">是<span class="jill"></span>select<span class="jill"></span>的数据列在</span><span class="inline-wrap"><b>索引</b></span><span class="inline-wrap">中就能够取得，不必读取数据行(也就是不用回表)</span></aside><h3 class="wolai-block"><span class="inline-wrap">possible_keys、key、key_len</span></h3><div class="wolai-block wolai-text"><div><span class="inline-wrap">possible_keys：这次查询可用的索引有哪些</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">key：这次查询最终用到的索引</span></div></div><h3 class="wolai-block"><span class="inline-wrap">ref</span></h3><h3 class="wolai-block"><span class="inline-wrap">rows</span></h3><div class="wolai-block wolai-text"><div><span class="inline-wrap">这次查询大概返回多少行</span></div></div><h3 class="wolai-block"><span class="inline-wrap">filtered</span></h3><aside class="bg-cultured wolai-block"><div data-symbol="🚀" class="icon"></div><span class="inline-wrap">TODO 看完连接的原理、查询的成本、子查询优化再来写这个吧</span></aside><div class="wolai-block wolai-text"><div></div></div></article><footer></footer></body></html>