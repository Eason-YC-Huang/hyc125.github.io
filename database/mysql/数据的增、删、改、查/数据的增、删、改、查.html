<!DOCTYPE html>
<html lang="zh-Hans-CN"><head><meta charset="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=Edge"/><link rel="stylesheet" type="text/css" href="../../../css/modern-norm.min.css"/><link rel="stylesheet" type="text/css" href="../../../css/prism.min.css"/><link rel="stylesheet" type="text/css" href="../../../css/katex.min.css"/><link rel="stylesheet" type="text/css" href="../../../css/wolai.css"/><title>数据的增、删、改、查 - wolai 笔记</title><link rel="shortcut icon" href="data:image/svg+xml,%3Csvg xmlns=&apos;http://www.w3.org/2000/svg&apos; viewBox=&apos;0 0 800 800&apos;%3E%3Cdefs%3E%3Cstyle%3E.cls-1%7Bfill:%23fff;%7D%3C/style%3E%3C/defs%3E%3Cg%3E%3Cpath class=&apos;cls-1&apos; d=&apos;M610.08,0c66,0,90,6.88,114.13,19.79a134.62,134.62,0,0,1,56,56l2.28,4.4C793.93,103,800,127.88,800,189.92V610.08l-.08,11.56c-.78,57.38-7.58,79.89-19.71,102.57a134.62,134.62,0,0,1-56,56l-4.4,2.28C697,793.93,672.12,800,610.08,800H189.92l-11.56-.08c-57.38-.78-79.89-7.58-102.57-19.71a134.62,134.62,0,0,1-56-56l-2.28-4.4C6.44,697.75.4,673.72,0,616L0,189.92c0-66,6.88-90,19.79-114.13a134.62,134.62,0,0,1,56-56l4.4-2.28C102.25,6.44,126.28.4,184,0Z&apos;/%3E%3Cpath d=&apos;M610.08,0c66,0,90,6.88,114.13,19.79a134.62,134.62,0,0,1,56,56l2.28,4.4C793.93,103,800,127.88,800,189.92V610.08l-.08,11.56c-.78,57.38-7.58,79.89-19.71,102.57a134.62,134.62,0,0,1-56,56l-4.4,2.28C697,793.93,672.12,800,610.08,800H189.92l-11.56-.08c-57.38-.78-79.89-7.58-102.57-19.71a134.62,134.62,0,0,1-56-56l-2.28-4.4C6.44,697.75.4,673.72,0,616L0,189.92c0-66,6.88-90,19.79-114.13a134.62,134.62,0,0,1,56-56l4.4-2.28C102.25,6.44,126.28.4,184,0Zm4.72,88.9H185.2L172.42,89c-32.78.62-43.68,3.24-54.71,9.14a45.84,45.84,0,0,0-19.54,19.54c-6.61,12.36-9.11,24.55-9.27,67.49V614.8L89,627.58c.62,32.78,3.24,43.68,9.14,54.71a45.84,45.84,0,0,0,19.54,19.54c12.36,6.61,24.55,9.11,67.49,9.27H610.08c46.79,0,59.41-2.44,72.21-9.28a45.84,45.84,0,0,0,19.54-19.54c6.61-12.36,9.11-24.55,9.27-67.49V189.92c0-46.79-2.44-59.41-9.28-72.21a45.84,45.84,0,0,0-19.54-19.54C669.93,91.56,657.74,89.06,614.8,88.9ZM233.33,493.33A73.34,73.34,0,1,1,160,566.67,73.35,73.35,0,0,1,233.33,493.33Z&apos;/%3E%3C/g%3E%3C/svg%3E"></link></head><body><header><div class="image"></div><div class="title"><div class="banner"><div class="icon"></div></div><div data-title="数据的增、删、改、查" class="main-title"></div></div></header><article><h2 class="wolai-block"><span class="inline-wrap">新增</span></h2><code-block class="wolai-block"><div class="wolai-pre"><div data-lang="Sql" class="marker"></div><pre><span class="token keyword">insert</span> <span class="token keyword">into</span> table_name 
<span class="token punctuation">(</span>column1<span class="token punctuation">,</span>column2<span class="token punctuation">)</span>
<span class="token keyword">values</span>
<span class="token punctuation">(</span>value1<span class="token punctuation">,</span>value2<span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span>value3<span class="token punctuation">,</span>value4<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">-- 忽略插入过程中出现的异常,例如Duplicate entry,配合唯一主键可以实现乐观锁</span>
<span class="token keyword">insert</span> <span class="token keyword">ignore</span> <span class="token keyword">into</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token comment">-- 把A表的数据同步到B表（B表必须存在）</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> TableB<span class="token punctuation">(</span>field1<span class="token punctuation">,</span>field2<span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span> <span class="token keyword">select</span> value1<span class="token punctuation">,</span>value2<span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token keyword">from</span> TableA
<span class="token comment">-- 把A表的数据同步到B表（B表必须不存在）</span>
<span class="token keyword">SELECT</span> vale1<span class="token punctuation">,</span> value2 <span class="token keyword">into</span> TableB <span class="token keyword">from</span> TableA
</pre></div></code-block><h2 class="wolai-block"><span class="inline-wrap">删除</span></h2><code-block class="wolai-block"><div class="wolai-pre"><div data-lang="Sql" class="marker"></div><pre><span class="token keyword">delete</span> <span class="token keyword">from</span> table_name <span class="token keyword">where</span> id <span class="token operator">=</span> <span class="token number">2333</span><span class="token punctuation">;</span>
<span class="token comment">-- 多表删除</span>
<span class="token keyword">DELETE</span> <span class="token keyword">FROM</span> t1 <span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> t2 <span class="token keyword">ON</span> t1<span class="token punctuation">.</span>id <span class="token operator">=</span> t2<span class="token punctuation">.</span>id<span class="token punctuation">;</span>
<span class="token comment">-- 数据去重</span>
<span class="token keyword">DELETE</span> t1 <span class="token keyword">FROM</span> <span class="token keyword">user</span> t1
<span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> <span class="token keyword">user</span> t2 
<span class="token keyword">WHERE</span> 
    t1<span class="token punctuation">.</span>account <span class="token operator">=</span> t2<span class="token punctuation">.</span>account <span class="token operator">AND</span> 
    t1<span class="token punctuation">.</span>create_time <span class="token operator">&lt;</span> t2<span class="token punctuation">.</span>create_time</pre></div></code-block><h2 class="wolai-block"><span class="inline-wrap">更新</span></h2><code-block class="wolai-block"><div class="wolai-pre"><div data-lang="Sql" class="marker"></div><pre><span class="token keyword">update</span> table_name 
<span class="token keyword">set</span> 
column1 <span class="token operator">=</span> value1<span class="token punctuation">,</span>
column2 <span class="token operator">=</span> value2<span class="token punctuation">;</span>
<span class="token comment">-- 批量更新</span>
<span class="token keyword">UPDATE</span> categories <span class="token keyword">SET</span>
    display_order <span class="token operator">=</span> <span class="token keyword">CASE</span> id
        <span class="token keyword">WHEN</span> <span class="token number">1</span> <span class="token keyword">THEN</span> <span class="token number">3</span>
        <span class="token keyword">WHEN</span> <span class="token number">2</span> <span class="token keyword">THEN</span> <span class="token number">4</span>
        <span class="token keyword">WHEN</span> <span class="token number">3</span> <span class="token keyword">THEN</span> <span class="token number">5</span>
    <span class="token keyword">END</span><span class="token punctuation">,</span>
    title <span class="token operator">=</span> <span class="token keyword">CASE</span> id
        <span class="token keyword">WHEN</span> <span class="token number">1</span> <span class="token keyword">THEN</span> <span class="token string">'New Title 1'</span>
        <span class="token keyword">WHEN</span> <span class="token number">2</span> <span class="token keyword">THEN</span> <span class="token string">'New Title 2'</span>
        <span class="token keyword">WHEN</span> <span class="token number">3</span> <span class="token keyword">THEN</span> <span class="token string">'New Title 3'</span>
    <span class="token keyword">END</span>
<span class="token keyword">WHERE</span> id <span class="token operator">IN</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span>

<span class="token comment">-- 把一个表的字段更新到另一个表上</span>
<span class="token keyword">UPDATE</span> t1<span class="token punctuation">,</span> t2 <span class="token keyword">SET</span> t2<span class="token punctuation">.</span>a <span class="token operator">=</span> t1<span class="token punctuation">.</span>a <span class="token keyword">WHERE</span> t2<span class="token punctuation">.</span>id <span class="token operator">=</span> t1<span class="token punctuation">.</span>id<span class="token punctuation">;</span></pre></div></code-block><h2 class="wolai-block"><span class="inline-wrap">检索</span></h2><h3 class="wolai-block"><span class="inline-wrap"><b>基本使用</b></span></h3><code-block class="wolai-block"><div class="wolai-pre"><div data-lang="Sql" class="marker"></div><pre><span class="token comment">-- 检索单列</span>
<span class="token keyword">SELECT</span> prod_name <span class="token keyword">FROM</span> products<span class="token punctuation">;</span>
<span class="token comment">-- 检索多列</span>
<span class="token keyword">SELECT</span> prod_id<span class="token punctuation">,</span>prod_name <span class="token keyword">FROM</span> products<span class="token punctuation">;</span>
<span class="token comment">-- 检索所有列</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> products<span class="token punctuation">;</span>
<span class="token comment">-- 常量字段</span>
<span class="token keyword">SELECT</span> <span class="token string">'Constant Field'</span> <span class="token punctuation">,</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> <span class="token keyword">user</span><span class="token punctuation">;</span>
<span class="token comment">-- DISTINCT 除去重复行</span>
<span class="token keyword">SELECT</span> <span class="token keyword">DISTINCT</span>  prod_name <span class="token keyword">FROM</span> products<span class="token punctuation">;</span> <span class="token comment">-- DISTINCT 必须放在列的前面，而且他会作用于所有列</span></pre></div></code-block><h3 class="wolai-block"><span class="inline-wrap">条件筛选</span></h3><code-block class="wolai-block"><div class="wolai-pre"><div data-lang="Sql" class="marker"></div><pre><span class="token comment">-- 通过WHERE关键字进行筛选</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> products <span class="token keyword">WHERE</span> prod_price<span class="token operator">=</span><span class="token number">2.50</span><span class="token punctuation">;</span>
<span class="token comment">-- WHERE子句操作符 =、!=、&lt;、&lt;=、>、>=、BETWEEN X AND、IN、NOT IN、IS NULL、AND、OR</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> products <span class="token keyword">WHERE</span> prod_price <span class="token operator">BETWEEN</span>  <span class="token number">5</span> <span class="token operator">AND</span> <span class="token number">10</span><span class="token punctuation">;</span> <span class="token comment">-- 包括5和10</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> products <span class="token keyword">WHERE</span> prod_price <span class="token operator">=</span> <span class="token number">5</span> <span class="token operator">OR</span> prod_price <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> products <span class="token keyword">WHERE</span> prod_price <span class="token operator">=</span> <span class="token number">5</span> <span class="token operator">AND</span> prod_category <span class="token operator">=</span> <span class="token string">'生活用品'</span><span class="token punctuation">;</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> products <span class="token keyword">WHERE</span> prod_price <span class="token operator">IN</span> <span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">15</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></div></code-block><h3 class="wolai-block"><span class="inline-wrap">排序</span></h3><code-block class="wolai-block"><div class="wolai-pre"><div data-lang="Sql" class="marker"></div><pre><span class="token comment">-- 通过ORDER BY关键字进行排序，ORDER BY必须放在WHERE关键字后面</span>
<span class="token keyword">SELECT</span> prod_name <span class="token keyword">FROM</span> products <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> prod_price <span class="token keyword">DESC</span> <span class="token punctuation">,</span> prod_name <span class="token keyword">ASC</span><span class="token punctuation">;</span></pre></div></code-block><h3 class="wolai-block"><span class="inline-wrap">分组</span></h3><div class="wolai-block wolai-center"><figure style="width: 100%"><img src="media/mysql-group-by.jpg" style="width: 760px"/></figure></div><code-block class="wolai-block"><div class="wolai-pre"><div data-lang="Sql" class="marker"></div><pre><span class="token comment">-- GROUP BY数据分组</span>
<span class="token comment">-- 显示每个学生获得过的最高分数</span>
<span class="token keyword">SELECT</span> NAME<span class="token punctuation">,</span> <span class="token function">MAX</span><span class="token punctuation">(</span>SCORE<span class="token punctuation">)</span> <span class="token keyword">FROM</span> Test <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> NAME<span class="token punctuation">;</span>
<span class="token comment">-- 显示每个学生获得过的最高分数，而且分数大于5的</span>
<span class="token keyword">SELECT</span> NAME<span class="token punctuation">,</span> <span class="token function">MAX</span><span class="token punctuation">(</span>SCORE<span class="token punctuation">)</span> <span class="token keyword">FROM</span> Test <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> NAME <span class="token keyword">HAVING</span> <span class="token function">MAX</span><span class="token punctuation">(</span>SCORE<span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">5</span><span class="token punctuation">;</span> 
<span class="token comment">-- 显示每个学生每门科目获得过的最高分数，而且分数大于5的</span>
<span class="token keyword">SELECT</span> NAME<span class="token punctuation">,</span> <span class="token function">MAX</span><span class="token punctuation">(</span>SCORE<span class="token punctuation">)</span> <span class="token keyword">FROM</span> Test <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> NAME <span class="token punctuation">,</span> SUBJECT <span class="token keyword">HAVING</span> <span class="token function">MAX</span><span class="token punctuation">(</span>SCORE<span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">5</span><span class="token punctuation">;</span> 
<span class="token comment">-- WHERE子句中不能使用聚合函数，必须使用HAVING子句来代替</span></pre></div></code-block><h3 class="wolai-block"><span class="inline-wrap"><b>通配符与正则表达式</b></span></h3><code-block class="wolai-block"><div class="wolai-pre"><div data-lang="Sql" class="marker"></div><pre><span class="token comment">-- _ 单字符匹配</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> prodcuts <span class="token keyword">WHERE</span> prod_name <span class="token operator">LIKE</span> <span class="token string">'_程思想'</span><span class="token punctuation">;</span>
<span class="token comment">-- % 任何字符出现任意次数</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> prodcuts <span class="token keyword">WHERE</span> prod_name <span class="token operator">LIKE</span> <span class="token string">'%思想'</span><span class="token punctuation">;</span>
<span class="token comment">-- 正则表达式</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> prodcuts <span class="token keyword">WHERE</span> prod_name <span class="token operator">REGEXP</span> <span class="token string">'%编程思想'</span><span class="token punctuation">;</span></pre></div></code-block><h3 class="wolai-block"><span class="inline-wrap">限制结果集行数</span></h3><code-block class="wolai-block"><div class="wolai-pre"><div data-lang="Sql" class="marker"></div><pre><span class="token comment">-- MySQL提供 LIMIT 关键字实现限制返回行数</span>
<span class="token keyword">SELECT</span> prod_name <span class="token keyword">FROM</span> products <span class="token keyword">LIMIT</span> <span class="token number">4</span><span class="token punctuation">;</span>
<span class="token keyword">SELECT</span> prod_name <span class="token keyword">FROM</span> products <span class="token keyword">LIMIT</span> <span class="token number">4</span> <span class="token keyword">OFFSET</span> <span class="token number">3</span><span class="token punctuation">;</span> <span class="token comment">-- 取4行数据，从索引为3开始</span>
<span class="token keyword">SELECT</span> prod_name <span class="token keyword">FROM</span> products <span class="token keyword">LIMIT</span> <span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">;</span>  <span class="token comment">-- 取4行数据，从索引为3开始</span>

<span class="token comment">-- Oracle为每个结果集都增加了一个默认的表示行号的列，这个列的名称是rownumber</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> <span class="token keyword">user</span> <span class="token keyword">WHERE</span> rownumber <span class="token operator">&lt;=</span> <span class="token number">6</span><span class="token punctuation">;</span>

<span class="token comment">-- 对于其它数据库，使用窗口函数ROW_NUMBER()</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> 
<span class="token punctuation">(</span>
    <span class="token keyword">select</span> 
    row_number<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">over</span><span class="token punctuation">(</span><span class="token keyword">order</span> <span class="token keyword">by</span> <span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token boolean">null</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">as</span> rownumber <span class="token punctuation">,</span> <span class="token operator">*</span>   
    <span class="token keyword">from</span> <span class="token keyword">user</span>
<span class="token punctuation">)</span> t
<span class="token keyword">where</span> t<span class="token punctuation">.</span>rownumber <span class="token operator">&lt;=</span> <span class="token number">6</span><span class="token punctuation">;</span></pre></div></code-block><h2 class="wolai-block"><span class="inline-wrap">多表检索</span></h2><h3 class="wolai-block"><span class="inline-wrap">1.使用连接实现多表检索</span></h3><div class="wolai-block wolai-text"><div><span class="inline-wrap"><b>内连接</b></span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">一个表的的所有行与另一个表的所有行，排列组合。</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">我们可以通过<span class="jill"></span>ON<span class="jill"></span>子句来添加排列组合的规则,从而减少排列组合的结果数</span></div></div><code-block class="wolai-block"><div class="wolai-pre"><div data-lang="Sql" class="marker"></div><pre><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> t1 <span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> t2 <span class="token keyword">ON</span> t1<span class="token punctuation">.</span>i1 <span class="token operator">=</span> t2<span class="token punctuation">.</span>i2</pre></div></code-block><div class="wolai-block wolai-text"><div><span class="inline-wrap"><b>左（外）连接和右（外）连接</b></span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">内连接只会显示在连接表里都匹配上的行。外连接除了显示同样的结果，还可以把其中一个表在另一个表没有匹配的行也显示出来。左连接就是把左表里没有匹配的内容也显示出来。</span></div></div><code-block class="wolai-block"><div class="wolai-pre"><div data-lang="Sql" class="marker"></div><pre><span class="token keyword">SELECT</span> <span class="token operator">*</span>
<span class="token keyword">FROM</span> t1
       <span class="token keyword">LEFT</span> <span class="token keyword">JOIN</span> t2 <span class="token keyword">on</span> t1<span class="token punctuation">.</span>i1 <span class="token operator">=</span> t2<span class="token punctuation">.</span>i2
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> t1<span class="token punctuation">.</span>i1 <span class="token keyword">ASC</span><span class="token punctuation">;</span></pre></div></code-block><div class="wolai-block wolai-center"><figure style="width: 100%"><img src="media/sql-join.jpg" style="width: 760px"/></figure></div><div class="wolai-block wolai-text"><div><span class="inline-wrap"><b>MySQL<span class="jill"></span>不支持<span class="jill"></span>OUTER JOIN，但是我们可以对左连接和右连接的结果做<span class="jill"></span>UNION<span class="jill"></span>操作来实现</b></span></div></div><h3 class="wolai-block"><span class="inline-wrap">2.使用子查询实现多表检索</span></h3><div class="wolai-block wolai-text"><div><span class="inline-wrap">子查询：用括号括起来，并嵌入另一条语句里的<span class="jill"></span>SELECT<span class="jill"></span>语句。</span></div></div><code-block class="wolai-block"><div class="wolai-pre"><div data-lang="Sql" class="marker"></div><pre><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> socre <span class="token keyword">WHERE</span> event_id <span class="token operator">IN</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> event_id <span class="token keyword">FROM</span> grade_event <span class="token keyword">WHERE</span> category <span class="token operator">=</span> <span class="token string">'T'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></div></code-block><div class="wolai-block wolai-text"><div><span class="inline-wrap">子查询可以返回各种不同类型的信息</span></div></div><ul class="wolai-block"><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">标量子查询：返回一个值</span></li><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">列子查询：返回一个由一个值或多个值构成的列</span></li><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">行子查询：返回一个由一个值或多个值构成的行</span></li><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">表子查询：返回一个由一个行或多个行组成的表</span></li></ul><div class="wolai-block wolai-text"><div><span class="inline-wrap"><b>IN 和 NOT IN 子查询</b></span></div></div><code-block class="wolai-block"><div class="wolai-pre"><div data-lang="Sql" class="marker"></div><pre><span class="token comment"># 查询逃课学生</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> student <span class="token keyword">WHERE</span> student_id <span class="token operator">IN</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> student_id <span class="token keyword">FROM</span> absence<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment"># 查询全勤学生</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> student <span class="token keyword">WHERE</span> student_id <span class="token operator">NOT</span> <span class="token operator">IN</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> student_id <span class="token keyword">FROM</span> absence<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></div></code-block><div class="wolai-block wolai-text"><div><span class="inline-wrap"><b>ALL、ANY<span class="jill"></span>和<span class="jill"></span>SOME<span class="jill"></span>子查询</b></span></div></div><code-block class="wolai-block"><div class="wolai-pre"><div data-lang="Sql" class="marker"></div><pre><span class="token comment"># 外查询找出比子查询的到的生日都要小的生日</span>
<span class="token keyword">SELECT</span> last_name <span class="token punctuation">,</span>first_name birth FORM persident <span class="token keyword">WHERE</span> birth <span class="token operator">&lt;=</span> <span class="token keyword">ALL</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> birth <span class="token keyword">FROM</span> president<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> last_name <span class="token punctuation">,</span>first_name birth FORM persident <span class="token keyword">WHERE</span> birth <span class="token operator">&lt;=</span> <span class="token keyword">ANY</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> birth <span class="token keyword">FROM</span> president<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> last_name <span class="token punctuation">,</span>first_name <span class="token punctuation">,</span> state <span class="token punctuation">,</span> city FORM persident <span class="token keyword">WHERE</span> <span class="token punctuation">(</span>state<span class="token punctuation">,</span>city<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token keyword">ANY</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> state <span class="token punctuation">,</span> city FORM persident <span class="token keyword">WHERE</span> last_name <span class="token operator">=</span> <span class="token string">'Roosevelt'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></div></code-block><div class="wolai-block wolai-text"><div><span class="inline-wrap"><b>EXISTS 和 NOT EXISTS 子查询</b></span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">这两个运算符只会测试某个子查询是否返回了行。如果有返回，EXISTS<span class="jill"></span>结果为真。</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap"><b>FORM<span class="jill"></span>子句里的子查询</b></span></div></div><code-block class="wolai-block"><div class="wolai-pre"><div data-lang="Sql" class="marker"></div><pre><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> <span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> t1 <span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> <span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> t2<span class="token punctuation">;</span></pre></div></code-block><h3 class="wolai-block"><span class="inline-wrap">3.使用<span class="jill"></span>UNION<span class="jill"></span>实现多表检索</span></h3><div class="wolai-block wolai-text"><div><span class="inline-wrap">如果想把多个查询的结果合并成一个结果集，那么需要使用</span><span class="inline-wrap"><code>UNION</code></span><span class="inline-wrap">语句。</span></div></div><code-block class="wolai-block"><div class="wolai-pre"><div data-lang="Sql" class="marker"></div><pre><span class="token keyword">SELECT</span> i <span class="token keyword">FROM</span> t1 <span class="token keyword">UNION</span> <span class="token keyword">SELECT</span> j <span class="token keyword">FROM</span> t2 <span class="token keyword">UNION</span>  <span class="token keyword">SELECT</span> k <span class="token keyword">FROM</span> t3<span class="token punctuation">;</span></pre></div></code-block><div class="wolai-block wolai-text"><div><span class="inline-wrap"><b>UNION<span class="jill"></span>的特性</b></span></div></div><ul class="wolai-block"><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">列名和数据类型</span><span class="inline-wrap">
</span><span class="inline-wrap"><code>UNION</code></span><span class="inline-wrap">结果集里的列名来自第一个<span class="jill"></span>SELECT<span class="jill"></span>里的列名。UNION<span class="jill"></span>选取的列数，必须跟第一个<span class="jill"></span>SELECT<span class="jill"></span>选取的列数相同。各列不需要名字相同，甚至数据结构也不需要相同，MySQL<span class="jill"></span>会进行必要的类型转换。</span></li><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">重复行处理</span><span class="inline-wrap">
</span><span class="inline-wrap">默认情况下，UNION<span class="jill"></span>会将结果集里的重复行剔除掉</span><span class="inline-wrap">
</span><span class="inline-wrap"><b>如果想保留重复的行，则需要把<span class="jill"></span>UNION 改为 UNION ALL</b></span></li><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">ORDER BY 和 LIMIT<span class="jill"></span>处理</span><span class="inline-wrap">
</span><span class="inline-wrap">如果想对<span class="jill"></span>UNION<span class="jill"></span>结果作为一个整体进行排序，那么需要用括号把每个<span class="jill"></span>SELECT<span class="jill"></span>语句括起来，并在最后加上<span class="jill"></span>ORDER BY<span class="jill"></span>子句。ORDER BY<span class="jill"></span>子句必须引用第一个<span class="jill"></span>SELECT<span class="jill"></span>语句选中的列名。</span><code-block class="wolai-block"><div class="wolai-pre"><div data-lang="Sql" class="marker"></div><pre><span class="token punctuation">(</span><span class="token keyword">SELECT</span> i <span class="token keyword">FROM</span> t1<span class="token punctuation">)</span> <span class="token keyword">UNION</span> <span class="token keyword">ALL</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> j <span class="token keyword">FROM</span> t2<span class="token punctuation">)</span> <span class="token keyword">UNION</span> <span class="token keyword">ALL</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> k <span class="token keyword">FROM</span> t3<span class="token punctuation">)</span> 
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> i<span class="token punctuation">;</span></pre></div></code-block></li></ul><h2 class="wolai-block"><span class="inline-wrap">函数</span></h2><h3 class="wolai-block"><span class="inline-wrap">字符串函数</span></h3><code-block class="wolai-block"><div class="wolai-pre"><div data-lang="Sql" class="marker"></div><pre><span class="token comment">-- 字符串长度</span>
LENGTH<span class="token punctuation">(</span>field<span class="token punctuation">)</span> <span class="token comment">-- MySQL Oracle</span>
<span class="token comment">-- 大小写转换</span>
LOWER<span class="token punctuation">(</span>field<span class="token punctuation">)</span> <span class="token comment">-- MySQL Oracle</span>
UPPER<span class="token punctuation">(</span>field<span class="token punctuation">)</span> <span class="token comment">-- MySQL Oracle</span>
<span class="token comment">-- Trim</span>
LTRIM<span class="token punctuation">(</span>field<span class="token punctuation">)</span> <span class="token comment">-- MySQL Oracle</span>
RTRIM<span class="token punctuation">(</span>field<span class="token punctuation">)</span><span class="token comment">-- MySQL Oracle</span>
TRIM<span class="token punctuation">(</span>field<span class="token punctuation">)</span><span class="token comment">--MySQL Oracle</span></pre></div></code-block><h3 class="wolai-block"><span class="inline-wrap">时间日期函数</span></h3><h3 class="wolai-block"><span class="inline-wrap">数学函数</span></h3><h3 class="wolai-block"><span class="inline-wrap">高级函数</span></h3><h3 class="wolai-block"><span class="inline-wrap">Over<span class="jill"></span>函数</span></h3><div class="wolai-block wolai-text"><div><span class="inline-wrap">利用<span class="jill"></span>over<span class="jill"></span>函数我们可以对多行数据进行处理（分组和排序）</span></div></div><code-block class="wolai-block"><div class="wolai-pre"><div data-lang="Sql" class="marker"></div><pre><span class="token comment">-- over函数不能单独使用，需要配合窗口函数使用</span>
<span class="token comment">-- 窗口函数有：排名函数、聚合函数、分析函数、NEXT VALUE FOR函数</span>
<span class="token keyword">over</span> <span class="token punctuation">(</span> <span class="token operator">&lt;</span><span class="token keyword">partition</span> <span class="token keyword">by</span> clause<span class="token operator">></span>  <span class="token operator">&lt;</span><span class="token keyword">order</span> <span class="token keyword">by</span> clause<span class="token operator">></span> <span class="token operator">&lt;</span><span class="token keyword">ROW</span> <span class="token operator">or</span> RANGE clause <span class="token operator">></span> <span class="token punctuation">)</span>
<span class="token comment">-- partition by 对数据进行分组 </span>
<span class="token comment">-- order by 对分组后的数据进行排序, 对于排名聚合函数，order by是必须的</span>
<span class="token comment">-- 窗口框架：框架是对窗口进行进一步的分区，框架有两种范围限定方式：一种是使用ROWS子句，通过指定当前行之前或之后的固定数目的行来限制分区中的行数，另一种是RANGE子句，按照排序列的当前值，根据相同值来确定分区中的行数。</span></pre></div></code-block><h3 class="wolai-block"><span class="inline-wrap">排名函数</span></h3><div class="wolai-block wolai-text"><div><span class="inline-wrap">排名函数：Ranking Functions</span></div></div><ul class="wolai-block"><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>row_number()</code></span><span class="inline-wrap">: 对<span class="jill"></span>over<span class="jill"></span>后查询出来的每一行记录生成一个序号</span></li><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>rank()</code></span><span class="inline-wrap">：排名，排名相同时会跳号</span></li><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>dense_rank()</code></span><span class="inline-wrap">：排名，排名相同时不会跳号</span></li><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>ntile()</code></span></li></ul><div class="wolai-block wolai-text"><div></div></div></article><footer></footer></body></html>